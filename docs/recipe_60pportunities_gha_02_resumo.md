Environments: o que são e como configurá-los
O que que são esses Environments?
E nós comentamos a questão de ambiente, de desenvolvimento, de homologação e produção?
Basicamente, os Environments são esses ambientes de Deployment no GitHub actions para que nós tenhamos ali uma configuração mais segregada por ambiente.
Como é que você gerencia isso dentro do GitHub Actions? É usando justamente essa questão dos Environments.
Nós não conseguimos ter variáveis e segredos para esse ambiente, exclusivamente.
Então nós poderíamos sim, teoricamente, usar isso sem ser num ambiente, mas no ambiente nós conseguimos separar um pouco melhor as coisas.
Então como é que eu crio esse ambiente para poder usar aqui? Primeiro eu vou vir aqui na parte de configurações do meu repositório e aí, nessa barra lateral, eu vou procurar por "Environments", que está aqui.
E aqui ele me diz que esse repositório não tem nenhum Environment configurado, ok? Então vou vir aqui em "New Environment".
E aqui eu vou dar o nome de "desenvolvimento". Vou configurar esse Environment e aqui nós temos algumas regras que nós podemos configurar aqui dentro para esse processo. A primeira delas é ter revisores obrigatórios aqui. E aí você pode ter aqui até seis revisores. Você pode configurar grupos e times da sua organização. Isso é importante para quê? Para que um processo de implantação, por exemplo, em produção, não entre de forma automática e sem ninguém saber, porque em vários dos casos, na maioria deles, nós não temos ambientes maduros o suficiente para esses deployment acontecerem de forma transparente nos ambientes. Em vários casos até temos, tá? Já passei por vários clientes onde nós temos deployments que acontecem automaticamente em todos os ambientes, mas na grande maioria dos casos, nós precisamos de algum processo de aprovação. E é aqui que você configura quem vai aprovar, tá? Aqui eu estou configurando eu mesmo, porque, bom, só tem eu mesmo nessa minha conta e é só para o nosso teste. Mas o ideal é que seja uma pessoa diferente, tanto que temos essa segunda configuração aqui, que é para prevenir a auto-revisão, que é o que eu vou fazer no caso, mas em um ambiente produtivo não deveria, porque isso me permitiria criar alterações e colocar alterações nos ambientes meio que sem ninguém saber. E isso não seria o mundo ideal na grande maioria dos casos. Então você marca aqui o Prevent self-review, que eu vou deixar desmarcado por motivos óbvios, senão eu não vou conseguir executar aqui com vocês. Mas no mundo de vocês muito provavelmente isso aqui vai estar marcado. Outra coisa que nós temos aqui é um tempo de aguardo. Para que que serve isso? Para que você... O seu processo de deployment aqui no ambiente, ele aguarde alguns instantes antes de iniciar. Então eu aprovei aqui o deploy em produção, mas eu não quero que ele execute imediatamente. Eu quero que ele execute só daqui a 15 minutos, daqui a 20 minutos após a minha aprovação, porque eu tenho uma janela ali no meu ambiente. Enfim, é aqui que você configura isso. Você configura quanto tempo isso deve ser aguardado antes de ser executado no ambiente. Outra coisa bem importante que nós temos aqui é: administradores podem bypassar esta regra, ou seja, administradores podem ignorar essa regra aqui de cima. Eu vou salvar ela aqui já para gente não esquecer. Salvamos. Então agora que eu tenho meu usuário como aprovador. Deixa eu desmarcar o wait timer aqui, que eu não quero que ele aguarde também não. Isso aqui está desabilitado, ok? Outra coisa que nós temos aqui é o deployment de branches e tags, tá? Para quê que serve isso? Isso aqui serve para poder restringir quais branches vão executar nesse ambiente. Então, imagina, o que eu quero é que o deployment para desenvolvimento ocorra apenas se tiver sido feito um Commit, um merge, um co-request para branch de develop ou desenvolvimento. É aqui que eu configuro isso. Desse jeito que tá, eu posso executar isso a partir de qualquer branch, mas para nossa demonstração isso funciona muito bem. Ok? Então volto aqui para o meu script. Como é que eu configuro agora para usar este ambiente que nós acabamos de criar? Para isso eu vou vir aqui e vou criar uma nova chave chamada environment. E aqui eu vou criar uma chave "name", onde eu vou dizer qual é o nome desse nosso ambiente que a gente acabou de criar. "Desenvolvimento". Está escrito certo? Está escrito certo. E aí eu vou fazer o Commit dessas alterações. E vamos dar lá uma olhada nas actions. Como é que essa execução vai funcionar agora? Então eu vou vir aqui, executar o meu workflow. Vamos abrir aqui a tela do workflow e, assim como nós já vimos antes, o processo de build vai ser executado, logo em seguida vai cair o processo de deployment de dev, onde provavelmente vai pedir a minha revisão. E é exatamente isso que aconteceu. O processo aqui, ó, ele está pausado porque ele precisa que eu faça a revisão disso em desenvolvimento e aqui embaixo nós, inclusive, conseguimos ver aqui, ó, que tem a Protection Rule, que o meu usuário foi requisitado como revisor no ambiente de desenvolvimento. Então eu posso vir aqui, revisar esta alteração, marca a caixinha de desenvolvimento e deixo um comentário aqui. "Aprovado para deploy". E aí eu faço isso, aprovo e faço o deploy. E aí, agora sim, esse processo vai ser executado, como nós já estávamos esperando, fazendo essa implantação dentro do ambiente de desenvolvimento. Beleza?
