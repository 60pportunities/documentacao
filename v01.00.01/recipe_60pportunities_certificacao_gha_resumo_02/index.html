<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Documentação 60pportunities" name=description><meta content="Horacio Vasconcellos" name=author><link href=https://60pportunities.com.br/v01.00.01/recipe_60pportunities_certificacao_gha_resumo_02/ rel=canonical><link href=../recipe_60pportunities_certificacao_gha_resumo_01/ rel=prev><link href=../recipe_60pportunities_certificacao_depc/ rel=next><link href=../img/favicon.ico rel=icon><meta content="mkdocs-1.6.1, mkdocs-material-9.6.11" name=generator><title>GitHub Actions 02 - 60portunities</title><link href=../assets/stylesheets/main.4af4bdda.min.css rel=stylesheet><link href=../assets/stylesheets/palette.06af60db.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href=../css/timeago.css rel=stylesheet><link href=../styles/app-theme.css rel=stylesheet><link href=https://unpkg.com/mermaid@8.5.1/dist/mermaid.css rel=stylesheet><link href=../styles/tablesort.css rel=stylesheet><link href=../styles/60pthemas.css rel=stylesheet><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-horacio"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-horacio",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-horacio",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script><link href=../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../assets/javascripts/glightbox.min.js></script></head> <body data-md-color-accent=purple data-md-color-primary=deep-purple data-md-color-scheme=default dir=ltr> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#temporalidade> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label=60portunities class="md-header__button md-logo" data-md-component=logo href=.. title=60portunities> <img alt=logo src=../img/logo.jpeg> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 60portunities </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> GitHub Actions 02 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Azul da cor do mar" class=md-option data-md-color-accent=purple data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary=deep-purple data-md-color-scheme=default id=__palette_0 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Azul da cor do mar"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg> </label> <input aria-label="Rock and Roll" class=md-option data-md-color-accent=deep-purple data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary=red data-md-color-scheme=default id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_0 hidden title="Rock and Roll"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <a aria-label=Share class="md-search__icon md-icon" data-clipboard data-clipboard-text data-md-component=search-share href=javascript:void(0) tabindex=-1 title=Share> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg> </a> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 title=Clear type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix tabindex=0> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a class=md-source data-md-component=source href=https://github.com/60pportunities/ title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg> </div> <div class=md-source__repository> documentacao </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label=60portunities class="md-nav__button md-logo" data-md-component=logo href=.. title=60portunities> <img alt=logo src=../img/logo.jpeg> </a> 60portunities </label> <div class=md-nav__source> <a class=md-source data-md-component=source href=https://github.com/60pportunities/ title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg> </div> <div class=md-source__repository> documentacao </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_1 type=checkbox> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> <span class=md-ellipsis> Inicio </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_1_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Inicio </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../LICENSE/ class=md-nav__link> <span class=md-ellipsis> Licença </span> </a> </li> <li class=md-nav__item> <a href=../CHANGELOG/ class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> <li class=md-nav__item> <a href=../CONTRIBUTING/ class=md-nav__link> <span class=md-ellipsis> Contribuições </span> </a> </li> <li class=md-nav__item> <a href=../CODE_OF_CONDUCT/ class=md-nav__link> <span class=md-ellipsis> Codigo de Conduta </span> </a> </li> <li class=md-nav__item> <a href=../notas/ class=md-nav__link> <span class=md-ellipsis> Notas </span> </a> </li> <li class=md-nav__item> <a href=../politicas/ class=md-nav__link> <span class=md-ellipsis> Políticas </span> </a> </li> <li class=md-nav__item> <a href=../SECURITY/ class=md-nav__link> <span class=md-ellipsis> Segurança </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2 type=checkbox> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Padrões Tecnológicos </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Padrões Tecnológicos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../recipe_60pportunities_engenharia_sw/ class=md-nav__link> <span class=md-ellipsis> Engenharia de Software </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_microservices_com_databases/ class=md-nav__link> <span class=md-ellipsis> Microservices with Databases </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3 type=checkbox> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Felicidade do imperfeito </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Felicidade do imperfeito </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../recipe_60pportunities_felicidade_001/ class=md-nav__link> <span class=md-ellipsis> Aprender, desaprender e reaprender </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_felicidade_002/ class=md-nav__link> <span class=md-ellipsis> Entender </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_felicidade_003/ class=md-nav__link> <span class=md-ellipsis> Tecnologia </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_dev_hacker_etico/ class=md-nav__link> <span class=md-ellipsis> IPLog </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4 type=checkbox> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Registro </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Registro </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../recipe_60pportunities_registro_001/ class=md-nav__link> <span class=md-ellipsis> Domínio </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_registro_002/ class=md-nav__link> <span class=md-ellipsis> Conta no GitHub </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_registro_004/ class=md-nav__link> <span class=md-ellipsis> Pages </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_registro_005/ class=md-nav__link> <span class=md-ellipsis> Pages no Domínio </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_5 type=checkbox> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Livro </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_5_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Livro </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_000/ class=md-nav__link> <span class=md-ellipsis> Introdução </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_001/ class=md-nav__link> <span class=md-ellipsis> Crise do Software (1960-1979) </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_002/ class=md-nav__link> <span class=md-ellipsis> Abertura Política (1980-1989) </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_003/ class=md-nav__link> <span class=md-ellipsis> Globalização e capitalismo (1990-1999) </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_004/ class=md-nav__link> <span class=md-ellipsis> Democratização da tecnologia (2000-2008) </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_005/ class=md-nav__link> <span class=md-ellipsis> Grande Depressão (2009-2015) </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_006/ class=md-nav__link> <span class=md-ellipsis> Década Perdida (2016-2020) </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_007/ class=md-nav__link> <span class=md-ellipsis> Avanço da vacinação (2021-2025) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_6 type=checkbox> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Software Development Lifecycle </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_6_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Software Development Lifecycle </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_sdlc_local_001/ class=md-nav__link> <span class=md-ellipsis> Definições </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_sdlc_local_002/ class=md-nav__link> <span class=md-ellipsis> Pastas </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_sdlc_local_003/ class=md-nav__link> <span class=md-ellipsis> Decisões </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_sdlc_local_004/ class=md-nav__link> <span class=md-ellipsis> Ferramentas </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_011/ class=md-nav__link> <span class=md-ellipsis> Padronizaçao de Escrita </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_011_01/ class=md-nav__link> <span class=md-ellipsis> Dívida Técnica </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_009/ class=md-nav__link> <span class=md-ellipsis> Documentação é Código </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_6_8 type=checkbox> <label class=md-nav__link for=__nav_6_8 id=__nav_6_8_label tabindex=0> <span class=md-ellipsis> Versionamento </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_6_8_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_6_8> <span class="md-nav__icon md-icon"></span> Versionamento </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_008/ class=md-nav__link> <span class=md-ellipsis> Conceitos e Histórico </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_008_01/ class=md-nav__link> <span class=md-ellipsis> Estrutura do Repositório </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_008_02/ class=md-nav__link> <span class=md-ellipsis> Resolvendo Problemas </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_008_03/ class=md-nav__link> <span class=md-ellipsis> Hooks Necessárias </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_sdlc_local_005/ class=md-nav__link> <span class=md-ellipsis> Estruturação da Aplicação </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_sdlc_local_006/ class=md-nav__link> <span class=md-ellipsis> Montagem de Time </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_020_01/ class=md-nav__link> <span class=md-ellipsis> Planejamento </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_020_07/ class=md-nav__link> <span class=md-ellipsis> Escrita de Código </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_020_02/ class=md-nav__link> <span class=md-ellipsis> Feature Flag </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_020_03/ class=md-nav__link> <span class=md-ellipsis> Segurança </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_020_04/ class=md-nav__link> <span class=md-ellipsis> DevOps </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_020_05/ class=md-nav__link> <span class=md-ellipsis> Fluxo </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_020_06/ class=md-nav__link> <span class=md-ellipsis> Secret-Scan </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_020_09/ class=md-nav__link> <span class=md-ellipsis> Trabalhe Pequeno </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_020_10/ class=md-nav__link> <span class=md-ellipsis> Pull Request </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_020_11/ class=md-nav__link> <span class=md-ellipsis> Arquitetura Sw </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_020_12/ class=md-nav__link> <span class=md-ellipsis> Bit rot </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_020_13/ class=md-nav__link> <span class=md-ellipsis> Estimativas </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_099/ class=md-nav__link> <span class=md-ellipsis> Leis da TI </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_010/ class=md-nav__link> <span class=md-ellipsis> Modelagem de Dados </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_012/ class=md-nav__link> <span class=md-ellipsis> O funil de Teste </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_013/ class=md-nav__link> <span class=md-ellipsis> Vamos dar uma espiada (Observabilidade) </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_014/ class=md-nav__link> <span class=md-ellipsis> Inteligência Artificial no Desenvolvimento de Software </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_018/ class=md-nav__link> <span class=md-ellipsis> Estimativa </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_015/ class=md-nav__link> <span class=md-ellipsis> Metas e Métricas: A Importância de Medir </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_016/ class=md-nav__link> <span class=md-ellipsis> IA Verticais </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_livro_cap_conclusao/ class=md-nav__link> <span class=md-ellipsis> Engenharia de Software </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_7 type=checkbox> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Publicações </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_7_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Publicações </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../recipe_60pportunities_publicacao_001/ class=md-nav__link> <span class=md-ellipsis> 31-jan-2025 - LinkedIn </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" id=__nav_8 type=checkbox> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Certificação Estudo </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=true aria-labelledby=__nav_8_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Certificação Estudo </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../recipe_60pportunities_certificacao_gha_resumo_01/ class=md-nav__link> <span class=md-ellipsis> GitHub Actions 01 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> GitHub Actions 02 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> GitHub Actions 02 </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#temporalidade> <span class=md-ellipsis> Temporalidade </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#limitacoes> <span class=md-ellipsis> Limitações </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#locais-especiais> <span class=md-ellipsis> Locais Especiais </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#git> <span class=md-ellipsis> Git </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#github> <span class=md-ellipsis> GitHub </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#github-actions> <span class=md-ellipsis> GitHub Actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#seu-primeiro-fluxo-de-trabalho> <span class=md-ellipsis> Seu primeiro fluxo de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#criando-uma-conta-github> <span class=md-ellipsis> Criando uma conta GitHub </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#criacao-do-repositorio> <span class=md-ellipsis> Criação do repositório </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#fork-do-repositorio> <span class=md-ellipsis> Fork do repositório </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#criando-um-fluxo-de-trabalho> <span class=md-ellipsis> Criando um fluxo de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#escolha-um-modelo-de-fluxo-de-trabalho> <span class=md-ellipsis> Escolha um modelo de fluxo de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#implantacao> <span class=md-ellipsis> Implantação </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#analisando-os-resultados> <span class=md-ellipsis> Analisando os resultados </span> </a> <nav aria-label="Analisando os resultados" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#resultados> <span class=md-ellipsis> Resultados </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#algumas-observacoes-sobre-yaml> <span class=md-ellipsis> Algumas observações sobre YAML </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#triggers> <span class=md-ellipsis> Triggers </span> </a> <nav aria-label=Triggers class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#gatilhos-automaticos> <span class=md-ellipsis> Gatilhos automáticos </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#filtros> <span class=md-ellipsis> Filtros </span> </a> <nav aria-label=Filtros class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#filtros-por-branch> <span class=md-ellipsis> Filtros por branch </span> </a> <nav aria-label="Filtros por branch" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#aviso> <span class=md-ellipsis> Aviso </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#os-filtros-por-caminho> <span class=md-ellipsis> Os filtros por caminho </span> </a> <nav aria-label="Os filtros por caminho" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#aviso_1> <span class=md-ellipsis> Aviso </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#scheduled-trigger> <span class=md-ellipsis> Scheduled trigger </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#manual-triggering> <span class=md-ellipsis> Manual triggering </span> </a> <nav aria-label="Manual triggering" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#disparar-manualmente-com-parametros> <span class=md-ellipsis> Disparar manualmente com parâmetros </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#desabilitarignorar-gatilhos-temporariamente> <span class=md-ellipsis> Desabilitar/ignorar gatilhos temporariamente </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#desativar-um-fluxo-de-trabalho> <span class=md-ellipsis> Desativar um fluxo de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicios> <span class=md-ellipsis> Exercícios </span> </a> <nav aria-label=Exercícios class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n1> <span class=md-ellipsis> Exercício n°1 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercise-n2> <span class=md-ellipsis> Exercise n°2 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n3> <span class=md-ellipsis> Exercício n°3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#jobs> <span class=md-ellipsis> Jobs </span> </a> <nav aria-label=Jobs class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#job-em-execucao> <span class=md-ellipsis> Job em Execução </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#jobs-em-conteiner> <span class=md-ellipsis> Jobs em contêiner </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#servicos-em-execucao> <span class=md-ellipsis> Serviços em execução </span> </a> <nav aria-label="Serviços em execução" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#diferencas> <span class=md-ellipsis> Diferenças </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#beneficios-dos-servicos> <span class=md-ellipsis> Benefícios dos serviços </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#dependencias-entre-seus-trabalhos> <span class=md-ellipsis> Dependências entre seus trabalhos </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#operator-description> <span class=md-ellipsis> Operator Description </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#status-check-functions> <span class=md-ellipsis> Status check functions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#gerenciamento-de-cache> <span class=md-ellipsis> Gerenciamento de cache </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#gerenciamento-de-artefatos> <span class=md-ellipsis> Gerenciamento de Artefatos </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#como-jobs-funcionam> <span class=md-ellipsis> Como Jobs funcionam </span> </a> <nav aria-label="Como Jobs funcionam" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#configuracoes-especificas-do-ambiente> <span class=md-ellipsis> Configurações específicas do ambiente </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#matrix-strategy> <span class=md-ellipsis> Matrix strategy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#estruturacao-de-fluxo-de-trabalho> <span class=md-ellipsis> Estruturação de Fluxo de Trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#steps> <span class=md-ellipsis> Steps </span> </a> <nav aria-label=Steps class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#propriedades-do-steps> <span class=md-ellipsis> Propriedades do Steps </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#executar-um-comando> <span class=md-ellipsis> Executar um comando </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#fluxos-de-trabalho-reutilizaveis> <span class=md-ellipsis> Fluxos de trabalho reutilizáveis </span> </a> <nav aria-label="Fluxos de trabalho reutilizáveis" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#limitacoes-dos-fluxos-de-trabalho-reutilizaveis> <span class=md-ellipsis> Limitações dos fluxos de trabalho reutilizáveis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#understanding-composite-actions> <span class=md-ellipsis> Understanding composite actions </span> </a> <nav aria-label="Understanding composite actions" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#limitacoes-dos-composite-actions> <span class=md-ellipsis> Limitações dos composite actions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#criando-uma-acao-composta-local> <span class=md-ellipsis> Criando uma ação composta local </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#execucao-de-uma-acao> <span class=md-ellipsis> Execução de uma Ação </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#execution-within-a-container> <span class=md-ellipsis> Execution within a container </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#descubra-novas-acoes> <span class=md-ellipsis> Descubra novas Ações </span> </a> <nav aria-label="Descubra novas Ações" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#o-editor-de-fluxo-de-trabalho> <span class=md-ellipsis> O editor de fluxo de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#editor-de-fluxo-de-trabalho> <span class=md-ellipsis> Editor de fluxo de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#gerenciamento-de-cache_1> <span class=md-ellipsis> Gerenciamento de cache </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#gestao-de-artefatos> <span class=md-ellipsis> Gestão de Artefatos </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#as-matrizes> <span class=md-ellipsis> As matrizes </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#execution-of-the-matrix> <span class=md-ellipsis> Execution of the matrix </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exclusions> <span class=md-ellipsis> Exclusions </span> </a> <nav aria-label=Exclusions class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#inclusions> <span class=md-ellipsis> Inclusions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-concept-of-fail-fast> <span class=md-ellipsis> The concept of fail-fast </span> </a> <nav aria-label="The concept of fail-fast" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#exercicios_1> <span class=md-ellipsis> Exercícios </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n1_1> <span class=md-ellipsis> Exercício n°1 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercise-n2_1> <span class=md-ellipsis> Exercise n°2 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercise-n3> <span class=md-ellipsis> Exercise n°3 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#tecnicas-de-depuracao-para-fluxos-de-trabalho> <span class=md-ellipsis> Técnicas de depuração para fluxos de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#visual-studio-code-github-actions-plugin> <span class=md-ellipsis> Visual Studio Code GitHub Actions plugin </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#runners> <span class=md-ellipsis> Runners </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-it-works> <span class=md-ellipsis> How it works </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#pre-installed-tooling> <span class=md-ellipsis> Pre-installed tooling </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#network-considerations> <span class=md-ellipsis> Network considerations </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-self-hosted-runners> <span class=md-ellipsis> The self-hosted runners </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#adding-a-new-agent> <span class=md-ellipsis> Adding a new agent </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#acoes-adicionar-runner-auto-hospedado> <span class=md-ellipsis> Ações / Adicionar runner auto-hospedado </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#download-the-latest-runner-package> <span class=md-ellipsis> Download the latest runner package </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#runner-configuration> <span class=md-ellipsis> Runner configuration </span> </a> <nav aria-label="Runner configuration" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#executor-disponivel-e-ativo> <span class=md-ellipsis> Executor disponível e ativo </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-to-use-our-self-hosted-runner> <span class=md-ellipsis> How to use our self-hosted runner? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#network-access> <span class=md-ellipsis> Network access </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#differences-between-the-two-types-of-runners> <span class=md-ellipsis> Differences between the two types of runners </span> </a> <nav aria-label="Differences between the two types of runners" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#runners-managed-by-github> <span class=md-ellipsis> Runners managed by GitHub: </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#self-managed-runners-self-hosted> <span class=md-ellipsis> Self-managed runners (self-hosted): </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#runner-diagnostic-logging> <span class=md-ellipsis> Runner diagnostic logging </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#monitoramento-e-alerta-de-fluxo-de-trabalho> <span class=md-ellipsis> Monitoramento e alerta de fluxo de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#recursos-de-notificacao-do-github> <span class=md-ellipsis> Recursos de notificação do GitHub </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#integrando-acoes-do-github-com-o-slack> <span class=md-ellipsis> Integrando ações do GitHub com o Slack </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#como-solicitar-permissoes-diferentes> <span class=md-ellipsis> Como solicitar permissões diferentes </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#criando-um-aplicativo-github> <span class=md-ellipsis> Criando um aplicativo GitHub </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#utilizando-fluxos-de-trabalho-iniciais-em-sua-equipe> <span class=md-ellipsis> Utilizando fluxos de trabalho iniciais em sua equipe </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-variables> <span class=md-ellipsis> The variables </span> </a> <nav aria-label="The variables" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#declaration-of-a-variable> <span class=md-ellipsis> Declaration of a variable </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#dynamic-variables> <span class=md-ellipsis> Dynamic variables </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#scope-of-variables> <span class=md-ellipsis> Scope of variables </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#output-variables> <span class=md-ellipsis> Output variables </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-built-in-environment-variables> <span class=md-ellipsis> The built-in environment variables </span> </a> <nav aria-label="The built-in environment variables" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#protect-the-content-of-variables-with-masks> <span class=md-ellipsis> Protect the content of variables with masks </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercises-variables> <span class=md-ellipsis> Exercises - variables </span> </a> <nav aria-label="Exercises - variables" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n1_2> <span class=md-ellipsis> Exercício n°1 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n2> <span class=md-ellipsis> Exercício n°2 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n3_1> <span class=md-ellipsis> Exercício n°3 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#os-segredos> <span class=md-ellipsis> Os segredos </span> </a> <nav aria-label="Os segredos" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#declaracao-de-um-segredo> <span class=md-ellipsis> Declaração de um segredo </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#os-limites-dos-segredos> <span class=md-ellipsis> Os limites dos segredos </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicios-segredos> <span class=md-ellipsis> Exercícios - Segredos </span> </a> <nav aria-label="Exercícios - Segredos" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n1_3> <span class=md-ellipsis> Exercício n°1 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n2_1> <span class=md-ellipsis> Exercício n°2 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n3_2> <span class=md-ellipsis> Exercício n°3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#variaveis-de-configuracao> <span class=md-ellipsis> Variáveis de configuração </span> </a> <nav aria-label="Variáveis de configuração" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#variaveis-de-configuracao_1> <span class=md-ellipsis> Variáveis de configuração </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-creation-of-multienvironment-workflows> <span class=md-ellipsis> The creation of multienvironment workflows </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#creating-an-environment> <span class=md-ellipsis> Creating an environment </span> </a> <nav aria-label="Creating an environment" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#protections-rules-screen> <span class=md-ellipsis> Protections rules screen </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#branch-filter> <span class=md-ellipsis> Branch filter </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#filtro-de-branch-desrespeitado> <span class=md-ellipsis> Filtro de branch desrespeitado </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#referenciando-um-ambiente> <span class=md-ellipsis> Referenciando um ambiente </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#manual-approval> <span class=md-ellipsis> Manual approval </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-use-of-custom-urls> <span class=md-ellipsis> The use of custom URLS </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicios_2> <span class=md-ellipsis> Exercícios </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n1_4> <span class=md-ellipsis> Exercício n°1 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n2_2> <span class=md-ellipsis> Exercício n°2 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#controle-de-fluxo> <span class=md-ellipsis> Controle de fluxo </span> </a> <nav aria-label="Controle de fluxo" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#defina-uma-condicionalidade-de-execucao> <span class=md-ellipsis> Defina uma condicionalidade de execução </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#ignore-execution-errors> <span class=md-ellipsis> Ignore execution errors </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#control-of-execution-time> <span class=md-ellipsis> Control of execution time </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#os-emblemas> <span class=md-ellipsis> Os emblemas </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configurando-um-emblema> <span class=md-ellipsis> Configurando um emblema </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#fluxos-de-trabalho-reutilizaveis_1> <span class=md-ellipsis> Fluxos de trabalho reutilizáveis </span> </a> <nav aria-label="Fluxos de trabalho reutilizáveis" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#como-funciona> <span class=md-ellipsis> Como funciona? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#access-to-reusable-workflows> <span class=md-ellipsis> Access to reusable workflows </span> </a> <nav aria-label="Access to reusable workflows" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#be-aware-of-some-limtations> <span class=md-ellipsis> Be aware of some limtations </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#create-your-own-custom-github-actions> <span class=md-ellipsis> Create your own custom GitHub Actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#create-your-first-action> <span class=md-ellipsis> Create your first Action </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-different-types-of-actions> <span class=md-ellipsis> The different types of Actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#pros-and-cons-what-to-choose> <span class=md-ellipsis> Pros and cons, what to choose? </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#creation-of-your-action> <span class=md-ellipsis> Creation of your Action </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#creating-the-manifest> <span class=md-ellipsis> Creating the manifest </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-business-logic-file> <span class=md-ellipsis> The business logic file </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#versioning> <span class=md-ellipsis> Versioning </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicios_3> <span class=md-ellipsis> Exercícios </span> </a> <nav aria-label=Exercícios class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n1_5> <span class=md-ellipsis> Exercício n°1 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n2_3> <span class=md-ellipsis> Exercício n°2 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n3_3> <span class=md-ellipsis> Exercício n°3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#publicar-no-marketplace> <span class=md-ellipsis> Publicar no Marketplace </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicios_4> <span class=md-ellipsis> Exercícios </span> </a> <nav aria-label=Exercícios class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n1_6> <span class=md-ellipsis> Exercício n°1 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n2_4> <span class=md-ellipsis> Exercício n°2 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n3_4> <span class=md-ellipsis> Exercício n°3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#estabelecimento-dos-pre-requisitos> <span class=md-ellipsis> Estabelecimento dos pré-requisitos </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-manifest-and-its-variables> <span class=md-ellipsis> The manifest and its variables </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-generation-of-the-changelog> <span class=md-ellipsis> The generation of the changelog </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-creation-of-a-release> <span class=md-ellipsis> The creation of a release </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-core-of-our-action> <span class=md-ellipsis> The core of our Action </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#typescript-compilation> <span class=md-ellipsis> TypeScript compilation </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#integration-with-a-workflow> <span class=md-ellipsis> Integration with a workflow </span> </a> <nav aria-label="Integration with a workflow" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#artefato-contendo-o-changelog> <span class=md-ellipsis> Artefato contendo o changelog </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#our-release-and-its-changelog> <span class=md-ellipsis> Our release and its changelog </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#create-a-docker-action> <span class=md-ellipsis> Create a docker Action </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-does-it-work> <span class=md-ellipsis> How does it work? </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#creating-a-pandoc-action> <span class=md-ellipsis> Creating a Pandoc Action </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-structure-of-a-docker-action> <span class=md-ellipsis> The structure of a Docker Action </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-to-optimize-docker-actions> <span class=md-ellipsis> How to optimize Docker Actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#create-composite-actions> <span class=md-ellipsis> Create composite Actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#github-script> <span class=md-ellipsis> GitHub Script </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#interact-on-other-repositories> <span class=md-ellipsis> Interact on other repositories </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#improve-the-user-experience-of-your-actions> <span class=md-ellipsis> Improve the user experience of your actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#improving-logs> <span class=md-ellipsis> Improving logs </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#annotations> <span class=md-ellipsis> Annotations </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#customizando-sumario-job> <span class=md-ellipsis> Customizando Sumário Job </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#job-summary> <span class=md-ellipsis> Job Summary </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#set-up-a-debug-mode> <span class=md-ellipsis> Set up a DEBUG mode </span> </a> <nav aria-label="Set up a DEBUG mode" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#activation-du-mode-debug> <span class=md-ellipsis> Activation du mode DEBUG </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#using-pre-and-post-scripts> <span class=md-ellipsis> Using Pre and Post Scripts </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#conditionality> <span class=md-ellipsis> Conditionality </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#conceitos-avancados> <span class=md-ellipsis> Conceitos avançados </span> </a> <nav aria-label="Conceitos avançados" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#artifact-management> <span class=md-ellipsis> Artifact management </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#artifacts-vs-packages> <span class=md-ellipsis> Artifacts vs. Packages </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#publication-of-an-artifact> <span class=md-ellipsis> Publication of an artifact </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#retention> <span class=md-ellipsis> Retention </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#downloading-an-artifact> <span class=md-ellipsis> Downloading an artifact </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#publication-of-a-release-element> <span class=md-ellipsis> Publication of a release element </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#publish-a-package> <span class=md-ellipsis> Publish a package </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#debugging-a-workflow> <span class=md-ellipsis> Debugging a workflow </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#logs-enriquecidos> <span class=md-ellipsis> Logs enriquecidos </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#conexao-direta-com-o-executor> <span class=md-ellipsis> Conexão direta com o executor </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#improve-the-performance-of-your-workflows> <span class=md-ellipsis> Improve the performance of your workflows </span> </a> <nav aria-label="Improve the performance of your workflows" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#improving-actions> <span class=md-ellipsis> Improving Actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#improve-the-source-code-checkout> <span class=md-ellipsis> Improve the source code checkout </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#caching-dependencies> <span class=md-ellipsis> Caching dependencies </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-usage-of-matrices> <span class=md-ellipsis> The usage of matrices </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-security-within-github-actions> <span class=md-ellipsis> The security within GitHub Actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-secrets-management> <span class=md-ellipsis> The secrets management </span> </a> <nav aria-label="The secrets management" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#the-secrets-flaws> <span class=md-ellipsis> The secrets' flaws </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#securing-self-hosted-agents> <span class=md-ellipsis> Securing self-hosted agents </span> </a> <nav aria-label="Securing self-hosted agents" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#limiting-the-access> <span class=md-ellipsis> Limiting the access </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#using-third-party-actions> <span class=md-ellipsis> Using third-party Actions </span> </a> <nav aria-label="Using third-party Actions" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#keep-up-with-the-good-security-practices> <span class=md-ellipsis> Keep up with the good security practices </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#controlling-the-github_tokens-authorizations> <span class=md-ellipsis> Controlling the GITHUB_TOKEN's authorizations </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#stay-protected-against-command-injection> <span class=md-ellipsis> Stay protected against command injection </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#my-real-world-workflows> <span class=md-ellipsis> My Real-World Workflows </span> </a> <nav aria-label="My Real-World Workflows" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#powerpoint> <span class=md-ellipsis> PowerPoint </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#prepare-the-markdown> <span class=md-ellipsis> Prepare the markdown </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#points-of-attention> <span class=md-ellipsis> Points of Attention </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#book-generation> <span class=md-ellipsis> Book Generation </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#documentary-website> <span class=md-ellipsis> Documentary Website </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#preparing-the-content> <span class=md-ellipsis> Preparing the content </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#points-of-attention_1> <span class=md-ellipsis> Points of Attention </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#devsecops> <span class=md-ellipsis> DevSecOps </span> </a> <nav aria-label=DevSecOps class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#static-application-security-testing> <span class=md-ellipsis> STATIC APPLICATION SECURITY TESTING </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#software-composition-analysis> <span class=md-ellipsis> SOFTWARE COMPOSITION ANALYSIS </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#dynamic-application-security-testing> <span class=md-ellipsis> DYNAMIC APPLICATION SECURITY TESTING </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#interactive-application-security-testing> <span class=md-ellipsis> INTERACTIVE APPLICATION SECURITY TESTING </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#container-scanner> <span class=md-ellipsis> CONTAINER SCANNER </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#infrastructure-as-code-scanner> <span class=md-ellipsis> INFRASTRUCTURE-AS-CODE SCANNER </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secrets-scanner> <span class=md-ellipsis> SECRETS SCANNER </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-workflow> <span class=md-ellipsis> The Workflow </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#create-a-public-container> <span class=md-ellipsis> Create a Public Container </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-workflow_1> <span class=md-ellipsis> The Workflow </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#conclusao> <span class=md-ellipsis> Conclusão </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#usando-hashicorp-vault-no-github> <span class=md-ellipsis> Usando HashiCorp Vault no GitHub </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#apendices> <span class=md-ellipsis> Apêndices </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#recursos-recomendados> <span class=md-ellipsis> Recursos recomendados </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_9 type=checkbox> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Certificação Perguntas </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_9_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Certificação Perguntas </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../recipe_60pportunities_certificacao_depc/ class=md-nav__link> <span class=md-ellipsis> Certiprof DevOps Essentials </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_certificacao_spd/ class=md-nav__link> <span class=md-ellipsis> Scrum Developer </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_certificacao_ghf/ class=md-nav__link> <span class=md-ellipsis> GitHub Foundations </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_certificacao_gha_en/ class=md-nav__link> <span class=md-ellipsis> GitHub Actions (EN) </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_certificacao_gha_ptb/ class=md-nav__link> <span class=md-ellipsis> GitHub Actions (PTB) </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_certificacao_gha_resumo_01/ class=md-nav__link> <span class=md-ellipsis> GitHub Actions 01 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_10 type=checkbox> <label class=md-nav__link for=__nav_10 id=__nav_10_label tabindex=0> <span class=md-ellipsis> Projetos </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_10_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Projetos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../recipe_60pportunities_projetos_standishgroup/ class=md-nav__link> <span class=md-ellipsis> PMI e Standish Group </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_11 type=checkbox> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex=0> <span class=md-ellipsis> Arquitetura </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_11_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Arquitetura </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../recipe_60pportunities_conf_arquitetura_api/ class=md-nav__link> <span class=md-ellipsis> Application Program Interface </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_conf_arquitetura_microservico/ class=md-nav__link> <span class=md-ellipsis> Microserviços </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_12 type=checkbox> <label class=md-nav__link for=__nav_12 id=__nav_12_label tabindex=0> <span class=md-ellipsis> Dados </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_12_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> Dados </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../recipe_60pportunities_conf_data_sod/ class=md-nav__link> <span class=md-ellipsis> Segregation of Duties </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_conf_data_master/ class=md-nav__link> <span class=md-ellipsis> Dados Mestres/Referência </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_conf_data_ccadastro/ class=md-nav__link> <span class=md-ellipsis> Central de Cadastro </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_conf_data_etica/ class=md-nav__link> <span class=md-ellipsis> Dados Ética </span> </a> </li> <li class=md-nav__item> <a href=../recipe_60pportunities_conf_data_master/ class=md-nav__link> <span class=md-ellipsis> Dados Mestres/Referência </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_13 type=checkbox> <label class=md-nav__link for=__nav_13 id=__nav_13_label tabindex=0> <span class=md-ellipsis> Estudos/Aprendizado </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_13_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_13> <span class="md-nav__icon md-icon"></span> Estudos/Aprendizado </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../recipe_60pportunities_conf_inteligencia_artificial/ class=md-nav__link> <span class=md-ellipsis> Inteligencia Artificial </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_14 type=checkbox> <label class=md-nav__link for=__nav_14 id=__nav_14_label tabindex=0> <span class=md-ellipsis> Links Úteis para o Aprendizado </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_14_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_14> <span class="md-nav__icon md-icon"></span> Links Úteis para o Aprendizado </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../recipe_60pportunities_lic_software/ class=md-nav__link> <span class=md-ellipsis> Faça você mesmo </span> </a> </li> <li class=md-nav__item> <a href=../recipe_links_inteligencia_artificial/ class=md-nav__link> <span class=md-ellipsis> Inteligência Artificial </span> </a> </li> <li class=md-nav__item> <a href=../recipe_links_biblioteca_virtual/ class=md-nav__link> <span class=md-ellipsis> Biblioteca Virtual </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#temporalidade> <span class=md-ellipsis> Temporalidade </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#limitacoes> <span class=md-ellipsis> Limitações </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#locais-especiais> <span class=md-ellipsis> Locais Especiais </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#git> <span class=md-ellipsis> Git </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#github> <span class=md-ellipsis> GitHub </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#github-actions> <span class=md-ellipsis> GitHub Actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#seu-primeiro-fluxo-de-trabalho> <span class=md-ellipsis> Seu primeiro fluxo de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#criando-uma-conta-github> <span class=md-ellipsis> Criando uma conta GitHub </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#criacao-do-repositorio> <span class=md-ellipsis> Criação do repositório </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#fork-do-repositorio> <span class=md-ellipsis> Fork do repositório </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#criando-um-fluxo-de-trabalho> <span class=md-ellipsis> Criando um fluxo de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#escolha-um-modelo-de-fluxo-de-trabalho> <span class=md-ellipsis> Escolha um modelo de fluxo de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#implantacao> <span class=md-ellipsis> Implantação </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#analisando-os-resultados> <span class=md-ellipsis> Analisando os resultados </span> </a> <nav aria-label="Analisando os resultados" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#resultados> <span class=md-ellipsis> Resultados </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#algumas-observacoes-sobre-yaml> <span class=md-ellipsis> Algumas observações sobre YAML </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#triggers> <span class=md-ellipsis> Triggers </span> </a> <nav aria-label=Triggers class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#gatilhos-automaticos> <span class=md-ellipsis> Gatilhos automáticos </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#filtros> <span class=md-ellipsis> Filtros </span> </a> <nav aria-label=Filtros class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#filtros-por-branch> <span class=md-ellipsis> Filtros por branch </span> </a> <nav aria-label="Filtros por branch" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#aviso> <span class=md-ellipsis> Aviso </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#os-filtros-por-caminho> <span class=md-ellipsis> Os filtros por caminho </span> </a> <nav aria-label="Os filtros por caminho" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#aviso_1> <span class=md-ellipsis> Aviso </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#scheduled-trigger> <span class=md-ellipsis> Scheduled trigger </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#manual-triggering> <span class=md-ellipsis> Manual triggering </span> </a> <nav aria-label="Manual triggering" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#disparar-manualmente-com-parametros> <span class=md-ellipsis> Disparar manualmente com parâmetros </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#desabilitarignorar-gatilhos-temporariamente> <span class=md-ellipsis> Desabilitar/ignorar gatilhos temporariamente </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#desativar-um-fluxo-de-trabalho> <span class=md-ellipsis> Desativar um fluxo de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicios> <span class=md-ellipsis> Exercícios </span> </a> <nav aria-label=Exercícios class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n1> <span class=md-ellipsis> Exercício n°1 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercise-n2> <span class=md-ellipsis> Exercise n°2 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n3> <span class=md-ellipsis> Exercício n°3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#jobs> <span class=md-ellipsis> Jobs </span> </a> <nav aria-label=Jobs class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#job-em-execucao> <span class=md-ellipsis> Job em Execução </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#jobs-em-conteiner> <span class=md-ellipsis> Jobs em contêiner </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#servicos-em-execucao> <span class=md-ellipsis> Serviços em execução </span> </a> <nav aria-label="Serviços em execução" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#diferencas> <span class=md-ellipsis> Diferenças </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#beneficios-dos-servicos> <span class=md-ellipsis> Benefícios dos serviços </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#dependencias-entre-seus-trabalhos> <span class=md-ellipsis> Dependências entre seus trabalhos </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#operator-description> <span class=md-ellipsis> Operator Description </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#status-check-functions> <span class=md-ellipsis> Status check functions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#gerenciamento-de-cache> <span class=md-ellipsis> Gerenciamento de cache </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#gerenciamento-de-artefatos> <span class=md-ellipsis> Gerenciamento de Artefatos </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#como-jobs-funcionam> <span class=md-ellipsis> Como Jobs funcionam </span> </a> <nav aria-label="Como Jobs funcionam" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#configuracoes-especificas-do-ambiente> <span class=md-ellipsis> Configurações específicas do ambiente </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#matrix-strategy> <span class=md-ellipsis> Matrix strategy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#estruturacao-de-fluxo-de-trabalho> <span class=md-ellipsis> Estruturação de Fluxo de Trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#steps> <span class=md-ellipsis> Steps </span> </a> <nav aria-label=Steps class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#propriedades-do-steps> <span class=md-ellipsis> Propriedades do Steps </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#executar-um-comando> <span class=md-ellipsis> Executar um comando </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#fluxos-de-trabalho-reutilizaveis> <span class=md-ellipsis> Fluxos de trabalho reutilizáveis </span> </a> <nav aria-label="Fluxos de trabalho reutilizáveis" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#limitacoes-dos-fluxos-de-trabalho-reutilizaveis> <span class=md-ellipsis> Limitações dos fluxos de trabalho reutilizáveis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#understanding-composite-actions> <span class=md-ellipsis> Understanding composite actions </span> </a> <nav aria-label="Understanding composite actions" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#limitacoes-dos-composite-actions> <span class=md-ellipsis> Limitações dos composite actions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#criando-uma-acao-composta-local> <span class=md-ellipsis> Criando uma ação composta local </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#execucao-de-uma-acao> <span class=md-ellipsis> Execução de uma Ação </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#execution-within-a-container> <span class=md-ellipsis> Execution within a container </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#descubra-novas-acoes> <span class=md-ellipsis> Descubra novas Ações </span> </a> <nav aria-label="Descubra novas Ações" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#o-editor-de-fluxo-de-trabalho> <span class=md-ellipsis> O editor de fluxo de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#editor-de-fluxo-de-trabalho> <span class=md-ellipsis> Editor de fluxo de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#gerenciamento-de-cache_1> <span class=md-ellipsis> Gerenciamento de cache </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#gestao-de-artefatos> <span class=md-ellipsis> Gestão de Artefatos </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#as-matrizes> <span class=md-ellipsis> As matrizes </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#execution-of-the-matrix> <span class=md-ellipsis> Execution of the matrix </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exclusions> <span class=md-ellipsis> Exclusions </span> </a> <nav aria-label=Exclusions class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#inclusions> <span class=md-ellipsis> Inclusions </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-concept-of-fail-fast> <span class=md-ellipsis> The concept of fail-fast </span> </a> <nav aria-label="The concept of fail-fast" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#exercicios_1> <span class=md-ellipsis> Exercícios </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n1_1> <span class=md-ellipsis> Exercício n°1 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercise-n2_1> <span class=md-ellipsis> Exercise n°2 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercise-n3> <span class=md-ellipsis> Exercise n°3 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#tecnicas-de-depuracao-para-fluxos-de-trabalho> <span class=md-ellipsis> Técnicas de depuração para fluxos de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#visual-studio-code-github-actions-plugin> <span class=md-ellipsis> Visual Studio Code GitHub Actions plugin </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#runners> <span class=md-ellipsis> Runners </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-it-works> <span class=md-ellipsis> How it works </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#pre-installed-tooling> <span class=md-ellipsis> Pre-installed tooling </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#network-considerations> <span class=md-ellipsis> Network considerations </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-self-hosted-runners> <span class=md-ellipsis> The self-hosted runners </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#adding-a-new-agent> <span class=md-ellipsis> Adding a new agent </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#acoes-adicionar-runner-auto-hospedado> <span class=md-ellipsis> Ações / Adicionar runner auto-hospedado </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#download-the-latest-runner-package> <span class=md-ellipsis> Download the latest runner package </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#runner-configuration> <span class=md-ellipsis> Runner configuration </span> </a> <nav aria-label="Runner configuration" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#executor-disponivel-e-ativo> <span class=md-ellipsis> Executor disponível e ativo </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-to-use-our-self-hosted-runner> <span class=md-ellipsis> How to use our self-hosted runner? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#network-access> <span class=md-ellipsis> Network access </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#differences-between-the-two-types-of-runners> <span class=md-ellipsis> Differences between the two types of runners </span> </a> <nav aria-label="Differences between the two types of runners" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#runners-managed-by-github> <span class=md-ellipsis> Runners managed by GitHub: </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#self-managed-runners-self-hosted> <span class=md-ellipsis> Self-managed runners (self-hosted): </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#runner-diagnostic-logging> <span class=md-ellipsis> Runner diagnostic logging </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#monitoramento-e-alerta-de-fluxo-de-trabalho> <span class=md-ellipsis> Monitoramento e alerta de fluxo de trabalho </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#recursos-de-notificacao-do-github> <span class=md-ellipsis> Recursos de notificação do GitHub </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#integrando-acoes-do-github-com-o-slack> <span class=md-ellipsis> Integrando ações do GitHub com o Slack </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#como-solicitar-permissoes-diferentes> <span class=md-ellipsis> Como solicitar permissões diferentes </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#criando-um-aplicativo-github> <span class=md-ellipsis> Criando um aplicativo GitHub </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#utilizando-fluxos-de-trabalho-iniciais-em-sua-equipe> <span class=md-ellipsis> Utilizando fluxos de trabalho iniciais em sua equipe </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-variables> <span class=md-ellipsis> The variables </span> </a> <nav aria-label="The variables" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#declaration-of-a-variable> <span class=md-ellipsis> Declaration of a variable </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#dynamic-variables> <span class=md-ellipsis> Dynamic variables </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#scope-of-variables> <span class=md-ellipsis> Scope of variables </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#output-variables> <span class=md-ellipsis> Output variables </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-built-in-environment-variables> <span class=md-ellipsis> The built-in environment variables </span> </a> <nav aria-label="The built-in environment variables" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#protect-the-content-of-variables-with-masks> <span class=md-ellipsis> Protect the content of variables with masks </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercises-variables> <span class=md-ellipsis> Exercises - variables </span> </a> <nav aria-label="Exercises - variables" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n1_2> <span class=md-ellipsis> Exercício n°1 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n2> <span class=md-ellipsis> Exercício n°2 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n3_1> <span class=md-ellipsis> Exercício n°3 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#os-segredos> <span class=md-ellipsis> Os segredos </span> </a> <nav aria-label="Os segredos" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#declaracao-de-um-segredo> <span class=md-ellipsis> Declaração de um segredo </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#os-limites-dos-segredos> <span class=md-ellipsis> Os limites dos segredos </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicios-segredos> <span class=md-ellipsis> Exercícios - Segredos </span> </a> <nav aria-label="Exercícios - Segredos" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n1_3> <span class=md-ellipsis> Exercício n°1 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n2_1> <span class=md-ellipsis> Exercício n°2 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n3_2> <span class=md-ellipsis> Exercício n°3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#variaveis-de-configuracao> <span class=md-ellipsis> Variáveis de configuração </span> </a> <nav aria-label="Variáveis de configuração" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#variaveis-de-configuracao_1> <span class=md-ellipsis> Variáveis de configuração </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-creation-of-multienvironment-workflows> <span class=md-ellipsis> The creation of multienvironment workflows </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#creating-an-environment> <span class=md-ellipsis> Creating an environment </span> </a> <nav aria-label="Creating an environment" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#protections-rules-screen> <span class=md-ellipsis> Protections rules screen </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#branch-filter> <span class=md-ellipsis> Branch filter </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#filtro-de-branch-desrespeitado> <span class=md-ellipsis> Filtro de branch desrespeitado </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#referenciando-um-ambiente> <span class=md-ellipsis> Referenciando um ambiente </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#manual-approval> <span class=md-ellipsis> Manual approval </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-use-of-custom-urls> <span class=md-ellipsis> The use of custom URLS </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicios_2> <span class=md-ellipsis> Exercícios </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n1_4> <span class=md-ellipsis> Exercício n°1 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n2_2> <span class=md-ellipsis> Exercício n°2 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#controle-de-fluxo> <span class=md-ellipsis> Controle de fluxo </span> </a> <nav aria-label="Controle de fluxo" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#defina-uma-condicionalidade-de-execucao> <span class=md-ellipsis> Defina uma condicionalidade de execução </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#ignore-execution-errors> <span class=md-ellipsis> Ignore execution errors </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#control-of-execution-time> <span class=md-ellipsis> Control of execution time </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#os-emblemas> <span class=md-ellipsis> Os emblemas </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configurando-um-emblema> <span class=md-ellipsis> Configurando um emblema </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#fluxos-de-trabalho-reutilizaveis_1> <span class=md-ellipsis> Fluxos de trabalho reutilizáveis </span> </a> <nav aria-label="Fluxos de trabalho reutilizáveis" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#como-funciona> <span class=md-ellipsis> Como funciona? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#access-to-reusable-workflows> <span class=md-ellipsis> Access to reusable workflows </span> </a> <nav aria-label="Access to reusable workflows" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#be-aware-of-some-limtations> <span class=md-ellipsis> Be aware of some limtations </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#create-your-own-custom-github-actions> <span class=md-ellipsis> Create your own custom GitHub Actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#create-your-first-action> <span class=md-ellipsis> Create your first Action </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-different-types-of-actions> <span class=md-ellipsis> The different types of Actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#pros-and-cons-what-to-choose> <span class=md-ellipsis> Pros and cons, what to choose? </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#creation-of-your-action> <span class=md-ellipsis> Creation of your Action </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#creating-the-manifest> <span class=md-ellipsis> Creating the manifest </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-business-logic-file> <span class=md-ellipsis> The business logic file </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#versioning> <span class=md-ellipsis> Versioning </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicios_3> <span class=md-ellipsis> Exercícios </span> </a> <nav aria-label=Exercícios class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n1_5> <span class=md-ellipsis> Exercício n°1 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n2_3> <span class=md-ellipsis> Exercício n°2 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n3_3> <span class=md-ellipsis> Exercício n°3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#publicar-no-marketplace> <span class=md-ellipsis> Publicar no Marketplace </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicios_4> <span class=md-ellipsis> Exercícios </span> </a> <nav aria-label=Exercícios class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n1_6> <span class=md-ellipsis> Exercício n°1 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n2_4> <span class=md-ellipsis> Exercício n°2 </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#exercicio-n3_4> <span class=md-ellipsis> Exercício n°3 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#estabelecimento-dos-pre-requisitos> <span class=md-ellipsis> Estabelecimento dos pré-requisitos </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-manifest-and-its-variables> <span class=md-ellipsis> The manifest and its variables </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-generation-of-the-changelog> <span class=md-ellipsis> The generation of the changelog </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-creation-of-a-release> <span class=md-ellipsis> The creation of a release </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-core-of-our-action> <span class=md-ellipsis> The core of our Action </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#typescript-compilation> <span class=md-ellipsis> TypeScript compilation </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#integration-with-a-workflow> <span class=md-ellipsis> Integration with a workflow </span> </a> <nav aria-label="Integration with a workflow" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#artefato-contendo-o-changelog> <span class=md-ellipsis> Artefato contendo o changelog </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#our-release-and-its-changelog> <span class=md-ellipsis> Our release and its changelog </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#create-a-docker-action> <span class=md-ellipsis> Create a docker Action </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-does-it-work> <span class=md-ellipsis> How does it work? </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#creating-a-pandoc-action> <span class=md-ellipsis> Creating a Pandoc Action </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-structure-of-a-docker-action> <span class=md-ellipsis> The structure of a Docker Action </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#how-to-optimize-docker-actions> <span class=md-ellipsis> How to optimize Docker Actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#create-composite-actions> <span class=md-ellipsis> Create composite Actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#github-script> <span class=md-ellipsis> GitHub Script </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#interact-on-other-repositories> <span class=md-ellipsis> Interact on other repositories </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#improve-the-user-experience-of-your-actions> <span class=md-ellipsis> Improve the user experience of your actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#improving-logs> <span class=md-ellipsis> Improving logs </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#annotations> <span class=md-ellipsis> Annotations </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#customizando-sumario-job> <span class=md-ellipsis> Customizando Sumário Job </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#job-summary> <span class=md-ellipsis> Job Summary </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#set-up-a-debug-mode> <span class=md-ellipsis> Set up a DEBUG mode </span> </a> <nav aria-label="Set up a DEBUG mode" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#activation-du-mode-debug> <span class=md-ellipsis> Activation du mode DEBUG </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#using-pre-and-post-scripts> <span class=md-ellipsis> Using Pre and Post Scripts </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#conditionality> <span class=md-ellipsis> Conditionality </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#conceitos-avancados> <span class=md-ellipsis> Conceitos avançados </span> </a> <nav aria-label="Conceitos avançados" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#artifact-management> <span class=md-ellipsis> Artifact management </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#artifacts-vs-packages> <span class=md-ellipsis> Artifacts vs. Packages </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#publication-of-an-artifact> <span class=md-ellipsis> Publication of an artifact </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#retention> <span class=md-ellipsis> Retention </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#downloading-an-artifact> <span class=md-ellipsis> Downloading an artifact </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#publication-of-a-release-element> <span class=md-ellipsis> Publication of a release element </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#publish-a-package> <span class=md-ellipsis> Publish a package </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#debugging-a-workflow> <span class=md-ellipsis> Debugging a workflow </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#logs-enriquecidos> <span class=md-ellipsis> Logs enriquecidos </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#conexao-direta-com-o-executor> <span class=md-ellipsis> Conexão direta com o executor </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#improve-the-performance-of-your-workflows> <span class=md-ellipsis> Improve the performance of your workflows </span> </a> <nav aria-label="Improve the performance of your workflows" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#improving-actions> <span class=md-ellipsis> Improving Actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#improve-the-source-code-checkout> <span class=md-ellipsis> Improve the source code checkout </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#caching-dependencies> <span class=md-ellipsis> Caching dependencies </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-usage-of-matrices> <span class=md-ellipsis> The usage of matrices </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-security-within-github-actions> <span class=md-ellipsis> The security within GitHub Actions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-secrets-management> <span class=md-ellipsis> The secrets management </span> </a> <nav aria-label="The secrets management" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#the-secrets-flaws> <span class=md-ellipsis> The secrets' flaws </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#securing-self-hosted-agents> <span class=md-ellipsis> Securing self-hosted agents </span> </a> <nav aria-label="Securing self-hosted agents" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#limiting-the-access> <span class=md-ellipsis> Limiting the access </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#using-third-party-actions> <span class=md-ellipsis> Using third-party Actions </span> </a> <nav aria-label="Using third-party Actions" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#keep-up-with-the-good-security-practices> <span class=md-ellipsis> Keep up with the good security practices </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#controlling-the-github_tokens-authorizations> <span class=md-ellipsis> Controlling the GITHUB_TOKEN's authorizations </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#stay-protected-against-command-injection> <span class=md-ellipsis> Stay protected against command injection </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#my-real-world-workflows> <span class=md-ellipsis> My Real-World Workflows </span> </a> <nav aria-label="My Real-World Workflows" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#powerpoint> <span class=md-ellipsis> PowerPoint </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#prepare-the-markdown> <span class=md-ellipsis> Prepare the markdown </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#points-of-attention> <span class=md-ellipsis> Points of Attention </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#book-generation> <span class=md-ellipsis> Book Generation </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#documentary-website> <span class=md-ellipsis> Documentary Website </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#preparing-the-content> <span class=md-ellipsis> Preparing the content </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#points-of-attention_1> <span class=md-ellipsis> Points of Attention </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#devsecops> <span class=md-ellipsis> DevSecOps </span> </a> <nav aria-label=DevSecOps class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#static-application-security-testing> <span class=md-ellipsis> STATIC APPLICATION SECURITY TESTING </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#software-composition-analysis> <span class=md-ellipsis> SOFTWARE COMPOSITION ANALYSIS </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#dynamic-application-security-testing> <span class=md-ellipsis> DYNAMIC APPLICATION SECURITY TESTING </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#interactive-application-security-testing> <span class=md-ellipsis> INTERACTIVE APPLICATION SECURITY TESTING </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#container-scanner> <span class=md-ellipsis> CONTAINER SCANNER </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#infrastructure-as-code-scanner> <span class=md-ellipsis> INFRASTRUCTURE-AS-CODE SCANNER </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#secrets-scanner> <span class=md-ellipsis> SECRETS SCANNER </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-workflow> <span class=md-ellipsis> The Workflow </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#create-a-public-container> <span class=md-ellipsis> Create a Public Container </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-workflow_1> <span class=md-ellipsis> The Workflow </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#conclusao> <span class=md-ellipsis> Conclusão </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#usando-hashicorp-vault-no-github> <span class=md-ellipsis> Usando HashiCorp Vault no GitHub </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#apendices> <span class=md-ellipsis> Apêndices </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#recursos-recomendados> <span class=md-ellipsis> Recursos recomendados </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h2 id=temporalidade>Temporalidade<a class=headerlink href=#temporalidade title="Permanent link">¶</a></h2> <table> <thead> <tr> <th>Temporalidade</th> <th>Tipo de Repositório</th> <th>Tempo</th> <th>Parametros</th> </tr> </thead> <tbody> <tr> <td>Retenção objetos gerados</td> <td>Publico</td> <td>90 dias</td> <td>time-to-live (TTL)</td> </tr> <tr> <td>Retenção objetos gerados</td> <td>Privados</td> <td>400 dias</td> <td>time-to-live (TTL)</td> </tr> <tr> <td>Termino de Retenção</td> <td>Arquivamento</td> <td>10 dias</td> <td>---</td> </tr> <tr> <td>Exclusão</td> <td>Arquivamento</td> <td>Excluidas definitiva</td> <td></td> </tr> <tr> <td>Caches</td> <td></td> <td>7 dias sem uso</td> <td>Ilimitado (até uso)</td> </tr> <tr> <td>Logs de workflow</td> <td></td> <td>90 dias</td> <td>----</td> </tr> <tr> <td>GitHub-hosted runners</td> <td>execução</td> <td>6 horas (360 minutos)</td> <td>Se um job ultrapassar esse tempo, ele será automaticamente cancelado.</td> </tr> </tbody> </table> <p>| Self-hosted runners | execução | Sem limite de tempo. | Você define a duração máxima. | | Número máximo de trabalhos que uma matriz | | 256 trabalhos | | | GITHUB_TOKEN | | após a conclusão de um trabalho ou após um máximo de 24 hora | | | segredos maiores que 48 KB | | usar criptografia com GPG. |</p> <h2 id=limitacoes>Limitações<a class=headerlink href=#limitacoes title="Permanent link">¶</a></h2> <p>Embora alguns limites sejam altos, há limitações no número de trabalhos executados em paralelo na mesma conta do GitHub.</p> <table> <thead> <tr> <th>Plano</th> <th style="text-align: right;">Max Parallel Jobs</th> <th style="text-align: right;">Max Parallel Jobs MacOS</th> </tr> </thead> <tbody> <tr> <td>Free</td> <td style="text-align: right;">20</td> <td style="text-align: right;">5</td> </tr> <tr> <td>Pro</td> <td style="text-align: right;">40</td> <td style="text-align: right;">5</td> </tr> <tr> <td>Team</td> <td style="text-align: right;">60</td> <td style="text-align: right;">5</td> </tr> <tr> <td>Enterprise</td> <td style="text-align: right;">150</td> <td style="text-align: right;">50</td> </tr> </tbody> </table> <h2 id=locais-especiais>Locais Especiais<a class=headerlink href=#locais-especiais title="Permanent link">¶</a></h2> <table> <thead> <tr> <th>Repositório</th> <th>Local</th> <th>Entenda</th> </tr> </thead> <tbody> <tr> <td><code>YOUR_ORG/GHA.workflows/.github/workflows</code></td> <td><code>workflow.yml@main</code></td> <td>Testar ação composta local.</td> </tr> <tr> <td><code>.github</code></td> <td><code>workflow-templates</code></td> <td>Compartilhamento de Actions</td> </tr> </tbody> </table> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <code>https://github.com/marketplace/actions/git-semantic-version</code></li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <code>https://github.com/marketplace/actions/hadolint-action</code></li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <code>https://www.paloaltonetworks.com/cyberpedia/what-is-sca</code></li> </ul> <h2 id=git>Git<a class=headerlink href=#git title="Permanent link">¶</a></h2> <p>Git é um "software de controle de versão descentralizado" e este termo bárbaro explica precisamente o que é e o que não é. Git é um software, o que significa que não é uma metodologia como seria "DevOps", não é uma sigla como "CI/CD" ou nem mesmo uma maneira de fazer como "gitflow".</p> <p>É um aplicativo que é necessário instalar em um servidor cuja função principal é gerenciar as diferentes versões do nosso código-fonte. Essas versões, em vez de um simples backup, permitem, particularmente no mundo do software, manter uma cópia de cada modificação do código-fonte, com a capacidade de voltar e/ou selecionar uma versão precisa.</p> <p>Este tipo de software existe há décadas com os famosos CVS (1990), ClearCase (1992), SVN (2000), Visual SourceSafe (1994), Team Foundation Server (2005) mas também muitos outros, menos conhecidos, como o BitKeeper (que foi usado para o código fonte do Linux), etc. Todos eles têm suas vantagens e desvantagens, mas acima de tudo, eles têm um ponto em comum: a necessidade de um único servidor onde o código fonte é armazenado e no qual tudo acontece.</p> <p>É o famoso conceito de "centralizado".</p> <p>É justamente para quebrar esse modelo que Linus Torvalds (também o inventor do Linux!) inventou o Git em 2005. Se o Git também funciona com um servidor "principal", cada software cliente também traz recursos de gerenciamento de código-fonte (ramificação, confirmação, etc.).</p> <p>Isso significa que todo desenvolvedor que instala o Git em seu computador pode usar todos os recursos localmente, incluindo a criação/gerenciamento de ramificações e a mesclagem de código, registro de dados, etc.</p> <p>Isso levou ao surgimento de novas formas de trabalho entre os desenvolvedores.</p> <p>Um bom exemplo é uma nova forma de criar uma ramificação por recurso ou desenvolvedor.</p> <p>No passado, geralmente era uma única ramificação correspondente a um software de versão, com os riscos de que essa ramificação, quando "quebrada", impedisse todos os desenvolvedores de trabalhar.</p> <p>Hoje, o Git, graças à sua flexibilidade, se tornou o software de gerenciamento de versão de referência e dominou completamente todos os outros do cenário. Mas com grande poder, o GitHub Actions também vem com uma complexidade.</p> <h2 id=github>GitHub<a class=headerlink href=#github title="Permanent link">¶</a></h2> <p>É justamente essa complexidade e capacidade de suporte (nenhuma empresa editou ou suportou o Git) que as empresas e equipes de desenvolvedores temiam migrar para essa nova ferramenta.</p> <p>É quando as pessoas decidem criar plataformas de hospedagem de código-fonte baseadas em Git (SaaS, Software as a Service) e a Internet então vê aparecer GitHub, GitLab ou Bitbucket.</p> <p>O objetivo dessas plataformas é esconder a complexidade do Git por meio de uma interface intuitiva e então adicionar recursos adicionais, como gerenciamento de projetos, rastreamento de bugs, varredura de código e muitos outros.</p> <p>Assim nasceu o GitHub no final de 2007, que neste momento era apenas uma oferta comercial de Git hospedado (apenas armazenamento de código-fonte).</p> <p>O GitHub, com mais de 50 milhões de usuários no início de 2021, é claramente o líder do mercado de plataformas de gerenciamento de código-fonte, mas há muito tempo é insuficiente para um projeto real.</p> <p>De fato, era necessário para cada equipe que esperava usá-lo como parte de um projeto real, adicionar:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Software de terceiros para gerenciar o backlog (problemas do GitHub e "Projetos" estão longe de serem perfeitos);</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Outro software para gerenciamento de testes;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Outro software para a parte de compilação/construção;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> E, finalmente, software para a implantação.</li> </ul> <p>Para competir com essas plataformas mais avançadas/completas, o GitHub começou a implementar recursos para preencher essas lacunas.</p> <p>Assim, entre vários novos recursos, nasceu um GitHub Actions.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Nota: GitHub, Inc, o editor do GitHub.com, foi adquirido pela Microsoft em junho de 2018, mas continua sendo uma empresa totalmente independente.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Se sinergias e co-investimentos técnicos forem feitos entre as duas empresas, o GitHub mantém sua orientação e independência total.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Se você estiver interessado no futuro do GitHub, esteja ciente de que a lista de próximos recursos e cronograma de implementação são públicos e acessíveis neste endereço: <code>https://github.com/github/roadmap/</code>.</li> </ul> <h2 id=github-actions>GitHub Actions<a class=headerlink href=#github-actions title="Permanent link">¶</a></h2> <p>Em agosto de 2019, o GitHub anunciou o beta público do GitHub Actions, embora eles tenham sido realmente acessíveis desde o verão de 2018 para alguns sortudos.</p> <p>As GitHub Actions são então descritas como "Seu fluxo de trabalho, criado por você, executado pelo GitHub. As GitHub Actions permitem que você compile facilmente, empacote, versione, atualize e implante seu projeto em qualquer linguagem, no GitHub ou em qualquer sistema externo, sem precisar executar nenhum código sozinho".</p> <p>As <strong>GitHub Actions, um sistema de automação, são mais do que isso, pois também podem interagir com os diferentes elementos de um projeto, como criar bugs, enviar e-mails automaticamente, atualizar os elementos do roadmap</strong>, etc.</p> <p>Mas vão muito além, pois você pode automatizar quase tudo com ele, como acionar o aspirador de pó robô, acender as luzes de uma árvore de Natal, fazer jogo da velha, etc.</p> <p>Os usos são infinitos, desde que sua criatividade esteja lá e que você esteja pronto para escrever algum código.</p> <h2 id=seu-primeiro-fluxo-de-trabalho>Seu primeiro fluxo de trabalho<a class=headerlink href=#seu-primeiro-fluxo-de-trabalho title="Permanent link">¶</a></h2> <p>Acredito que será mais fácil entender esses conceitos quando você os tiver visto e aplicado pelo menos uma vez.</p> <h2 id=criando-uma-conta-github>Criando uma conta GitHub<a class=headerlink href=#criando-uma-conta-github title="Permanent link">¶</a></h2> <p>Se isso ainda não tiver sido feito, você precisará criar uma conta GitHub para criar e usar fluxos de trabalho em seu ambiente. A criação de uma conta é totalmente gratuita e é realizada na seguinte URL: <code>https://github.com/join</code>.</p> <p>Embora o GitHub ofereça várias assinaturas pagas que permitem acesso a recursos adicionais, você precisará de uma conta gratuita neste livro.</p> <p>Os recursos do GitHub Actions são totalmente acessíveis gratuitamente, mas alguns recursos estão disponíveis para contas gratuitas apenas em repositórios públicos.</p> <p>Assim, se você decidir criar um repositório privado (visível apenas para você), certos recursos como ambientes, varredura de código ou publicação de páginas não estarão acessíveis para você.</p> <h2 id=criacao-do-repositorio>Criação do repositório<a class=headerlink href=#criacao-do-repositorio title="Permanent link">¶</a></h2> <p>Você pode começar com um novo repositório vazio, mas para mais simplicidade neste primeiro capítulo, criamos um repositório pronto para uso que você só precisa copiar para sua conta. Para fazer isso, visite a seguinte URL: <code>https://github.com/60pportunities/estudo-actions</code> e bifurque o repositório.</p> <h2 id=fork-do-repositorio>Fork do repositório<a class=headerlink href=#fork-do-repositorio title="Permanent link">¶</a></h2> <p>Um fork é uma cópia de um repositório, mantendo uma conexão com o arquivamento do qual é copiado.</p> <p>Isso permite que você edite a cópia como quiser (é sua cópia), mas também lhe dá a capacidade de "empurrar" suas alterações para reaplicar o repositório original para contribuir (se o autor aceitar, é claro).</p> <p>É como operamos a maioria dos projetos de código aberto. Cada colaborador executa e trabalha na cópia e então propõe adicionar emendas ao rascunho original.</p> <p>O proprietário do repositório de origem pode então ver as alterações que você deseja fazer e aceitar ou rejeitar as alterações, que são automaticamente incluídas em seu código.</p> <p>Assim que o fork for alcançado, o que deve levar alguns segundos, você deve pousar em um novo repositório chamado NOME_DA_SUA_CONTA/estudo-actions.</p> <h2 id=criando-um-fluxo-de-trabalho>Criando um fluxo de trabalho<a class=headerlink href=#criando-um-fluxo-de-trabalho title="Permanent link">¶</a></h2> <p>Observe as guias disponíveis em seu repositório e anote aquela que nos interessa: Actions.</p> <p>Na aba do seu projeto em Actions é que você pode criar, editar e, principalmente, visualizar o status de seus vários fluxos de trabalho.</p> <p>Entre na guia Ações para chegar ao Assistente de criação de fluxo de trabalho.</p> <p>Observe a mensagem que informa que os fluxos de trabalho foram deliberadamente desabilitados pelo GitHub neste repositório devido aos riscos que eles podem causar.</p> <p>A mensagem recomenda que você inspecione o código-fonte dos fluxos de trabalho e certifique-se de que não haja nada perigoso lá.</p> <p>Se, após sua leitura cuidadosa, não houver nada suspeito, você pode clicar em <strong>"Eu entendo meus fluxos de trabalho, vá em frente e habilite-os"</strong> para reativar a funcionalidade do repositório GitHub para suas Ações.</p> <p>Esta etapa só é necessária porque você <strong>bifurcou</strong> um repositório de outra pessoa; no caso de um novo repositório de código pessoal, esta etapa não existe.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Crie um fluxo de trabalho "vazio" que lhe dará a estrutura de um fluxo de trabalho genérico que apenas envia uma mensagem no console</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Crie um fluxo de trabalho a partir de um modelo predefinido.</li> </ul> <p>O GitHub oferece modelos que devem se alinhar com o que ele acha que detectou em seu repositório ou permitindo que você escolha entre dezenas de modelos predefinidos.</p> <p>Esses fluxos de trabalho são um bom ponto de partida e uma excelente maneira de aprender quando você está começando com o GitHub Actions.</p> <h2 id=escolha-um-modelo-de-fluxo-de-trabalho>Escolha um modelo de fluxo de trabalho<a class=headerlink href=#escolha-um-modelo-de-fluxo-de-trabalho title="Permanent link">¶</a></h2> <p>Crie, teste e implante seu código.</p> <p>Faça revisões de código, gerenciamento de ramificação e triagem de problemas funcionarem da maneira que você deseja. Selecione um modelo de fluxo de trabalho para começar.</p> <h2 id=implantacao>Implantação<a class=headerlink href=#implantacao title="Permanent link">¶</a></h2> <p>No nosso caso, criaremos nosso fluxo de trabalho completamente à mão.</p> <p>Clique em Configurar um fluxo de trabalho você mesmo, o que abre uma nova página com um arquivo em modo de edição. Você pode observar vários elementos importantes:</p> <p>O arquivo tem uma extensão <code>.yml</code> e uma sintaxe que pode parecer simplista, mas, no momento, totalmente absurda.</p> <p>Esta é a <code>linguagem" YAML (YAML Ain't Markup Language)</code> que quer ser um formato minimalista (mais leve que JSON) para descrever as propriedades de um objeto.</p> <p>Portanto, em um único arquivo e escrito usando YAML que descreveremos nosso fluxo de trabalho.</p> <p>O arquivo é chamado de "main.yml", mas você pode renomeá-lo como achar melhor, desde que mantenha a extensão correta.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O arquivo é criado diretamente no seu repositório, junto com seu código-fonte, mas localizado na pasta <code>.github/workflows</code>.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Esta pasta deve ser nomeada exatamente assim;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> É o caminho onde o GitHub espera encontrar os fluxos de trabalho para usar.</li> </ul> <p>Isso significa que toda vez que você quiser adicionar seu próprio fluxo de trabalho, é nesta pasta específica que ele terá que registrá-lo e não em outro lugar <code>.github</code> corresponde a uma pasta oculta no Linux.</p> <div class=highlight><pre><span></span><code>.github/
├── workflows/
│   ├── ci.yml
│   └── deploy.yml
├── actions/
│   └── custom-action/
├── ISSUE_TEMPLATE/
│   ├── bug-report.md
│   └── feature-request.md
├── environments/
│   └── production.yml
├── CODEOWNERS
├── dependabot.yml
└── SECURITY.md
</code></pre></div> <p>Neste caso, você também pode encontrar fluxos de trabalho em uma subpasta chamada workflows, templates e outros arquivos usados para personalizar o uso do GitHub.</p> <p>Reserve um tempo para olhar o conteúdo pré-preenchido do arquivo 01-60pportuinties-workflow.yml:</p> <div class=highlight><pre><span></span><code>name: 01-60pportuinties-workflow
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Use Node.js
      uses: actions/setup-node@v4
    - run: npm install
    - run: gulp build
    - uses: actions/upload-artifact@v4
      with:
        name: MyPackage
        path: dest
</code></pre></div> <p>Aqui indicamos que nosso fluxo de trabalho terá que ser acionado no caso de um commit em um branch, no caso de uma solicitação de pull ou após um lançamento manual.</p> <p>Esta máquina virtual é criada perfeitamente em servidores GitHub, você não precisa se preocupar com isso por enquanto.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Uma ação indica que queremos instalar o NodeJS na máquina virtual que executará o fluxo de trabalho.</li> </ul> <div class=highlight><pre><span></span><code>- name: User Nodes
  uses: actions/setup-node@v4
</code></pre></div> <ul class=task-list> <li class=task-list-item> <p><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Uma ação que inicia um comando npm install, que analisará os pacotes necessários do nosso código-fonte (eles estão listados no arquivo /src/packages.json) e os instalará localmente (=na máquina virtual).</p> </li> <li> <p>run: npm install</p> </li> <li class=task-list-item> <p><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Uma ação executa o comando gulp build, que usa os pacotes baixados pelo NPM para transformar nosso código PUG em XHTML e, em seguida, copiará o resultado gerado em uma pasta /dest. Todas essas mecânicas ocultas estão escritas no arquivo gulpfile.js, mas você não precisa se preocupar com isso.</p> </li> <li> <p>run: gulp build</p> </li> <li> <p>[x]Uma ação que pegará todos os arquivos gerados na pasta /dest, nossa página HTML gerada e o arquivo CSS, compactará como MyPackage e, em seguida, fará o upload deste arquivo para o portal do GitHub.</p> </li> </ul> <div class=highlight><pre><span></span><code>  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Use Node.js
      uses: actions/setup-node@v4
    - run: npm install
    - run: gulp build
    - uses: actions/upload-artifact@v4
      with:
        name: MyPackage
        path: dest
</code></pre></div> <h2 id=analisando-os-resultados>Analisando os resultados<a class=headerlink href=#analisando-os-resultados title="Permanent link">¶</a></h2> <p>Se você clicar na execução do seu fluxo de trabalho (chamado <code>run</code>), você chegará na tela de resultados.</p> <h3 id=resultados>Resultados<a class=headerlink href=#resultados title="Permanent link">¶</a></h3> <p>Esta tela é separada em várias subpartes:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> No lado esquerdo está a lista de trabalhos no seu fluxo de trabalho;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O status geral do fluxo de trabalho, seu <strong>tempo de execução</strong>, <strong>o tempo cobrado</strong> (livre até um certo número) e o <strong>número de elementos</strong> (artefatos) que foram gerados;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Logo abaixo está a visualização do gráfico. Permite ver as relações entre os diferentes elementos e o status dos diferentes estágios.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> A seção Anotações que lista todos os avisos e erros importantes do fluxo de trabalho.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Todos os fluxos de trabalho não geram artefatos, mas quando o fazem como aqui, eles são listados aqui.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> No lado esquerdo, se você clicar no trabalho chamado build, verá os resultados detalhados de cada ação do fluxo de trabalho. Este é o lugar onde você <strong>verifica os logs</strong> para validar se seu fluxo de trabalho se comporta conforme o esperado.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Clique no artefato MyPackage e baixe o arquivo zip, e então configure-o:<ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Ele deve conter dois arquivos: index.html e main.css.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Se você abrir o arquivo com um navegador da web, você deve ver o resultado: nosso adorável panda animado.</li> </ul> </li> </ul> <h2 id=algumas-observacoes-sobre-yaml>Algumas observações sobre YAML<a class=headerlink href=#algumas-observacoes-sobre-yaml title="Permanent link">¶</a></h2> <p>O formato YAML já tem 20 anos, mas só recentemente é amplamente conhecido, a ponto de substituir os formatos XML e JSON para tudo o que está relacionado à configuração ou descrição.</p> <p>Além disso, seu formato simples, em formato livre e sem nenhuma tag, o torna um formato leve, muito legível e utilizável para qualquer necessidade; portanto, o GitHub tornou o elemento central das Ações do GitHub.</p> <p>Um arquivo YAML pode, no caso do GitHub Actions, ser resumido com três elementos:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Elementos de chave/valor<ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Os elementos de chave/valor são compostos de um nome de chave, seguido pelo caractere de coluna ":" e finalmente por seu valor. Aqui estão alguns exemplos: <strong>key: value</strong> # observe o espaço após os dois pontos ":", mas não antes <div class=highlight><pre><span></span><code>keyNumeric: 1235
keyBoolean: false
OtherKey: "Hello world" # entre aspas porque o valor contém espaços
cmd: "echo"
</code></pre></div></li> </ul> </li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Elementos aninhados</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Matrizes de elementos</li> </ul> <p>O valor deve estar em uma linha. No entanto, se você precisar de um valor multilinha, é necessário usar o caractere pipe "|": <div class=highlight><pre><span></span><code>key: | # caractere que indica que as linhas a seguir
      $var = "hello" # fazem parte de um único bloco
      echo $var # atribuído à chave
</code></pre></div> Então vêm os elementos aninhados. É uma chave que não tem nenhum valor, mas tem subelementos que precisam ser recuados. O recuo em YAML é feito com dois espaços (sem tabulações):</p> <p><div class=highlight><pre><span></span><code>a_nested_key:
   key: value    # subelemento recuado por dois espaços
   other_key: other value # sub-element at the same level
   other_nested_key:     #sub-element too
            hello: hello # sub sub-element indented by two spaces
 jobs: # new first-level element so no indented
    build:
      runs-on: self-hosted
</code></pre></div> Por fim, vêm os elementos cujo valor é uma lista de objetos. Eles estão disponíveis em duas formas. Primeiro vem a lista de valores escritos na mesma linha em um array, representados por colchetes.</p> <div class=highlight><pre><span></span><code>   weekDay: ['Monday','Tuesday', 'Wednesday', 'Thursday', 'Friday'] # string array
   oddNumbers: [1,3,5,7,9] # List of numeric values
   os: [self-hosted, windows-latest, macos-latest]
</code></pre></div> <p>Depois vêm os objetos mais complexos, inclusive quando cada valor do array também é um objeto. Neste caso, o formato acima não funciona, e um novo formato é necessário. Nele, cada elemento é representado por um traço sem recuo.</p> <p><div class=highlight><pre><span></span><code>students:
    - firstname: Jean    # element, no indentation
      name: Dupont       # property of the same element
    - firstname: Marine  # new element
      name: Leblanc      # property of the second element
addresses:
    - name: "personal address"
      street: 1 Wisteria Lane
city:
  name: Paris   # sub-property and therefore indentation
  postalCode: 75001
 - name: "second address"
 - street: 2 Geek street

  city:
    name: Courbevoie
     postalCode: 92400
</code></pre></div> <strong>Observação</strong>: Para conseguir ler estes arquivos utilize o utilitário Json(jq) e Yaml(yq).</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <code>yq -r '.students[].firstname, .students[].name' students.yml</code></li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <code>jq -r '.students[].firstname' students.json</code></li> </ul> <h2 id=triggers>Triggers<a class=headerlink href=#triggers title="Permanent link">¶</a></h2> <p>Os gatilhos são, como o nome indica, os meios para especificar o critério de início de um fluxo de trabalho, e todo fluxo de trabalho deve conter um ou mais gatilhos. Existem três categorias de gatilhos:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Gatilhos automáticos;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Gatilhos de schedulle;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Gatilhos manuais;</li> </ul> <table> <thead> <tr> <th>Objeto</th> <th>Tipo de Evensots</th> </tr> </thead> <tbody> <tr> <td>Código</td> <td>push, pull_request e pull_request_review</td> </tr> <tr> <td>Problemas e Projetos</td> <td>issues, issue_comment e milestone</td> </tr> <tr> <td>Agendados</td> <td>cron</td> </tr> <tr> <td>Manual</td> <td>workflow_dispatch</td> </tr> <tr> <td>Repositório e organização</td> <td>repository, team e organization</td> </tr> <tr> <td>External events</td> <td>repository_dispatch e workflow_run</td> </tr> </tbody> </table> <h3 id=gatilhos-automaticos>Gatilhos automáticos<a class=headerlink href=#gatilhos-automaticos title="Permanent link">¶</a></h3> <p>Ao criar um fluxo de trabalho, você deve primeiro definir sua finalidade e as condições para acioná-lo.</p> <p>O caso mais comum é querer um gatilho sempre que uma nova versão do código-fonte estiver disponível, para verificar se tudo pode ser compilado corretamente.</p> <p>No mundo do Git, significa agir assim que um dos desenvolvedores envia seu código para o servidor.</p> <p>Portanto, estamos falando aqui sobre integração contínua ("CI").</p> <p>Em termos de sintaxe, em nosso arquivo, usaremos a palavra-chave "on:" que significa "no caso de", e especificaremos o termo "push" para indicar cada vez que um commit é enviado para o servidor.</p> <p><code>on: push</code></p> <p>Da mesma forma, é possível disparar o fluxo de trabalho quando uma solicitação de pull é realizada quando o desenvolvedor solicita "push" seu código para uma ramificação de outra ramificação.</p> <p>A pequena diferença com o caso anterior é que ele é disparado antes que seu código seja mesclado na ramificação de destino.</p> <p>É possível agir e bloquear modificações se um problema for detectado.</p> <p>No caso de "push", é tarde demais, o código já está na ramificação e, se o código tiver algum erro, a ramificação será quebrada, o que pode impactar outros desenvolvedores.</p> <div class=highlight><pre><span></span><code>on:
  push:            # inicia em cada push
   pull_request:   # ou solicitação de pull
</code></pre></div> <p>Eventos como push e pull_request são numerosos.</p> <p>Aqui está uma lista não exaustiva dos mais comuns. Você verá alguns deles neste livro:</p> <table> <thead> <tr> <th>Evento</th> <th>Disparo</th> </tr> </thead> <tbody> <tr> <td>create</td> <td>Quando uma ramificação ou uma tag é criada</td> </tr> <tr> <td>delete</td> <td>Quando uma ramificação ou uma tag é excluída</td> </tr> <tr> <td>gollum</td> <td>Quando uma página wiki é criada ou modificada</td> </tr> <tr> <td>issue_comment</td> <td>Quando um problema do GitHub é criado, editado ou excluído</td> </tr> <tr> <td>registry_package</td> <td>Quando um pacote* é publicado</td> </tr> <tr> <td>release</td> <td>Quando uma versão é criada, excluída, editada</td> </tr> </tbody> </table> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Pacotes: São binários, bibliotecas ou imagens (como .npm, .jar, .docker, .nuget) publicados em um registro do GitHub.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Artefatos: São arquivos temporários gerados durante um workflow (ex: logs, binários, relatórios de teste).</li> </ul> <h2 id=filtros>Filtros<a class=headerlink href=#filtros title="Permanent link">¶</a></h2> <p>Se um gatilho for executado a cada modificação de código, seria normal nos questionarmos como lidar com isso no caso de um projeto mais complexo, seja porque ele contém várias ramificações ou porque apenas um repositório tem vários aplicativos dentro dele e cada um requer um fluxo de trabalho dedicado que não queremos ver ser acionado quando não deveria.</p> <p>Essa especialização do fluxo de trabalho é feita com os filtros que se aplicam em combinação com o critério de gatilho.</p> <h3 id=filtros-por-branch>Filtros por branch<a class=headerlink href=#filtros-por-branch title="Permanent link">¶</a></h3> <p>Em alguns eventos como push e pull_request, é possível especificar o branch que deve disparar o fluxo de trabalho (main por exemplo). Então, se um novo código de versão for enviado para outro branch, o fluxo de trabalho não será acionado.</p> <div class=highlight><pre><span></span><code>on:
  push: # quando o código for enviado
   branches: # quando o código for enviado
      - main
</code></pre></div> <p>Também é possível especificar múltiplos branches nominalmente ou, ao contrário, um conjunto de branches</p> <div class=highlight><pre><span></span><code>on: #fires
  push:
     branches:
        - main
        - features/**
        - "**bug**'
</code></pre></div> <p>Mas também é possível excluir certos branches.</p> <div class=highlight><pre><span></span><code>on:
  push:
     branches-ignore: # on all branches
       - main #except the main branch
</code></pre></div> <h4 id=aviso>Aviso<a class=headerlink href=#aviso title="Permanent link">¶</a></h4> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <strong>Você não pode usar branches e branches-ignore no mesmo fluxo de trabalho</strong>.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Você deve usar a listagem explícita (white-Listing) ou a exclusão explícita (black-listing). Se precisar de ambas, é necessário usar o caractere "!" para fazer um padrão negativo escolhendo apenas uma das duas palavras-chave.</li> </ul> <div class=highlight><pre><span></span><code>on:
 push:
   branches:
      - '**'       # Executa em todas as branches...
      - '!develop' # ...exceto develop.
</code></pre></div> <h2 id=os-filtros-por-caminho>Os filtros por caminho<a class=headerlink href=#os-filtros-por-caminho title="Permanent link">¶</a></h2> <p>Também é possível ser ainda mais granular com base na adição de código, mas apenas quando ele está localizado em um arquivo específico ou em uma pasta específica.</p> <p>Isso é particularmente útil quando você tem <strong>vários aplicativos no mesmo repositório</strong>, mas cada um precisa de um fluxo de trabalho dedicado, como um aplicativo Android e iOS.</p> <div class=highlight><pre><span></span><code>name: 52-patch_validation
on:
  workflow_dispatch:
  push:
    branches:
      - main                   # Só executa na branch main
    paths-ignore:
      - '**'                    # Ignora qualquer alteração **
      - '!resource/**'
jobs:
  validate-resources:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: List modified files (debug)
        run: |
          echo "Arquivos modificados (exceto java/):"
          git diff --name-only HEAD^ HEAD -- . ':!java/**'
      - name: Validate Resource Changes
        run: |
          if [ -n "$(git diff --name-only HEAD^ HEAD -- resource/)" ]; then
            echo "✅ Alterações válidas em resource/ detectadas"
            # Adicione comandos de validação aqui (ex: testes, scripts)
          else
            echo "❌ Nenhuma alteração em resource/ (workflow não deveria ter sido acionado)"
          fi
</code></pre></div> <h4 id=aviso_1>Aviso<a class=headerlink href=#aviso_1 title="Permanent link">¶</a></h4> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Não é possível usar <strong>paths e paths-ignore</strong> no mesmo fluxo de trabalho.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Quanto aos branches, você pode excluir paths com o uso do caractere "!'</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Ou, por outro lado, é possível ignorar alguns paths:</li> </ul> <div class=highlight><pre><span></span><code>on:
  push:
    paths-ignore:
       - 'docs/**
</code></pre></div> <h3 id=scheduled-trigger>Scheduled trigger<a class=headerlink href=#scheduled-trigger title="Permanent link">¶</a></h3> <p>Este gatilho serve em particular para as compilações que são comumente chamadas de <strong>Nightly Builds</strong>.</p> <p>Essas compilações são (geralmente) iniciadas à noite, mas descorrelacionadas do processo de CI/CD, seja porque realizam tratamentos longos (ex.: varredura de código mais avançada) ou porque as ações do fluxo de trabalho não são necessárias para o escopo da Integração Contínua (ex.: geração de um relatório de qualidade de código)</p> <p>Essa configuração é feita adicionando a propriedade schedule e um parâmetro cron, conforme mostrado no exemplo abaixo:</p> <div class=highlight><pre><span></span><code>on:
  schedule:
    - cron: '0 0 * * *' #Every day at midnight
</code></pre></div> <p>Esta formatação usa a terminologia crontab que permite que você defina qualquer agendamento.</p> <p>No exemplo anterior, "0 0 * * *" 0 significa 0 minutos, às 0 horas (meia-noite), todos os dias, todos os meses, todos os dias da semana. Você pode especificar qualquer coisa, desde que respeite o intervalo mínimo de 5 minutos. Link útil:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <a href=https://crontab.guru/ >Crontab-Guru</a></li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <a href=http://www.cronmaker.com>Crontab-Maker</a></li> </ul> <p>Um exemplo de uso pode ser um fluxo de trabalho que começa toda segunda-feira às 9h antes da reunião standup e fecha os problemas abertos que não estão mais ativos.</p> <div class=highlight><pre><span></span><code>name: 52-marca_e_fecha_issue_e_pull_request
on:
#  schedule:
#    - cron: '0 0 * * *'  # Executa diariamente à meia-noite (UTC)
  workflow_dispatch:      # Permite execução manual
permissions:
  contents: write # only for delete-branch option
  issues: write
  pull-requests: write
jobs:
  stale:
    runs-on: ubuntu-latest
    steps:
      - name: Mark and Close Stale Issues/PRs
        uses: actions/stale@v8
        with:
          days-before-issue-stale: 30
          days-before-issue-close: 7
          stale-issue-label: 'stale'
          stale-issue-message: |
            ⏳ Esta issue está inativa há 30 dias.
            **Ela será fechada em 7 dias** se não houver novas interações.
            Caso ainda seja relevante, comente aqui para mantê-la aberta!

          # Configurações para PRs
          days-before-pr-stale: 30      # Marca PRs após 30 dias inativos
          days-before-pr-close: 7       # Fecha 7 dias após ser marcado
          stale-pr-label: 'stale'       # Rótulo aplicado a PRs inativos
          stale-pr-message: |
            ⏳ Este PR está inativo há 30 dias.
            **Será fechado em 7 dias** se não houver atualizações.
            Reative-o com um comentário ou commit se ainda for importante!

          # Configurações gerais
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          exempt-issue-labels: 'pinned,high-priority'  # Ignora issues com esses rótulos
          exempt-pr-labels: 'critical'                 # Ignora PRs com esses rótulos
          operations-per-run: 100       # Limite de operações por execução
</code></pre></div> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <strong>Atenção</strong>: Por motivos de sustentabilidade, o <strong>GitHub desabilita qualquer fluxo de trabalho agendado quando não há atividade no repositório nos últimos dois meses</strong>.</li> </ul> <p>Você recebe um e-mail para estender manualmente a atividade do seu fluxo de trabalho por 60 dias.</p> <p>Uma alternativa é usar esta ação (<a href=https://github.com/gautamkrishnar/keepalive-workflow>https://github.com/gautamkrishnar/keepalive-workflow</a>) que simula a atividade no repositório.</p> <div class=highlight><pre><span></span><code>name: 52-atualiza-readme
on:
  workflow_dispatch:
permissions:
  contents: write # only for delete-branch option
  issues: write
  pull-requests: write
#  schedule:
#    # Runs at 12 am UTC
#    - cron: "0 0 * * *"
jobs:
  update-readme:
    environment: DESENVOLVIMENTO
    name: Update this repo's README
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Update README with WakaTime stats
        uses: athul/waka-readme@master
        with:
          GH_TOKEN: ${{ secrets.MKDOCS_TOKEN_PAT_ESTUDO }}
          WAKATIME_API_KEY: ${{ secrets.WAKATIME_API_KEY }}
          ### meta
          REPOSITORY: horaciovasconcellos/horaciovasconcellos # optional
          ### content
          SHOW_TITLE: true
          BLOCKS: -&gt; # optional
          TIME_RANGE: all_time # optional
          LANG_COUNT: 10 # optional
          SHOW_TIME: true # optional
          SHOW_TOTAL: true # optional
          SHOW_MASKED_TIME: false # optional
          STOP_AT_OTHER: true # optional
          ### commit
          COMMIT_MESSAGE: Updated waka-readme graph with new metrics # optional
          TARGET_BRANCH: main # optional
          TARGET_PATH: README.md # optional
          COMMITTER_NAME: 'HVasconcellos'
          COMMITTER_EMAIL: 'horacio.vasconcellos@gmail.com'
          AUTHOR_NAME: 'HVasconcellos'
          AUTHOR_EMAIL: 'horacio.vasconcellos@gmail.com'
      - name: Keep workflow alive
        uses: gautamkrishnar/keepalive-workflow@v2
        with:
          commit_message: 'Mensagem de Execução'
          committer_username: 'HVasconcellos'
          committer_email: 'horacio.vasconcellos@gmail.com'
      - name: Log completion
        run: echo "Workflow concluído com sucesso."
</code></pre></div> <h3 id=manual-triggering>Manual triggering<a class=headerlink href=#manual-triggering title="Permanent link">¶</a></h3> <p>O gatilho manual é particularmente útil quando você quer que a ação seja disparada por um humano, como implantar em um ambiente após uma fase de teste.</p> <p>Este gatilho é especial porque você tem que usar o evento workflow_dispatch que indica que o fluxo de trabalho pode ser iniciado a partir de um item externo (por exemplo, <strong>outro fluxo de trabalho, uma chamada de API ou... um humano</strong>).</p> <p>Uma vez configurado, o fluxo de trabalho pode ser acionado a partir de um fluxo de trabalho de terceiros e manualmente a partir do portal GitHub.</p> <p>Os gatilhos manuais também podem fornecer parâmetros de entrada ao iniciar o fluxo de trabalho para dar a eles um pouco de dinamicidade.</p> <p>Essas configurações são declaradas com as entradas de propriedade. É possível então definir um parâmetro que tenha propriedades diferentes:</p> <p>É claro que é possível definir vários parâmetros, cada um com sua configuração.</p> <p>O GitHub cuida apenas de gerar um formulário contendo os parâmetros de entrada e então transmitir os valores para seu fluxo de trabalho. Você ainda precisa configurar seu fluxo de trabalho para usar esses parâmetros. Aqui está um exemplo de um fluxo de trabalho que pede para fornecer dois parâmetros obrigatórios, um dos quais já tem um valor padrão.</p> <div class=highlight><pre><span></span><code>name: 52_manual_opcoes
on:
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log level'
        required: true
        default: 'warning'
        type: choice
        options:
          - info
          - warning
          - debug
      print_tags:
        description: 'True to print to STDOUT'
        required: true
        type: boolean
      tags:
        description: 'Test scenario tags'
        required: true
        type: string
      environment:
        description: 'Environment to run tests against'
        type: environment
        required: true

jobs:
  print-tag:
    runs-on: ubuntu-latest
    if: ${{ inputs.print_tags }}
    steps:
      - name: Print the input tag to STDOUT
        run: |
               echo  The tags are ${{ inputs.tags }}
               echo  The tags are ${{ inputs.print_tags }}
               echo  The tags are ${{ inputs.environment }}
               echo  The tags are ${{ inputs.logLevel }}
</code></pre></div> <h4 id=disparar-manualmente-com-parametros>Disparar manualmente com parâmetros<a class=headerlink href=#disparar-manualmente-com-parametros title="Permanent link">¶</a></h4> <p>O formato um tanto particular $ {{ github.event.inputs.environment }} que representa uma variável do GitHub é abordado no capítulo. Lembre-se apenas por um momento que este formato informa o fluxo de trabalho:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Entre as variáveis do GitHub;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Procure nas propriedades do evento que disparou o workflow;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Procure entre seus parâmetros de entrada (inputs);</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Então recupere o valor do parâmetro chamado "logLevel"</li> </ul> <p>Desde novembro de 2021, agora é possível atribuir tipos para parâmetros. Se as configurações fossem todas string (agora o tipo padrão), agora é possível especificar tipos como <strong>boolean, choice ou environment</strong>:</p> <p>Também é possível dar um nome dinâmico ao fluxo de trabalho usando essas entradas. Em vez de usar a propriedade name, você pode usar a propriedade run-name</p> <p>run-name: O fluxo de trabalho cumprimentará <span _={ class=arithmatex github.actor=github.actor>\({{ inputs.name}} por @\)</span>}</p> <h3 id=desabilitarignorar-gatilhos-temporariamente>Desabilitar/ignorar gatilhos temporariamente<a class=headerlink href=#desabilitarignorar-gatilhos-temporariamente title="Permanent link">¶</a></h3> <p>Pode acontecer de você querer alterar um ou mais arquivos, mas não querer acionar o fluxo de trabalho associado a este evento (push ou pull-request).</p> <p>Por exemplo, quando você edita um arquivo que não é relevante para a implantação, como um arquivo README.md.</p> <p>Um truque não documentado consiste em inserir uma palavra-chave no comentário de um commit ou pull_request, e o GitHub ignorará o evento e não acionará o fluxo de trabalho.</p> <p>A lista de possíveis palavras-chave para desabilitar temporariamente um fluxo de trabalho é a seguinte: <strong>[skip ci], [ci skip], [no ci], [skip actions] ou [actions skip] (não se esqueça dos colchetes)</strong>.</p> <h3 id=desativar-um-fluxo-de-trabalho>Desativar um fluxo de trabalho<a class=headerlink href=#desativar-um-fluxo-de-trabalho title="Permanent link">¶</a></h3> <p>Se desabilitar temporariamente for útil, isso requer nunca omitir a inserção de uma das palavras-chave de desativação para cada commit.</p> <p>Uma alternativa é desabilitar um fluxo de trabalho totalmente (until reactivated);</p> <p>O arquivo YAML permanece presente e funcional, mas tecnicamente o GitHub não o acionará até novo aviso.</p> <p>A desativação (ou reativação) é realizada por meio da aba Ações do repositório; ao clicar em um dos fluxos de trabalho no canto superior direito, clique no botão "..." e escolha "Desativar fluxo de trabalho".</p> <h3 id=exercicios>Exercícios<a class=headerlink href=#exercicios title="Permanent link">¶</a></h3> <p>Agora, vamos aplicar o que você acabou de aprender fazendo alguns exercícios.</p> <h4 id=exercicio-n1>Exercício n°1<a class=headerlink href=#exercicio-n1 title="Permanent link">¶</a></h4> <p>Aqui está um fluxo de trabalho que fecha os bugs que são muito antigos. Modifique-o para que ele seja executado todas as noites às 19h30, de segunda a sexta-feira.</p> <div class=highlight><pre><span></span><code>name: 52-fecha-bugs
on:
  schedule:
    # Executa às 19:30 UTC (16:30 BRT) de segunda a sexta-feira
    - cron: '30 19 * * 1-5'
  workflow_dispatch:  # Permite execução manual

jobs:
  fechar-bugs-antigos:
    runs-on: ubuntu-latest
    steps:
      - name: Verificar bugs antigos
        uses: actions/github-script@v6
        with:
          script: |
            const { data: issues } = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              labels: 'bug',
              sort: 'created',
              direction: 'asc',
              per_page: 100
            });

            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - 30); // 30 dias atrás

            for (const issue of issues) {
              const createdAt = new Date(issue.created_at);
              if (createdAt &lt; cutoffDate) {
                await github.rest.issues.update({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issue.number,
                  state: 'closed'
                });

                await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issue.number,
                  body: 'Este bug foi fechado automaticamente por estar aberto há mais de 30 dias sem atualização. Se ainda for relevante, por favor reabra.'
                });

                console.log(`Fechado bug #${issue.number}: ${issue.title}`);
              }
            }
</code></pre></div> <h4 id=exercise-n2>Exercise n°2<a class=headerlink href=#exercise-n2 title="Permanent link">¶</a></h4> <p>Altere este fluxo de trabalho para ser acionado sempre que o código for enviado em qualquer branch. Adicione um segundo gatilho quando uma solicitação de pull for feita no branch principal</p> <div class=highlight><pre><span></span><code>name: Fechar Bugs Antigos
on:
  push:
    branches:
      - '**'
  pull_request:
    branches:
      - 'main'
  schedule:
    - cron: '30 19 * * 1-5'

jobs:
  fechar-bugs-antigos:
    if: github.event_name == 'schedule'
    runs-on: ubuntu-latest
    steps:
      - name: Verificar bugs antigos
        uses: actions/github-script@v6
        with:
          script: |
            const { data: issues } = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              labels: 'bug',
              sort: 'created',
              direction: 'asc',
              per_page: 100
            });

            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - 30); // 30 dias atrás

            for (const issue of issues) {
              const createdAt = new Date(issue.created_at);
              if (createdAt &lt; cutoffDate) {
                await github.rest.issues.update({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issue.number,
                  state: 'closed'
                });

                await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issue.number,
                  body: 'Este bug foi fechado automaticamente por estar aberto há mais de 30 dias sem atualização. Se ainda for relevante, por favor reabra.'
                });

                console.log(`Fechado bug #${issue.number}: ${issue.title}`);
              }
            }

  # Novo job para executar em push/pull_request (opcional)
  validacoes:
    if: github.event_name != 'schedule'
    runs-on: ubuntu-latest
    needs: fechar-bugs-antigos
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Echo Event
        run: |
          echo "Evento disparador: ${{ github.event_name }}"
          echo "Branch: ${{ github.ref }}"
          echo "SHA: ${{ github.sha }}"
</code></pre></div> <h4 id=exercicio-n3>Exercício n°3<a class=headerlink href=#exercicio-n3 title="Permanent link">¶</a></h4> <p>Disparar o fluxo de trabalho quando os arquivos com extensão ".yml" forem modificados durante um pull request, exceto aqueles que têm uma pasta pai chamada "mkdocs".</p> <div class=highlight><pre><span></span><code>name: 52-YAML
on:
  pull_request:
    paths:
      - '**.yml'           # Monitora todos arquivos .yml
      - '!mkdocs/**/*.yml'   # Ignora .yml dentro da pasta test

jobs:
  validate-yml:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Necessário para verificar diferenças entre commits

      - name: Get changed YAML files
        id: changed-files
        uses: tj-actions/changed-files@v42
        with:
          files: |
            **.yml
            !mkdocs/**/*.yml

      - name: List modified YAML files
        run: |
          echo "Arquivos YAML modificados (exceto em /mkdocs):"
          echo "${{ steps.changed-files.outputs.all_changed_files }}"

      - name: Validate YAML syntax
        run: |
          for file in ${{ steps.changed-files.outputs.all_changed_files }}; do
            echo "Validando $file"
            yamllint "$file" || exit 1
          done
</code></pre></div> <h3 id=jobs>Jobs<a class=headerlink href=#jobs title="Permanent link">¶</a></h3> <p>Jobs são os blocos de construção dos fluxos de trabalho do GitHub Actions. Eles representam unidades individuais de trabalho que consistem em uma série de steps, executadas em um ambiente específico. Um trabalho é definido dentro de um fluxo de trabalho do GitHub Actions usando a palavra-chave jobs , seguida por um identificador exclusivo e opções de configuração.</p> <p>Cada fluxo de trabalho é composto de um ou mais jobs, que são um grupo de tarefas que um único agente executará. Essas tarefas, chamadas steps.</p> <table> <thead> <tr> <th>Atributo</th> <th>Descrição</th> </tr> </thead> <tbody> <tr> <td>Name</td> <td>Um nome descritivo para o trabalho, que é exibido na interface do GitHub Actions.</td> </tr> <tr> <td>Runs on</td> <td>O nome do executor no qual a tarefa será executada é especificado usando a palavra-chave runs-on. Pode ser um executor hospedado no GitHub, como ubuntu-latest, windows-latest ou macos-latest, ou um executor auto-hospedado.</td> </tr> <tr> <td>Steps</td> <td>Uma sequência de etapas que executam tarefas individuais, como verificar código, executar um script ou usar uma ação pré-criada.</td> </tr> </tbody> </table> <h4 id=job-em-execucao>Job em Execução<a class=headerlink href=#job-em-execucao title="Permanent link">¶</a></h4> <p>Um job representa um conjunto de tarefas que serão executadas sequencialmente pelo mesmo agente. Um fluxo de trabalho, portanto, contém pelo menos um job, mas pode ter dezenas deles, se necessário.</p> <p>O importante a lembrar é que cada job é executado por um agente diferente. Cada job é composto de vários elementos:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Um nome simples e chave que será exibido se a propriedade name não for preenchida;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Um nome de propriedade (opcional), que serve apenas para legibilidade em logs;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Uma propriedade runs-on, a mais importante, define o tipo de máquina virtual na qual o job será executado;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Uma propriedade Steps, que contém um conjunto de tarefas a serem executadas;</li> </ul> <div class=highlight><pre><span></span><code>jobs:
  print-tag:                      # Um nome simples e chave que será exibido se a propriedade name não for preenchida
    name: Horacio                 # Um nome de propriedade (opcional),
    runs-on: ubuntu-latest        # Define o tipo de máquina virtual na qual o job será executado.
    if: ${{ inputs.print_tags }}
    steps:
      - name: Print the input tag to STDOUT
        run: |
        [...]
</code></pre></div> <p>A seção <code>runs-on</code> é a mais crítica de todas porque você terá que selecionar um sistema operacional específico dependendo das tarefas que você tem que executar.</p> <p>Por exemplo, escolher uma máquina Windows para compilar um aplicativo <code>.Net</code> ou uma máquina macOS para construir um aplicativo iOS.</p> <p>Se você escolher uma tarefa que precisa do Windows e cujas solicitações de fluxo de trabalho são executadas em uma máquina Linux, a tarefa travará no tempo de execução, porque o GitHub não realizou nenhum controle inicial.</p> <p>Aqui estão as escolhas possíveis atuais de máquinas virtuais:</p> <table> <thead> <tr> <th>Virtual machine</th> <th>Label</th> </tr> </thead> <tbody> <tr> <td>Windows Server 2022</td> <td>windows-latest or windows-2022</td> </tr> <tr> <td>Windows Server 2019</td> <td>windows-2019</td> </tr> <tr> <td>Ubuntu 24.04</td> <td>self-hosted ou ubuntu 22.04</td> </tr> <tr> <td>macOS Sequoia 15.0</td> <td>macos-latest or macos-15</td> </tr> <tr> <td>macOS Sonoma 14.0</td> <td>macos-latest or macos-14</td> </tr> <tr> <td>macOS Ventura 13.0</td> <td>macos-13</td> </tr> </tbody> </table> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Executores ARM: Os executores ARM estão disponíveis apenas para planos Teams/Enterprises.</li> </ul> <p>A maioria dessas VMs vem com 2 CPUs, 7 Gb de RAM e 14 Gb de armazenamento (SSD), mas CPU/RAM são duplicados se seu repositório for público. Se você estiver procurando por executores com processadores Arm64 ou GPU, eles são reservados apenas para os planos de preços Teams/Enterprise.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Um fluxo de trabalho pode conter vários trabalhos.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> É importante observar que cada um desses trabalhos será executado em uma máquina virtual diferente, mesmo se o mesmo sistema operacional for especificado.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Portanto, se você planeja transmitir dados de um trabalho para outro, será necessário usar mecanismos mais complexos ou serviços de terceiros.</li> </ul> <h4 id=jobs-em-conteiner>Jobs em contêiner<a class=headerlink href=#jobs-em-conteiner title="Permanent link">¶</a></h4> <p>Executar trabalhos em um contêiner permite controlar o ambiente no qual seus trabalhos são executados. Para executar um trabalho em um contêiner, você especifica a imagem do contêiner usando a palavra-chave <code>container</code> no seu arquivo de fluxo de trabalho.</p> <div class=highlight><pre><span></span><code>name: Node Version in a container

on:
  workflow_dispatch:

jobs:
  node_job:
    runs-on: ubuntu-latest
    container:
      image: node:12
    steps:
      - name: Run a command
        run: node --version
</code></pre></div> <h4 id=servicos-em-execucao>Serviços em execução<a class=headerlink href=#servicos-em-execucao title="Permanent link">¶</a></h4> <p>Serviços no GitHub Actions são contêineres adicionais que hospedam software não executado diretamente no ambiente do executor do GitHub Actions, mas necessário para seus fluxos de trabalho. Esses serviços são semelhantes a <code>contêineres sidecar</code> ou <code>contêineres vinculados no Docker</code>.</p> <h5 id=diferencas>Diferenças<a class=headerlink href=#diferencas title="Permanent link">¶</a></h5> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Imagens de serviço personalizadas: Especificar qualquer imagem do Docker disponível no Docker Hub ou outro registro do Docker para seu serviço.</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Service options:</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Health checks:</li> </ul> <div class=highlight><pre><span></span><code>jobs:
  my_job:
    runs-on: ubuntu-latest
    services:
      my_database:
         image: postgres:15
         env:
           POSTGRES_USER: postgres
           POSTGRES_PASSWORD: postgres
         options: &gt;-
                   --health-cmd pg_isready
                   --health-interval 10s
                   --health-timeout 5s
                   --health-retries 5
    steps:
       # Steps that interact with the database go here
</code></pre></div> <h5 id=beneficios-dos-servicos>Benefícios dos serviços<a class=headerlink href=#beneficios-dos-servicos title="Permanent link">¶</a></h5> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Teste de integração de banco de dados</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Teste de microsserviços: se seu aplicativo for composto de vários microsserviços, você pode querer testar como esses serviços interagir;</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Running Selenium tests: Iniciar um contêiner executando o servidor Selenium ou navegador necessário;</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Caching: Se seu aplicativo usa um sistema de cache, como Redis ou Memcached, você pode usar o recurso de serviços para iniciar um contêiner executando esse sistema de cache.</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Message queues:como RabbitMQ ou Kafka, você pode usar o recurso de serviços para inicie um contêiner executando essa fila de mensagens.</li> </ul> <h4 id=dependencias-entre-seus-trabalhos>Dependências entre seus trabalhos<a class=headerlink href=#dependencias-entre-seus-trabalhos title="Permanent link">¶</a></h4> <p>Os trabalhos do mesmo fluxo de trabalho são executados <strong>em paralelo e independentementes</strong> um do outro (=iniciar simultaneamente).</p> <p>Isso permite, por exemplo, compilar um aplicativo para Android em um agente Linux e um aplicativo para iOS em um agente macOS simultaneamente, em vez de um após o outro.</p> <p>No entanto, há muitos casos em que precisaremos executar os jobs sequencialmente. Para isso, é necessário adicionar o atributo <code>needs:</code> no job que queremos ver executando após o outro:</p> <p><div class=highlight><pre><span></span><code>jobs:
  job1:
  job2:
     needs: job1
   job3:
     needs: [job1, job2]
</code></pre></div> No exemplo anterior, o job1 deve ser executado inteiramente e com sucesso para que o job2 comece.</p> <p>Uma vez que o job2 for concluído com sucesso, o job3 será iniciado porque depende do job1 e do job2. Poderíamos ter apenas colocado uma dependência no job2 neste caso.</p> <p>Também é possível configurar um job para que ele seja executado após outro job que foi concluído com sucesso ou não.</p> <p>Útil para um job de limpeza final, por exemplo. Este comportamento é configurado usando a palavra-chave condicional if e o valor always().</p> <div class=highlight><pre><span></span><code>  jobs:
    job1:
      job2:
        needs: job1
        if: always()  # diz que será executado aconteça o que acontecer# mas depois do job1
</code></pre></div> <p>Por outro lado, é possível executar um job somente se o job do qual ele depende falhou. Portanto, é comum usar esse tipo de etapa de configuração para ações de cancelamento que não foram bem-sucedidas (rollback):</p> <div class=highlight><pre><span></span><code>      job1:
        job2:
          needs: job1
        if: failure() # indica que ele só será executado se o Job1 falhar
</code></pre></div> <h4 id=operator-description>Operator Description<a class=headerlink href=#operator-description title="Permanent link">¶</a></h4> <table> <thead> <tr> <th>Operador</th> <th>Descrição</th> </tr> </thead> <tbody> <tr> <td><code>( )</code></td> <td>Logical grouping</td> </tr> <tr> <td><code>[ ]</code></td> <td>Index</td> </tr> <tr> <td><code>.</code></td> <td>Property de-reference</td> </tr> <tr> <td><code>!</code></td> <td>Not</td> </tr> <tr> <td><code>&lt;</code></td> <td>Less than</td> </tr> <tr> <td><code>&lt;=</code></td> <td>Less than or equal</td> </tr> <tr> <td><code>&gt;</code></td> <td>Greater than</td> </tr> <tr> <td><code>&gt;=</code></td> <td>Greater than or equal</td> </tr> <tr> <td><code>==</code></td> <td>Equal</td> </tr> <tr> <td><code>!=</code></td> <td>Not equal</td> </tr> <tr> <td><code>&amp;&amp;</code></td> <td>And</td> </tr> <tr> <td><code>||</code></td> <td>Or</td> </tr> </tbody> </table> <h4 id=status-check-functions>Status check functions<a class=headerlink href=#status-check-functions title="Permanent link">¶</a></h4> <table> <thead> <tr> <th>Condição</th> <th>Descrição</th> </tr> </thead> <tbody> <tr> <td>success()</td> <td>Quando o trabalho anterior foi (implícito)</td> </tr> <tr> <td>failure()</td> <td>Quando o trabalho anterior falhou</td> </tr> <tr> <td>cancelled()</td> <td>Quando o trabalho anterior foi cancelado</td> </tr> <tr> <td>always()</td> <td>O tempo todo, se os trabalhos anteriores foram bem-sucedidos ou não</td> </tr> </tbody> </table> <h4 id=gerenciamento-de-cache>Gerenciamento de cache<a class=headerlink href=#gerenciamento-de-cache title="Permanent link">¶</a></h4> <p>Os fluxos de trabalho podem utilizar caches dentro de um repositório. A ação de cache do GitHub que salva e restaura artefatos e dependências de cache pode ajudar a reduzir massivamente os tempos de compilação e melhorar o desempenho. A introdução do cache requer que duas etapas sejam adicionadas: <code>restore</code> de um cache e <code>save</code> em um cache.</p> <h4 id=gerenciamento-de-artefatos>Gerenciamento de Artefatos<a class=headerlink href=#gerenciamento-de-artefatos title="Permanent link">¶</a></h4> <p>Os fluxos de trabalho podem produzir artefatos e utilizar caches dentro de um repositório. Os artefatos de upload e download dos seus fluxos de trabalho.</p> <p><div class=highlight><pre><span></span><code>build:
  runs-on: ubuntu-latest
  ...
- uses: actions/upload-artifact@vx
  with:
    name: my-app
    path: dist/
    retention-days: 1
deploy-job:
needs: [ build ]

steps:
- uses: actions/download-artifact@vx
  with:
    name: my-app
    path: downloaded-content
- run: |
        ls downloaded-content
</code></pre></div> Essas limitações devem ser consideradas ao dividir seus fluxos de trabalho, especialmente se você os usa em projetos profissionais com várias pessoas trabalhando em paralelo.</p> <h2 id=como-jobs-funcionam>Como Jobs funcionam<a class=headerlink href=#como-jobs-funcionam title="Permanent link">¶</a></h2> <h4 id=configuracoes-especificas-do-ambiente>Configurações específicas do ambiente<a class=headerlink href=#configuracoes-especificas-do-ambiente title="Permanent link">¶</a></h4> <p>Configurações específicas de ambiente no GitHub Actions permitem que você defina diferentes configurações ou segredos para diferentes ambientes. Introduza uma <strong>restrição de ramificação</strong> de implantação usando o menu suspenso Ramos selecionados para trazer um padrão de ci/*, que permite para bloquearmos explicitamente a execução no ambiente para este caminho de ramificação.</p> <p>Adicionar aprovações ao seu fluxo de trabalho pode ajudar a atingir as principais etapas de governança</p> <h3 id=matrix-strategy>Matrix strategy<a class=headerlink href=#matrix-strategy title="Permanent link">¶</a></h3> <p>Para garantir testes e implantação eficientes em diferentes ambientes, você pode executar um único trabalho em várias combinações de plataformas, sistemas operacionais ou versões de idioma com duplicação mínima de configuração. O exemplo mais comum disso é executar compilações em máquinas diferentes.</p> <h2 id=estruturacao-de-fluxo-de-trabalho>Estruturação de Fluxo de Trabalho<a class=headerlink href=#estruturacao-de-fluxo-de-trabalho title="Permanent link">¶</a></h2> <p>Estruturar seus fluxos de trabalho do GitHub Actions e estabelecer <strong>bons hábitos</strong> desde o início é essencial para garantir a manutenibilidade, a legibilidade e a eficiência. Aqui estão algumas práticas recomendadas:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Mantenha os fluxos de trabalho focados e concisos;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Use nomes descritivos;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Utilize possivelmente a categoria do Workflow(maintenance,ongoing, manual e etc.)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> run-name: NOME-DESEJADO ${{ github.actor }}</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Utilize a estratégia de matriz para testar em vários ambientes;</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Use variáveis de ambiente e segredos com sabedoria;</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Utilize versões de ação (pode especificar uma versão específica, uma versão principal ou até mesmo um SHA de confirmação para garantir que você esteja usando uma versão estável);</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Use needs para gerenciar dependências de trabalho;</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Lidar com falhas de forma eficaz: Ao utilizar a condicional if junto com as funções failure(), success() ou cancelled() , você pode decidir o que os trabalhos ou etapas subsequentes devem fazer com base no status dos trabalhos anteriores.</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Mantenha o código DRY (Don't Repeat Yourself) com fluxos de trabalho reutilizáveis;</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Use executores auto-hospedados quando necessário;</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Revise e atualize os fluxos de trabalho regularmente</li> </ul> <h2 id=steps>Steps<a class=headerlink href=#steps title="Permanent link">¶</a></h2> <p>A parte mais rica de um fluxo de trabalho é representada pelo bloco steps que contém todas as ações que um fluxo de trabalho executa. Essas ações são precisamente essas famosas GitHub Actions, módulos que executam uma tarefa específica e que podem ser facilmente combinados dentro de um fluxo de trabalho.</p> <p>Você pode escolher entre:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Executar um comando, uma linha de comando simples ou uma série de comandos</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Executar uma Action, um módulo rico, personalizável e reutilizável criado anteriormente por outra pessoa</li> </ul> <p>Há três tipos principais de steps em um fluxo de trabalho do GitHub Actions:</p> <table> <thead> <tr> <th>Tipo de Steps</th> <th>Descrição</th> </tr> </thead> <tbody> <tr> <td>Shell commands</td> <td>Execute comandos de shell ou scripts diretamente no ambiente do executor</td> </tr> <tr> <td>Built-in actions</td> <td>Utilize ações fornecidas pelo GitHub, como actions/checkout ou actions/setup-node</td> </tr> <tr> <td>Community and third-party actions</td> <td>aproveite ações criadas pela comunidade do GitHub ou serviços de terceiros para simplificar e automatizar tarefas específicas</td> </tr> </tbody> </table> <h3 id=propriedades-do-steps>Propriedades do Steps<a class=headerlink href=#propriedades-do-steps title="Permanent link">¶</a></h3> <table> <thead> <tr> <th>Tipo de Steps</th> <th>Descrição</th> </tr> </thead> <tbody> <tr> <td>id</td> <td>Identificador do Step</td> </tr> <tr> <td>name</td> <td>Um nome descritivo para a etapa exibida na interface</td> </tr> <tr> <td>run</td> <td>O comando ou script a ser executado, normalmente usado para comandos ou scripts de shell</td> </tr> <tr> <td>uses</td> <td>O identificador da ação a ser usada, geralmente no formato usuário/repositório@versão</td> </tr> <tr> <td>with</td> <td>Um conjunto de parâmetros de entrada para passar para a ação, especificados como pares chave-valor</td> </tr> <tr> <td>if</td> <td>Um conjunto de parâmetros de entrada para passar para a ação, especificados como pares chave-valor</td> </tr> </tbody> </table> <h2 id=executar-um-comando>Executar um comando<a class=headerlink href=#executar-um-comando title="Permanent link">¶</a></h2> <p>A execução de um comando é o equivalente a uma tarefa CMD no Windows ou um comando bash no Linux. Ele executa uma linha de comando simples e retorna o resultado para o console. Frequentemente usado para exibir uma mensagem, para executar uma operação em arquivos, às vezes é usado para iniciar comandos do sistema ou scripts de terceiros como vimos no capítulo anterior com "npm install" e "gulp build". Este tipo de tarefa é reconhecível pela presença da palavra-chave run.</p> <p>Uma etapa de execução se parece com isso: <code>- run: echo 'Execução do meu comando'</code></p> <p>Caso você queira executar vários comandos, você terá a opção entre duplicar cada etapa com um único comando ou usar um caractere pipe (1) e combinar comandos com o seguinte formato:</p> <div class=highlight><pre><span></span><code>steps:
 #way of doing no 1
  - run: echo 'Hello'
  - run: echo 'World'
#way of doing n°2-
run: | # Indicates that multiple commands have to be executed
      echo 'Hello'
      echo 'World'
</code></pre></div> <p>A escolha de um ou outro tem forte incidência porque cada tarefa (passo) é executada em um contexto diferente. Assim, se um comando define uma variável local, o próximo passo não pode acessar essa variável. Veremos mais adiante como é possível fazer a mesma coisa usando variáveis de saída e/ou ambientes.</p> <div class=highlight><pre><span></span><code>steps:
    - run: MY_VARIABLE="hello"
    - run: echo $MY_VARIABLE # does not work
</code></pre></div> <p>Também é comum dar um alias para cada etapa por meio do nome da propriedade, o que, embora completamente opcional, traz mais clareza:</p> <p><div class=highlight><pre><span></span><code>  steps:
    - name: My first command
      run: echo 'Execution of my command'
    - name: my second command
      run: echo 'Execution of my second command'
</code></pre></div> Esta propriedade facilita a diferenciação e análise de logs de execução de fluxo de trabalho exibidos no portal da Web GitHub.</p> <p>Uma das propriedades mais interessantes para execuções de comando é a propriedade shell que permite especificar o interpretador do comando. Assim, é possível executar um comando do PowerShell ou do sistema sem configuração adicional ou instalação de um tempo de execução específico.</p> <div class=highlight><pre><span></span><code>steps:
 - name: Start a PowerShell command
    run: Write-Host "Hello"
  shell: pwsh # specifies that we want a PowerShell shell
- name: Start a Python command
   run: print("Hello")
   shell: python # specifies that we want a python shell
</code></pre></div> <p>Esta propriedade shell pode ter valores diferentes, cada um direcionando um ambiente de linha de comando específico que depende do ambiente que foi designado para a execução do trabalho (runs-on). Aqui está a lista exaustiva:</p> <div class=highlight><pre><span></span><code>Platform | Setting | Descriptio | Commandnlaunched  |
All      | bash    | The default shell on non- | bash -noprofile |
</code></pre></div> <p>Essa liberdade permite executar scripts personalizados e especificar o interpretador relevante. No caso a seguir, o código snippet permite que você execute um script bash:</p> <div class=highlight><pre><span></span><code> steps:
   - run: ./.github/scripts/build.sh
    shell: bash
</code></pre></div> <p>Além das propriedades name e shell, cada passo de comando (e os "passos de ação" que veremos logo depois) tem propriedades adicionais opcionais que serão vistas em detalhes ao longo dos capítulos deste livro. Entre essas propriedades, você encontrará em particular:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> id: identificador único do passo quando você deseja interagir com o passo, como recuperar suas variáveis de saída ⚫</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> with: para transmitir parâmetros para o comando/ação</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> env: para declarar variáveis locais no nível do passo</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> if: para tornar condicional a execução do passo</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> continue-on-error: para evitar que um passo seja considerado como falha mesmo quando um problema surge ou que um de seus comandos retorna um código de erro</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> timeout-minutes: para forçar a parada de um passo se ele exceder o limite de tempo</li> </ul> <h2 id=fluxos-de-trabalho-reutilizaveis>Fluxos de trabalho reutilizáveis<a class=headerlink href=#fluxos-de-trabalho-reutilizaveis title="Permanent link">¶</a></h2> <p>Os fluxos de trabalho reutilizáveis no GitHub Actions permitem que você defina um modelo de fluxo de trabalho que pode ser reutilizado em vários repositórios ou projetos.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <strong>Pipelines de CI/CD padronizados</strong>: Permitem que você estabeleça pipelines de CI/CD padronizados em toda a sua organização.</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> <strong>Colaboração eficiente</strong>: Aproveitar fluxos de trabalho predefinidos, reduzindo a necessidade de reinventar a roda para cada projeto.</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> <strong>Promover uma cultura DevOps</strong>: As equipes de desenvolvimento podem se concentrar na escrita de código enquanto confiando em práticas e processos estabelecidos.</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> <strong>Integração acelerada</strong>: Fluxos de trabalho reutilizáveis simplificam o processo de integração para novos membros da equipe.</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> <strong>Manutenção e atualizações</strong>: Alterações ou melhorias em um fluxo de trabalho reutilizável podem ser aplicadas automaticamente a todos os repositórios que o utilizam.</li> </ul> <p>Os fluxos de trabalho reutilizáveis promovem a reutilização, a consistência e a manutenibilidade do código ao encapsular tarefas comuns em uma unidade modular.</p> <table> <thead> <tr> <th>Local</th> <th>Reutilizáveis</th> <th>Normal</th> </tr> </thead> <tbody> <tr> <td>Escopo</td> <td>Escopo mais amplo e a vários repositórios</td> <td>Limitados a um único repositório.</td> </tr> <tr> <td>Lógica compartilhada</td> <td>Lógica comum</td> <td>Cada um com o seu modelo</td> </tr> <tr> <td>Manutenção centralizada</td> <td>Alterações são propagadas automaticamente</td> <td>Liminado ao Workflow e Repositório</td> </tr> </tbody> </table> <p>Os fluxos de trabalho reutilizáveis podem ser benéficos:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Processos de build e teste padronizados;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Pipelines de Integração Contínua (CI);</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Pipelines de implantação;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Gerenciamento de liberação;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Verificações de segurança e conformidade;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Geração de documentação;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Formatação e estilo de código;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Testes multiplataformam;</li> </ul> <h3 id=limitacoes-dos-fluxos-de-trabalho-reutilizaveis>Limitações dos fluxos de trabalho reutilizáveis<a class=headerlink href=#limitacoes-dos-fluxos-de-trabalho-reutilizaveis title="Permanent link">¶</a></h3> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Variáveis de Ambiente definidas no nível do chamador não podem ser acessadas dentro do fluxo de trabalho reutilizável e vice-versa;</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Estruturas de fluxo de trabalho sigam parâmetros específicos, incluindo não ultrapassar quatro níveis de profundidade;</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Evite chamadas para mais de 20 fluxos de trabalho reutilizáveis de um único arquivo de fluxo de trabalho;</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Fluxo de trabalho reutilizável não pode chamar outro fluxo de trabalho reutilizável.</li> </ul> <h2 id=understanding-composite-actions>Understanding composite actions<a class=headerlink href=#understanding-composite-actions title="Permanent link">¶</a></h2> <p>Elas permitem que você encapsule uma sequência de etapas em uma única ação, que pode ser facilmente reutilizada em vários fluxos de trabalho e repositórios.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Encapsulamento: Encapsulam uma sequência de etapas em uma única unidade reutilizável</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Reutilização: Ações compostas podem ser facilmente reutilizadas em vários fluxos de trabalho</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Personalização: Podem aceitar parâmetros de entrada, permitindo personalização e flexibilid</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Modularidade: Permitem que você divida fluxos de trabalho complexos em unidades menores e independentes, melhorando a manutenibilidade e facilitando a organização do código.</li> </ul> <h3 id=limitacoes-dos-composite-actions>Limitações dos composite actions<a class=headerlink href=#limitacoes-dos-composite-actions title="Permanent link">¶</a></h3> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Permissões e segredos: Não têm acesso direto aos segredos do repositório ou outras informações confidenciais.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Incapacidade de modificar o ambiente: Não podem modificar diretamente o ambiente ou contexto em que são executadas.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Controle de simultaneidade limitado: Não têm controle de simultaneidade integrado;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Profundidade de aninhamento de ação: uma ação composta tem um limite de aninhamento de 20 níveis.</li> </ul> <h2 id=criando-uma-acao-composta-local>Criando uma ação composta local<a class=headerlink href=#criando-uma-acao-composta-local title="Permanent link">¶</a></h2> <p>Envolve a criação de uma ação composta sob o repositório local e referenciando-o a partir de um fluxo de trabalho local.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Permite que você experimente antes de movê-lo para um repositório reutilizável;</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> <code>uses: YOUR_ORG/GHA.workflows/.github/workflows/gha.workflows.build-node.yml@main</code></li> </ul> <h2 id=execucao-de-uma-acao>Execução de uma Ação<a class=headerlink href=#execucao-de-uma-acao title="Permanent link">¶</a></h2> <p>Suponha que seja possível fazer quase tudo apenas com passos run. Nesse caso, o verdadeiro poder do GitHub Actions vem da possibilidade de chamar diretamente módulos de script complexos que outras pessoas criaram. Esses módulos (os famosos GitHub Actions) são, como veremos mais adiante no livro, scripts simples colocados em um pacote que facilita seu download, configuração e execução.</p> <p>Você pode chamar uma Action com a palavra-chave uses, especificando o nome e a "versão" da ação a ser executada. Isso pode ser feito usando três variações: - [x] <strong>Usando a versão da ação</strong>: que permite direcionar uma versão específica (um lançamento correspondente a essa versão deve ter sido criado) - [x] <strong>Via branch da ação</strong>: que permite usar uma versão em desenvolvimento sem precisar de nenhum lançamento existente - [x] <strong>Via hash da ação</strong>: pode direcionar um commit específico. Cada um desses métodos fornece o mesmo resultado em termos de execução, mas corresponde a diferentes casos de uso. Por exemplo, quando criamos nossa ação, e ela está sendo desenvolvida, é mais fácil usar o branch de desenvolvimento dessa ação. Dessa forma, se a criação for feita de forma iterativa, o fluxo de trabalho sempre pegará a última versão, e a publicação do release oficial só precisará ser feita quando o código estiver pronto:</p> <p><div class=highlight><pre><span></span><code>  - uses: Igmorand/github-action-hello@main # take the main branch
</code></pre></div> Este método deve ser reservado para desenvolvimento e uso de suas ações. Não o use para ações de terceiros; o risco é muito grande para quebrar seu fluxo de trabalho ou de uma perspectiva de segurança. A prática atual é confiar em uma versão "fixa" de uma ação que garanta a estabilidade do código. O conceito de versionamento é visto em detalhes em um capítulo posterior neste livro; veja isso simplesmente como uma versão de software. Quando uma ação é estável e totalmente funcional, é costume que o código seja marcado para congelar sua versão. É então possível direcionar a tag, que serve como o número da versão.</p> <p><div class=highlight><pre><span></span><code>  - uses: 60pportunities/github-action-hello@v1 # V1 is the tag corresponding to a release
</code></pre></div> Na última maneira, a chamada via hash de uma ação tem como alvo um commit específico. Em alguns casos, essa maneira de fazer as coisas é considerada uma boa prática de segurança, mas vem com limitações. Este tópico é discutido no capítulo Conceitos avançados › Segurança.</p> <div class=highlight><pre><span></span><code>  - uses: 60pportunities/github-action-hello@4ad9596b7c626f5cef5b66419d00bafac1950066 # hash (SHA)of a commit
</code></pre></div> <p>É o único método para garantir uma versão imutável da ação carregada em seu fluxo de trabalho. Se isso pode ser lógico à primeira vista, isso significa que se a ação, que está em um repositório próprio, altera ou corrige um bug nela, essa correção/melhoria nunca será cobrada pelo seu fluxo de trabalho. Por outro lado, se você referenciar uma ação "v1", seu fluxo de trabalho baixará quaisquer atualizações dela. Então, se o autor da ação publicar uma versão "v1.1", ela será cobrada pelo seu fluxo de trabalho sem nenhuma intervenção de sua parte ou sem ser notificado porque v.1.1 é uma versão de lançamento menor de v.1.</p> <p>Importante: Se você quiser saber mais sobre essas mecânicas, leia o capítulo dedicado: Criar uma Ação › Versionamento. Você encontrará todos os pontos de atenção e como usá-los seguindo as boas práticas.</p> <p>Também há a opção de chamar uma Ação privada. Uma Ação privada é qualquer Ação que vem do mesmo repositório do qual é chamada. Esse mecanismo é útil quando você deseja usar uma Ação de sua criação sem expô-la ao público. Atualmente (embora esteja no roteiro do GitHub), uma ação deve estar em um repositório público para ser utilizável. Portanto, é impossível usar uma ação que viria de outro repositório pertencente a você sem ser exposto ao público.</p> <p>Para usar uma Ação privada, basta especificar o caminho da pasta que contém os diferentes arquivos em sua ação:</p> <p><code>- uses: ./chemin/github-action-hello</code></p> <p>Por convenção, espera-se que ações privadas sejam armazenadas na pasta .github/actions, mas isso não é obrigatório. Por outro lado, fluxos de trabalho devem estar em .github/workflows.</p> <p><code>- uses: ./.github/actions/github-action-hello</code></p> <p>A combinação de ações e tarefas de execução oferece infinitas possibilidades. Portanto, é normal (até recomendado) usar as Ações o máximo possível e concluir o fluxo de trabalho com tarefas de execução quando nenhuma ação atende à sua necessidade ou se a necessidade é tão simples que o uso de uma ação de terceiros traria mais riscos do que benefícios.</p> <h2 id=execution-within-a-container>Execution within a container<a class=headerlink href=#execution-within-a-container title="Permanent link">¶</a></h2> <p>A liberdade dada dentro do fluxo de trabalho permite que você instale todos os componentes/ferramentas/programas necessários para executar as tarefas definidas no seu fluxo de trabalho. No entanto, a instalação dessas ferramentas pode ser longa e tornar cada execução do fluxo de trabalho ineficiente.</p> <p>O GitHub Actions permite que você execute tarefas dentro de um contêiner que será provisionado sob demanda. Além da vantagem de ser mais rápido, também permite ter o mesmo comportamento/ambiente, seja no computador do desenvolvedor ou por meio de um fluxo de trabalho em uma máquina virtual.</p> <p>O exemplo a seguir, através da propriedade container, solicita ao fluxo de trabalho que baixe (docker pull) a imagem do contêiner "node", para iniciar uma instância deste contêiner e carregar dentro dele os diferentes comandos. Desta forma, não há necessidade de instalar o NodeJS no agente GitHub, pois a imagem do nó já possui todas as ferramentas necessárias.</p> <div class=highlight><pre><span></span><code>jobs:
  build:
    runs-on: self-hosted
    container: 'node:current'
    steps:
      - uses: actions/checkout@v4
      - run: |
              npm install
              npm run build
</code></pre></div> <p>Aviso: É necessário especificar o sistema operacional subjacente (propriedade runs-on) porque os contêineres serão necessariamente contêineres Linux ou Windows e precisam de sistemas operacionais correspondentes.</p> <h2 id=descubra-novas-acoes>Descubra novas Ações<a class=headerlink href=#descubra-novas-acoes title="Permanent link">¶</a></h2> <p>A riqueza das Ações do GitHub é amplamente composta pelas ações criadas pela comunidade. No momento em que escrevo estas linhas, há mais de 9000 Ações publicadas no marketplace do GitHub: <a href="https://github.com/marketplace?type=actions">https://github.com/marketplace?type=actions</a>.</p> <p>Marketplace: Ações</p> <p>De lá, você pode acessar a página detalhada de cada ação. Esta página é extremamente importante porque lhe dirá a maneira de integrar esta ação em seu fluxo de trabalho, seus parâmetros, mas também informações importantes, como o autor ou o link para o repositório da ação, o que lhe fornecerá ainda mais informações, como a possibilidade de analisar seu código-fonte:</p> <p>Marketplace: página detalhada</p> <p>Quando você tiver alguma necessidade especial em um fluxo de trabalho, incluindo uma tarefa simples como instalar uma ferramenta, comece verificando se uma ação produzida por terceiros já existe. Usar sua ação provavelmente permite que você economize tempo, adicione recursos e simplifique seu fluxo de trabalho. Se você não encontrar o que está procurando entre as ações existentes, não hesite em crie sua própria Ação. Este tópico é abordado em detalhes no capítulo "Criar uma Ação Personalizada".</p> <h3 id=o-editor-de-fluxo-de-trabalho>O editor de fluxo de trabalho<a class=headerlink href=#o-editor-de-fluxo-de-trabalho title="Permanent link">¶</a></h3> <p>Com a prática, você ficará mais confiante para escrever fluxos de trabalho manualmente; no entanto, para facilitar sua escrita, o GitHub fornece um editor web dedicado à escrita de fluxos de trabalho que oferece recursos úteis, como um mecanismo de busca integrado para ações, linting de estrutura e preenchimento automático.</p> <h3 id=editor-de-fluxo-de-trabalho>Editor de fluxo de trabalho<a class=headerlink href=#editor-de-fluxo-de-trabalho title="Permanent link">¶</a></h3> <p>Este editor é ativado automaticamente ao abrir um arquivo YAML (a extensão *.yml ou *.yaml é obrigatória) localizado na pasta ".github/workflows". Se o arquivo YAML estiver em outro lugar, o GitHub o ignorará como fluxo de trabalho (= não será acionado) e o editor proposto será o editor de arquivo padrão. Pessoas que preferem trabalhar diretamente em seu computador com seu editor de código preferido também podem usar o mesmo facilidade, especialmente se o editor fornecer extensões de preenchimento automático. Por exemplo, o Visual Studio Code permite que você instale uma extensão que permite obter o mesmo preenchimento automático, a detecção de erros em seu YAML, mas também ver diretamente do Visual Studio Code os logs e os resultados de seus fluxos de trabalho, permitindo que você trabalhe totalmente localmente sem precisar abrir o portal da web. Dicas: Esta extensão foi escrita por Christopher Schleiden e pode ser encontrada aqui: <code>https://marketplace.visualstudio.com/items?itemName=github.vscode-github-actions</code> É muito mais avançado do que o editor nativo do portal da web.</p> <h3 id=gerenciamento-de-cache_1>Gerenciamento de cache<a class=headerlink href=#gerenciamento-de-cache_1 title="Permanent link">¶</a></h3> <p>Os fluxos de trabalho podem utilizar caches dentro de um repositório. A ação de cache do GitHub que salva e restaura artefatos e dependências de cache pode ajudar a reduzir massivamente os tempos de compilação e melhorar o desempenho.</p> <div class=highlight><pre><span></span><code>- name: Restore Cache
uses: actions/cache@v2
with:
path: ~/.npm
key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}
restore-keys: |
${{ runner.os }}-npm-
- name: Save Cache
uses: actions/cache@v2
with:
path: ~/.npm
key: ${{ runner.os }}-npm-${{ hashFiles('**/package-lock.json') }}
</code></pre></div> <h3 id=gestao-de-artefatos>Gestão de Artefatos<a class=headerlink href=#gestao-de-artefatos title="Permanent link">¶</a></h3> <p>Os fluxos de trabalho podem produzir artefatos e utilizar caches dentro de um repositório. Os artefatos de upload e download dos seus fluxos de trabalho e dependências de cache podem ajudar a reduzir massivamente os tempos de construção e melhorar o desempenho.</p> <div class=highlight><pre><span></span><code>- uses: actions/upload-artifact@v3
  with:
    name: my-app
    path: dist/
</code></pre></div> <h2 id=as-matrizes>As matrizes<a class=headerlink href=#as-matrizes title="Permanent link">¶</a></h2> <p>Um fluxo de trabalho pode conter vários trabalhos. Essa flexibilidade permite, por exemplo, compilar com um único fluxo de trabalho tanto um aplicativo móvel Android no Linux quanto um iOS no macOS. Também pode ser útil compilar o mesmo código-fonte com diferentes configurações do compilador, como um recurso habilitado ou não (chamado sinalizador de recurso), ou simplesmente compilar o mesmo aplicativo em várias versões da estrutura subjacente (Java, NodeJS, etc.).</p> <p>Suponha que esses vários trabalhos possam realizar várias ações em uma única execução. Nesse caso, isso tem a desvantagem de ter um arquivo de fluxo de trabalho muito longo e muitas linhas de código duplicadas, levando a uma manutenção mais complexa e possíveis erros. O GitHub Actions oferece uma solução para isso: as matrizes. Uma matriz, que é declarada como um conjunto de valores-chave, pode gerar proativamente mais trabalhos a partir de uma única definição: cada versão "gerada" é chamada de expansão. Vantagem: um arquivo, uma definição de trabalho, mas n trabalhos gerados automaticamente e configurados em tempo de execução. As matrizes são declaradas no nível do trabalho, como uma propriedade de uma estratégia e, em seguida, como uma subpropriedade chamada matriz, incluindo uma (ou mais) matriz(s) do tipo "chave: [valor1, valor2]". Os valores declarados serão acessíveis como variáveis por cada expansão. Neste primeiro exemplo, que visa gerar jobs com base no sistema operacional, a definição do job tem uma matriz cuja chave é os e cujos valores são "self-hosted", "windows-latest" e "macos-latest". A matriz injeta em cada expansão (serão, portanto, três delas, uma para cada valor) a variável chamada os com o respectivo valor. Esta variável fica então disponível como ${{ matrix.os }} dentro de cada job, permitindo, neste exemplo, obter um sistema operacional dinâmico.</p> <p>A declaração de uma matriz: <div class=highlight><pre><span></span><code>jobs:
myjob:
strategy:
Jobs
matrix:
os: [self-hosted, macos-latest, windows-latest]
runs-on: ${{ matrix.os }}
steps: # the actions #
</code></pre></div></p> <p>Ao executar o fluxo de trabalho, você vê uma execução única do fluxo de trabalho, mas ela contém a execução de três tarefas paralelas, para as quais os valores das matrizes são injetados:</p> <h2 id=execution-of-the-matrix>Execution of the matrix<a class=headerlink href=#execution-of-the-matrix title="Permanent link">¶</a></h2> <p>Observe que as matrizes também podem ser declaradas em um formato um pouco mais legível: <div class=highlight><pre><span></span><code>strategy:
matrix:
OS:
-self-hosted
-macos-latest
-windows-latest
</code></pre></div> Também é possível declarar várias matrizes, o que causará uma combinação de valores. Aqui, teremos 6 combinações possíveis e, portanto, 6 jobs: ubuntu+node10, ubuntu+node16, windows+node10, windows+node 16, macos+node10 e macos +node16:</p> <div class=highlight><pre><span></span><code>runs-on: ${{ matrix.os }}
strategy:
matrix:
os: [self-hosted, windows-latest, macos-latest]
node: [node10, node16]
steps:
- name: Setup Node
uses: actions/setup-node@v4
with:
node-version: ${{ matrix.node}}
</code></pre></div> <p>Importante: Um fluxo de trabalho não pode ter mais de 256 expansões de trabalho. Nesse caso, o fluxo de trabalho simplesmente não será iniciado.</p> <h2 id=exclusions>Exclusions<a class=headerlink href=#exclusions title="Permanent link">¶</a></h2> <p>Matrizes combinatórias podem, portanto, gerar todas as combinações desejadas. Você pode querer excluir uma ou mais combinações porque sabe que essa combinação não é útil. Em vez de gerar expansão e adicionar uma condição nas etapas para fazer "nada" neste caso específico, é possível evitar essa expansão em particular usando a propriedade exclude.</p> <p>No exemplo a seguir, temos duas matrizes (uma com 3 valores, a outra com 2 valores) e, portanto, 6 expansões no total. A adição de exclusão impedirá a combinação "macos-latest + 12":</p> <div class=highlight><pre><span></span><code>runs-on: ${{ matrix.os }}
strategy:
matrix:
os: [self-hosted, windows-latest, macos-latest]
node: [10, 12]
exclude:
- os: macos-latest
node: 12 # Note that there is no "-" in front of the key "node" because it is part of the same object as "os"
</code></pre></div> <p>Então, apenas 5 expansões serão executadas:</p> <h3 id=inclusions>Inclusions<a class=headerlink href=#inclusions title="Permanent link">¶</a></h3> <p>Por outro lado, você pode achar mais fácil adicionar combinações específicas. Por exemplo, queremos que as 6 expansões base testem a combinação NodeJS 8 + macOS no caso a seguir.</p> <p><div class=highlight><pre><span></span><code>runs-on: ${{ matrix.os }}
strategy:
matrix:
os: [self-hosted, windows-latest, macos-latest]
node: [10, 12]
include:
- os: macos-latest
  node: 8
</code></pre></div> Esse recurso de inclusão é muito mais útil do que pode parecer à primeira vista. De fato, ele permite, por exemplo, configurar compilações de sombra para verificar se o aplicativo pode operar em casos imprevistos, por exemplo, uma versão do framework normalmente não suportada pelo aplicativo.</p> <p>Por exemplo, aqui está um fluxo de trabalho destinado a compilar o aplicativo com Java 8 e 11 e adicionar uma combinação para compilar com Java 14. Essa combinação também adiciona uma chave "testing" atribuída à propriedade padrão de um trabalho continues-on-error. Essa propriedade especifica que um trabalho deve continuar, não importa o estado de suas etapas.</p> <div class=highlight><pre><span></span><code>jobs:
build:
strategy:.
matrix:
java: [8, 11]
testing: [false]
include:
-java: 14
testing: true
continue-on-error: ${{ matrix.testing }}
</code></pre></div> <h2 id=the-concept-of-fail-fast>The concept of fail-fast<a class=headerlink href=#the-concept-of-fail-fast title="Permanent link">¶</a></h2> <p>Quando você executa uma matriz, cada expansão é executada em paralelo em seu agente para ir mais rápido. Quando uma das expansões falha, as outras expansões são canceladas e param no meio de suas tarefas.</p> <p>Esse comportamento é o comportamento padrão de uma estratégia porque é padrão pensar que a partir do momento em que parte do fluxo de trabalho falha. Portanto, o fluxo de trabalho em sua totalidade não pode ser considerado um sucesso, e que é necessário parar qualquer trabalho inútil que seria caro em tempo (e financeiramente). Isso é chamado de fail fast para parar o mais rápido possível, para corrigir rapidamente e tentar novamente. Na captura a seguir, você pode ver que as versões do Windows e do macOS mudaram para o status "cancelado" assim que o fluxo de trabalho do Ubuntu falhou.</p> <p>No entanto, isso pode acontecer, seja porque você está depurando um fluxo de trabalho ou simplesmente porque deseja que cada expansão de uma matriz conclua suas tarefas. Portanto, você tem que desabilitar esse comportamento fail-fast. Para fazer isso, adicione a propriedade fail-fast (com o valor false) à sua estratégia.</p> <div class=highlight><pre><span></span><code>strategy:
matrix:
os: [self-hosted, macos-latest, windows-latest]
fail-fast: false # expansions won't stop
</code></pre></div> <p>Neste momento, cada expansão de matriz continuará até que seja concluída com sucesso ou falhe. No nosso caso, as versões macOS e Windows continuaram até o fim, mesmo que a expansão ubuntu tenha falhado:</p> <p>Aviso: Como você verá no próximo capítulo sobre runners, workflows paralelos impactam a soma dos minutos de execução e, portanto, impactam o custo mensal, principalmente se você desabilitar o fail-fast e deixar os workflows continuarem.</p> <h3 id=exercicios_1>Exercícios<a class=headerlink href=#exercicios_1 title="Permanent link">¶</a></h3> <p>Vamos colocar em prática através de alguns exercícios.</p> <h3 id=exercicio-n1_1>Exercício n°1<a class=headerlink href=#exercicio-n1_1 title="Permanent link">¶</a></h3> <p>Neste primeiro exercício, você deve editar o próximo workflow para compilar a aplicação com duas versões do .NET Framework (4.2.x e 5.0.x), mas também precisa compilar duas versões usando um parâmetro respectivamente debug e release:</p> <div class=highlight><pre><span></span><code>name: "matrix - exercise 1"
jobs:
build:
strategy:
matrix: # TO BE COMPLETED
steps:
- name: Retrieve source code
  uses: actions/checkout@v4
- name: Install .NET
  uses: actions/setup-dotnet@v4
   with:
dotnet-version: # TO BE COMPLETED
- name: Restore dependencies
  run: dotnet restore
- name: Build
   run: dotnet build --no-restore --configuration ${{ env.buildMode}}
env:
buildMode: # TO BE COMPLETED
</code></pre></div> <h3 id=exercise-n2_1>Exercise n°2<a class=headerlink href=#exercise-n2_1 title="Permanent link">¶</a></h3> <p>Quantos trabalhos são gerados com esse fluxo de trabalho?</p> <div class=highlight><pre><span></span><code>name: "matrix - exercise 2"
on:
workflow_dispatch:
jobs:
build:
runs-on: ${{ matrix.os}}
strategy:
matrix:
os: [self-hosted, windows-latest, macos-latest]
node: [10, 12]
include:
- os: macos-latest
 node: 8
exclude:
- os: macos-latest
  node: 10
- os: macos-latest
node: 8
steps:
- run: echo "I run on ${{ matrix.os }} with the Node version $ {{ matrix.node }}"
</code></pre></div> <h3 id=exercise-n3>Exercise n°3<a class=headerlink href=#exercise-n3 title="Permanent link">¶</a></h3> <p>Nossa necessidade é criar um fluxo de trabalho que implante nosso aplicativo em oito servidores de produção. O número de servidores no futuro pode aumentar, e é inaceitável duplicar etapas. Portanto, queremos usar as matrizes para simplificar nosso fluxo de trabalho, conforme mostrado pelo seguinte YAML: <div class=highlight><pre><span></span><code>runs-on: self-hosted
strategy:
matrix:
server: [prod1, prod2, prod3, prod4, prod5, prod6, prod7, prod8]
steps:
 - name: Deploy application
    run: echo "Deploy on ${{ matrix.server}}"
</code></pre></div></p> <p>Este fluxo de trabalho funciona perfeitamente, mas a implantação em paralelo em todos os servidores de produção pode causar interrupção do serviço para os usuários. Nossa equipe de DevOps propõe fazer a implantação progressiva (implantação canário) e implantar nos servidores, no máximo 2 por vez. Altere o YAML para obter o comportamento esperado.</p> <p>Dica: leia a documentação oficial sobre matrizes para descobrir como fazer isso. Procure controlar o paralelismo.</p> <h3 id=tecnicas-de-depuracao-para-fluxos-de-trabalho>Técnicas de depuração para fluxos de trabalho<a class=headerlink href=#tecnicas-de-depuracao-para-fluxos-de-trabalho title="Permanent link">¶</a></h3> <p>Os recursos de depuração em fluxos de trabalho poderiam ser melhores. - [x] Se você receber um erro, verifique se o daemon do Docker está em execução no Docker Desktop instalado. - [ ] <code>gh act -l</code> - [ ] <code>gh act push -n</code></p> <h3 id=visual-studio-code-github-actions-plugin>Visual Studio Code GitHub Actions plugin<a class=headerlink href=#visual-studio-code-github-actions-plugin title="Permanent link">¶</a></h3> <p>editor de código popular Visual Studio Code e GitHub Actions.</p> <h2 id=runners>Runners<a class=headerlink href=#runners title="Permanent link">¶</a></h2> <p>Os agentes, também conhecidos como runners ou "runners hospedados no GitHub", são pequenos programas com apenas uma coisa a fazer: executar as tarefas dadas a eles e transmitir seus resultados de volta.</p> <table> <thead> <tr> <th></th> <th>GitHub-Hosted Runners</th> <th>Self-Hosted Runners</th> </tr> </thead> <tbody> <tr> <td>Configuração e manutenção</td> <td>Nenhuma configuração necessária; totalmente gerenciado pelo GitHub</td> <td>Requer configuração e manutenção manuais</td> </tr> <tr> <td>Custo</td> <td>Gratuito com limites de uso; cobranças por minutos extras</td> <td>Sem custo para o executor; custos de infraestrutura aplicáveis</td> </tr> <tr> <td>Escalabilidade</td> <td>Escala automaticamente com base na demanda</td> <td>Gerenciado manualmente com base na sua infraestrutura</td> </tr> <tr> <td>Controle de ambiente</td> <td>Ambientes predefinidos com controle limitado</td> <td>Controle total sobre o ambiente</td> </tr> <tr> <td>Sistemas operacionais</td> <td>Windows, Linux e macOS</td> <td>Qualquer sistema operacional que possa executar o aplicativo executor</td> </tr> <tr> <td>Segurança</td> <td>Seguro, mas executado em um ambiente compartilhado</td> <td>Potencialmente mais seguro, isolado em sua infraestrutura.</td> </tr> <tr> <td>Desempenho</td> <td>Recursos de desempenho fixos</td> <td>Pode ser adaptado às suas necessidades</td> </tr> <tr> <td>Acesso a recursos internos</td> <td>Limitado, a menos que use serviços auto-hospedados</td> <td>Acesso direto a redes e recursos internos</td> </tr> <tr> <td>Personalização</td> <td>Limitado a ambientes GitHub disponíveis</td> <td>Personalização completa da configuração</td> </tr> <tr> <td>Limites de uso</td> <td>Sujeito aos limites e cotas de uso do GitHub</td> <td>Determinado por seus próprios recursos</td> </tr> </tbody> </table> <p>Self-hosted runners can be:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Physical</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Virtual</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> In a container</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> On-premises</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> In a cloud</li> </ul> <h2 id=how-it-works>How it works<a class=headerlink href=#how-it-works title="Permanent link">¶</a></h2> <p>Um agente é um orquestrador; sua única "inteligência" é executar as tarefas descritas em um arquivo de fluxo de trabalho. O comportamento interno é o seguinte:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Um evento é acionado no GitHub (push, pull_request, etc.)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O GitHub verifica os fluxos de trabalho do repositório para ver se um ou mais fluxos de trabalho têm um gatilho correspondente ao evento</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O GitHub aciona a criação de um novo agente hospedado (é uma pequena máquina virtual, chamada de ambiente virtual)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O GitHub reserva o agente para um fluxo de trabalho específico (o agente só funcionará para este fluxo de trabalho)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O GitHub lê o arquivo YAML do fluxo de trabalho para detectar informações para injetar (segredos, variáveis de ambiente, variáveis do GitHub)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O GitHub envia tudo para o agente recém-criado</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O agente executa as tarefas uma por uma, enviando o resultado para o GitHub</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O GitHub integra os resultados, armazena-os em seu banco de dados e os exibe no portal, o que nos permite monitorar em "tempo real" o que acontece</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Uma vez que o agente concluiu seu trabalho, o agente é destruído No entanto, um agente é um programa com capacidades muito limitadas; ele só pode executar comandos sequencialmente e retornar seu resultado. Qualquer ação (compilar código, converter um arquivo, implantar, escanear, etc.) só é possível por meio da instalação de ferramentas de terceiros no sistema, ou por estarem presentes por padrão no sistema operacional escolhido, ou porque você solicita ao agente para instalá-las por meio de uma linha de comando durante o fluxo de trabalho.</li> </ul> <h2 id=pre-installed-tooling>Pre-installed tooling<a class=headerlink href=#pre-installed-tooling title="Permanent link">¶</a></h2> <p>Se for possível instalar qualquer ferramenta em um agente usando uma tarefa que baixaria e iniciaria um instalador, os agentes fornecidos pelo GitHub têm vários softwares e frameworks pré-instalados. Isso permite que esses agentes já estejam prontos para uso e tornem os fluxos de trabalho mais rápidos. Nos agentes do Windows, você encontrará .NET, Java, GO, PHP sendo pré-instalados e ferramentas CLI para implantar no Azure, AWS ou até mesmo AliCloud. No Linux, você terá, entre outras coisas, Mono, Ruby, GNU C++, Google Cloud SDK, etc. Se quiser saber em detalhes a lista de ferramentas pré-instaladas em cada sistema, a lista atualizada é mantida no repositório oficial: <a href=https://github.com/actions/virtual->https://github.com/actions/virtual-</a> enviroments/tree/main/images</p> <p>Se um programa necessário para seu fluxo de trabalho não estiver presente, basta instalá-lo você mesmo. Crie (ou use uma existente) uma tarefa que baixe a ferramenta necessária no início do seu fluxo de trabalho. Por exemplo, o livro que você está lendo atualmente foi escrito em Markdown, mas precisava de ferramentas para ser transformado em PDF/EPUB. Para fazer isso, o fluxo de trabalho precisa instalar duas ferramentas (Pandoc e LaTeX) antes que você possa usá-las.</p> <div class=highlight><pre><span></span><code>runs-on: ubuntu-20.04
steps:
name: installing Pandoc
run: sudo apt-get install --assume-yes pandoc
- name: installing pdflatex + modules
run: |
sudo apt-get install texlive-latex-base
sudo apt-get install texlive-fonts-recommended
sudo apt-get install texlive-latex-extra
sudo apt-get install texlive-xetex
- name: Generating the PDF version
run: pandoc -V documentclass-memoir --pdf-engine-xelatex from=markdown-blank_before_header -s $(cat _includes.txt) -o './ dist/GitHub Actions-par la pratique.pdf'
working-directory: ./book
</code></pre></div> <p>As possibilidades de ferramentas são infinitas; desde que o fluxo de trabalho possa baixar uma ferramenta e iniciar uma linha de comando (sem nenhuma interface gráfica de usuário) para instalá-la ou executá-la, qualquer software de terceiros deve ser fácil.</p> <h2 id=network-considerations>Network considerations<a class=headerlink href=#network-considerations title="Permanent link">¶</a></h2> <p>O fato de os agentes gerenciados pelo GitHub (GitHub hosted runners) serem hospedados na nuvem Microsoft Azure é uma vantagem clara: isso evita qualquer custo de manutenção específico (hardware, licença do sistema operacional, salário de pessoas, etc.). No entanto, isso também implica que esses agentes estão fora da rede da sua empresa.</p> <p>Se isso não é um problema para a maioria dos fluxos de trabalho, incluindo fluxos de trabalho de compilação (CI) que geralmente não precisam de nenhuma conexão específica, isso pode ser muito diferente para fluxos de trabalho de implantação. De fato, é comum que redes corporativas sejam fechadas para qualquer acesso externo por motivos de segurança; portanto, um agente de implantação externo (por estar na nuvem) seria bloqueado, conforme mostrado no diagrama a seguir:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=80% href=../img/github-runners-network.png><img alt src=../img/github-runners-network.png></a></p> <p>Devido a essa restrição de rede, alguns casos de uso em que os agentes do GitHub não atendem à necessidade ou em que a equipe de rede/segurança proíbe seu uso. A resposta para esse problema é o uso de agentes "auto-hospedados".</p> <h2 id=the-self-hosted-runners>The self-hosted runners<a class=headerlink href=#the-self-hosted-runners title="Permanent link">¶</a></h2> <p>O GitHub fornece agentes (chamados de "hosted runners" ou "managed agents") que fornecem para cada execução um ambiente "descartável" para compilar e/ou implantar seus aplicativos. Se eles são adequados para a maioria dos usos, em muitos casos, infelizmente não são suficientes. Se tivéssemos, por exemplo:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> A necessidade de compilar em um sistema operacional diferente dos propostos por padrão</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> A necessidade de compilar um aplicativo com acesso a hardware específico ou licença associada a este hardware (uso comum em IoT)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> A necessidade de implantar em servidores que não são acessíveis pela Internet (onde os agentes hospedados do GitHub estão)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Só precisa de um servidor de compilação com mais poder de computação (memória, CPU)</li> </ul> <p>Para muitos cenários possíveis em que os agentes padrão não são suficientes, existe uma solução: os "self-hosted runners", agentes que você mesmo gerencia.</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=80% href=../img/github-runners-network-01.png><img alt src=../img/github-runners-network-01.png></a></p> <h2 id=adding-a-new-agent>Adding a new agent<a class=headerlink href=#adding-a-new-agent title="Permanent link">¶</a></h2> <p>Os agentes auto-hospedados têm a vantagem de serem mais flexíveis e são livres do ponto de vista da licença. Ainda assim, eles têm um custo de manutenção, pois é sua responsabilidade garantir que eles estejam atualizados (a versão do agente do GitHub) e em servidores continuamente protegidos/corrigidos. Também devemos adicionar o custo implícito do servidor onde o agente está instalado (por exemplo, licença do sistema operacional, equipamento, eletricidade) e garantir a resiliência da plataforma, o que pode implicar ter vários servidores. Apesar desse custo, os agentes auto-hospedados geralmente fazem parte da solução em projetos corporativos.</p> <p>Você pode adicionar um número infinito de agentes por projeto, e sua instalação leva apenas alguns minutos. A declaração de um runner auto-hospedado é feita na tela Configurações &gt; Ações do seu repositório. Nesta tela, à direita, está localizado um bloco listando todos os runners registrados deste repositório:</p> <p>Clique em "Adicionar agente" para abrir uma nova tela que permite selecionar o sistema operacional correspondente ao servidor que hospedará seu runner. Essa escolha é crítica porque, ao instalar um runner em um runner do Windows, apenas fluxos de trabalho do "windows" (propriedade runs-on) serão executados por esse runner. Portanto, se um dos seus fluxos de trabalho exigir a execução de um trabalho no Windows e outro no Linux, você precisará de dois servidores diferentes com dois sistemas operacionais e dois runners.</p> <p>Aviso: se um agente estiver vinculado a apenas um repositório (exceto com o GitHub Enterprise), ainda será possível instalar vários agentes gerenciando vários projetos lado a lado no mesmo computador. Além dos problemas de segurança, os riscos de colisão (aplicativos instalados por cada projeto, incompatíveis entre si) são altos. Além disso, os diretórios de trabalho contêm uma cópia do código-fonte baixado e outros itens que potencialmente contêm dados confidenciais. No final do livro, no apêndice, um capítulo aborda em detalhes a criação de um agente em contêiner auto-hospedado, permitindo substituir essas limitações e reduzir esses riscos.</p> <p>Declarar um novo runner requer duas etapas. Primeiro, a instalação do runner. Após escolher o sistema operacional, o portal da Web fornece um comando para executar no servidor de destino; esse comando baixa e instala o runner corretamente.</p> <h2 id=acoes-adicionar-runner-auto-hospedado>Ações / Adicionar runner auto-hospedado<a class=headerlink href=#acoes-adicionar-runner-auto-hospedado title="Permanent link">¶</a></h2> <p>Adicionar um runner auto-hospedado requer que você baixe, configure e execute o GitHub Actions Runner. Ao baixar e configurar o Github Actions Runner, você concorda com os Termos de Serviço do GitHub ou os Termos de Serviço Corporativos do GitHub, conforme aplicável.</p> <h2 id=download-the-latest-runner-package>Download the latest runner package<a class=headerlink href=#download-the-latest-runner-package title="Permanent link">¶</a></h2> <p>Uma vez instalado, o segundo passo é configurar o runner para interagir com seu repositório de forma segura. O portal da Web gera um comando contendo a URL do repositório e um token de autenticação, que permite que o runner acesse o acesso de leitura/gravação ao seu repositório. O comando se parece com isso:</p> <div class=highlight><pre><span></span><code># Runner configuration
$ ./config.cmd --url https://github.com/60pportunities/book-github-actions --token C3C13STUNF4K3TOK3N
</code></pre></div> <p>Quando executado, o comando pede várias informações para personalizar o agente, como seu nome, seus rótulos e o tipo de execução (como um serviço ou manual). Claro, você também pode deixar esses valores vazios e deixar que a configuração use os valores padrão:</p> <h2 id=runner-configuration>Runner configuration<a class=headerlink href=#runner-configuration title="Permanent link">¶</a></h2> <p>Após a conclusão da configuração, o agente deve aparecer registrado no portal do GitHub com seu nome e rótulos. No entanto, seu status é inativo (offline). Esse status indica que o GitHub não se comunica com o agente porque um firewall está bloqueando as comunicações ou simplesmente porque o agente, embora instalado, não foi iniciado.</p> <p>Aviso: Um agente auto-hospedado é vinculado a um e apenas um repositório. Se você quiser compartilhar um agente entre repositórios, deverá ter uma conta do GitHub Enterprise e o executor no nível da organização.</p> <p>Para iniciar o executor, uma linha de comando é suficiente. Durante a execução deste comando, o agente se reporta ao GitHub como disponível e começa a escutar/aguardar.</p> <p>Após iniciado, o executor aparece como "Ocioso", o que significa que está pronto e aguardando para receber um fluxo de trabalho.</p> <h3 id=executor-disponivel-e-ativo>Executor disponível e ativo<a class=headerlink href=#executor-disponivel-e-ativo title="Permanent link">¶</a></h3> <p>Informações: Como veremos mais adiante neste capítulo, os rótulos são usados para reconhecer os executores e suas capacidades ou selecionar explicitamente um executor específico que executará o fluxo de trabalho.</p> <h3 id=how-to-use-our-self-hosted-runner>How to use our self-hosted runner?<a class=headerlink href=#how-to-use-our-self-hosted-runner title="Permanent link">¶</a></h3> <p>Quando um agente está devidamente registrado (status Idle), precisamos apenas informar ao workflow para usá-lo. Essa atribuição é feita por meio da propriedade "runs-on: self-hosted".</p> <p><code>runs-on: self-hosted</code></p> <p>A propriedade, como escrito acima, informa ao GitHub que o fluxo de trabalho deve ser executado por um dos agentes auto-hospedados. O texto "auto-hospedado" é um dos rótulos adicionados automaticamente ao agente durante sua configuração. Vários rótulos padrão são adicionados de acordo com a máquina na qual o agente está instalado:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> auto-hospedado: adicionado a todos os agentes auto-hospedados</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> linux, windows ou macOS: correspondente ao sistema operacional subjacente</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> x64, ARM ou ARM64: especifica a arquitetura do processador</li> </ul> <p>Esses rótulos, chamados de "rotas", permitem que você direcione um agente ou um grupo de agentes específico. Assim, ao combiná-los, é possível direcionar especificamente um agente cujas características técnicas executarão tarefas de fluxo de trabalho; na realidade, essas tarefas decidem implicitamente o tipo de agente necessário para sua conclusão adequada. O exemplo a seguir informa ao GitHub que o fluxo de trabalho deve ser executado por um agente auto-hospedado com um processador de 64 bits e instalado em um sistema operacional Windows:</p> <p><code>runs-on: [self-hosted, windows, x64]</code></p> <p>Os rótulos são declarados ao registrar o agente, mas também podem ser adicionados posteriormente usando a interface do portal do GitHub:</p> <p>Esta prática é especialmente útil quando seu agente está localizado em um servidor específico (por exemplo, um servidor de produção) ou um servidor fisicamente conectado a um dispositivo de hardware (IoT ou robótica). Ela permite que você dê um rótulo exclusivo a este agente e o direcione de forma muito específica. A escolha de um agente pelo GitHub é feita procurando os agentes candidatos que correspondem a todos os rótulos.</p> <p><code>runs-on: self-hosted, raspberry1 # target the runner which has both these labels</code></p> <h2 id=network-access>Network access<a class=headerlink href=#network-access title="Permanent link">¶</a></h2> <p>Suponha que o principal ativo dos executores auto-hospedados esteja sendo executado dentro da sua rede local e tenha apenas comunicações de saída. Nesse caso, é necessário permitir que o agente se comunique com o GitHub e abra os fluxos de comunicação relevantes. Aqui está a lista completa de URLs que devem ser abertas no seu firewall para permitir que o agente se comunique, coloque ou recupere itens no/do GitHub.</p> <p>Necessário para operações essenciais:</p> <p><div class=highlight><pre><span></span><code>github.com
api.github.com
*.actions.githubusercontent.com
````

Necessário para baixar ações:
</code></pre></div> codeload.github.com Needed for uploading/downloading job summaries and logs actions-results-receiver-production.githubapp.com *.blob.core.windows.net <div class=highlight><pre><span></span><code>Necessário para atualizações da versão do runner:
</code></pre></div> objects.githubusercontent.com objects-origin.githubusercontent.com github-releases.githubusercontent.com github-registry-files.githubusercontent.com <div class=highlight><pre><span></span><code>Necessário para carregar/baixar caches e artefatos de fluxo de trabalho:
```
*.blob.core.windows.net
Needed for retrieving OIDC tokens:
*.actions.githubusercontent.com
</code></pre></div></p> <p>Necessário para baixar ou publicar pacotes ou contêineres no GitHub Pacotes: <div class=highlight><pre><span></span><code>*.pkg.github.com
ghcr.io
</code></pre></div></p> <p>It will also be necessary to open access to the servers in your local network on which you want the agent to deploy your applications.</p> <h2 id=differences-between-the-two-types-of-runners>Differences between the two types of runners<a class=headerlink href=#differences-between-the-two-types-of-runners title="Permanent link">¶</a></h2> <p>Os runners autogerenciados trazem mais liberdade e mais recursos, mas vêm com mais restrições. Toda a parte normalmente gerenciada pelo GitHub (gerenciamento de atualizações, atualização dos componentes do sistema) agora deve ser gerenciada manualmente com uma sobrecarga não desprezível.</p> <h3 id=runners-managed-by-github>Runners managed by GitHub:<a class=headerlink href=#runners-managed-by-github title="Permanent link">¶</a></h3> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Atualização automática do sistema operacional, ferramentas/pacotes pré-instalados e o próprio agente.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Mantido e gerenciado inteiramente pelo GitHub</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Fornece uma nova instância limpa para cada execução</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Use o tempo de execução gratuito oferecido pelo GitHub e, em seguida, inclua um custo se o limite for excedido</li> </ul> <h3 id=self-managed-runners-self-hosted>Self-managed runners (self-hosted):<a class=headerlink href=#self-managed-runners-self-hosted title="Permanent link">¶</a></h3> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O próprio agente atualiza automaticamente. Você é responsável por atualizar o sistema operacional e todos os outros componentes</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Ele pode ser instalado em quase todos os lugares, no computador local, em um servidor físico, em uma máquina virtual na Nuvem</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Permite ser associado a uma configuração completamente personalizada (hardware, capacidade de computação ou software)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Reutiliza a mesma instância para cada novo pipeline</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> São completamente gratuitos, independentemente da duração do uso</li> </ul> <p>Se globalmente, os executores do GitHub responderão à maioria dos casos de uso e, portanto, devem ser sua primeira escolha. Nesse caso, os executores auto-hospedados serão relevantes para necessidades de implantação feitas com fortes restrições de segurança de rede. A combinação de ambos traz o melhor dos dois mundos para atender a todos os cenários possíveis.</p> <h2 id=runner-diagnostic-logging>Runner diagnostic logging<a class=headerlink href=#runner-diagnostic-logging title="Permanent link">¶</a></h2> <p>GitHub Actions fornece arquivos de log adicionais que oferecem insights sobre como um executor está executando um trabalho.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Log do processo do runner: detalhes sobre a inicialização do runner, configuração e quaisquer problemas encontrados durante o processo de configuração do runner;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Log do processo do trabalhador: Ele captura detalhes sobre as etapas que estão sendo executadas, o progresso do trabalho e quaisquer erros ou avisos encontrados durante a execução do trabalho.</li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> Registro de depuração de etapas permite que você aumente a verbosidade dos registros de um trabalho durante e após a execução de um trabalho. (ACTIONS_STEP_DEBUG = true)</li> </ul> <table> <thead> <tr> <th>Variável</th> <th>O que faz</th> <th>Valor típico</th> <th>Escopo</th> </tr> </thead> <tbody> <tr> <td>ACTIONS_STEP_DEBUG</td> <td>Ativa log detalhado de cada step (comandos, variáveis, saídas etc).</td> <td>true</td> <td>Cada step</td> </tr> <tr> <td>ACTIONS_RUNNER_DEBUG</td> <td>Ativa log interno do runner (útil para runners self-hosted).</td> <td>true</td> <td>Runner</td> </tr> <tr> <td>ACTIONS_CACHE_DEBUG</td> <td>Ativa logs de debug para ações de cache (actions/cache).</td> <td>true</td> <td>Ação de cache</td> </tr> <tr> <td>ACTIONS_ALLOW_UNSECURE_COMMANDS</td> <td>Permite comandos ::set-env e ::add-path (deprecados e inseguros).</td> <td>true</td> <td>(não recomendado)</td> </tr> <tr> <td>RUNNER_TRACKING_ID</td> <td>ID do runner (gerado automaticamente pelo GitHub).</td> <td>automático</td> <td>Runner</td> </tr> <tr> <td>RUNNER_DEBUG</td> <td>Não documentada oficialmente, possivelmente igual a ACTIONS_RUNNER_DEBUG</td> <td>true</td> <td>Runner (??)</td> </tr> </tbody> </table> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Problemas na lógica do workflow? Use ACTIONS_STEP_DEBUG</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Problemas no runner (self-hosted)? Use ACTIONS_RUNNER_DEBUG</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Problemas com cache? Use ACTIONS_CACHE_DEBUG</li> </ul> <div class=highlight><pre><span></span><code>env:
  ACTIONS_STEP_DEBUG: true
  ACTIONS_RUNNER_DEBUG: true
  CTIONS_STEP_DEBUG: true
  RUNNER_DEBUG: 1
</code></pre></div> <h2 id=monitoramento-e-alerta-de-fluxo-de-trabalho>Monitoramento e alerta de fluxo de trabalho<a class=headerlink href=#monitoramento-e-alerta-de-fluxo-de-trabalho title="Permanent link">¶</a></h2> <p>As execuções do fluxo de trabalho são orquestradas em nossos executores autohospedados pela integração do GitHub e do Microsoft Teams e nossa instância interna do Grafana que coleta métricas do Actions Runner Controller (ARC).</p> <p>O Actions Runner Controller (ARC) é uma ferramenta oficial da GitHub (desenvolvida pela equipe do GitHub Actions) que permite gerenciar runners autohospedados em ambientes Kubernetes de forma escalável e automatizada.</p> <h2 id=recursos-de-notificacao-do-github>Recursos de notificação do GitHub<a class=headerlink href=#recursos-de-notificacao-do-github title="Permanent link">¶</a></h2> <p>GitHub oferece suporte para notificações em quase todos os repositórios e artefatos que ele cria.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <code>https://github.com/settings/notifications</code></li> <li class=task-list-item><label class=task-list-control><input disabled type=checkbox><span class=task-list-indicator></span></label> <code>https://github.com/notifications</code></li> </ul> <h2 id=integrando-acoes-do-github-com-o-slack>Integrando ações do GitHub com o Slack<a class=headerlink href=#integrando-acoes-do-github-com-o-slack title="Permanent link">¶</a></h2> <p>É uma plataforma de colaboração de equipe amplamente usada que fornece mensagens em tempo real, compartilhamento de arquivos e recursos de integração.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <code>https://github.com/integrations/slack#readme</code></li> </ul> <h2 id=como-solicitar-permissoes-diferentes>Como solicitar permissões diferentes<a class=headerlink href=#como-solicitar-permissoes-diferentes title="Permanent link">¶</a></h2> <p>Ao configurar um fluxo de trabalho, você pode solicitar permissões específicas que o fluxo de trabalho requer. As permissões definem o escopo de ações que o fluxo de trabalho pode executar dentro de um repositório. São os três tipos de permissão de componentes que um fluxo de trabalho pode solicitar:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Acesso de leitura: permite que os fluxos de trabalho leiam informações do repositório, como código, solicitações de pull e problemas,</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Acesso de gravação: permite que os fluxos de trabalho modifiquem os recursos do repositório, incluindo a criação de ramificações, o envio de alterações e a criação ou atualização de problemas;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Nenhum acesso: Não fornece acesso aos fluxos de trabalho para esse recurso fornecido no GitHub usando o valor none.</li> </ul> <div class=highlight><pre><span></span><code>permissions:
   actions: read|write|none
   checks: read|write|none
   contents: read|write|none
   deployments: read|write|none
   id-token: read|write|none
   issues: read|write|none
   discussions: read|write|none
   packages: read|write|none
   pages: read|write|none
   pull-requests: read|write|none
   repository-projects: read|write|none
   security-events: read|write|none
   statuses: read|write|non
</code></pre></div> <h2 id=criando-um-aplicativo-github>Criando um aplicativo GitHub<a class=headerlink href=#criando-um-aplicativo-github title="Permanent link">¶</a></h2> <p>O propósito do App que vamos criar é reportar resultados de testes unitários para o pull request sob esta conta. Perfil → Settings → Developer Settings → OAuth Apps</p> <h2 id=utilizando-fluxos-de-trabalho-iniciais-em-sua-equipe>Utilizando fluxos de trabalho iniciais em sua equipe<a class=headerlink href=#utilizando-fluxos-de-trabalho-iniciais-em-sua-equipe title="Permanent link">¶</a></h2> <p>Pagina 36 - 3</p> <p>SELECT * FROM dba_network_acl_privileges where principal = 'SCOTT'; begin dbms_network_acl_admin.create_acl ( acl =&gt; 'http_permissions.xml', description =&gt; 'HTTP Access', principal =&gt; 'SCOTT', is_grant =&gt; TRUE, privilege =&gt; 'connect', start_date =&gt; null, end_date =&gt; null );</p> <p>end;</p> <p>DBMS_NETWORK_ACL_ADMIN.ADD_PRIVILEGE(acl =&gt; '/sys/acls/ldap.xml',</p> <p>principal =&gt; 'XXBBTSSOA',</p> <p>is_grant =&gt; true,</p> <p>privilege =&gt; 'resolve');</p> <p>end;</p> <p>begin</p> <p>DBMS_NETWORK_ACL_ADMIN.ADD_PRIVILEGE(acl =&gt; '/sys/acls/ldap.xml', principal =&gt; 'XXBBTSSOA',</p> <p>is_grant =&gt; true,</p> <p>privilege =&gt; 'resolve');</p> <p>end;</p> <p>/ BEGIN</p> <p>dbms_network_acl_admin.assign_acl (</p> <p>acl =&gt; '/sys/acls/ldap.xml',</p> <p>host =&gt; '*'</p> <p>lower_port =&gt; null,</p> <p>upper_port =&gt; null</p> <p>);</p> <p>END;</p> <p>commit;</p> <h2 id=the-variables>The variables<a class=headerlink href=#the-variables title="Permanent link">¶</a></h2> <p>Como qualquer linguagem de programação ou script, as variáveis ​​permitem que você defina chaves com valores reutilizáveis ​​dentro dos fluxos de trabalho.</p> <h3 id=declaration-of-a-variable>Declaration of a variable<a class=headerlink href=#declaration-of-a-variable title="Permanent link">¶</a></h3> <p>A declaração de uma variável é feita adicionando a propriedade env e declarando valores-chave, conforme mostrado no exemplo a seguir: <div class=highlight><pre><span></span><code>env:
MY_VARIABLE_FIRSTNAME: John
MY_VARIABLE_NAME: "Doe" # quotation marks are not mandatory even if the value contains spaces
MY_VARIABLE_MULTILINE:|
hello
to all
!
</code></pre></div></p> <p>Os nomes de variáveis ​​diferenciam maiúsculas de minúsculas; para evitar confusão e melhorar a legibilidade, é um uso comum escrevê-los todos em letras maiúsculas, mas isso não é obrigatório. Além disso, a nomenclatura permite caracteres alfanuméricos e o caractere sublinhado (_). Uma vez definida uma variável, estaticamente ou dinamicamente, ela pode ser chamada com a sintaxe ${{ env.MY_VARIABLE }} que diz para carregar a MY_VARIABLE do contexto env, que representa o contexto do nível em que estamos, seja o fluxo de trabalho, o trabalho ou a etapa atual.</p> <p><div class=highlight><pre><span></span><code>env:
#definition at job level
MY_VARIABLE: hello
#variable definition
steps:
- run: echo ${{ env.MY_VARIABLE }} # display "hello" in the console
</code></pre></div> The variable can be used to replace any value (but not a key), to be used within a command (example above) or an action.</p> <h3 id=dynamic-variables>Dynamic variables<a class=headerlink href=#dynamic-variables title="Permanent link">¶</a></h3> <p>Em alguns casos, a variável é desconhecida e será definida durante o fluxo de trabalho, potencialmente passando de uma etapa para outra. Com o GitHub Actions, você não pode atribuir uma variável como faria normalmente, como $MYVARIABLE=my value. Em vez disso, é necessário concatenar a chave e o valor e transferi-los para a variável global $GITHUB_ENV:</p> <p><code>echo "NAME_VARIABLE=value" &gt;&gt; $GITHUB_ENV</code></p> <p>Tecnicamente falando, você escreve o nome da variável e seu valor em um arquivo temporário. Este arquivo é lido no final da etapa, e seus dados são injetados nas variáveis de ambiente. Portanto, quando você define dinamicamente o valor de uma variável em uma etapa, o novo valor desta variável só estará acessível para as etapas seguintes, não para a etapa atual. O fluxo de trabalho a seguir exibe "amarelo - amarelo - verde".</p> <div class=highlight><pre><span></span><code>job:
runs-on: self-hosted
env:
VARIABLE: yellow
steps:
 - run: echo $VARIABLE # displays "yellow", default value
 - run: |
echo "VARIABLE=green" &gt;&gt; $GITHUB_ENV
echo $VARIABLE # displays "yellow", because we're still in the same step
run: echo $VARIABLE # displays "green"
</code></pre></div> <h3 id=scope-of-variables>Scope of variables<a class=headerlink href=#scope-of-variables title="Permanent link">¶</a></h3> <p>As variáveis podem ser definidas em diferentes níveis de um fluxo de trabalho e, portanto, operar com diferentes escopos. Vimos um exemplo com variáveis definidas em um nível de trabalho, mas é possível defini-las:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> No nível do fluxo de trabalho</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> No nível do trabalho</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> No nível da etapa</li> </ul> <p>Dependendo do nível, a variável será acessível por todos os níveis subjacentes. Assim, uma variável definida em um nível de fluxo de trabalho será acessível por todos os trabalhos e etapas, enquanto uma variável definida em um nível de etapa será acessível apenas por ela. Isso é importante se você precisar passar uma variável de uma etapa para outra.</p> <p>Se diferentes variáveis com o mesmo nome forem declaradas em níveis diferentes, então será a variável de escopo mais específica (nível mais baixo) que será escolhida. Analise o seguinte fluxo de trabalho e o mecanismo de prioridade:</p> <div class=highlight><pre><span></span><code>env:
MYVARIABLE: value1
MYVARIABLE2: value1
jobs:
test_variables:
runs-on: self-hosted
env:
MYVARIABLE: value2
steps:
 run: echo $MYVARIABLE #value2 appears because variable at the job level
 run: echo ${{env.MYVARIABLE}} # value2 appears because variable at the job level
- name: variable env we redefinition at step level
env:
MYVARIABLE: value3
run: echo ${{env.MYVARIABLE}} # value3 appears because variable at step level
- name: variable direct MYVARIABLE2
  run: echo $MYVARIABLE2 #value1 displays because variable at the workflow level
</code></pre></div> <h2 id=output-variables>Output variables<a class=headerlink href=#output-variables title="Permanent link">¶</a></h2> <p>O uso de variáveis globais ($GITHUB_ENV) permite que você responda à maioria dos usos para transmitir uma variável entre duas etapas. Isso, no entanto, requer que você tenha controle total dos nomes das variáveis dentro do fluxo de trabalho completo. Isso não pode ser garantido se você usar ações de terceiros que definem variáveis internamente. Além disso, isso pode causar uma colisão de variáveis se você usar a mesma ação duas vezes com configurações diferentes. A resposta perfeita é usar uma variável de saída: uma variável de saída é uma variável associada a uma etapa específica, mas é visível de outras etapas.</p> <p>A definição de uma variável de saída de uma etapa é feita usando o comando "&gt;&gt; $GITHUB_OUTPUT". Isso torna possível definir uma variável vinculada a esta etapa e cujo escopo de nomenclatura também será vinculado.</p> <p><code>run: echo "NAMEVARIABLE=hello" &gt;&gt; $GITHUB_OUTPUT</code></p> <p>É necessário então realizar um segundo passo, para acessar um passo: dar a ele um nome através do id da propriedade.</p> <div class=highlight><pre><span></span><code>steps:
-id: myStep
echo "NAMEVARIABLE=hello" &gt;&gt; $GITHUB_OUTPUT
</code></pre></div> <p>Depois que uma etapa obtém um id, é possível referenciar sua variável de saída com a fórmula $ {{ steps.STEPID.outputs.NAMEVARIABLE }}.</p> <div class=highlight><pre><span></span><code>steps:
-id: myStep
run: echo "NAMEVARIABLE=hello" &gt;&gt; $GITHUB_OUTPUT
- run: echo ${{ steps.myStep.outputs.NAMEVARIABLE}}
</code></pre></div> <p>Muitas vezes, você encontrará variáveis de saída ao usar ações do marketplace porque é a maneira mais limpa de retornar informações ao fluxo de trabalho pai.</p> <h2 id=the-built-in-environment-variables>The built-in environment variables<a class=headerlink href=#the-built-in-environment-variables title="Permanent link">¶</a></h2> <p>Além das variáveis que você cria, há muitas variáveis predefinidas disponíveis dentro do seu fluxo de trabalho. Aqui está uma lista (parcial) delas:</p> <table> <thead> <tr> <th>Variable</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>CI</td> <td>It is always equal to true</td> </tr> <tr> <td>GITHUB_WORKFLOW</td> <td>The name of the workflow</td> </tr> <tr> <td>GITHUB_RUN_ID</td> <td>A unique number for each run within a repository. This number does not change if you re-run the workflow run.</td> </tr> <tr> <td>GITHUB RUN_NUMBER</td> <td>An incremental number representing the number of executions of the same workflow. This number begins at 1 for the workflow's first run and increments with each new run. This number does not change if you re-run the workflow run.</td> </tr> <tr> <td>GITHUB JOB</td> <td>The job_id of the current job.</td> </tr> <tr> <td>GITHUB_ACTION</td> <td>Unique identifier (id) of an action</td> </tr> <tr> <td>GITHUB_ACTIONS</td> <td>true if executed by GitHub Actions. false if running locally on your computer; useful for testing</td> </tr> </tbody> </table> <div class=highlight><pre><span></span><code>GITHUB_ACTOR
Name of the person or application that started the workflow
runner/work/my-repo-name/
my-repo-name.
GITHUB_SHA
The Hash (SHA-1) of the
GITHUB REPOSITO Full name of the repository
RY
GITHUB_EVENT_N Name of the event that
commit that triggered the
workflow. For example,
dc57e9addd1bbba026c5c71f5
6ad9285139967ec
AME
triggered the workflow
GITHUB_REF
The branch or tag that
GITHUB_EVENT_PA The path of the file comprising
TH
all data from the webhook
event. For example, /github/
workflow/event.json.
GITHUB_WORKSPA The path of the current
CE
workspace. This workspace is a copy of the repository if the workflow uses the action actions/checkout. If you do not use it, the folder is simply empty. For example, /home/vtriggered the workflow. For example, refs/heads/my- branch. If no branch or tag is available for this event, then
the variable is not available.
GITHUB_HEAD_REF Only for pull requests. Contains the name of the branch head
GITHUB_BASE_REF Only for pull requests. Contains the name of the branch base
GITHUB_SERVER_URL Returns the GitHub server
GITHUB_API_URL
URL. For example, https:// github.com.
Returns the URL of the
API. For example, https:// api.github.com.
GITHUB GRAPHQL Returns the URL of the _URL GraphQL API. For example, https://api.github.com/graphql.
</code></pre></div> <p>Uma das variáveis que você usará com mais frequência é a variável GITHUB_TOKEN que está no contexto dos segredos. Esta variável contém um token de autenticação que permite que você interaja como "você". O usuário acionou o fluxo de trabalho e permite que você execute tarefas no repositório onde o fluxo de trabalho está localizado. Se seu fluxo de trabalho quiser criar elementos (issues, pr, releases, etc.), ele precisará deste token de autenticação.</p> <div class=highlight><pre><span></span><code>steps:
- run: ./script --token {{ secrets.GITHUB_TOKEN }}
</code></pre></div> <p>Essas poucas variáveis predefinidas são apenas uma pequena parte das informações que é possível usar. Algumas não têm uma variável predefinida, mas ainda são recuperáveis dentro de um dos contextos existentes.</p> <p>O contexto do github é o principal e tem uma centena de propriedades detalhadas relativas ao fluxo de trabalho, como o evento que disparou o fluxo de trabalho, o repositório, seu proprietário e muitos outros.</p> <p>Para exibi-lo, como outros contextos (env, strategy, matrix, steps, runner), uma solução simples consiste em converter o contexto em JSON e depois exibi-lo no console:</p> <p><code>run: echo "${{ toJson(github)}}" # Do not forget the quotation marks, or the JSON will crash your workflow</code></p> <p>Bom saber: A função toJson() é uma das várias funções disponíveis por padrão no GitHub Actions. O GitHub oferece os métodos toJson(), fromJson(), contains(), startsWith(), endsWith(), format() e hashFiles(). A documentação oficial é suficientemente detalhada sobre seu uso para não cobri-lo neste livro.</p> <p>Isso permite ter o nome de todas as propriedades do contexto (seu número muda dependendo do evento de gatilho do fluxo de trabalho):</p> <div class=highlight><pre><span></span><code>{
"token":
"job": "build",
"ref": "refs/heads/main",
"repository": "60pportunities/test",
"repository_owner": "60pportunities",
#"repositoryUrl": "git://github.com/60pportunities/test.git",
"run_id":"587245182",
"run_number": "8",
"retention_days": "90",
"actor": "60pportunities",
"workflow": "Test Wkf",
"head_ref": "",
"base_ref": "",
"event_name": "workflow_dispatch",
"event": {
"inputs": null,
"ref": "refs/heads/main",
"repository": {
|| ...
// many other properties
[] ...
}
}
}
</code></pre></div> <h3 id=protect-the-content-of-variables-with-masks>Protect the content of variables with masks<a class=headerlink href=#protect-the-content-of-variables-with-masks title="Permanent link">¶</a></h3> <p>Pode haver casos em que a variável contenha um valor confidencial. Se o valor for definido manualmente, a boa prática deve ser definir um "secreto" (em vez de uma variável), um objeto do GitHub que é abordado no próximo capítulo. No entanto, se o valor for gerado durante a execução do fluxo de trabalho, o uso de secret é impossível, e apenas variáveis podem armazenar esse valor. O risco é então que o conteúdo dessa variável seja inadvertidamente exibido nos logs, expondo completamente o valor que gostaríamos de manter em segredo.</p> <p>O GitHub oferece uma solução que não é perfeita, mas que permite evitar que um valor seja exibido nos logs. Essas mecânicas permitem adicionar uma máscara sobre o conteúdo do valor (e não a variável em si!). Isso requer o uso do comando add-mask, para quem o valor é transmitido para ser oculto. Então, se o valor for, de qualquer forma, exibido nos logs, seu conteúdo será substituído por asteriscos ("***").</p> <div class=highlight><pre><span></span><code>- run: "::add-mask::hello"
- run: echo "hello" # displays *** in the logs
</code></pre></div> <p>If the variable is not known in advance (e.g., a generated token or password), masking its value can be done like this: <div class=highlight><pre><span></span><code>- run: "::add-mask::$MYVARIABLE"
- run: echo "$MYVARIABLE" # displays
</code></pre></div></p> <p>Um efeito perverso é que se o conteúdo de uma variável também for o valor (ou parte do valor) de outra variável, proteger o conteúdo da primeira variável fará com que o conteúdo da segunda variável também fique oculto.</p> <p>Fica bem claro com o exemplo a seguir, onde o conteúdo de VAR2, que não é estritamente idêntico a VAR1, fica parcialmente oculto quando exibido nos logs. Coisa boa ou ruim? Isso vai depender dos seus casos de uso, mas não ter controle preciso torna o comando add-mask um recurso propenso a bugs.</p> <div class=highlight><pre><span></span><code>env:
VAR1: hello
VAR2: hello2
steps:
- run: echo "::add-mask::$VAR1" # we hide the value of VAR1
- run: echo $VAR1 # displays
- run: echo $VAR2 # displays ***2
</code></pre></div> <h2 id=exercises-variables>Exercises - variables<a class=headerlink href=#exercises-variables title="Permanent link">¶</a></h2> <p>Aplique o que você acabou de aprender fazendo alguns exercícios.</p> <h3 id=exercicio-n1_2>Exercício n°1<a class=headerlink href=#exercicio-n1_2 title="Permanent link">¶</a></h3> <p>Este primeiro exercício visa validar a teoria sobre escopos de variáveis. Primeiro, crie um fluxo de trabalho simples com uma variável de ambiente VAR1. Em seguida, crie uma tarefa que coloque o conteúdo desta variável em uma segunda variável, VAR2. Por fim, exiba o conteúdo de VAR2 no console de outra etapa sem usar as variáveis de saída.</p> <h3 id=exercicio-n2>Exercício n°2<a class=headerlink href=#exercicio-n2 title="Permanent link">¶</a></h3> <p>Pesquise no marketplace a ação get-current-time, cujo autor é "josStorer". Use esta ação em um fluxo de trabalho e, em seguida, exiba no console a data atual usando o formato francês (25/01/1984).</p> <h3 id=exercicio-n3_1>Exercício n°3<a class=headerlink href=#exercicio-n3_1 title="Permanent link">¶</a></h3> <p>É comum usar informações contextuais para enriquecer seu fluxo de trabalho, suas ações ou para tomar uma decisão com base nessas informações. Crie um fluxo de trabalho que exibirá as seguintes informações no console:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O nome do fluxo de trabalho atual</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O link para o perfil do proprietário (owner) do repositório do qual o fluxo de trabalho é iniciado</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Gera um alerta como uma anotação se o repositório atual for público</li> </ul> <p>Todas as informações podem ser encontradas no contexto github.</p> <h3 id=os-segredos>Os segredos<a class=headerlink href=#os-segredos title="Permanent link">¶</a></h3> <p>Os segredos são o equivalente a variáveis de ambiente, mas criptografados e armazenados fora do arquivo YAML do fluxo de trabalho. Eles são usados para transmitir chaves de segurança ou strings de conexão para seu fluxo de trabalho sem que sejam expostas porque nunca são armazenadas no código-fonte.</p> <p>Os segredos são criptografados com um módulo libsodium (<a href=https://libsodium.gitbook.io>https://libsodium.gitbook.io</a>), garantindo que eles sejam protegidos quando saem do seu navegador e sejam descriptografados apenas quando seu fluxo de trabalho os usa. O GitHub não tem como acessá-lo, nem um pirata.</p> <h4 id=declaracao-de-um-segredo>Declaração de um segredo<a class=headerlink href=#declaracao-de-um-segredo title="Permanent link">¶</a></h4> <p>Alguns padrões de nomenclatura devem ser observados para definir um segredo:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O nome pode conter apenas caracteres alfanuméricos ([a-z], [A-Z], [0-9]) e o caractere sublinhado (_)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Eles não podem começar com um número</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Eles não podem começar com "GITHUB_", porque esse prefixo é reservado para os segredos internos do GitHub, como GITHUB_TOKEN</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Os nomes não diferenciam maiúsculas de minúsculas, mas por questões de visibilidade, como para variáveis, é uma boa prática sempre escrevê-los usando letras maiúsculas</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Os nomes dos segredos devem ser exclusivos dentro de um repositório. Essa limitação pode ter um impacto se seu repositório tiver muitos fluxos de trabalho, pois a interface gráfica lista todos os segredos no mesmo lugar. Vários fluxos de trabalho do mesmo repositório podem usar o mesmo segredo. Como resultado, há sérios riscos de colisão ou efeitos indesejados.</li> </ul> <p>A criação de um segredo é feita no nível do repositório. O link para a tela de gerenciamento de segredo pode ser encontrado no menu esquerdo dentro da tela de Configurações. Você pode lá, clicar em "Novo segredo de repositório".</p> <p>A partir desta nova tela, é possível criar um segredo cujo valor nunca mais poderá ser visto (por medidas de segurança) uma vez que o botão Adicionar segredo for clicado. Ações segredos / Novo segredo</p> <p>Ambientes: Os segredos dos ambientes são apenas segredos que são particionados juntos. O assunto dos ambientes é abordado no próximo capítulo.</p> <p>Uma vez que um segredo é definido, o GitHub declara uma variável no contexto segredos acessíveis por fluxos de trabalho. É então possível recuperar o valor de um segredo usando o seguinte formato $ {{ secrets.MY_SECRET }}. <div class=highlight><pre><span></span><code>etapas:
- executar: echo "${{ secrets.MY_SECRET }}"
</code></pre></div></p> <p>O GitHub adiciona automaticamente uma máscara (add-mask) em cada segredo. Dessa forma, o conteúdo do segredo não deve vazar nos logs de execução de fluxos de trabalho.</p> <p>Importante: os segredos podem sugerir que eles estão perfeitamente lacrados e protegidos. No entanto, backdoors estão permitindo que o fluxo de trabalho exiba os valores dos segredos nos logs. O assunto dessa "falha de segurança" é abordado no capítulo Segurança &gt; Gerenciamento de segredos.</p> <h3 id=os-limites-dos-segredos>Os limites dos segredos<a class=headerlink href=#os-limites-dos-segredos title="Permanent link">¶</a></h3> <p>Cada repositório não pode ter mais de 100 segredos e 100 segredos de ambiente também. Além disso, cada segredo não pode ter mais de 64 KB, o que é suficiente para a maioria dos casos; no entanto, se você fosse armazenar um segredo maior, como um certificado ou proteger um arquivo de configuração completo. Nesse caso, é possível armazenar o segredo criptografado no repositório de código-fonte e declarar a chave de descriptografia dentro de um segredo.</p> <p>A abordagem não é muito intuitiva, mas é possível:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> No seu disco local, criptografe seu arquivo usando a criptografia AES256 (ou qualquer criptografia suportada pelo GPG). <code>gpg --symmetric --cipher-algo AES256 my_secret.txt</code> Executar o comando GPG pede que você defina uma senha (passphrase) e criptografa o conteúdo do arquivo para criar uma cópia criptografada com a extensão ".gpg".</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Copie a senha que foi definida e, no seu repositório, crie um novo segredo cujo valor seja a senha, por exemplo, MY_LARGE_SECRET_PASSPHRASE</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Copie o arquivo "my_secret.txt.gpg" no seu repositório e salve (commit) ele.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Crie um arquivo de script (no nosso caso chamado decrypt_secret.sh) que será responsável por decifrar o arquivo usando o segredo previamente configurado</li> </ul> <div class=highlight><pre><span></span><code>#!/bin/sh
gpg --quiet --batch --yes --decrypt passphrase="$MY_LARGE_SECRET_PWD" --output my_secret.txt my_secret.txt.gpg
</code></pre></div> <ul class=task-list> <li class=task-list-item> <p><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Certifique-se de que o arquivo é executável antes do commit: <code>chmod +x decrypt_secret.sh</code></p> </li> <li class=task-list-item> <p><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> No seu fluxo de trabalho, crie uma etapa que defina uma variável local com um valor contendo o segredo protegido e, em seguida, execute o script para regenerar o arquivo my_secret.txt cujo conteúdo será decifrado.</p> </li> </ul> <div class=highlight><pre><span></span><code>jobs:
my-job:
runs-on: self-hosted
steps:
 - uses: actions/checkout@v4
  - run: decrypt_secret.sh
env:
MY_LARGE_SECRET_PWD:
{{ secrets.MY_LARGE_SECRET_PASSPHRASE}}
</code></pre></div> <h3 id=exercicios-segredos>Exercícios - Segredos<a class=headerlink href=#exercicios-segredos title="Permanent link">¶</a></h3> <h4 id=exercicio-n1_3>Exercício n°1<a class=headerlink href=#exercicio-n1_3 title="Permanent link">¶</a></h4> <p>O primeiro exercício, crie um segredo e passe-o diretamente para a ação Igmorand@github-action-hello (<a href=https://github.com/ >https://github.com/</a> 60pportunities/github-action-hello). Depois, verifique se seu valor não aparece nos logs.</p> <h4 id=exercicio-n2_1>Exercício n°2<a class=headerlink href=#exercicio-n2_1 title="Permanent link">¶</a></h4> <p>O repositório que contém a ação 60pportunities@github-action-hello (<a href=https://github.com/60pportunities/github-action-hello>https://github.com/60pportunities/github-action-hello</a>) tem um segredo chamado MY_SECRET. Este repositório tem um fluxo de trabalho disparado no push e/ou pull request e tem como objetivo validar que a ação ainda esteja totalmente funcional em um teste unitário. Execute um pull request no repositório e altere o fluxo de trabalho para obter o valor de sigilo.</p> <h3 id=exercicio-n3_2>Exercício n°3<a class=headerlink href=#exercicio-n3_2 title="Permanent link">¶</a></h3> <p>De outra conta, tente bifurcar um dos seus repositórios que contém um segredo (ou bifurcar um repositório de terceiros que contém um segredo, por exemplo este: <a href=https://github.com/60pportunities/aks-checklist>https://github.com/60pportunities/aks-checklist</a>). Em seguida, abra a aba Configurações e altere o valor de um dos segredos.</p> <h2 id=variaveis-de-configuracao>Variáveis de configuração<a class=headerlink href=#variaveis-de-configuracao title="Permanent link">¶</a></h2> <p>Desde janeiro de 2023, o GitHub também permite a declaração de variáveis de configuração. As variáveis de configuração são estritamente idênticas aos segredos, exceto que seu conteúdo não é protegido e pode ser visualizado dentro do fluxo de trabalho. É perfeito quando você quer adicionar dinamicidade ao seu fluxo de trabalho sem codificá-lo dentro do arquivo YAML ou colocá-lo em um segredo porque você não pode necessariamente ver/editar seu conteúdo facilmente.</p> <p>As variáveis de configuração são declaradas em uma nova tela, no mesmo lugar que os segredos.</p> <h3 id=variaveis-de-configuracao_1>Variáveis de configuração<a class=headerlink href=#variaveis-de-configuracao_1 title="Permanent link">¶</a></h3> <p>As variáveis de configuração são acessíveis dentro dos fluxos de trabalho por meio de novas variáveis de contexto:</p> <div class=highlight><pre><span></span><code>jobs:
display-variables:
runs-on: self-hosted
steps:
- name: Use variables
run: |
echo "Here is my first variable : ${{ vars.MY_VARIABLE1 }}"
echo "And my second one : ${{ vars.MY_CONFIG }}"
</code></pre></div> <h2 id=the-creation-of-multienvironment-workflows>The creation of multienvironment workflows<a class=headerlink href=#the-creation-of-multienvironment-workflows title="Permanent link">¶</a></h2> <p>O GitHub Actions permite que você faça qualquer tipo de fluxo de trabalho, como enviar um e-mail, criar aplicativos ou até mesmo automatizar uma máquina de café. Mas se houver um domínio no qual as ações são esperadas, é para implantação de aplicativos. Seja qual for a complexidade do seu aplicativo, monolítico, n-tier, microsserviços, ele geralmente será implantado em vários ambientes, como um para desenvolvedores, um para testes e outro para Produção. Embora fazer uma implantação de vários ambientes com o GitHub Actions possa ser alcançado de diferentes maneiras, a primeira solução é fazer um fluxo de trabalho pelo ambiente, cada um com sua lógica e variáveis para se conectar a cada servidor de destino. Mas essa prática deve ser evitada por dois motivos principais:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O gerenciamento de segredos e variáveis pode se tornar muito complexo, com riscos de colisão entre fluxos de trabalho. Segundo, se seus fluxos de trabalho tiverem um grande número de segredos, seu gerenciamento dentro de uma tela única pode se tornar bastante complexo.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Um dos mantras do DevOps requer que um único aplicativo binário seja gerado e implantado em diferentes ambientes sequencialmente; a única maneira de garantir que a versão implantada na Produção seja a mesma que foi testada em ambientes anteriores. Embora tecnicamente viável por meio de vários fluxos de trabalho, é complexo e propenso a erros.</li> </ul> <p>O GitHub Actions introduz ambientes, que são simplesmente configurações externas nomeadas para atender a esse requisito. Essas configurações podem ser aplicadas a um ou mais trabalhos dentro de um fluxo de trabalho. Além disso, cada uma dessas configurações pode definir várias regras que queremos ver aplicadas a uma parte específica do fluxo de trabalho. Essas configurações se enquadram em duas categorias:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> As regras de proteção</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Os segredos</li> </ul> <p>Vamos analisar em detalhes como definir e usar esses ambientes.</p> <h2 id=creating-an-environment>Creating an environment<a class=headerlink href=#creating-an-environment title="Permanent link">¶</a></h2> <p>Os ambientes são vinculados a um projeto e, portanto, (apenas) a um repositório. Dentro de um repositório GitHub, o gerenciamento de ambientes é feito por meio da tela Configurações &gt; Ambientes. O nome do ambiente é livre para escolher, mas é a ele que você precisará se referir no fluxo de trabalho.</p> <p><div class=highlight><pre><span></span><code>Environments
You can configure environments with protection rules and secrets. Learn more.
PRD
TST
DEV
1 protection rule
New environment
</code></pre></div> Importante: Recursos relacionados ao ambiente não são permitidos em repositórios privados.</p> <p>Ao criar um ambiente, uma tela de configuração é exibida. Semelhante ao conceito de "gates" no DevOps, as regras de proteção são etapas de verificação pré-implantação. Elas tornam possível acionar apenas parte de um fluxo de trabalho somente quando todos os controles de validação estão verdes. No caso do GitHub Actions, os três controles possíveis são:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> controle sobre os branches válidos para implantação</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> aprovação manual por uma pessoa (revisor)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> timer: tempo mínimo de espera antes de desbloquear a continuação do fluxo de trabalho</li> </ul> <h3 id=protections-rules-screen>Protections rules screen<a class=headerlink href=#protections-rules-screen title="Permanent link">¶</a></h3> <p>Os revisores são pessoas que aprovarão manualmente a continuação do fluxo de trabalho. É possível especificar até 6 pessoas ou grupos de pessoas. Veremos mais adiante o comportamento do fluxo de trabalho e a interação que deve ser alcançada.</p> <p>A adição de um timer, como o nome sugere, permite atrasar a execução do fluxo de trabalho e especificar uma pausa. Seu valor é configurado usando minutos e pode assumir um valor entre 0 e 43200, correspondendo a um limite máximo de 30 dias. Uma pausa em um fluxo de trabalho faz sentido ao configurar a entrega contínua, especialmente ao usar a implantação progressiva (implantação canário). É possível fazer um fluxo de trabalho que implementa uma nova versão em um ambiente (por exemplo, Produção) em um segundo servidor e configura o tráfego para que 5% dos usuários sejam redirecionados para o segundo servidor, aguarde um dia para garantir que nenhum problema chegue, então acione uma alteração para enviar 40% do tráfego e aguarde mais 24 horas e, finalmente, se nenhum problema for detectado, redireciona todos os usuários no segundo servidor com a nova versão do aplicativo.</p> <p>O filtro por branch garante controle de qualidade implícito no código a ser implantado. Três modos estão disponíveis:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Todos os branches são permitidos: nenhum controle é feito</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Alguns branches específicos são permitidos: esses branches são listados explicitamente</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Somente branches com regras de proteção são permitidos: esta é uma funcionalidade do GitHub que permite aplicar controles no código-fonte. Por exemplo, é possível enviar o código em um branch somente se ele vier de uma solicitação de pull ou quando houver uma revisão de código.</li> </ul> <h3 id=branch-filter>Branch filter<a class=headerlink href=#branch-filter title="Permanent link">¶</a></h3> <p>Se um filtro de ramificação for implementado para um ambiente, ele será interrompido com um erro quando o fluxo de trabalho for iniciado a partir de uma ramificação não autorizada.</p> <h3 id=filtro-de-branch-desrespeitado>Filtro de branch desrespeitado<a class=headerlink href=#filtro-de-branch-desrespeitado title="Permanent link">¶</a></h3> <p>Os segredos do ambiente operam na mesma mecânica que os segredos do fluxo de trabalho discutidos anteriormente, mas diferem pelo seu escopo de acesso. Eles são acessíveis apenas pelos trabalhos (e suas ações) que referenciam o ambiente ao qual pertencem. Mais do que uma questão de segurança, isso simplesmente torna possível separar os segredos uns dos outros, para poder manipulá-los mais facilmente, evitando qualquer erro humano. Também permite criar um segredo com um nome único, mas declará-lo em dois ambientes com dois valores diferentes, facilitando a chamada do fluxo de trabalho ao reutilizar o mesmo YAML.</p> <h3 id=referenciando-um-ambiente>Referenciando um ambiente<a class=headerlink href=#referenciando-um-ambiente title="Permanent link">¶</a></h3> <p>Depois que o(s) ambiente(s) são criados e configurados, ainda temos que vincular nossos estágios de fluxos de trabalho a cada um deles. A conexão é extremamente simples adicionando no nível do trabalho a propriedade environment e o nome do ambiente ao qual você deseja ser vinculado. Cada trabalho só pode ser vinculado a um ambiente, mas todos os trabalhos de fluxo de trabalho não precisam ser vinculados a um ambiente.</p> <div class=highlight><pre><span></span><code>Build:
runs-on: self-hosted # not linked to an environment
steps: #...
DeployDev:
runs-on: self-hosted
environment: #...
name: DEV # Indicates the name of the environment linked to this job
steps: #...
DeployPRD:
runs-on: self-hosted
environment:
name: PRD # Indicates the name of the environment linked to this job
steps:
</code></pre></div> <p>Percebemos que a implantação de produção está pausada no exemplo anterior, aguardando uma aprovação manual definida no ambiente PRD. Então, um dos aprovadores tem que clicar na caixa do ambiente, para abrir um pop-up de aprovação.</p> <h3 id=manual-approval>Manual approval<a class=headerlink href=#manual-approval title="Permanent link">¶</a></h3> <p>Assim que a aprovação for realizada e nenhuma outra regra estiver pendente (por exemplo, um cronômetro), o fluxo de trabalho continua sua execução.</p> <h3 id=the-use-of-custom-urls>The use of custom URLS<a class=headerlink href=#the-use-of-custom-urls title="Permanent link">¶</a></h3> <p>Os ambientes oferecem uma funcionalidade discreta, mas podem ser muito úteis, a configuração da URL do ambiente. Esta URL é exibida diretamente abaixo do nome do ambiente (na verdade, o trabalho) dentro do visualizador de fluxo de trabalho. Ele permite com um simples clique ir para o ambiente de destino e verificar se ele está funcionando corretamente.</p> <div class=highlight><pre><span></span><code>environment:
name: DEV
url: https://dev.my-application.com
</code></pre></div> <p>No entanto, codificar essas informações não tem muito mais valor do que um favorito em um navegador da Web. Esse recurso faz sentido quando a URL não é conhecida com antecedência, mas será descoberta (ou gerada) durante a implantação do aplicativo.</p> <p>Esse é frequentemente o caso quando o fluxo de trabalho gera a infraestrutura que hospeda o aplicativo (infraestrutura como código) e, em seguida, implanta o aplicativo; caso de uso muito comum ao trabalhar com um provedor de nuvem pública, como o Microsoft Azure.</p> <p>Vamos pegar o exemplo de uma implantação de um aplicativo em contêiner em um cluster Kubernetes. A implantação é feita por meio de um arquivo manifesto (escrito em YAML) que indica ao Kubernetes qual contêiner implantar, mas também se esse contêiner deve ser exposto na Internet. Se for esse o caso, o Kubernetes fornece um endereço IP automaticamente, o que permite o acesso ao aplicativo implantado.</p> <p><div class=highlight><pre><span></span><code>deploy:
name: Deployment on Dev
runs-on: self-hosted
environment:
name: DEV
url: ${{ steps.retrieve_ip.outputs.IP }} # retrieves the output variable of the step retrieve_ip
steps:
- name: Deploying the Kubernetes manifest
run: kubectl apply -f myapp.yaml
- name: Recovery of the IP of the service
id: retrieve_ip
run: |
IP=$(kubectl get SVC my-app jsonpath="{.status.loadBalancer.ingress[0].ip}') # Ask Kubernetes which IP it was created for the application
echo 'IP=https://$IP' &gt;&gt; $GITHUB_OUTPUT # puts the IP in a variable
</code></pre></div> O resultado fornece a URL diretamente do aplicativo exposto pelo Kubernetes; então, essa URL é prefixada com "https://" (obrigatório porque o GitHub espera uma cadeia no formato de URL) antes de ser inserida em uma variável de saída e então recuperada automaticamente na propriedade "url".</p> <h3 id=exercicios_2>Exercícios<a class=headerlink href=#exercicios_2 title="Permanent link">¶</a></h3> <h3 id=exercicio-n1_4>Exercício n°1<a class=headerlink href=#exercicio-n1_4 title="Permanent link">¶</a></h3> <p>Crie um fluxo de trabalho multiambiente que permita que você obtenha exatamente (incluindo cada rótulo) o seguinte resultado:</p> <p>Informações adicionais: - [x] Os quatro trabalhos são chamados de job1, job2, job3 e job4 - [x] O estágio Teste de carga requer esperar 5 minutos antes do início - [x] O estágio Teste requer aprovação manual de uma pessoa</p> <h3 id=exercicio-n2_2>Exercício n°2<a class=headerlink href=#exercicio-n2_2 title="Permanent link">¶</a></h3> <p>Você lidera uma equipe de desenvolvimento com vários desenvolvedores que trabalham no mesmo código-fonte no mesmo repositório. Cada desenvolvedor trabalha em uma parte do aplicativo e, sempre que um desenvolvedor envia seu código para o branch principal, a implantação no ambiente DEV é acionada. Quando dois desenvolvedores enviam seu código em um curto espaço de tempo, duas implantações são acionadas em paralelo no ambiente e ocorrem erros. Você deve alterar o fluxo de trabalho para garantir que apenas um ambiente possa ocorrer ao mesmo tempo no ambiente DEV. A implementação dessa restrição não é explicada neste livro, mas está presente na documentação do GitHub. Dica: simultaneidade.</p> <h2 id=controle-de-fluxo>Controle de fluxo<a class=headerlink href=#controle-de-fluxo title="Permanent link">¶</a></h2> <p>Um fluxo de trabalho executa sequencialmente as tarefas descritas em seu arquivo YAML da mesma maneira para cada execução para fornecer a confiabilidade que esperamos de um processo automatizado, ao contrário de um processo humano sujeito a erros. O arquivo YAML, no entanto, representa a versão otimista do fluxo de trabalho: a execução das tarefas sendo bem-sucedida sem que nada venha a prender as rodas. Mas, infelizmente, a experiência da vida real nos ensina, especialmente em TI, que nada é previsível em 100% e surpresas (ruins) são comuns. O GitHub Actions, no entanto, nos oferece vários elementos para controlar nosso fluxo de trabalho mais finamente, especialmente em erros ou comportamentos imprevistos.</p> <h3 id=defina-uma-condicionalidade-de-execucao>Defina uma condicionalidade de execução<a class=headerlink href=#defina-uma-condicionalidade-de-execucao title="Permanent link">¶</a></h3> <p>Como você faria com uma linguagem de programação, o GitHub Actions permite considerar as etapas como blocos de execução e acioná-las dinamicamente de acordo com um teste condicional retornando verdadeiro/falso. Além disso, cada etapa tem uma propriedade opcional if que permite indicar uma fórmula que será avaliada no início da etapa para definir se a uma deve ser ignorada ou não. Então é possível, por exemplo, testar se uma variável específica tem um valor específico:</p> <div class=highlight><pre><span></span><code>steps:
- if: ${{MY_VAR}} = 'value'
run: blahblah
</code></pre></div> <p>Ou para fazer condições mais complexas usando valores contextuais:</p> <div class=highlight><pre><span></span><code>steps:
- if: github.repository == 'Igmorand/book' &amp;&amp; github.event_name == 'pull_request'
  run: blahblah
</code></pre></div> <p>Também é possível controlar a execução de uma etapa quando uma etapa anterior falhou, por exemplo, usando o método failure().</p> <div class=highlight><pre><span></span><code>steps:
- run: mycommand
- if: failure() # If previous step fails
run: blahblah
</code></pre></div> <p>Se você quiser verificar o status de uma etapa específica, que não foi colocada imediatamente antes, é necessário usar o contexto de execução das etapas e observar o status registrado pelo agente por meio do resultado da propriedade.</p> <div class=highlight><pre><span></span><code>steps:
- name: Step 1
  id: step1
  run: mycommand
continue-on-error: true
- name: Step 2
run: echo 'still processing'
- if: steps.step1.outcome != 'success' # check
run: blahblah
</code></pre></div> <h2 id=ignore-execution-errors>Ignore execution errors<a class=headerlink href=#ignore-execution-errors title="Permanent link">¶</a></h2> <p>A mecânica dos fluxos de trabalho e agentes é simples: um fluxo de trabalho para assim que um erro é encontrado. Para que esse erro venha de uma linha de comando ou de uma ação de terceiros que retornaria um código de erro (código de saída diferente de O), a etapa é marcada como falha nos logs de erro, o fluxo de trabalho para instantaneamente e as outras etapas são ignoradas. A sintaxe do GitHub Actions permite o atributo continue-on-error que permite indicar ao agente em execução para ignorar os códigos de erro retornados pelas etapas.</p> <div class=highlight><pre><span></span><code>- uses: 60pportunities/action-which-can-fail@v1
continue-on-error: true
</code></pre></div> <p>Esta palavra-chave é usada principalmente quando você tem etapas que podem falhar, mas deseja que as etapas seguintes ainda sejam executadas, aconteça o que acontecer, como etapas de limpeza.</p> <div class=highlight><pre><span></span><code>- uses: 60pportunities/action-which-can-fail@v1
continue-on-error: true
- name: Cleaning
run: ./cleanup.sh
</code></pre></div> <p>Uma alternativa é usar a função always(), idêntica à usada com jobs. Ela controla a execução do passo. Assim, no caso a seguir, o segundo passo executará o que quer que aconteça.</p> <div class=highlight><pre><span></span><code>- name: main command
run: failing command
name: cleaning
run: ./cleanup.sh
if: always()
</code></pre></div> <h2 id=control-of-execution-time>Control of execution time<a class=headerlink href=#control-of-execution-time title="Permanent link">¶</a></h2> <p>Normalmente, um fluxo de trabalho é executado por um "robô", seu tempo de execução não é um problema, pois não consome o tempo de um humano. Às vezes, no entanto, algumas etapas do fluxo de trabalho falham em executar sua tarefa atribuída e caem em um modo de loop infinito. Esses casos que podem ser acionados por vários motivos apresentam muitos problemas:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> A tarefa esperada nunca é concluída.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O fluxo de trabalho pode durar horas antes de ser encerrado pelo GitHub (tempo máximo de execução de um trabalho de 6 horas), e os usuários só serão notificados quando o limite de tempo for atingido.</li> </ul> <p>O tempo de execução tem um custo porque consome parte do tempo de execução alocado a você. Isso pode ter um custo financeiro. Portanto, é importante limitar esse desvio potencial.</p> <p>Para responder a isso, o GitHub Actions permite que você aplique um atributo timeout-minutes em uma etapa para limitar a execução.</p> <p>Assim, se você acha que uma etapa pode entrar em um loop infinito, você pode aplicar um limite após o qual o GitHub irá pará-la e considerá-la como falha se a etapa não tiver terminado a tempo.</p> <div class=highlight><pre><span></span><code>- run: ./my-script.sh
timeout-minutes: 5 # max limit of 5 minutes
</code></pre></div> <h2 id=os-emblemas>Os emblemas<a class=headerlink href=#os-emblemas title="Permanent link">¶</a></h2> <p>A vantagem de automatizar processos usando fluxos de trabalho automáticos é simplificar o gerenciamento desses processos, pois eles não exigem interações/tratamentos humanos. No entanto, a desvantagem é que é fácil perder de vista o estado do processo e esquecer de verificar a boa execução de cada fluxo de trabalho. O GitHub oferece um sistema de alertas, mas quando você deseja dar visibilidade dos fluxos de trabalho a pessoas externas, isso pode ser mais complexo ou precisar implementar mecanismos dentro dos fluxos de trabalho, como enviar um e-mail ou enviar uma mensagem de bate-papo em um grupo do Teams/Slack.</p> <p>Existe outra alternativa: os emblemas. Os emblemas são botões "inativos" que permitem uma olhada para indicar se um fluxo de trabalho foi bem-sucedido ou não. É possível criar um (ou mais) emblema(s) por fluxo de trabalho. A criação de um emblema é realizada por meio da tela de execução do fluxo de trabalho e por meio do menu de contexto oculto no canto superior direito desta tela:</p> <p>O portal da Web exibe então um formulário que permite definir o emblema, incluindo a ramificação ou o evento que acionou o fluxo de trabalho. Por exemplo, isso permite que você tenha um emblema de combinação no caso de um fluxo de trabalho ter vários gatilhos ou poder ser executado por várias ramificações.</p> <h2 id=configurando-um-emblema>Configurando um emblema<a class=headerlink href=#configurando-um-emblema title="Permanent link">¶</a></h2> <p>Os emblemas são então gerados dinamicamente, e um portal fornece a você um bloco de texto de empréstimo que pode ser integrado aos arquivos Markdown do GitHub. Em particular, é comum incluir emblemas no arquivo README do Repositório para dar uma visão clara e direta sobre o status dos fluxos de trabalho, seja implantação, teste de segurança ou simplesmente compilação. Aqui está um exemplo do uso de emblemas:</p> <p>README.md A lista de verificação do serviço Azure Kubernetes Crie e implante na licença MPL-2.0 de aprovação prévia do último commit de ontem</p> <p>Emblemas em um arquivo README</p> <p>Também é possível incluir o emblema em um site externo ao GitHub. Isso requer o uso do seguinte formato:</p> <p><code>https://github.com/&lt;OWNER&gt;/&lt;REPOSITORY&gt;/actions/workflows/&lt;WORKFLOW_FILENAME&gt;/badge.svg</code></p> <p>Aqui está um exemplo de um emblema injetado em uma página HTML:</p> <p><code>&lt;img src="https://github.com/60pportunities/aks-checklist/actions/ workflows/generate-offline.yml/badge.svg" /&gt;</code></p> <p>Esses emblemas são mais do que um elemento estético; eles podem dar visibilidade centralizada, sem precisar ir para a parte de ações restaurativas e analisar cada fluxo de trabalho.</p> <h2 id=fluxos-de-trabalho-reutilizaveis_1>Fluxos de trabalho reutilizáveis<a class=headerlink href=#fluxos-de-trabalho-reutilizaveis_1 title="Permanent link">¶</a></h2> <p>Em vez de duplicar e transferir conteúdo entre diferentes fluxos de trabalho, é possível estabelecer fluxos de trabalho reutilizáveis. Esses fluxos de trabalho reutilizáveis podem ser invocados por você ou qualquer pessoa autorizada a acessá-los, permitindo a integração em outros fluxos de trabalho.</p> <p>A prática de reutilizar fluxos de trabalho elimina a redundância, simplificando o gerenciamento do fluxo de trabalho. Isso acelera a criação de novos fluxos de trabalho, aproveitando a base estabelecida por outros, semelhante a como você constrói sobre ações existentes. Além disso, a reutilização de fluxos de trabalho promove a adoção de melhores práticas, facilitando a utilização de fluxos de trabalho bem elaborados, pré-testados e comprovadamente eficazes. Essa abordagem capacita sua organização a cultivar um repositório de fluxos de trabalho reutilizáveis que podem ser controlados centralmente, contribuindo para uma manutenção eficiente.</p> <h3 id=como-funciona>Como funciona?<a class=headerlink href=#como-funciona title="Permanent link">¶</a></h3> <p>De um lado, você simplesmente cria um fluxo de trabalho reutilizável que é um fluxo de trabalho padrão com uma exceção, se você quiser passar parâmetros, você precisa declará-los como workflow_call:</p> <div class=highlight><pre><span></span><code>name: Reusable workflow example
on:
workflow_call:
inputs:
message:
required: true
type: string
jobs:
myjob:
runs-on: self-hosted
steps:
- run: echo ${{inputs.message }}
</code></pre></div> <p>E então, do outro lado, a partir de um fluxo de trabalho de chamada, você apenas referencia o YAML que deseja carregar:</p> <div class=highlight><pre><span></span><code>name: Reusing workflow example
on:
workflow_dispatch:
jobs:
call-workflow-in-other-repo:
uses: ./.github/workflows/reusable.yaml
with:
 message: 'hello my friend'
</code></pre></div> <p>Neste exemplo anterior, nós o carregamos usando um arquivo YAML local, o que significa que o fluxo de trabalho reutilizável é armazenado no mesmo repositório. Você pode imaginar um cenário onde você tem um repositório externo com todo o seu fluxo de trabalho reutilizável. Nesse caso, você deve especificar a organização (ou conta do GitHub) e o branch do seu arquivo.</p> <div class=highlight><pre><span></span><code>call-workflow-in-local-repo:
uses: 60pportunities/REPO-REUSABLE/.github/workflows/reusable.yaml@main
</code></pre></div> <p>Note que você pode criar fluxos de trabalho mais ricos carregando diferentes fluxos de trabalho reutilizáveis, onde cada fluxo de trabalho reutilizável pode conter várias etapas, mas você não pode misturar fluxos de trabalho reutilizáveis e etapas "normais" em um único trabalho. No entanto, você pode ter algo assim: <div class=highlight><pre><span></span><code>name: Reusing workflow example
on:
workflow_dispatch:
jobs:
call-workflow-1-in-local-repo:
uses: 60pportunities/test/.github/workflows/reusable.yaml@main
with:
message: 'hello my friend'
job2:
runs-on: self-hosted
steps:
- run: echo 'a normal step'
call-workflow-1-in-remote-repo:
uses: 60pportunities/test/.github/workflows/another-reusable.yaml@main
</code></pre></div> Você já deve estar se perguntando: qual é a diferença com Composite Actions que permite injetar vários passos de uma vez? Essa é uma boa pergunta porque a diferença é muito (muito) sutil e, como ambos os recursos continuam a remover limitações, eles se tornam cada vez mais idênticos. Use o que você acha que se encaixa em suas necessidades ou sua preferência. acessado.</p> <h2 id=access-to-reusable-workflows>Access to reusable workflows<a class=headerlink href=#access-to-reusable-workflows title="Permanent link">¶</a></h2> <p>Fluxos de trabalho reutilizáveis significam que um fluxo de trabalho deve ser capaz de acessar o YAML que contém o fluxo de trabalho chamado. Isso significa que pelo menos um dos seguintes requisitos deve ser verdadeiro:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Ambos os fluxos de trabalho (chamador e chamado) estão no mesmo repositório.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O fluxo de trabalho chamado é armazenado em um repositório público, e sua organização permite que você use fluxos de trabalho públicos reutilizáveis.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O fluxo de trabalho chamado é armazenado em um repositório privado e as configurações para esse repositório permitem que ele seja acessado.</li> </ul> <h3 id=be-aware-of-some-limtations>Be aware of some limtations<a class=headerlink href=#be-aware-of-some-limtations title="Permanent link">¶</a></h3> <p>A reutilização é superimportante para a governança e também para a eficiência e legibilidade dos seus fluxos de trabalho, mas vem com algumas limitações:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Um fluxo de trabalho pode carregar um fluxo de trabalho que carrega outro modelo e assim por diante, até 4 níveis no máximo (para evitar loop infinito)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Você pode chamar até 20 fluxos de trabalho reutilizáveis ​​de um arquivo de fluxo de trabalho raiz. A contagem inclui todos os fluxos de trabalho reutilizáveis aninhados também.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Variáveis de ambiente não são propagadas para fluxos de trabalho chamados. Você tem que passá-las como parâmetros de entrada</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Da mesma forma, variáveis de ambiente definidas no contexto env, definidas no fluxo de trabalho chamado, não são acessíveis no contexto env do fluxo de trabalho do chamador. Você deve usar saídas do fluxo de trabalho reutilizável</li> </ul> <p>Não se esqueça desse recurso quando sentir que está se repetindo em seus fluxos de trabalho.</p> <h3 id=create-your-own-custom-github-actions>Create your own custom GitHub Actions<a class=headerlink href=#create-your-own-custom-github-actions title="Permanent link">¶</a></h3> <p>O poder do GitHub Actions não é seu modelo ou tecnologia (pipeline como código) que já existe. É sua extensibilidade, permitindo que qualquer um crie uma Action e a disponibilize para todos. As possibilidades de coisas alcançáveis com o GitHub Actions se tornam quase infinitas.</p> <p>Ao criar seus fluxos de trabalho, você provavelmente encontrará a maioria de suas necessidades com Actions criadas e disponíveis no mercado (mais de 8.000 no momento em que escrevo estas linhas). Mas a tecnologia e as necessidades mudam rapidamente e inevitavelmente chegará um dia em que você estará enfrentando uma necessidade para a qual nenhuma ação já existe, ou se você deseja oferecer mais do que o que torna uma ação existente. Nesse dia, você terá a possibilidade de criar sua própria GitHub Action.</p> <p>A segunda seção deste livro é dedicada à criação de GitHub Actions em diferentes formas. Primeiro, abordaremos os diferentes conceitos e, em seguida, criaremos diferentes Actions, cada uma delas, usando recursos mais avançados.</p> <h3 id=create-your-first-action>Create your first Action<a class=headerlink href=#create-your-first-action title="Permanent link">¶</a></h3> <p>Ao criar sua própria Ação do GitHub? Uma ação é um módulo que contém código personalizado que será executado por um dos agentes para executar uma tarefa específica. É reconhecido que uma ação deve operar no modelo de componente Linux, o que significa um componente que executa apenas algumas coisas, mas as executa perfeitamente. Você pode se deparar com ações ricas e complexas, mas esse não é o objetivo principal delas. Portanto, é preferível ter duas Ações simples enfileiradas do que apenas uma Ação complexa.</p> <p>O mercado está cheio de Ações escritas por indivíduos, mas, infelizmente, a Ação que atende às suas necessidades pode não estar lá. Também é possível que seu fluxo de trabalho tenha que executar várias ações que consistem em vários comandos sequenciais que você deseja replicar em diferentes fluxos de trabalho sem ter que copiar e colar cada reutilização. Fatoração e experiência do usuário são os dois primeiros motivos para criar uma ação personalizada.</p> <p>Este capítulo discutirá a criação de uma Ação, seja para compartilhá-la com a comunidade do GitHub ou mantê-la para uso pessoal.</p> <h2 id=the-different-types-of-actions>The different types of Actions<a class=headerlink href=#the-different-types-of-actions title="Permanent link">¶</a></h2> <p>O primeiro conceito para desenvolver uma ação adequada é considerar um programa: um software com seus parâmetros de entrada e saída, que realiza uma tarefa dada e precisa. Esta ação tem uma versão, uma nomenclatura para chamá-la e lógica de erro (código de saída) como uma ferramenta de linha de comando. A principal diferença é que ela é empacotada para que sua integração em um fluxo de trabalho seja simplificada o máximo possível.</p> <p>Como qualquer programa, uma Ação tem um código de negócio que é escrito em uma linguagem de programação. Dependendo da escolha desta linguagem ou do sistema operacional de destino (do agente), você terá a oportunidade de compor uma ação de três maneiras:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Ação escrita inteiramente em JavaScript (ou TypeScript)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Uma Ação escrita em qualquer linguagem, mas empacotada como um contêiner de imagem Docker</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Ação escrita usando YAML, ações compostas</li> </ul> <p>Dependendo do formulário escolhido, as Ações estarão disponíveis para alguns sistemas operacionais, conforme resumido na tabela a seguir:</p> <table> <thead> <tr> <th>Туре</th> <th>Sistema operacional</th> </tr> </thead> <tbody> <tr> <td>Contêiner Docker</td> <td>Linux</td> </tr> <tr> <td>JavaScript</td> <td>Linux, macOS, Windows</td> </tr> <tr> <td>Etapas de execução de Composites</td> <td>Linux, macOS, Windows</td> </tr> </tbody> </table> <h2 id=pros-and-cons-what-to-choose>Pros and cons, what to choose?<a class=headerlink href=#pros-and-cons-what-to-choose title="Permanent link">¶</a></h2> <p>A escolha do formato da sua ação também terá impactos no seu uso diário, seja em termos de desenvolvimento/manutenção ou desempenho. Cada tipo de ação tem suas vantagens e desvantagens. Além do seu conforto para qualquer tecnologia, reserve um tempo para pesar os prós e contras de cada escolha, dependendo da sua necessidade e uso feito da sua ação.</p> <p>VER TABEL:A 163</p> <h2 id=creation-of-your-action>Creation of your Action<a class=headerlink href=#creation-of-your-action title="Permanent link">¶</a></h2> <p>Nos próximos capítulos, você aprenderá como construir suas ações usando conceitos avançados. No entanto, para ser mais didático, começaremos criando uma ação simples e personalizada para aprender todos os conceitos básicos, ou seja, a estrutura da ação, seus vários componentes e sua publicação. Começaremos com o famoso "Hello World", uma ação que recebe um primeiro nome e exibe uma mensagem no console.</p> <p>Comece criando um repositório dedicado chamado github-action-hello (o nome não importa, mas ele terá que ser chamado da mesma forma dentro dos fluxos de trabalho). Este repositório deve ser público; é de fato um pré-requisito para poder hospedar uma Ação.</p> <p>Nota: Desde 2023, é possível usar uma ação de um repositório privado se ela pertencer ao mesmo proprietário (ou organização) e tiver sido explicitamente compartilhada por meio do menuConfigurações &gt; Ação &gt;Geral&gt;Acesso.</p> <p>Depois que o repositório for criado, clone-o localmente no seu computador, pois algumas ações não podem ser realizadas no portal online.</p> <h2 id=creating-the-manifest>Creating the manifest<a class=headerlink href=#creating-the-manifest title="Permanent link">¶</a></h2> <p>Uma ação é um conjunto de arquivos enviados em um repositório. Para que o mecanismo GitHub carregue e use dentro dos fluxos de trabalho, essa ação deve seguir um formato predefinido. Assim, as Ações geralmente observam a seguinte estrutura:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Um arquivo README.md (opcional, mas fortemente recomendado) que descreve sua ação, mas também como usá-la, como seus parâmetros de entrada-saída</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Um arquivo LICENSE (opcional) para esclarecer se alguém pode ou não reutilizar o código para sua ação</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Um arquivo manifesto action.yaml (obrigatório!).</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Scripts que compõem a lógica de sua ação e o que ela executa</li> </ul> <p>Comece criando o manifesto de sua futura Ação: action.yml (ou action.yaml). Este arquivo permite que o GitHub "descubra" sua ação, suas propriedades, mas também seu comportamento. Ele contém várias propriedades que você definirá para criar sua primeira ação. O primeiro bloco descreve sua ação; ele contém o nome, uma pequena descrição e, potencialmente, o autor da Ação.</p> <div class=highlight><pre><span></span><code>name: 'Hello World' # The name of your action (mandatory)
description: 'Says hello to someone' # a simple description (mandatory)
author: 'Louis-Guillaume MORAND' # The name of the creator (optional)
</code></pre></div> <p>Um segundo bloco descreve a parte técnica: o formato da ação (JavaScript ou Docker). No nosso caso, ele também contém o ponto de entrada e a versão do JavaScript usada. No nosso caso, começaremos criando uma ação JavaScript baseada no NodeJS 12 e cujo arquivo principal será index.js.</p> <p><div class=highlight><pre><span></span><code>runs:
using: 'node20' #JavaScript action using NodeJS 20
main: 'index.js' # The entry point (main script)
</code></pre></div> Uma seção é dedicada aos parâmetros de entrada e saída. Não há necessidade de parâmetros de saída em nosso caso, mas um parâmetro chamado who contém o nome da pessoa para passar como parâmetro. Vamos dar a ele um valor padrão.</p> <div class=highlight><pre><span></span><code>inputs: # List of input parameters
firstname: # (mandatory) the name of the parameter
description: 'Name of the person' # (mandatory) a sentence that describes the parameter
required: true # (mandatory) indicates whether the parameter is required or not
default: 'World' # (optional) gives a default value to the parameter
default: 'World' # (optional) gives a default value to the parameter
</code></pre></div> <p>Por fim, um bloco opcional está relacionado à marca da sua ação. Este é o ícone que aparecerá no marketplace se você publicá-lo. <div class=highlight><pre><span></span><code>branding:
icon: 'message-circle' # The name of one of the available icons
color: 'orange' # The background color of your icon
</code></pre></div></p> <p>A lista de ícones disponíveis está bem acima de cem se a lista de cores for limitada (branco, amarelo, azul, verde, laranja, vermelho, roxo ou cinza-escuro). Os nomes desses ícones e a exibição esperada podem ser encontrados no site FeathersIcon: <a href=https://feathericons.com/ >https://feathericons.com/</a>.</p> <p>O conteúdo final do seu arquivo manifesto deve ser semelhante a este: (a ordem dos blocos não importa)</p> <div class=highlight><pre><span></span><code>name: 'Hello World' # The name of your action (mandatory)
description: 'Say hello to someone' # a simple description (mandatory)
author: 'Louis-Guillaume MORAND' # The name of the creator (optional)
runs:
using: 'node20' #JavaScript action using NodeJS 20
main: 'index.js' # The entry point (main script)
inputs: # List of input parameters
firstname: # (mandatory) the name of the parameter
description: 'Name of the person' # (mandatory) a sentence that describes the parameter
required: true # (mandatory) indicates whether the parameter is required or not
default: 'World' # (optional) gives a default value to the parameter
branding:
icon: 'message-circle' # The name of one of the available icons
color: 'orange' # The background color of your icon
</code></pre></div> <h2 id=the-business-logic-file>The business logic file<a class=headerlink href=#the-business-logic-file title="Permanent link">¶</a></h2> <p>É hora de criar o script que executará as ações desejadas. Se o nome dele estiver livre, ele deve corresponder ao que você colocou no manifesto; no nosso caso, index.js. Nosso arquivo deve conter a seguinte lógica:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Recuperar o primeiro nome da entrada</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Colocar o valor em uma variável local</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Exibir uma mensagem no console</li> </ul> <p>Vamos começar recuperando o parâmetro da ação. Nada complicado, especialmente porque o GitHub fornece um kit de ferramentas que facilita o desenvolvimento de ações. Este kit de ferramentas tem muitos módulos, mas precisamos apenas de um aqui: <a class="magiclink magiclink-github magiclink-repository" href=https://github.com/action/core title="GitHub Repository: action/core">action/core</a>.</p> <p>Este tem métodos diferentes, incluindo getInput(), que pode recuperar o valor de um parâmetro de entrada:</p> <div class=highlight><pre><span></span><code>const core = require('@actions/core'); // loading the Toolkit's core module
const firstname = core.getInput('firstname'); // recovery of the parameter's value
</code></pre></div> <p>Para a exibição, nada complicado, uma linha pura de JavaScript:</p> <p><code>console.log(Hello ${firstname}!</code>);`</p> <p>Se essas três linhas forem suficientes para fazer uma ação que funcione perfeitamente, adicionaremos um bloco try-catch que permite que o módulo não trave se ocorrer uma exceção ou problema.</p> <p>Finalmente, adicionamos no bloco de tratamento de erros uma chamada para o método setfailed() que informa ao agente que a ação deve ser considerada falha. Claro, as chances de o código não funcionar são muito baixas neste caso, mas sem essa mecânica, o fluxo de trabalho pai não consegue adivinhar se o script se comportou como esperado ou se ocorreu um problema grave.</p> <p><div class=highlight><pre><span></span><code>const core = require('@actions/core'); // loading the Toolkit's core module
try
{
const firstname = core.getInput('firstname'); // recovery of the parameter's value
console.log(`Hello ${firstname}!`);          // writes a message in the console
}
catch (error)
{
core.setFailed(error.message); // tells the agent that the process has failed and transmits the details of the problem
}
</code></pre></div> Seu arquivo de script está completo; no entanto, se você conhece um pouco de JavaScript, a primeira linha deve questioná-lo. Com a função require(), esta indica que carrega um módulo, mas em nenhum momento disponibilizamos este módulo. Devemos instalá-lo usando o NPM (Node Package Manager), que pode ser baixado no seguinte endereço: <a href=https://nodejs.org>https://nodejs.org</a>.</p> <p>Abra um prompt de comando cuja pasta atual deve ser uma das cópias locais do seu repositório.</p> <p>Primeiro, execute o comando "npm init" para preparar o NPM para usar um package.json para configurar os módulos. Este comando fará várias perguntas. Você pode deixar os valores como padrão ou personalizá-los; eles são de pouca importância.</p> <p><code>npm init</code></p> <p>Then run "npm install" to install the module <a class="magiclink magiclink-github magiclink-repository" href=https://github.com/actions/core title="GitHub Repository: actions/core">actions/core</a>.</p> <p><code>npm install @actions/core</code></p> <p>Este comando cria uma pasta node_modules na qual o módulo <a class="magiclink magiclink-github magiclink-repository" href=https://github.com/actions/core title="GitHub Repository: actions/core">actions/core</a> é baixado, e um novo arquivo package-lock.json registra a lista de todos os submódulos dependentes. Esses são dois arquivos técnicos importantes, mas nunca devem ser modificados manualmente.</p> <p>Nossa ação está pronta; só precisamos testá-la em um fluxo de trabalho. Para fazer isso, basta usar a palavra-chave uses e fornecer o nome completo da nossa ação: Igmorand/github-action-hello@main</p> <p><code>- uses: 60pportunities/github-action-hello@main</code></p> <p>Você pode então fazer commit e enviar seu código para o repositório que está no GitHub.</p> <p>Observe que "60pportunities" deve ser substituído pelo nome da sua conta no GitHub, depois vem o nome do repositório da sua ação e, finalmente, "<a class="magiclink magiclink-github magiclink-mention" href=https://github.com/main title="GitHub User: main">@main</a>", que indica usar o branch principal. Usar um nome de branch é incomum; veremos em um capítulo vindouro versionamento como sua ação e chamar esse número de versão explicitamente.</p> <p>O YAML final deve ser parecido com isto:</p> <div class=highlight><pre><span></span><code>steps:
- uses: Igmorand/github-action-hello@main # loading our action
with:
  firstname: 'Louis-Guillaume' # parameter to provide, indicate the name of your choice
</code></pre></div> <h2 id=versioning>Versioning<a class=headerlink href=#versioning title="Permanent link">¶</a></h2> <p>Cada Action GitHub tem um número de versão exclusivo. Esta versão é importante porque permite que você implemente alterações em suas GitHub Actions sem impactar negativamente os usuários que consomem sua ação. Você deve estar ciente de que assim que seu primeiro rascunho do seu trabalho for publicado, os usuários poderão usá-lo.</p> <p>É sua responsabilidade nunca interromper seus fluxos de trabalho, seja removendo a ação ou fazendo qualquer alteração importante sem alterar o número da versão. Portanto, é fundamental estar atento à definição da versão.</p> <p>O GitHub recomenda seguir a especificação SemVer ("Semantic Versioning) para construir e manter o número da versão da sua Ação. Uma versão compatível com SemVer contém pelo menos três blocos de números no formato MAJOR.MINOR.PATCH. Para cada produto, o trabalho de script sempre começa com a versão 1.0.0.</p> <p>Mas é especialmente a mudança de versão que chamamos de incremento, que depende do que é feito dentro do aplicativo. Assim, incrementamos a parte:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> MAJOR: sempre que grandes mudanças ou que causam mudanças de quebra são implementadas</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> MINOR: sempre que recursos compatíveis com versões anteriores são adicionados</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> PATCH: sempre que você corrige um bug ou um problema de segurança</li> </ul> <p><code>MAJOR Breaking changes 2.1.7 PATCH Bug fixes</code> Semantic versioning</p> <p>Às vezes, você verá um quarto bloco especificando um número de compilação (por exemplo, a data e um incremento) ou um modo de lançamento, por exemplo, um rótulo "pré-lançamento" ou "beta".</p> <p>Certifique-se de entender completamente esse versionamento porque você inevitavelmente precisará dele para usar sua ação, pois ajudará os usuários a entender qual versão de sua ação usar.</p> <h2 id=exercicios_3>Exercícios<a class=headerlink href=#exercicios_3 title="Permanent link">¶</a></h2> <p>Vamos praticar com alguns exercícios sobre versionamento de ações.</p> <h3 id=exercicio-n1_5>Exercício n°1<a class=headerlink href=#exercicio-n1_5 title="Permanent link">¶</a></h3> <p>Vamos verificar se você entendeu bem as regras de versionamento. Para todas as versões a seguir, indique quais estão corretas ou não:</p> <ol> <li>v1</li> <li>v2.3 3.3.2024.5</li> <li>1.10.3.23230</li> <li>plop1.3 6.2.0.0.pre-alpha</li> <li>3.56.42.win-x64 Easy, isn't it?</li> </ol> <h3 id=exercicio-n2_3>Exercício n°2<a class=headerlink href=#exercicio-n2_3 title="Permanent link">¶</a></h3> <p>Vamos trabalhar um pouco no ciclo de vida de uma ação. Vamos pegar o exemplo da nossa Ação HelloWorld publicada como versão 2.0.0 e rapidamente usada por muitas pessoas. Como parte de sua evolução, faremos várias atualizações e novas publicações no Marketplace.</p> <p>Com a primeira evolução, nossa ação 2.0.0 agora recebe dois primeiros nomes em parâmetro e permite exibi-los dentro da mensagem no console. Aqui está a assinatura para chamar a ação:</p> <p><div class=highlight><pre><span></span><code>steps:
-uses: YOUR-REPO/github-action-hello@v2
with:
firstname: 'XXX'
firstname2: 'YYY'
</code></pre></div> Você percebe que a ação trava se o primeiro nome contiver um caractere especial como um apóstrofo ou um traço. Você corrige sua ação e a republica. Qual novo número de versão você deve dar a ela? Então, você decide adicionar um recurso à sua ação que permite personalizar o idioma da mensagem exibida. Definindo o idioma com um novo parâmetro obrigatório, mas um valor padrão é igual a "fr". Qual novo número de versão você deve colocar?</p> <p>Finalmente, você decide alterar como os nomes são fornecidos com um novo parâmetro, "firstnames", que pega uma matriz contendo todos os primeiros nomes como valores. O valor padrão é uma tabela incluindo apenas o primeiro nome "Louis-Guillaume".</p> <p>A nova assinatura para chamar a ação tem o seguinte formato:</p> <p><div class=highlight><pre><span></span><code>steps:
- uses: YOUR-REPO/github-action-hello@v???
with:
firstnames: ['John', 'Jane', 'Bob']
</code></pre></div> Qual novo número de versão você deve colocar?</p> <h3 id=exercicio-n3_3>Exercício n°3<a class=headerlink href=#exercicio-n3_3 title="Permanent link">¶</a></h3> <p>Você criou uma ação para integrar com um produto de terceiros. Depois de alguns meses, o publicador deste produto de terceiros decide criar uma ação oficial do GitHub, tornando sua ação obsoleta. Você decide interromper o suporte da sua ação, mas em vez de abandoná-la brutalmente; você planeja alertar todas as pessoas que usam sua ação que uma ação oficial agora está disponível. Você decide adicionar um aviso dentro da sua ação, que mostrará uma mensagem ao executar seu fluxo de trabalho. Você quer que a mensagem seja visível e integrada diretamente na interface do GitHub, não apenas por meio dos logs do fluxo de trabalho. Sua ação deve continuar a funcionar corretamente.</p> <p>Dica: Se você não sabe como exibir um aviso adequado (=anotação), leia o capítulo "Melhorar ações".</p> <h2 id=publicar-no-marketplace>Publicar no Marketplace<a class=headerlink href=#publicar-no-marketplace title="Permanent link">¶</a></h2> <p>Sua ação é perfeitamente funcional e agora pode ser usada por outras pessoas porque seu repositório é público. Uma pergunta ainda surge: qual o interesse em publicá-la no GitHub Marketplace? A resposta é simples: para melhorar sua capacidade de descoberta. É improvável que uma pessoa encontre o repositório da sua ação por acaso, e sua ação pode nunca ser referenciada automaticamente pelos mecanismos de busca. A maneira mais eficaz de permitir o uso mais amplo da sua ação e, assim, participar do esforço coletivo em torno do GitHub Actions é publicá-la no mecanismo de busca dedicado a essas ações: o Marketplace.</p> <p>A publicação é extremamente simples e leva apenas alguns cliques. Requer quatro etapas:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Documentando sua ação: como os usuários esperam aproveitar sua ação sem instruções para usá-la?</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Versionamento: como acabamos de ver no capítulo anterior</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Branding: dê uma identidade à sua ação por meio de seu logotipo e título</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Release: a criação de um release oficial e sua tag</li> </ul> <p>A seção de documentação é a mais simples, mas também a mais importante. Ela permitirá que você use sua ação e faça com que os usuários queiram usá-la. A documentação pode ser completa e rica em seu repositório e conter várias páginas, mas o Marketplace exibirá apenas uma página: o arquivo readme.me na raiz do repositório de sua Action.</p> <p>Este arquivo deve conter informações diferentes sobre sua Ação, como:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Uma descrição de sua Ação</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Os parâmetros de entrada e saída e uma descrição de cada um deles e seus valores padrão</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Segredos e variáveis de ambiente usados por sua Ação</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Um exemplo de uso (trecho YAML para chamar a Ação)</li> </ul> <p>Para a parte de versionamento, você precisa seguir rigorosamente as regras semânticas explicadas no capítulo anterior ou correr o risco de perder usuários de sua ação ou potencialmente quebrar seus fluxos de trabalho e atrair seus miseráveis.</p> <p>Quanto à marca, esta é rápida, pois você só pode escolher um ícone de uma lista e uma cor de fundo. Você pode encontrar ações que tenham um ícone personalizado, como um logotipo da empresa. Saiba que é impossível personalizar o logotipo, a menos que seja um "parceiro" do GitHub, um longo processo administrativo reservado para empresas que oferecem integração com o GitHub ou serviços de nuvem. Se sua empresa estiver interessada, o processo para se tornar um parceiro é descrito no site dedicado: <a href=https://partner.github.com/ >https://partner.github.com/</a>.</p> <p>Como lembrete, a marca é feita por meio de duas propriedades do manifesto de ação: <div class=highlight><pre><span></span><code>branding:
icon: 'message-circle' # The name of one of the available icons
color: 'orange' # The background color of your icon
</code></pre></div></p> <p>Então vem a parte final: a criação de um release. O propósito deste ato é congelar uma versão, ou seja, uma versão única do seu código-fonte que não pode mais mudar no futuro para este release específico, uma versão estável. Comece abrindo o repositório do seu custom</p> <p>Ação. Se estiver bem configurado com seu manifesto, o GitHub exibirá automaticamente um pop-up para facilitar sua implantação:</p> <p>Clique em Draft a release para chegar à tela que pede para você preencher um nome de release e uma tag (o famoso número da versão). Este identificador git exclusivo permite que você direcione uma versão muito específica do código-fonte do seu repositório.</p> <p>Marque a caixa para publicar no Marketplace Se esta caixa estiver desmarcada, sua ação ainda poderá ser usada pelos usuários, mas eles não terão como saber/descobri-la a menos que alguém lhes dê a URL do seu repositório.</p> <p>Quando a caixa de seleção estiver marcada, o GitHub realiza várias verificações, como a exclusividade do nome da sua ação. Você não pode publicar no Marketplace se todos os LEDs não estiverem verdes:</p> <p>Pag.183</p> <p>Se tudo estiver bem, clique no botão "Criar Release" na parte inferior da tela. Você pode então ir para o Marketplace (<a href="https://github.com/marketplace?type=actions">https://github.com/marketplace?type=actions</a>) e encontrar lá sua Ação:</p> <p>Você encontrará o conteúdo da descrição, mas também o ícone (laranja neste exemplo) definido na seção de branding do manifesto.</p> <h2 id=exercicios_4>Exercícios<a class=headerlink href=#exercicios_4 title="Permanent link">¶</a></h2> <p>Vamos praticar um pouco.</p> <h3 id=exercicio-n1_6>Exercício n°1<a class=headerlink href=#exercicio-n1_6 title="Permanent link">¶</a></h3> <p>Se você ainda não fez isso, publique uma Ação Hello World de acordo com o capítulo que você acabou de ler. Certifique-se de encontrar sua Ação entre as ações do Marketplace: <a href=https://github.com/marketplace/actions/ >https://github.com/marketplace/actions/</a></p> <h3 id=exercicio-n2_4>Exercício n°2<a class=headerlink href=#exercicio-n2_4 title="Permanent link">¶</a></h3> <p>Para este segundo exercício, modifique sua ação para ser chamada pelo seguinte YAML (adicionando um parâmetro e alterando o número da versão). A ação deve exibir a seguinte mensagem no console: "Hello XXX &amp; YYY." Você deve alterar o script, mas também seu manifesto.</p> <div class=highlight><pre><span></span><code>steps:
- uses: YOUR-REPO/github-action-hello@v2
with:
firstname: 'XXX'
firstname: 'YYY'
</code></pre></div> <h3 id=exercicio-n3_4>Exercício n°3<a class=headerlink href=#exercicio-n3_4 title="Permanent link">¶</a></h3> <p>Para o último exercício, você deve cancelar a publicação de sua ação do Marketplace. Novamente, não queremos "poluir" o Marketplace com nossos testes. Portanto, certifique-se de que sua ação não esteja mais visível nos resultados de pesquisa do Marketplace.</p> <p>O processo de cancelamento de publicação não foi abordado neste capítulo, mas é explicado na documentação oficial, e as etapas também serão detalhadas nas soluções dos exercícios no final deste livro.</p> <p>Dica: basta reverter as etapas de publicação, mas isso deve ser feito para cada lançamento da Ação. Ou procure pelo pequeno botão mágico ;-)</p> <p>Crie sua segunda ação A primeira Ação está concluída, agora construiremos uma segunda ação que aborda novos conceitos. Esta segunda ação visa simplificar a criação de uma versão do GitHub automatizando a criação da tag e gerando automaticamente um histórico de alterações (changelog). Esta nova Ação, mais relevante para casos de uso reais, cobrirá as noções de execução de código de terceiros, pré/pós script, geração de variável de saída, mas também interações com o GitHub.</p> <p>Um ponto de atenção em particular, a Action, contém dezenas de arquivos e conceitos que não estão relacionados ao GitHub Actions (ex: como configurar a estrutura do projeto Typescript). Esses conceitos não serão abordados neste livro, mas você pode baixar uma cópia totalmente funcional da action do repositório que contém algumas indicações adicionais: <a href=https://github.com/60pportunities/github-action-generate-relnotes>https://github.com/60pportunities/github-action-generate-relnotes</a>.</p> <p>Aviso: O código-fonte da action é minimalista e está longe de ser perfeito, mas visa ser o mais conciso possível para evitar explicar centenas de linhas de código. Você pode se concentrar nas partes que têm um valor técnico real.</p> <h2 id=estabelecimento-dos-pre-requisitos>Estabelecimento dos pré-requisitos<a class=headerlink href=#estabelecimento-dos-pre-requisitos title="Permanent link">¶</a></h2> <p>Esta segunda Ação será escrita em TypeScript, uma linguagem de programação que visa escrever um código JavaScript melhor por meio de uma sintaxe mais rigorosa. Os arquivos Typescript (*.ts) são então transpirados (transformados) em JavaScript puro e, em seguida, executados pelo NodeJS dentro do fluxo de trabalho. Você frequentemente encontrará no mercado Ações escritas com Typescript, que se tornou a linguagem de programação mais favorecida para projetos da Web nos últimos anos.</p> <p>Nosso código Typescript chamará vários módulos do GitHub Actions Toolkit para simplificar algumas de suas operações. A Ação usa:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <a class="magiclink magiclink-github magiclink-repository" href=https://github.com/actions/core title="GitHub Repository: actions/core">actions/core</a>: módulo que fornece funções para gerenciar variáveis de entrada/saída, gerenciamento de log, acesso ao segredo/variáveis, etc.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <a class="magiclink magiclink-github magiclink-repository" href=https://github.com/actions/exec title="GitHub Repository: actions/exec">actions/exec</a>: módulo para executar programas de terceiros e executar linhas de comando. <a class="magiclink magiclink-github magiclink-repository" href=https://github.com/actions/github title="GitHub Repository: actions/github">actions/github</a>: fornece um objeto para interagir com o GitHub, pré-configurado com o contexto atual (usuário + repositório do qual o fluxo de trabalho é executado)</li> </ul> <p>Esses módulos devem ser declarados no arquivo package.json, que será usado pelo NPM (npm install) para baixar o código-fonte desses módulos que nossa ação exigirá.</p> <div class=highlight><pre><span></span><code>"dependencies": {
"@actions/core": "^1.10.0",
"@actions/exec": "^1.1.1",
"@actions/github": "^5.1.1",
"actions-toolkit": "^6.0.1"
},
"devDependencies": {
  "typescript": "^3.7.4"
},
</code></pre></div> <p>Recurso: Como um lembrete, o GitHub Actions Toolkit é o SDK que simplifica muito o desenvolvimento de ações JavaScript usando módulos ricos, mas ainda simplificados. Sua documentação está localizada no repositório dedicado: <a href=https://github.com/actions/toolkit>https://github.com/actions/toolkit</a>.</p> <h2 id=the-manifest-and-its-variables>The manifest and its variables<a class=headerlink href=#the-manifest-and-its-variables title="Permanent link">¶</a></h2> <p>Naturalmente, nossa Ação precisa de um manifesto action.yml, e seu conteúdo se parece com o criado para a primeira ação. Mas é diferente para a declaração de variáveis de entrada que são definidas:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> githubToken: Token de autenticação que permite que você interaja com o repositório no GitHub. Será uma questão de transmitir a variável GITHUB_TOKEN que o GitHub cria automaticamente para cada fluxo de trabalho</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> newTag: Número da tag Git que também servirá como nome da versão</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> generateArtifact: parâmetro opcional que indica se a ação deve ou não gerar um arquivo changelog.txt</li> </ul> <p>Aqui está um trecho do manifesto contendo a declaração de parâmetros de entrada:</p> <div class=highlight><pre><span></span><code>inputs:
github Token:
description: 'Token to access GitHub'
required: true
newTag:
description: 'New tag'
required: true
generateArtifact:
description: 'Generation of changelog?'
required: true
default: true
</code></pre></div> <p>A ação também declara uma variável de saída relnotes que contém o conteúdo do changelog gerado. Embora a ação seja autônoma para reutilizar diretamente o changelog que gerou, retornar seu conteúdo ao fluxo de trabalho pai é uma boa prática se o usuário fizer outro uso do fluxo de trabalho, como enviar uma publicação por e-mail de tal lançamento.</p> <p><div class=highlight><pre><span></span><code>outputs:
relnotes:
description: 'Content of the release note"
</code></pre></div> O arquivo de manifesto global é o seguinte. Observe que a ação carregará o arquivo index.js enquanto escreve nosso código em um arquivo index.ts. O arquivo JavaScript será gerado durante a compilação do TypeScript, que deve ser realizada antes de carregar seu código. Não é o GitHub Actions que fará isso automaticamente.</p> <div class=highlight><pre><span></span><code>name: 'Generate release'
description: 'Generates a release and release notes based on commits'
author: 'Louis-Guillaume MORAND'
branding:
icon: 'award'
color: 'orange'
inputs:
githubToken:
description: 'Token to access GitHub'
required: true
description: 'New tag'
required: true
generateArtifact:
description: 'Generate changelog?'
required: true
default: false
outputs:
relnotes:
description: 'Content of the release note'
runs:
using: 'node20'
main: 'dist/index.js'
</code></pre></div> <h2 id=the-generation-of-the-changelog>The generation of the changelog<a class=headerlink href=#the-generation-of-the-changelog title="Permanent link">¶</a></h2> <p>Claro, se os desenvolvedores trabalham com metodologia, eles comentam ao enviar seu código para o repositório, o que corresponde à funcionalidade que eles adicionam ao aplicativo. Então, por exemplo, neste comentário no commit, nossa ação simplesmente listará todos os commits desde a última tag (que era logicamente o release anterior) e então usará suas mensagens associadas para gerar um novo arquivo, o famoso changelog.</p> <p>Convenção: Não será muito fácil gerar um arquivo de release limpo e legível se os desenvolvedores não respeitarem uma certa homogeneidade para suas mensagens de commit. Existe uma convenção para escrever essas mensagens; essa convenção é uma referência hoje em desenvolvimento. Ela pode ser encontrada no seguinte site: <a href=https://www.conventionalcommits.org>https://www.conventionalcommits.org</a></p> <p>Temos dois métodos para recuperar esses commits, seja usando a API do GitHub para listar esses commits ou simplesmente usando a linha de comando do Git. Esta segunda solução é a mais simples e pode ser testada facilmente em seu computador.</p> <p>O comando para listar todos os comentários de commits (com uma exibição simplificada sem metadados) de uma tag até agora é o seguinte:</p> <p><code>git log MONTAG..HEAD --oneline --pretty-format:"%s"</code></p> <p>Falta-nos um comando para encontrar automaticamente a última tag para o usuário, não fornecendo-a explicitamente para nossa ação. O comando para listar as tags é "git describe -tags" e o comando para exibir apenas a última tag:</p> <p><code>git describe --tags --abbrev=0</code></p> <p>Agora que temos nossos comandos CLI, como fazê-los serem executados por nossa Ação JavaScript? O GitHub Actions Toolkit tem um módulo exec; este módulo torna possível chamar uma ferramenta externa (aqui git.exe instalado por padrão no agente) para passar parâmetros e controlar sua execução (modo silencioso, códigos de erro e até mesmo recuperar logs de saída).</p> <p>Graças a este módulo, podemos criar um método getLastTag() que retorna o nome da última tag.</p> <div class=highlight><pre><span></span><code>import * as exec from '@actions/exec'
await exec.exec('git',
['describe',
'--abbrev=0',
'--tags'],
options);
</code></pre></div> <p>Código-fonte: O código é simplificado aqui para facilitar a leitura. Encontre o código completo no repositório da Action, incluindo como recuperar o valor de retorno da linha de comando: <a href=https://github.com/actions/toolkit>https://github.com/actions/toolkit</a></p> <p>Então, no mesmo princípio, podemos criar um método getCommits() que retornará a lista de mensagens de commits da nossa tag:</p> <p><div class=highlight><pre><span></span><code>let tagFilter= tag+'..HEAD';
await exec.exec('git',
['log',
tagFilter,
'--oneline',
'--pretty-format:"%s"],
options);
</code></pre></div> Finalmente, para formatar a exibição de nossas notas de lançamento, um pequeno método toList(). O método formata cada mensagem em uma nova linha com um traço para fazer uma lista legal: <div class=highlight><pre><span></span><code>export function toList(text: string): string {
return text
.split('\n')
`-
.map(line =&gt; (line? - ${line} :"))
.join('\n')
}
</code></pre></div></p> <h2 id=the-creation-of-a-release>The creation of a release<a class=headerlink href=#the-creation-of-a-release title="Permanent link">¶</a></h2> <p>O objetivo principal da nossa Ação é criar uma versão do GitHub. O GitHub, sendo uma plataforma moderna, expõe a maioria dos seus serviços como API REST. No nosso caso, queremos usar a API dedicada à criação de uma versão documentada aqui: <a href=https://docs.github.com/en/rest/ >https://docs.github.com/en/rest/</a> reference/repos#create-a-release. No entanto, antes de escrever nosso código chamando essa API, vamos ver o que o GitHub oferece em seu kit de ferramentas. Ao ler a documentação do módulo <a class="magiclink magiclink-github magiclink-mention" href=https://github.com/actions title="GitHub User: actions">@actions</a>/ do github, você encontrará um objeto octokit. Este objeto contém muitas propriedades e métodos, incluindo um chamado createRelease(). Parece promissor, não é?</p> <p>O método pronto para uso se encaixa exatamente na nossa necessidade, mas requer vários argumentos (alguns deles são opcionais):</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> owner: o nome do proprietário que criará o release deve ser um dos usuários do repositório</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> repo: o link para o repositório que conterá o release</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> tag_name: o nome da tag</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> name: o título do nosso release</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> body: um texto que descreve o conteúdo do nosso release (onde queremos colocar nosso changelog)</li> </ul> <p>Já temos todas as informações, exceto o nome do repositório e o proprietário. Eles estão localizados no contexto de um fluxo de trabalho, e seria possível usar as variáveis de ambiente no fluxo de trabalho. Aqui, novamente, o GitHub nos ajuda fornecendo um objeto pré-preenchido dentro do módulo <a class="magiclink magiclink-github magiclink-mention" href=https://github.com/actions title="GitHub User: actions">@actions</a>/ github, o famoso octokit.</p> <p><div class=highlight><pre><span></span><code>// Creating a context object with our GITHUB_TOKEN
const octokit = github.getOctokit(repoToken);
// Creation of the release
const response = await octokit.repos.createRelease({
owner: github.context.repo.owner, // owner's name
repo: github.context.repo.repo, // repository's name
tag_name: newTag, // The tag we found
name: newTag, // The tag we found
body: releaseNotes, // release notes
})
</code></pre></div> Aviso: Dependendo da versão do pacote NPM <a class="magiclink magiclink-github magiclink-repository" href=https://github.com/actions/github title="GitHub Repository: actions/github">actions/github</a>, a assinatura para chamar o método é octokit.rest.repos.createRelease() ou octokit.repos.createRelease(). Uma nova versão foi publicada após a escrita deste livro.</p> <h2 id=the-core-of-our-action>The core of our Action<a class=headerlink href=#the-core-of-our-action title="Permanent link">¶</a></h2> <p>Agora que todos os métodos estão prontos, ainda temos que conectá-los e viver nossas ações. Primeiro, criaremos um arquivo index.ts, que corresponderá ao ponto de entrada da nossa ação. O primeiro passo do método é ler os parâmetros conforme declarado no manifesto acima:</p> <div class=highlight><pre><span></span><code>const token = core.getInput("githubToken");
const newTag = core.getInput("newTag");
const isChangeLogEnabled = core.getInput("generateArtifact");
</code></pre></div> <p>Então obtemos a última tag:</p> <div class=highlight><pre><span></span><code>const tag = await git.getLastTag();
</code></pre></div> <p>Essa tag é então passada para o método getCommits() para recuperar a lista de mensagens. Essas mensagens são então formatadas por toList(). <div class=highlight><pre><span></span><code>const messages = await git.getCommits(tag)
const releaseNotes = text.toList(messages);
</code></pre></div> Em seguida, são transmitidos para o método que cria a liberação.</p> <p><code>release.createRelease(newTag, token, releaseNotes);</code></p> <p>Por fim, um pedaço de código funcional correspondente ao parâmetro generateArtifact para decidir se um arquivo (changelog.txt) deve ou não ser gerado.</p> <p><div class=highlight><pre><span></span><code>if (isChangeLogEnabled)
{
  io.writeOutput("changelog.txt", releaseNotes);
}
</code></pre></div> O código completo deste arquivo (index.ts) é:</p> <div class=highlight><pre><span></span><code>import * as core from '@actions/core'
import * as git from './git'
import * as release from './release'
import * as text from './text'
import * as io from './io'

export async function start(): Promise&lt;void&gt;
{
try {
// retrieving parameters
const token = core.getInput("githubToken");
const newTag = core.getInput("newTag");
const isChangeLogEnabled = core.getInput("generateArtifact");
core.debug("Token: ${token}");
core.debug("Tag: ${newTag}");
core.debug("Generate changelog: ${isChangeLogEnabled}");
// retrieving tag
const tag = await git.getLastTag();
// retrieving history message
if (tag != ")
{
const messages = await git.getCommits(tag)
const releaseNotes = text.toList(messages);
core.debug("Releases notes: ${releaseNotes}");
// create release
release.createRelease(newTag, token, releaseNotes);
if (isChangeLogEnabled)
{
  io.writeOutput("changelog.txt", releaseNotes);
}

// set output variable
core.setOutput("relnotes", releaseNotes);
}
}
catch (error)
{
core.setFailed(error.message)
}
}
start();
</code></pre></div> <h2 id=typescript-compilation>TypeScript compilation<a class=headerlink href=#typescript-compilation title="Permanent link">¶</a></h2> <p>A geração do código final da nossa ação é extremamente simples, pois requer apenas dois comandos:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> npm install</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> npm run build</li> </ul> <p>O comando "npm install", baixa na pasta node_modules todos os pacotes declarados em package.json, ou seja, todos os pacotes necessários para a nossa Ação e o módulo typescript que adicionamos manualmente. Além disso, dentro deste mesmo package.json são declaradas as configurações de script, uma das quais, chamada build, irá lançar o "TSC", o compilador Typescript.</p> <div class=highlight><pre><span></span><code>"scripts" :{
  "build": "tsc",
"test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
},
"build": "tsc",
"test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
</code></pre></div> <p>Por fim, um arquivo tsconfig.json é criado manualmente para definir a compilação do typescript. É declarado onde encontrar os arquivos de origem (**.ts*), mas o diretório de destino onde os arquivos JavaScript gerados serão colocados.</p> <div class=highlight><pre><span></span><code>{
"compilerOptions": {
"target":"es6",
"module": "commonjs",
"outDir": "./js",
"rootDir": "./src",
"strict": true,
"noImplicitAny": true,
"esModuleInterop": true
},
</code></pre></div> <p>É como a mecânica funciona dentro de um projeto TypeScript, um pouco complexo de configurar para neófitos, mas muito flexível. Sinta-se à vontade para verificar o repositório de amostra para analisar os diferentes arquivos: <a href=https://github.com/60pportunities/github-action-generate-relnotes>https://github.com/60pportunities/github-action-generate-relnotes</a></p> <p>Nossa ação está tecnicamente pronta, mas ainda temos que enviar todos os arquivos de origem (incluindo arquivos baixados/gerados) para o repositório GitHub.</p> <h2 id=integration-with-a-workflow>Integration with a workflow<a class=headerlink href=#integration-with-a-workflow title="Permanent link">¶</a></h2> <p>Outros usuários agora podem referenciar e usar nossa ação usando sua ramificação, já que nenhuma versão foi publicada ainda. Nossa responsabilidade é garantir que nossa Ação seja funcional, e a melhor maneira é criar um fluxo de trabalho de teste dentro do mesmo repositório.</p> <div class=highlight><pre><span></span><code>- uses: ./ # called the action from the current repository
with:
githubToken: ${{ secrets.GITHUB_TOKEN }}
newTag: ${{ github.event.inputs.tag}}"
generateArtifact: true
</code></pre></div> <p>Pequena sutileza, por padrão, quando um fluxo de trabalho baixa o código-fonte usando a ação checkout, ele realiza um "shallow checkout", um download apenas da versão mais recente do código-fonte, sem o histórico dos commits para ter o download mais rápido possível.</p> <p>No entanto, esse histórico é necessário porque contém as informações necessárias para encontrar tags e comentários. Portanto, é importante definir a ação checkout e indicar para retornar mais informações para nossa necessidade. Isso pode ser feito modificando o valor fetch-depth e dando a ele "O" para dizer à ação para baixar o histórico completo do Git.</p> <div class=highlight><pre><span></span><code>- uses: actions/checkout@v4
with:
fetch-depth: 0
</code></pre></div> <p>Um exemplo de um fluxo de trabalho que permite especificar a tag no momento do acionamento manual:</p> <p><div class=highlight><pre><span></span><code>on:
workflow_dispatch:
inputs:
tag:
description: 'Tag'
required: true
jobs:
build:
runs-on: self-hosted
steps:
- uses: actions/checkout@v4
  with:
  fetch-depth: 0
- name: Generate release + changelog
- id: genRelease # an ID is required to recover relnotes
uses: ./ # called the action from the current repository
with:
githubToken: ${{ secrets.GITHUB_TOKEN }}
newTag: ${{ github.event.inputs.tag}}"
generateArtifact: true
- name: Test the generated release notes
- run: echo "${{ steps.genRelease.outputs.relnotes }}"

- uses: actions/upload-artifact@v4
  with:
name: changelog
path: changelog.txt
</code></pre></div> Quando o fluxo de trabalho é executado, um artefato contendo o arquivo changelog.txt contendo o histórico das mensagens dos commits é criado.</p> <h3 id=artefato-contendo-o-changelog>Artefato contendo o changelog<a class=headerlink href=#artefato-contendo-o-changelog title="Permanent link">¶</a></h3> <p>E um release com uma descrição profissional também é gerado.</p> <h2 id=our-release-and-its-changelog>Our release and its changelog<a class=headerlink href=#our-release-and-its-changelog title="Permanent link">¶</a></h2> <p>E aqui para nossa segunda ação que mostra a interação com o GitHub. Também é possível fazer ações que interagem com outros itens, como criar issues quando um problema é detectado, interagir com repositórios, gerenciar usuários, além, é claro, de poder interagir com qualquer serviço de terceiros. Conto com sua imaginação para criar todos os tipos de fluxo de trabalho que atendam às suas necessidades.</p> <h2 id=create-a-docker-action>Create a docker Action<a class=headerlink href=#create-a-docker-action title="Permanent link">¶</a></h2> <p>Além das Ações JavaScript, as Ações GitHub suportam ações no formato Docker (somente Linux). Se precisamos lembrar do interesse das ações Docker em comparação com as Ações JavaScript, nesse caso, é a capacidade de pré-empacotar vários elementos juntos: ferramentas, bibliotecas, intérpretes, etc., e garantir a consistência de um ambiente que nunca mudará ao longo do tempo. Reuni-los em um único pacote torna possível simplificar o fluxo de trabalho e evitar surpresas ruins criando uma imagem de contêiner imutável (que nunca mudará novamente). Assim, a ação sempre se comportará da mesma maneira. Infelizmente, as Ações JavaScript baixam e instalam essas mesmas ferramentas a cada execução. Portanto, pode haver conflitos de versão, pacotes que não estão mais disponíveis, etc.</p> <h2 id=how-does-it-work>How does it work?<a class=headerlink href=#how-does-it-work title="Permanent link">¶</a></h2> <p>Integrar uma ação do tipo Docker em um fluxo de trabalho é feito da mesma forma que uma Ação JavaScript (autor/ repositório@versão), mas a mecânica por trás disso é diferente. Um fluxo de trabalho, quando executado, realiza tarefas muito específicas:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Ao iniciar o fluxo de trabalho, o GitHub cria uma nova máquina virtual cujo sistema operacional é baseado na propriedade runs-on que você definiu no fluxo de trabalho</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Nesta máquina virtual é iniciado um runner que baixa o manifesto do fluxo de trabalho para saber as tarefas a serem executadas</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> A primeira ação (primeiro passo) deste runner é geralmente a ação checkout que baixa o código-fonte do repositório localmente</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Então, quando se trata da nossa ação Docker, ele baixa todo o código-fonte do repositório que hospeda a ação</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O runner busca um arquivo Dockerfile dentro do código-fonte e o usa para criar uma imagem Docker usando o comando "docker build"</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Uma vez que a imagem é criada, o runner inicia uma instância de contêiner local e lhe dá acesso à pasta atual (mount). Dessa forma, seu container pode interagir com seus arquivos de código-fonte</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O container executa sua ação e devolve o controle ao runner, que pode continuar a executar as próximas tarefas</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Os logs são enviados ao GitHub para serem exibidos no portal</li> </ul> <p>A mecânica usada para Docker Actions foi projetada para facilitar seu uso sem nenhuma adaptação do seu container (sua ação) ou mesmo da estrutura do seu repositório.</p> <h2 id=creating-a-pandoc-action>Creating a Pandoc Action<a class=headerlink href=#creating-a-pandoc-action title="Permanent link">¶</a></h2> <p>Neste capítulo, para misturar teoria e prática, criaremos uma Docker Action contendo a ferramenta "Pandoc". O Pandoc é uma ferramenta de conversão de documentos. Ele pode pegar um formato de entrada e convertê-lo para outro, por exemplo, converter do HTML markdown ou texto bruto para arquivo do Microsoft Word, de um formato científico latex para PDF ou uma combinação de todos esses, porque o Pandoc sabe como gerenciar cerca de trinta formatos; ele é frequentemente chamado de canivete suíço da geração de documentos.</p> <p>O livro que você está lendo atualmente foi escrito no formato Markdown em um repositório do GitHub e transformado com o Pandoc em diferentes formatos (Microsoft Word, PDF, epub) para ser compartilhado com meus leitores. Aqui está parte do fluxo de trabalho que gera o arquivo PDF; ele contém várias etapas. O tempo de instalação das diferentes ferramentas não é insignificante (2 minutos e 30 segundos no total para gerar o livro).</p> <div class=highlight><pre><span></span><code>steps:
- uses: actions/checkout@v4 # downloading source code
  name: Apt-get update # update the package database
run: sudo apt-get update
- name: install pandoc #installing pandoc
run: sudo apt-get install --assume-yes pandoc
- name: install pdflatex # installing latex and several additional modules
run: |
sudo apt-get install texlive-latex-base
sudo apt-get install texlive-fonts-recommended
sudo apt-get install texlive-latex-extra
sudo apt-get install texlive-xetex
- name: Build PDF version # Generating a PDF from markdown
run: pandoc -V documentclass-memoir --pdf-engine-xelatex -- from=markdown-blank_before_header -o './dist/GitHub Actions-a
practical guide.pdf'
working-directory: ./book
</code></pre></div> <p>O fluxo de trabalho não é tão complicado (mesmo que você veja apenas uma pequena parte), mas gostaríamos de reduzi-lo a uma única etapa para facilitar a leitura. Além disso, explicamos anteriormente que as ações baseadas em um arquivo docker eram mais lentas, especialmente porque leva o GitHub para gerar uma imagem docker e, em seguida, implantar (girar) um contêiner.</p> <p>No entanto, esse tempo de processamento do Docker pode ser menor do que o tempo cumulativo de diferentes ações sequenciais de um fluxo de trabalho padrão, especialmente como veremos, a instalação do Pandoc e suas extensões leva 2 minutos atualmente, onde uma ação do docker realizando a mesma coisa levaria apenas 30 segundos. Portanto, para responder a esse tipo de cenário, é interessante que você aprenda como criar ações do Docker.</p> <p>Para hospedar sua ação, é necessário criar um novo repositório, nomeie-o "github-action-pandoc". Se você escolher outro nome, terá que adaptar os exemplos de código de acordo.</p> <h2 id=the-structure-of-a-docker-action>The structure of a Docker Action<a class=headerlink href=#the-structure-of-a-docker-action title="Permanent link">¶</a></h2> <p>Uma Docker Action é geralmente mais sintética do que uma JavaScript Action; ela geralmente contém quatro arquivos:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Um arquivo action.yaml, o manifesto do aplicativo para sua publicação no Marketplace (o mesmo formato das JavaScript Actions)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Um Dockerfile contendo as instruções para criar a imagem Docker</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Um arquivo de script que será executado dentro do nosso contêiner</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Um arquivo README.md para descrever sua ação</li> </ul> <p>O arquivo README.md contém a descrição da sua ação e um exemplo de YAML para usar nossa Action: <div class=highlight><pre><span></span><code>- uses: 60pportunities/github-action-pandoc@v1
with:
args: "--standalone --output-readme.pdf README.md"
</code></pre></div></p> <p>A seção manifest difere muito ligeiramente daquela das ações JavaScript. A seção runs será específica, pois especificamos o tempo de execução do Docker, mas também um nome de arquivo que serve para gerar a imagem do contêiner. É um uso comum chamá-lo de Dockerfile.</p> <p><div class=highlight><pre><span></span><code>runs:
using: "docker"
image: "Dockerfile"
</code></pre></div> O manifesto também contém as seções descritivas e de marca:</p> <div class=highlight><pre><span></span><code>name: 'Pandoc Converter'
description: 'GitHub Action to Convert Documents via Pandoc'
author: 'Louis-Guillaume MORAND'
runs:
using: "docker"
image: "Dockerfile"
branding:
icon: 'book-open'
color: 'green'
</code></pre></div> <p>Depois vêm os dois arquivos mais importantes: o arquivo docker de receitas e o script principal (que pode, é claro, ser composto de vários scripts dependendo de sua complexidade). O arquivo Dockerfile é uma lista de comandos que o Docker usará para criar sua imagem de contêiner; esta "receita" especifica todos os ingredientes a serem integrados, começando pelo sistema operacional, depois os módulos a serem instalados nele e, finalmente, os comandos a serem executados na inicialização.</p> <p>Nota: Este livro não aborda em detalhes a escrita do Dockerfile e suas boas práticas. Se este tópico lhe interessa, a melhor fonte de informação continua sendo a documentação oficial: <a href=https://docs.docker.com/engine/reference/builder/ >https://docs.docker.com/engine/reference/builder/</a>. Em particular, existem boas práticas para iluminar imagens de contêiner, mas não as aplicaremos para manter o máximo de simplicidade e legibilidade.</p> <p>O primeiro reflexo para atender à nossa necessidade de criar um contêiner Pandoc é escrever uma receita como esta, perfeitamente funcional:</p> <div class=highlight><pre><span></span><code># We choose a base OS Image: alpine is very lightweight
FROM alpine: 3.12
# Installing pandoc
RUN apk update &amp;&amp; apk --no-cache add pandoc
# Installing additional modules and various tools
RUN apk add texlive-full\
texlive-xetex\
biber\
make\
rsync\
tar\
libarchive-tools\
gmp\
curl
ADD entrypoint.sh /entrypoint.sh
RUN ["chmod", "+x","/entrypoint.sh"]
ENTRYPOINT ["/entrypoint.sh"]
</code></pre></div> <p>No entanto, a geração desta imagem é relativamente lenta devido ao grande número de ferramentas para instalar (vários minutos), e o interesse de uma ação do Docker seria muito limitado em comparação ao nosso fluxo de trabalho original. Felizmente, os editores do Pandoc fizeram uma imagem de contêiner do Pandoc, permitindo-nos usá-la como base de trabalho e adicionar os módulos ausentes de que precisamos.</p> <p>O novo arquivo Dockerfile é bastante simplificado e muito mais rápido de gerar:</p> <div class=highlight><pre><span></span><code># Base OS image: Alpine with already integrated Pandoc
FROM pandoc/latex:2.6
# Reduced installation of modules because many tools are already in the base image
RUN apk update\
&amp;&amp; apk add texlive-full\
texlive-xetex\
biber
# Integration of our script
ADD entrypoint.sh /entrypoint.sh
#Allowing script execution
RUN ["chmod", "+x", "/entrypoint.sh"]
#Defining the script to run at startup of the container
ENTRYPOINT ["/entrypoint.sh"]
</code></pre></div> <p>Você certamente notou esse arquivo estranho chamado entrypoint.sh. Este é um arquivo de script simples para colocar ao lado do Dockerfile. Este é o ponto de entrada do nosso contêiner, o que significa que ele será chamado quando o contêiner iniciar e que os parâmetros foram enviados para o contêiner. Intrinsecamente, quando o runner executa sua ação, ele percebe algo como isto:</p> <p><code>docker run image-of-my-action --parameter-of-my-choice</code></p> <p>Assim, os parâmetros de uma ação são transmitidos para o container e então para o arquivo Entrypoint.sh que pode então usá-los. A estrutura de um script é geralmente da seguinte forma:</p> <p><div class=highlight><pre><span></span><code>#!/bin/sh # the "shebang", header that tells the system by which interpreter
set -e

[...] # commands to run
</code></pre></div> No nosso caso, nada complicado, pois queremos apenas chamar a ferramenta Pandoc, pré-instalada em nosso contêiner, e então passar parâmetros que podem ser recuperados com "$ *": <div class=highlight><pre><span></span><code>#!/bin/sh
set-e
sh -c "pandoc $*" # opens a shell, and runs Pandoc by giving him the arguments
</code></pre></div></p> <p>De quais argumentos estamos falando? Argumentos que estão no arquivo YAML. O runner os lê e então os passa para um contêiner que pode, por sua vez, transmiti-los para o script:</p> <p><div class=highlight><pre><span></span><code>- uses: 60pportunities/github-action-pandoc@main # replace with your action
   with:
   args: "--standalone --output-readme.pdf README.md"
</code></pre></div> Portanto, o comando final é "pandoc standalone -output=readme.pdf README.md", que diz ao Pandoc para pegar o arquivo README.md e transformá-lo em readme.pdf. Finalmente, se você ainda não fez isso, crie um arquivo README.md com conteúdo markdown.</p> <p>Nota: Você pode encontrar minha ação pronta para o usuário e bifurcá-la se desejar. Ela está localizada neste repositório: <a href=https://github.com/60pportunities/github-action-pandoc>https://github.com/60pportunities/github-action-pandoc</a>. Eu recomendo que você pegue o arquivo sample.md e coloque seu conteúdo em seu arquivo README.md. O resultado deste arquivo transformado em PDF pode surpreendê-lo.</p> <p>Seu repositório deve ser parecido com isto:</p> <p>Resta testar sua Ação. Para fazer isso, vamos criar um fluxo de trabalho dentro do repositório de sua Ação. Temos que testar várias coisas:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Que o arquivo dockerfile seja válido e gere com sucesso uma imagem de contêiner (isso será feito automaticamente ao chamar nossa função)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Que a chamada para nosso contêiner passando parâmetros seja executada sem erros</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Que o arquivo gerado esteja no formato correto e não contenha nenhum erro</li> </ul> <p>Isso pode ser feito com um fluxo de trabalho muito simples que contém três ações:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> A primeira ação baixa o código-fonte (checkout)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> A segunda, a ação Pandoc, transforma o README.md em um arquivo PDF</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> A terceira ação carrega o arquivo PDF como um artefato</li> </ul> <p><div class=highlight><pre><span></span><code>name: Generate PDF
on:
workflow_dispatch: # manual trigger
push:
# and each commit on the main branch
jobs:
generate:
runs-on: self-hosted
steps:
- uses: actions/checkout@v4
- uses: 60pportunities/github-action-pandoc@main # replace with your action and your branch
with:
args: "--standalone --output-readme.pdf README.md"
- uses: actions/upload-artifact@v4
with:
name: "PDF"
path: readme.pdf
</code></pre></div> A execução deste fluxo de trabalho permite que você gere uma imagem de contêiner na inicialização antes de executar as ações. De fato, o GitHub começa validando todos os pré-requisitos de execução cuja validade das ações antes de executá-las.</p> <p>Finalmente, você notará que entre os artefatos associados ao seu fluxo de trabalho está um arquivo pdf.zip que contém o arquivo readme.pdf que acabamos de gerar. Se você usou o conteúdo do arquivo sample.md, você deve ter um PDF com uma página de rosto, um índice e um layout bonito. Novamente, é o poder do Pandoc.</p> <h2 id=how-to-optimize-docker-actions>How to optimize Docker Actions<a class=headerlink href=#how-to-optimize-docker-actions title="Permanent link">¶</a></h2> <p>A principal lentidão de uma Docker Action é a "compilação" da própria imagem. Em nosso fluxo de trabalho de exemplo, em quase 4 minutos para executar todo o fluxo de trabalho, 3 minutos e 33 segundos são consumidos apenas pela criação desta imagem.</p> <p>Mais problemático, uma imagem de contêiner é recriada com cada execução do fluxo de trabalho, o que significa que tempo é perdido a cada vez (o que também não é favorável ao meio ambiente!). Como a ação em si não muda entre duas execuções, a solução elegante seria gerar a imagem uma vez e reutilizá-la depois.</p> <p>Esta solução é viável com GitHub Actions ao atingir três etapas:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Geração da imagem de contêiner da sua ação</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Publicação da ação no Docker Hub (ou qualquer registro de contêiner)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Edite seu fluxo de trabalho para carregar a ação do Registro do Docker Hub</li> </ul> <p>Se você ainda não tiver uma, precisará criar uma conta no Docker Hub (<a href=https://hub.docker.com/ >https://hub.docker.com/</a>). Isso permitirá que você tenha um registro de contêiner pessoal, ou seja, uma biblioteca onde armazenar suas imagens de contêiner que podem ser baixadas de qualquer lugar. Anote seu login e sua senha porque você precisará deles.</p> <p>No repositório da sua ação, crie um novo fluxo de trabalho de publicação de imagem do Docker. Para o exemplo, escolheremos um gatilho manual para publicar somente quando uma versão estável estiver pronta. Adicionamos dois parâmetros para fornecer no momento do gatilho: o nome da imagem e sua tag (número da versão). A primeira parte do nome da imagem deve incluir seu login do Docker e corresponde ao seu "namespace".</p> <p><div class=highlight><pre><span></span><code>name: Publish Docker Image
on:
workflow_dispatch:
inputs:
version:
description: 'name of the container image'
required: true
image:
description: 'version of the container image'
required: true
default: "60pportunities/github-action-pandoc"
</code></pre></div> Isso tem a consequência de exibir um formulário durante a inicialização do fluxo de trabalho:</p> <p>Então vem a parte dos passos. O primeiro passo baixa o código-fonte e os arquivos que precisaremos (Dockerfile e entrypoint.sh). <div class=highlight><pre><span></span><code>jobs:
publish:
runs-on: self-hosted
steps:
- uses: actions/checkout@v4
</code></pre></div></p> <p>O próximo passo é conectar-se ao Docker Hub. Ao fazer isso, uma chave de conexão (token) é baixada localmente pelo runner e será reutilizada pelos seguintes comandos:</p> <div class=highlight><pre><span></span><code>- name: Docker Hub login
run: echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "$ {{ secrets.DOCKER_USERNAME }}" --password-stdin
</code></pre></div> <p>Depois vem o último passo, responsável por recuperar as variáveis que você insere no workflow iniciado, para construir a imagem docker da nossa ação, marcá-la com um número de versão e, finalmente, publicar a imagem no seu Docker Hub. A imagem então estará disponível e reutilizável:</p> <div class=highlight><pre><span></span><code>- name: Push image to Docker Hub
run:|
VERSION="${{ github.event.inputs.version}}"
IMAGE_NAME="${{ github.event.inputs.image }}"
TAG="$IMAGE_NAME: $VERSION"

docker build --file Dockerfile --tag $IMAGE_NAME --label "org.opencontainers.image.version= $VERSION"
docker tag $IMAGE_NAME $TAG
docker push $TAG
</code></pre></div> <p>O resultado final do fluxo de trabalho é:</p> <p>Recurso: em caso de problemas ou se você não quiser reescrever o fluxo de trabalho completamente, você pode encontrar uma versão pronta para uso no repositório <a href=https://github.com/ >https://github.com/</a> 60pportunities/github-action-pandoc</p> <div class=highlight><pre><span></span><code>name: Publish Docker Image
on:
workflow_dispatch:
inputs:
version:
description: 'version of the container image'
required: true
image:
description: 'name of the container image'
required: true
default: "60pportunities/github-action-pandoc"
jobs:
publish:
runs-on: self-hosted
steps:
uses: actions/checkout@v4
- name: Docker Hub login
run: echo "${{ secrets.DOCKER_PASSWORD}}" | docker login -u "${{ secrets.DOCKER_USERNAME}}" --password-stdin
name: Push image to Docker Hub
run: |
VERSION="${{ github.event.inputs.version}}"
IMAGE_NAME="${{ github.event.inputs.image}}"
TAG="$IMAGE_NAME:$VERSION"
docker build. --file Dockerfile --tag $IMAGE_NAME --label "org.opencontainers.image.version= $VERSION"
docker tag $IMAGE_NAME $TAG
docker push $TAG
</code></pre></div> <p>Quando o fluxo de trabalho é executado com sucesso, o contêiner da sua ação pode ser encontrado no seu namespace no Docker Hub.</p> <p>Agora que a imagem foi gerada, é necessário indicar ao fluxo de trabalho para usá-la em vez de gerar uma do Dockerfile. Isso é feito com uma nova maneira de chamar uma Ação do Docker e o prefixo "docker://":</p> <div class=highlight><pre><span></span><code>- uses: docker://NAMESPACE/NAME_DOCKER_IMAGE:VERSION
with:
args: "--blahblah" # parameters
</code></pre></div> <p>Isso nos permite escrever um fluxo de trabalho substancialmente idêntico ao que havíamos escrito anteriormente:</p> <div class=highlight><pre><span></span><code>name: Generate PDF - optimized version
on:
workflow_dispatch:
jobs:
generate:
runs-on: self-hosted
steps:
- uses: actions/checkout@v4
- uses: docker://60pportunities/github-action-pandoc:1.0.1
with:
args: "--standalone --output-readme.html README.md"
- uses: actions/upload-artifact@v4
with:
name: "Artifact"
path: readme.html
</code></pre></div> <p>Mas cujo tempo de execução será significativamente menor:</p> <p>Tempo de execução reduzido</p> <p>Concluindo, criar uma Docker Action nos permitiu ir de um fluxo de trabalho "JavaScript" que levava 2 min 30 para um fluxo de trabalho usando Docker, que levava 3 min 30 antes de otimizá-lo para atingir um tempo de execução de 20 segundos. Em larga escala ou simplesmente dentro de uma equipe de desenvolvimento, ganhar velocidade em cada execução do fluxo de trabalho é uma prioridade para a eficiência geral e faz parte da mentalidade DevOps.</p> <p>No entanto, lembre-se de que uma parte do tempo de execução do fluxo de trabalho vem do download da imagem do Docker. Portanto, deve-se manter seu tamanho o menor possível, o que pode ser feito usando imagens minimalistas básicas (Alpine e outras versões chamadas distroless) e por meio do procedimento "multiestágio" dentro dos arquivos Dockerfile. Esta parte, embora não seja complexa, não é abordada neste livro; no entanto, você encontrará facilmente informações sobre ela na Internet.</p> <h2 id=create-composite-actions>Create composite Actions<a class=headerlink href=#create-composite-actions title="Permanent link">¶</a></h2> <p>Depois de abordar ações JavaScript e sua alternativa Docker, vamos abordar ações compostas (etapas de execução compostas na documentação). Ação composta é uma ação composta de outras ações. Ela simplifica fluxos de trabalho (legibilidade) e facilita a reutilização quando uma ação de grupo é repetida várias vezes em vários fluxos de trabalho. Essas ações compostas são "partes" de fluxo de trabalho que serão injetadas em seus fluxos de trabalho de chamada.</p> <p>Ação composta não é muito diferente de ação JavaScript ou Docker. Ela tem o manifesto action.yaml contendo os mesmos campos com uma exceção para o campo runs. Este contém o valor "using: composite" bem como uma propriedade "steps", que conterá as diferentes etapas no mesmo formato de um fluxo de trabalho "padrão":</p> <div class=highlight><pre><span></span><code>runs:
using: "composite" # Specific mode that means that this module is a composite action
steps:
- run: echo "I'm the first step"
name: step1
- run: echo "I'm the second step"
name: step2
</code></pre></div> <p>Nada realmente complexo. Especialmente porque no fluxo de trabalho pai, chamar uma ação composta é feito da mesma forma que para qualquer ação padrão:</p> <div class=highlight><pre><span></span><code>jobs:
test:
runs-on: self-hosted
steps:
- uses: actions/checkout@v4
- uses: 60pportunities/mon-action-composite@v1
</code></pre></div> <p>Vamos colocar isso em prática criando juntos uma ação composta verdadeira. Nosso exemplo é uma ação que escaneia o código-fonte para verificar se as senhas foram codificadas no código-fonte, o que seria uma prática ruim e mereceria bloquear uma compilação/lançamento.</p> <p>Crie um novo repositório chamado "github-action-composite- credscanning" e crie lá um arquivo manifesto action.yaml. Comece adicionando os metadados padrão:</p> <div class=highlight><pre><span></span><code>name: 'Credentials scanning'
description: 'Scan source code to find if credentials have been hardcoded'
branding:
icon: 'lock' # The name of one of the available icons
color: 'orange' # The background color of your icon
</code></pre></div> <p>Nota: O código-fonte completo desta ação de exemplo está no repositório público: <a href=https://github.com/60pportunities/github-action-composite-credscanning>https://github.com/60pportunities/github-action-composite-credscanning</a></p> <p>Em seguida, adicione um parâmetro de entrada folderToScan que especifica a pasta (e subpastas) que você deseja que o scanner. Útil quando não queremos escanear o repositório completo.</p> <div class=highlight><pre><span></span><code>inputs:
folderToScan: #path
description: 'The folder where to scan files'
required: true
default: '/src'
</code></pre></div> <p>Então adicione o primeiro passo. Graças ao seu comando Bash particular, ele faz uma busca recursiva que permite que você encontre todos os arquivos contendo a palavra "password" e salva a lista de arquivos "em risco" em um arquivo chamado result.txt. Note que seu diretório de trabalho é especificado por meio da propriedade working- directory, que recupera o valor do parâmetro de entrada. Assim, seremos capazes de ter uma ação composta cujo caminho será dinâmico de um fluxo de trabalho para outro:</p> <p><div class=highlight><pre><span></span><code>runs:
using: "composite"
steps:
- run: grep "password" . -R &gt; ../result.txt
shell: bash
working-directory: ${{ inputs.folderToScan }} # Retrieves the input parameter
</code></pre></div> Adicione uma segunda etapa que conta o número de arquivos encontrados contando o número de linhas que foram escritas no arquivo result.txt. Para isso, você pode usar o comando "wc" (significa "contagem de palavras") e passar o parâmetro "-1" para pedir que ele conte as linhas.</p> <div class=highlight><pre><span></span><code>- shell: bash
run: COUNT=$(wc -1 &lt; result.txt) # counts and puts the result in the variable COUNT
</code></pre></div> <p>Exporte essa variável como saída em seu passo para então ser transmitida ao pai do fluxo de trabalho. Para isso, é necessário dar um ID exclusivo ao seu passo.</p> <div class=highlight><pre><span></span><code>-id: count-files # unique ID of your step
shell: bash
run: |
      COUNT=$(wc-1 &lt; result.txt)
      echo "filesCount=$(echo $COUNT)" &gt;&gt; $GITHUB_OUTPUT # export of our variable
</code></pre></div> <p>Por fim, resta apenas recuperar a saída desta etapa e transformá-la em uma saída de ação. Assim, o valor da variável é acessível pelo fluxo de trabalho pai. Isso acontece declarando um bloco de saída compreendendo uma variável de saída "scanned-files", que será mapeada para o valor de saída da etapa de contagem "count-files".</p> <div class=highlight><pre><span></span><code>outputs:
scanned-files: # name of the output variable
description: "Number of files scanned"
value: ${{ steps.count-files.outputs.filesCount}}
</code></pre></div> <p>O resultado completo do arquivo YAML deve ficar assim:</p> <div class=highlight><pre><span></span><code>name: 'Credentials scanning'
description: 'Scan source code to find if credentials have been hardcoded'
inputs:
folderToScan:
description: 'The folder where to scan files'
required: true
default: '/src'
outputs:
scanned-files:
description: "Number of files scanned"
value: ${{ steps.count-files.outputs.filesCount}}
runs:
using: "composite"
steps:
· run: grep "password" . -R &gt; ../result.txt
shell: bash
working-directory: ${{inputs.folderToScan }}
-id: count-files
 run: |
      COUNT=$(wc -l &lt; result.txt)
      echo "File count: $COUNT "&gt;&gt; $GITHUB_OUTPUT
      shell: bash
</code></pre></div> <p>Qualquer ação deve sempre ter seu próprio fluxo de trabalho de teste para garantir que esteja totalmente funcional, integrando-a de alguma forma. Por exemplo, crie um fluxo de trabalho de gatilho manual no repositório da sua ação e proponha um parâmetro de entrada "pasta" para personalizar a pasta escaneada. <div class=highlight><pre><span></span><code>name: Test composite action
on:
workflow_dispatch:
inputs:
folder:
required: true
jobs:
test:
runs-on: self-hosted
steps:
- uses: actions/checkout@v4
 [...] our steps
</code></pre></div></p> <p>Em seguida, basta chamar sua ação composta transmitindo o parâmetro de entrada do fluxo de trabalho (pasta) por meio do parâmetro de entrada da ação (folderToScan):</p> <div class=highlight><pre><span></span><code>-id: myCompositeAction
uses: 60pportunities/github-action-composite-credscanning@main
default: "src"
with:
folderToScan: "${{ github.event.inputs.folder }}" # Using the input parameter
</code></pre></div> <p>Em seguida, adicione uma etapa que recupere a variável de saída da ação e gere uma mensagem de erro do GitHub se senhas codificadas forem encontradas.</p> <div class=highlight><pre><span></span><code>- run: |
if [ ${{ env.COUNT }}&gt; 0]
then
echo "::error::Some files contain hardcoded passwords"
exit 1
fi
env:
COUNT: ${{ steps.myCompositeAction.outputs.scanned-files }}
</code></pre></div> <p>Idealmente, deveríamos colocar o gerenciamento da exceção e sua configuração dentro da ação composta para esconder a lógica de negócios e simplificar seu uso. Primeiro, no entanto, é interessante entender como retornar variáveis internas ao fluxo de trabalho pai para pedagogia.</p> <p>Limitações Ações compostas, infelizmente, ainda têm muitas limitações. Se algumas podem desaparecer em breve, elas ainda estão presentes (verão de 2021) e podem ser suficientemente impactantes em muitos casos para tornar essas ações inutilizáveis. A primeira limitação importante foi a impossibilidade de usar a palavra-chave "uses" nessas ações e chamar uma ação de terceiros. Felizmente, esse recurso está disponível desde agosto de 2021 e fornece uma unidade maior de reutilização, como:</p> <div class=highlight><pre><span></span><code>runs:
using: "composite"
steps:
- uses: docker/setup-buildx-action@v3
- uses: docker/login-action@v3
with:
username: ${{inputs.registry_username}}
password: ${{inputs.registry_password}}
- uses: docker/build-push-action@v5
with:
context: .
push: true
tags: user/app:latest
</code></pre></div> <p>Outros recursos estão, no momento, indisponíveis ao usar Ações compostas:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Não é possível usar dependências (palavra-chave "needs")</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Recursos de tempo limite não funcionam (timeout-minutes)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Falha silenciosa de uma etapa (continue-on-error)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Acesso a segredos. Eles devem ser recuperados pelo fluxo de trabalho pai e passados para a Ação como parâmetros</li> </ul> <p>Esses recursos estão atualmente em desenvolvimento pelas equipes do GitHub, e esses limites podem desaparecer em um futuro próximo. Minhas fontes internas no GitHub me dizem que o uso da palavra-chave uses deve estar disponível por volta de agosto de 2021.</p> <h2 id=github-script>GitHub Script<a class=headerlink href=#github-script title="Permanent link">¶</a></h2> <p>Vimos que é possível criar vários tipos de ações do github, algumas das quais são desenvolvidas usando JavaScript e que podem tirar proveito do framework octokit.js (<a href=https://octokit.github.io/rest.js>https://octokit.github.io/rest.js</a>). Este framework permite que você faça quase tudo no GitHub usando um cliente REST que pode chamar as diferentes APIs. Qualquer ação na sua conta do Github (repositórios, branches, segurança, etc.) que você queira fazer pode ser feita facilmente por meio deste framework.</p> <p>GitHub Script <a href=https://github.com/actions/github-script>https://github.com/actions/github-script</a> é uma Action que permite que você acesse a API do GitHub a partir de qualquer fluxo de trabalho e permite, entre outras coisas, chamar todos os métodos disponíveis no octokit sem precisar criar uma ação personalizada do github. O exemplo a seguir mostra como criar facilmente um Issue :</p> <div class=highlight><pre><span></span><code>- uses: actions/github-script@v7
with:
github-token: ${{secrets.GITHUB_TOKEN}}
script:
github.rest.issues.create({
owner: context.repo.owner,
repo: context.repo.repo,
title: "You've created this issue using GitHub Script!!!"
})
</code></pre></div> <p>Isso também permite que você crie cenários avançados, como enviar uma mensagem para qualquer colaborador iniciante:</p> <div class=highlight><pre><span></span><code>on: pull_request_target
jobs:
welcome:
runs-on: self-hosted
steps:
- uses: actions/github-script@v7
with:
script: |
// We get all issues created by the user
// because issues and PR are mixed up together in events
const creator = context.payload.sender.login
const opts = github.rest.issues.listForRepo.endpoint.merge({
...context.issue,
creator,
state: 'all'
})
const issues = await github.paginate(opts)
for (const issue of issues) {
if (issue.number === context.issue.number) {
continue
}
if (issue.pull_request) {
return // person already contributed, we stop here
}
}

await github.rest.issues.createComment({
issue_number: context.issue.number,
owner: context.repo.owner,
repo: context.repo.repo,
body: ***Welcome**, new contributor!

Certifique-se de ler nosso [guia de contribuição](CONTRIBUTING.md) e estamos ansiosos para analisar sua solicitação de Pull em breve.})
</code></pre></div> <h2 id=interact-on-other-repositories>Interact on other repositories<a class=headerlink href=#interact-on-other-repositories title="Permanent link">¶</a></h2> <p>O GitHub Script é uma ação que fornece um cliente octokit autenticado. Ele recupera automaticamente o contexto do fluxo de trabalho atual e o usa para executar suas ações. Por padrão, quando um fluxo de trabalho é acionado, ele preenche uma variável (GITHUB_TOKEN) com direitos de acesso no repositório atual, e a ação do GitHub Script carrega essa variável implicitamente. No entanto, pode acontecer de você querer interagir em um repositório de terceiros ou alterar algo na configuração da sua conta/organização. Para isso, é necessário fornecer um token de autenticação com direitos de acesso suficientes.</p> <p>Informações: A criação de um token PAT é feita no portal GitHub, clicando no seu perfil, depois em Configurações, Configurações do desenvolvedor e, finalmente, Tokens de acesso pessoal.</p> <p>No exemplo a seguir, criamos um token que colocamos em um segredo e o passamos para a ação por meio da propriedade github-token. Este token tem um escopo maior do que o repositório atual e, portanto, torna possível interagir nos elementos de uma conta de usuário ou de uma organização. No caso a seguir, simplesmente listamos os repositórios existentes, mas também podemos completar o código para configurar esses repositórios com proteções de ramificação ou gerenciar usuários.</p> <div class=highlight><pre><span></span><code>- uses: actions/github-script@v7
id: get-repos
with:
github-token: ${{secrets.MY_GITHUB_TOKEN}}
script:|
return github.rest.repos.listForUser({
username: "60pportunities"
});
</code></pre></div> <p>Então, mesmo que não seja uma Ação que você mesmo cria, pareceu essencial apresentá-la para que você possa usá-la para enriquecer seus fluxos de trabalho.</p> <p>Agora, vamos dar uma olhada em como melhorar suas Ações.</p> <h2 id=improve-the-user-experience-of-your-actions>Improve the user experience of your actions<a class=headerlink href=#improve-the-user-experience-of-your-actions title="Permanent link">¶</a></h2> <p>Ao criar uma ação para seu uso pessoal ou compartilhá-la com o maior público, é importante tornar a experiência do usuário a mais simples e agradável possível. Portanto, o uso de sua Ação pode ter uma boa experiência do usuário se você seguir regras básicas. Aqui estão algumas:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Qualquer ação deve ter um README claro e completo, idealmente escrito em inglês</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Forneça exemplos de como usar sua ação (trechos YAML)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Considere também fornecer fluxos de trabalho de amostra abrangentes. Um trecho de código às vezes omite mostrar o que acontece antes e depois</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Simplifique seu uso com parâmetros explícitos e de nome curto, mas também com valores padrão</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Se você criar uma ação docker, mesmo que ofereça uma imagem de contêiner pronta para o usuário, forneça o arquivo Dockerfile para permitir que as pessoas vejam o que ele contém e para permitir que reconstruam a imagem do seu lado</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Considere, dependendo da complexidade da sua ação, fornecer um modo DEBUG/VERBOSE para exibir mais detalhes se ocorrerem problemas de configuração</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Se sua ação gerar arquivos, exponha um parâmetro para permitir que o usuário especifique o nome e o caminho do arquivo gerado</li> </ul> <p>Existem outras boas práticas, que exigem algum esforço, mas cujo valor agregado, por menor que seja, melhora muito o uso da sua ação.</p> <h2 id=improving-logs>Improving logs<a class=headerlink href=#improving-logs title="Permanent link">¶</a></h2> <p>Os logs da sua ação são a principal maneira de um usuário verificar se o comportamento esperado ocorreu bem e o melhor lugar para obter informações sobre as várias atividades realizadas. Os logs da sua ação aparecem nos logs de execução do fluxo de trabalho no portal do GitHub e são mais ou menos legíveis.</p> <p>No entanto, há muitas maneiras de melhorar a legibilidade. A primeira maneira é usar os métodos dedicados para mensagens de aviso e erro, respectivamente: error() e warning().</p> <div class=highlight><pre><span></span><code>core.warning('my warning message');
core.error('my error message');
</code></pre></div> <p>Também pode ser usado sem o kit de ferramentas:</p> <div class=highlight><pre><span></span><code>echo '::error::my error message'
echo '::warning::my warning message'
</code></pre></div> <p>Além de serem enfatizadas dentro dos logs, as mensagens digitadas como "aviso" ou "erro" também são exibidas na tela de resumo do fluxo de trabalho.</p> <p>Isso permite que você destaque mensagens importantes no meio de centenas de linhas de logs que um fluxo de trabalho pode produzir.</p> <h2 id=annotations>Annotations<a class=headerlink href=#annotations title="Permanent link">¶</a></h2> <p>Essa coloração também pode ser realizada manualmente, seja para a cor do texto, cor de fundo ou estilo do texto (negrito, itálico, sublinhado). Então, prefixe o texto a ser exibido com um código de escape, com base nos códigos ANSI (<a href=https://en.wikipedia.org/wiki/ANSI_escape_code>https://en.wikipedia.org/wiki/ANSI_escape_code</a>), que torna possível controlar totalmente o layout do texto que o segue:</p> <p><div class=highlight><pre><span></span><code>core.info("\u001b[38;5;6mText in blue')
core.info("\u001b[48;2;255;0;0mOr a blue background')
core.info("\u001b[1mOr just bold text')
</code></pre></div> Posso brincar com cores</p> <p>Também é possível injetar ícones nos logs para tornar uma mensagem mais visual.</p> <p>Também posso incorporar ícones se quiser 13 qualquer tipo de ícone</p> <p>Inclusão de ícones</p> <p>A lista de ícones possíveis é baseada na lista de emojis suportados pelo portal GitHub. A lista inclui várias centenas deles, o suficiente para atender a cada uso. A lista completa de códigos de ícones e a imagem associada a cada um deles está na seguinte página: <a href=https://github.com/ikatyang/emoji-cheat-sheet>https://github.com/ikatyang/emoji-cheat-sheet</a>.</p> <p>Por fim, saiba que também é possível agrupar logs em blocos dobráveis usando os métodos startGroup() e endGroup(), conforme mostrado no exemplo a seguir:</p> <div class=highlight><pre><span></span><code>core.startGroup('A group of logs')
core.info('my first log')
core.info('my second log')
core.info('my third log')
core.endGroup()
</code></pre></div> <h2 id=customizando-sumario-job>Customizando Sumário Job<a class=headerlink href=#customizando-sumario-job title="Permanent link">¶</a></h2> <p>Assim como as anotações que já discutimos, que permitem enfatizar alguns avisos ou mensagens de erro, é possível adicionar informações na página de resumo da execução de um fluxo de trabalho. Pode ser um link, detalhes, um status da implantação ou qualquer coisa que você queira fornecer ao usuário final.</p> <p>Para gerar um resumo do Job, você só precisa anexar conteúdo markdown na variável $GITHUB_STEP_SUMMARY e esse conteúdo será formatado e adicionado ao portal GitHub automaticamente.</p> <p><code>echo "{markdown content}" &gt;&gt; $GITHUB_STEP_SUMMARY</code></p> <p>Os recursos são tão infinitos quanto o markdown permite, como layout, lista, tabelas, ícones, mas também esquemas (usando o formato Mermaid <a href=https://mermaid-js.github.io/mermaid>https://mermaid-js.github.io/mermaid</a>).</p> <div class=highlight><pre><span></span><code>- run: |
echo "# This is a title"                               &gt;&gt; $GITHUB_STEP_SUMMARY
echo ""                                                &gt;&gt; $GITHUB_STEP_SUMMARY # this is a blank line build summary
echo "- My first element"                              &gt;&gt; $GITHUB_STEP_SUMMARY
echo "- My second one"                                 &gt;&gt; $GITHUB_STEP_SUMMARY
echo " How about a third one with an icon :thumbsup:?" &gt;&gt; $GITHUB_STEP_SUMMARY
</code></pre></div> <h2 id=job-summary>Job Summary<a class=headerlink href=#job-summary title="Permanent link">¶</a></h2> <p>Observe que, dentro das Ações personalizadas do GitHub, você pode carregar o SDK (pacote NPM <a class="magiclink magiclink-github magiclink-repository" href=https://github.com/action/core title="GitHub Repository: action/core">action/core</a>) para formatar facilmente o Resumo do Trabalho, como:</p> <div class=highlight><pre><span></span><code>import * as core from '@actions/core'
await core.summary
.addHeading('Test Results')
.addTable([
[{data: 'Test', header: true}, {data: 'Result', header: true}],
['Test n°1', 'Pass'],
['Test n°2', 'Fail'],
['Test n°3', 'Pass']
.addLink('View deployed application!', 'https://my-link.com')
.write()
</code></pre></div> <h2 id=set-up-a-debug-mode>Set up a DEBUG mode<a class=headerlink href=#set-up-a-debug-mode title="Permanent link">¶</a></h2> <p>Como você verá mais adiante neste livro durante o capítulo sobre depuração, o GitHub oferece a possibilidade de ativar o "Debug Mode", um tipo de variável global que diz a um fluxo de trabalho para ser mais verboso. Este capítulo explicará diferentes técnicas de depuração, mas para a que nos interessa agora, é suficiente que você crie um segredo chamado ACTIONS_STEP_DEBUG com o valor "true" no repositório onde o fluxo de trabalho é executado (e não o da sua Action!). Naturalmente, isso tem o efeito de tornar o agente mais verboso sobre as tarefas que ele realiza.</p> <h3 id=activation-du-mode-debug>Activation du mode DEBUG<a class=headerlink href=#activation-du-mode-debug title="Permanent link">¶</a></h3> <p>Estando ciente desse modo, sua ação pode então tirar vantagem dele para exibir informações adicionais ao usuário. A maneira mais fácil é usar o GitHub Actions Toolkit (<a href=https://github.com/actions/toolkit>https://github.com/actions/toolkit</a>) e, em particular, seu módulo core que fornece métodos para exibir uma mensagem no console somente se o usuário tiver ativado o modo DEBUG.</p> <p><div class=highlight><pre><span></span><code>#Loading the module
const core = require('@actions/core');
#Displaying a message
core.debug('This is my DEBUG message');
</code></pre></div> Caso você não consiga usar o kit de ferramentas de ação JavaScript, há um método alternativo com a seguinte formatação para escrever uma mensagem no console que funciona com todas as tecnologias:</p> <p><code>echo "::debug::This is my DEBUG message"</code></p> <p>O Toolkit também fornece uma função (isDebug()) que permite que você execute o processamento somente se o modo Debug estiver habilitado. Útil para iniciar diferentes comandos ou executar ações em arquivos, por exemplo. Conforme mostrado no exemplo a seguir:</p> <p><div class=highlight><pre><span></span><code>if (!core.isDebug()) // Normal mode &gt; Note the "!" meaning NOT
{
//curl https://github.com
// Deletes temporary files
}
else // Mode Debug
{
  //curl -v https://github.com
// does not delete temporary files for analysis
}
</code></pre></div> Cada uma dessas boas práticas é importante porque, com esses pequenos detalhes, sua ação será adotada por um número maior de pessoas.</p> <h2 id=using-pre-and-post-scripts>Using Pre and Post Scripts<a class=headerlink href=#using-pre-and-post-scripts title="Permanent link">¶</a></h2> <p>A ação torna possível executar um conjunto de comandos quando o agente a inicia, mas infelizmente é impossível para ela controlar sua posição dentro do fluxo de trabalho; pode estar no início, no meio ou no final, de acordo com o autor do fluxo de trabalho. Às vezes, no entanto, podemos precisar que nosso processamento de trabalho seja feito em várias etapas, potencialmente no início do fluxo de trabalho para executar tarefas de inicialização ou às vezes no final do fluxo de trabalho para executar um script de limpeza. Criar uma ação padrão não dá liberdade para fazer isso fora da própria ação: a limpeza será feita após o código principal terminar, mas antes que a próxima ação seja chamada. Não é o que queremos. Depois de todas as outras ações que desconhecemos, como executar um script no final do fluxo de trabalho?</p> <p>O GitHub Actions fornece um recurso específico para essa necessidade usando palavras-chave pre e post, que devem ser definidas no manifesto action.yaml da nossa ação. Como a palavra-chave main que especifica o script principal, essas palavras-chave especificam um script para executar no início do fluxo de trabalho e outro no final dele. O exemplo a seguir declara um script (pre.js) acionado antes de qualquer outra ação e outro script (post.js) acionado no final do fluxo de trabalho.</p> <div class=highlight><pre><span></span><code>runs:
using: 'node20'
main: 'index.js'
pre: 'pre.js'
post: 'post.js'
</code></pre></div> <p>A ação é então carregada três vezes no fluxo de trabalho e executada a cada vez apenas o script correspondente à etapa do fluxo de trabalho:</p> <h2 id=conditionality>Conditionality<a class=headerlink href=#conditionality title="Permanent link">¶</a></h2> <p>Durante suas experiências, você descobrirá que é costume compactar os diferentes arquivos JavaScript de um único arquivo para facilitar o gerenciamento e reduzir o tamanho do código-fonte (as pessoas geralmente usam o módulo CNN do npmJS para fazer isso). Você encontrará ações que chamam o mesmo arquivo que o script principal, pre ou post. Por exemplo, se você olhar o código-fonte da ação CHECKOUT (muito informativo: <a href=https://github.com/actions/checkout/ >https://github.com/actions/checkout/</a>), você descobrirá que é um uso duplo do mesmo arquivo index.js:</p> <div class=highlight><pre><span></span><code>runs:
using: node20
main: dist/index.js
post: dist/index.js
</code></pre></div> <p>Como explicar que o script não executa a mesma coisa que é chamada como script principal ou pós-script? O script simplesmente tem uma lógica interna que o faz executar um código diferente dependendo do momento no fluxo de trabalho. Isso é feito com a variável de ambiente STATE_isPost. Por exemplo, o código JavaScript poderia ser assim:</p> <div class=highlight><pre><span></span><code>const isPost = Boolean(process.env['STATE_isPost'])
if (isPost)
{
  myPostCode();
}
else
{
  myStandardCode();
}
</code></pre></div> <p>Existe uma alternativa se você tiver scripts separados e não quiser colocar uma lógica de negócios dentro do script. Por exemplo, você quer ter um script de inicialização que seja acionado somente no Windows. Em vez de colocar esse controle da versão do Windows dentro do script que será iniciado e potencialmente não fará nada depois, é possível pedir ao agente para fazer esse teste para você usando a propriedade pre-if.</p> <div class=highlight><pre><span></span><code>pre: 'pre-script.js'
pre-if: runner.os == 'windows'
</code></pre></div> <p>Existe a propriedade post-if que funciona da mesma forma. Ela também pode ser baseada no resultado da execução do script principal. Assim, no caso a seguir, o script post.js só será executado se o script principal tiver sucesso sem error:</p> <p><div class=highlight><pre><span></span><code>post: 'post.js'
post-if: 'failure()'
</code></pre></div> Docker: Existe uma mecânica idêntica para ações do Docker, mas ela usa propriedades como pre-entrypoint e post-entrypoint. Com essas poucas opções adicionais, agora você pode criar uma ação que controla perfeitamente seu fluxo de trabalho. Quando este capítulo for assimilado, vire a página para começar a próxima seção que aborda conceitos ainda mais avançados do GitHub Actions.</p> <h2 id=conceitos-avancados>Conceitos avançados<a class=headerlink href=#conceitos-avancados title="Permanent link">¶</a></h2> <p>Esta terceira seção do livro lida com conceitos avançados. Esses conceitos não são necessariamente complexos, mas vêm como um segundo passo na jornada de aprendizado e uso da plataforma.</p> <h3 id=artifact-management>Artifact management<a class=headerlink href=#artifact-management title="Permanent link">¶</a></h3> <p>Os fluxos de trabalho podem executar qualquer tipo de tarefa e, para muitos deles, durante sua execução, gerarão elementos: binários, ativos de aplicativos da Web, arquivos compactados, resultados de testes ou logs. Esses elementos gerados, comumente chamados de artefatos, são criados nas máquinas virtuais usadas para executar o fluxo de trabalho e são perdidos permanentemente no final do fluxo de trabalho quando o GitHub reinicializa automaticamente a máquina virtual.</p> <p>Às vezes, é necessário manter esses artefatos, seja para necessidades de arquivamento ou simplesmente porque o objetivo principal do fluxo de trabalho é gerar um elemento que deve ser recuperado e preservado. Além disso, é claro, é possível pedir ao fluxo de trabalho para copiá-los por meio de ações em serviços de terceiros (hosts da web, servidor FTP, etc.). Ainda assim, o GitHub oferece um serviço de arquivamento diretamente integrado ao seu portal da web.</p> <h3 id=artifacts-vs-packages>Artifacts vs. Packages<a class=headerlink href=#artifacts-vs-packages title="Permanent link">¶</a></h3> <p>Os elementos gerados podem ser armazenados em duas categorias, dependendo do uso que será feito deles.</p> <p>A primeira categoria está relacionada aos elementos técnicos. É aceito que todos os elementos gerados por um fluxo de trabalho se enquadrem nessa categoria (arquivo zip, binários, logs, imagem de contêiner, etc.). Combinar esses elementos para executar um fluxo de trabalho e disponibilizar seu download sob demanda é possível. É nessa categoria que o GitHub nomeia os Artefatos.</p> <p>A segunda categoria contém os elementos técnicos reutilizáveis por outros fluxos de trabalho/projetos: pacotes ou bibliotecas que são baixados automaticamente por alguns projetos que os referenciam. Esses elementos específicos, que devem ser baixáveis por outros fluxos de trabalho, serão salvos em outro serviço do GitHub: Pacotes do GitHub. Isso é o equivalente a outros produtos com os quais você pode estar familiarizado, como Nexus, Artifactory ou Azure DevOps Artifacts. Os seguintes formatos são suportados:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Pacotes NuGet, usados por projetos .NET</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Maven para projetos Java</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> NPM para projetos JavaScript</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Gradle para projetos Java</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> RubyGems para projetos Ruby</li> </ul> <p>E mais do que isso, o GitHub Packages oferece um registro de contêiner docker.</p> <p>Assim, dependendo do tipo de item gerado e seu uso, você pode usar o GitHub Artifacts ou o GitHub Packages.</p> <h3 id=publication-of-an-artifact>Publication of an artifact<a class=headerlink href=#publication-of-an-artifact title="Permanent link">¶</a></h3> <p>A publicação de um artefato é extremamente simples e consiste em usar a ação actions/upload-artifact. Esta requer apenas dois parâmetros: - [x] path: o(s) arquivo(s) ou pasta(s) a serem incluídos no arquivo zip gerado - [x] name: o nome do arquivo Zip gerado</p> <div class=highlight><pre><span></span><code>- name: Archiving the binaries of the application
uses: actions/upload-artifact@v4
with:
path: myapplication.exe # Take and zip a particular file
name: Release           # And upload it as Release.zip
- name: Archiving the technical logs
uses: actions/upload-artifact@v4
with:
path: logs # Take all files in the logs folder
name: logs # Upload them as logs.zip
</code></pre></div> <p>Após executar o fluxo de trabalho na tela de resultados, são listados todos os artefatos gerados. Eles podem ser facilmente baixados.</p> <h3 id=retention>Retention<a class=headerlink href=#retention title="Permanent link">¶</a></h3> <p>No entanto, esses artefatos não podem ser considerados um arquivo confiável. Primeiro, os arquivos associados são destruídos porque o histórico do fluxo de trabalho pode ser excluído manualmente (ou por engano). Mas, acima de tudo, esses elementos têm um tempo máximo de retenção, após o qual o GitHub os remove automaticamente. Essa duração é configurável nas configurações do repositório do GitHub:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> 90 dias máximos de retenção para repositórios públicos.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> 400 dias máximos de retenção para repositórios privados.</li> </ul> <p>Essa é a duração máxima padrão aplicada a cada artefato. Também é possível personalizar essa duração de retenção (menor que o limite padrão) para um determinado elemento, especialmente onde os artefatos são significativamente maiores. Como lembrete, a cota de armazenamento gratuito no GitHub é de apenas 500 MB para uma conta gratuita do GitHub. Portanto, para liberar algum espaço limitando o tempo de retenção de um artefato específico, é necessário usar a propriedade retention-delay:</p> <p><div class=highlight><pre><span></span><code>- uses: actions/upload-artifact@v4
with:
name: my-artifact
path: /output
retention-days: 5 # days of retention
</code></pre></div> Dica: Se você atingir o tamanho máximo de armazenamento da sua conta, o upload de um novo artefato falhará. É possível abrir os resultados de fluxos de trabalho antigos e remover os artefatos manualmente e um por um. Há também uma Ação para excluí-los todos de uma vez: kolpav/purge-artifacts-action. Por fim, observe que, uma vez que a remoção é feita, o GitHub pode levar uma ou duas horas antes de considerar o espaço e permitir que você faça o upload novamente.</p> <p>Se sua necessidade é manter esses itens indefinidamente, várias possibilidades estão disponíveis para você: - [x] Para baixá-los manualmente e armazená-los no seu disco rígido - [x] Adicione ao seu fluxo de trabalho a capacidade de salvá-los em um serviço de hospedagem de terceiros (servidor FTP, armazenamento de blobs, etc.) - [x] Adicione-os a uma versão do seu projeto</p> <p>Essa noção de arquivo de versão (ativo) é abordada um pouco mais adiante neste capítulo.</p> <h3 id=downloading-an-artifact>Downloading an artifact<a class=headerlink href=#downloading-an-artifact title="Permanent link">¶</a></h3> <p>O download de um artefato também é possível (com a ação actions/ download-artifact), mas apenas para os artefatos que a execução do fluxo de trabalho em andamento publicou. Eles respondem a um caso de uso único: transferir dados de um trabalho para outro dentro do mesmo fluxo de trabalho, conforme explicado nos primeiros capítulos deste livro, os trabalhos são executados em máquinas diferentes. Vamos supor que você queira compilar um aplicativo no primeiro trabalho; o segundo trabalho não pode acessar os binários gerados porque eles não estão no mesmo disco. A única alternativa, editar o primeiro trabalho para carregar um artefato chamado e pedir ao segundo para baixar esse artefato.</p> <p><div class=highlight><pre><span></span><code>job1:
steps:
- name: Archiving the binaries of the application
uses: actions/upload-artifact@v4
with:
path: /bin # takes the bin folder and zip it
name: Release # uploads it as that release.zip
job2:
runs-on: self-hosted
needs: job1 # in order for job2 to only start after job1
steps:
- name: Downloading the artifact
uses: actions/download-artifact@v4
with:
name: Release
#performs actions using the artifact
</code></pre></div> Às vezes, você cria um fluxo de trabalho usando as matrizes para construir várias versões do mesmo aplicativo, gerando assim vários artefatos. Você pode baixar todos os artefatos simplesmente omitindo a propriedade "name":</p> <div class=highlight><pre><span></span><code>- name: Download all artifacts
  uses: actions/download-artifact@v4
</code></pre></div> <h3 id=publication-of-a-release-element>Publication of a release element<a class=headerlink href=#publication-of-a-release-element title="Permanent link">¶</a></h3> <p>Se as execuções de fluxos de trabalho não forem retidas para sempre, não será o caso para lançamentos (versões estáveis do projeto). Em vez disso, você deve usar o mesmo procedimento de lançamento que discutimos para publicar uma Ação no Marketplace. Um lançamento de uma Ação requer apenas uma tag para congelar uma versão do código-fonte, mas no nosso caso, aproveitaremos a capacidade de adicionar arquivos ao lançamento para que eles sejam retidos indefinidamente (desde que o lançamento não seja excluído manualmente).</p> <p>Há duas maneiras de anexar arquivos a um lançamento: - [x] Adicionar manualmente arquivos (chamados de ativos) a um lançamento existente usando o Portal da Web do GitHub - [x] Criar um lançamento por meio do fluxo de trabalho e adicionar a ele os arquivos desejados</p> <p>Para adicionar arquivos a um lançamento existente, potencialmente arquivos que você carregou anteriormente como artefatos e baixou, clique em qualquer lançamento do seu repositório e clique no botão editar. Uma tela permite que você altere as propriedades do lançamento e arraste e solte arquivos na parte inferior desta tela.</p> <p>Adição manual de arquivos de release</p> <p>O segundo método, mais simples porque totalmente automatizado, simplesmente substitui a ação de upload de um artefato por uma ação de upload dos arquivos em um novo release. Novamente, a comunidade recomenda usar a ação softprops/action-gh-release que é fácil de usar e completa.</p> <p>Aviso: Há uma ação oficial do GitHub para gerenciar releases e seus ativos (actions/upload-release-asset), mas o GitHub interrompeu seu suporte e manutenção. Prefira; portanto, é uma alternativa.</p> <p>Quando essa ação é colocada em um fluxo de trabalho, ela criará automaticamente um release com base na tag do fluxo de trabalho. Além disso, permite usar a propriedade with.files para listar os arquivos que serão adicionados ao release.</p> <div class=highlight><pre><span></span><code>- name: Create a release
uses: softprops/action-gh-release@v2
env:
GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
with:
files: | # List of files to attach to the release
CHANGELOG.txt
MyApplication.windows.x86.msi
MyApplication.windows.x64.msi
MyApplication.linux.tar.gz
</code></pre></div> <p>Quando o fluxo de trabalho é executado com sucesso, uma nova versão aparece no seu repositório, incluindo seus arquivos anexados e o código-fonte que o GitHub anexa automaticamente.</p> <p>Adição automática de arquivos de versão O uso de versões tem muitas vantagens. Além do armazenamento de longo prazo, ele serve principalmente para fornecer aos usuários de seus projetos acesso rápido a binários ou informações de que precisam. Não há necessidade de bifurcar um repositório e gerenciar a compilação você mesmo; você fornece binários prontos para uso para as pessoas.</p> <h3 id=publish-a-package>Publish a package<a class=headerlink href=#publish-a-package title="Permanent link">¶</a></h3> <p>Infelizmente, os lançamentos não respondem a todos os usos do compartilhamento de binários; alguns exigem o uso de pacotes. Pacotes, também chamados de dependências, são hoje em dia a maneira moderna de compartilhar bibliotecas entre projetos. Se referenciadas por um projeto, as Dependências são baixadas automaticamente de galerias públicas, como <a href=http://www.nuget.org>www.nuget.org</a> ou <a href=http://www.npmjs.com>www.npmjs.com</a>. Pacotes do GitHub é uma galeria adicional onde você pode armazenar pública ou privadamente suas próprias dependências.</p> <p>Publicaremos um pacote Nuget para projetos escritos na linguagem .NET para cobrir a geração de pacotes via GitHub Actions. Os pacotes de projetos .Net, chamados pacotes NuGet (com uma *.nupkg_extension) e sua publicação requerem duas etapas:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Criar projeto de aplicativo .Net autônomo</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> (Opcional) Criar um arquivo .nuspec, arquivo de metadados contendo informações como o autor do pacote, o editor, licença, versão, etc.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Construir o projeto para gerar uma biblioteca (.dll)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Transformar em um arquivo nuget (*.nupkg)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Carregar o arquivo em uma galeria listando os pacotes nuget</li> </ul> <p>O primeiro passo é criar um projeto .NET. O comando "dotnet new" gera um projeto .Net vazio, mas perfeitamente válido.</p> <p><code>dotnet new console --name DemoNuGet</code></p> <p>A compilação de um projeto .Net normalmente é feita com o comando "dotnet build", mas o comando que permite criar o arquivo Nuget ("dotnet pack") também cuida da compilação, então podemos omitir o primeiro:</p> <p><code>dotnet pack --configuration Release # Creating the package</code></p> <p>O upload do pacote é feito no repositório do seu projeto. No entanto, a ferramenta de gerenciamento de pacotes (nuget.exe no nosso caso) conhece apenas a galeria oficial. Portanto, é necessário declarar outra galeria (chamada source) e fornecer as credenciais para conectar e fazer upload do nosso pacote.</p> <p><code>nuget sources add -name "github" -Source https://nuget.pkg.github.com/OWNER/ index.json -Username USERNAME -Password PASSWORD</code></p> <p>OWNER representa o nome da sua conta ou organização aqui, enquanto USERNAME é o nome do usuário que carrega o pacote. A senha é um PAT (Personal Access Token). É possível criar uma nova ou simplesmente reutilizar a que é injetada automaticamente em cada fluxo de trabalho: GITHUB_TOKEN.</p> <p><code>nuget sources add -name "github" -Source https://nuget.pkg.github.com/60pportunities/ index.json -Username 60pportunities -Password ${{ secrets.GITHUB_TOKEN}}</code></p> <p>Isso tem o efeito de produzir um arquivo de configuração que contém todas as galerias do NuGet, que ele pode acessar para carregar ou baixar pacotes. Por exemplo, aqui está o arquivo após o comando anterior:</p> <div class=highlight><pre><span></span><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;configuration&gt;
&lt;packageSources&gt;
&lt;add key="github" value="https://nuget.pkg.github.com/60pportunities/index.json" protocolVersion="3" /&gt;
&lt;add  key="nuget.org" value="https://api.nuget.org/v3/index.json" protocolVersion="3" /&gt;
&lt;/packageSources&gt;
&lt;/configuration&gt;
</code></pre></div> <p>Por fim, o comando mais importante, "nuget push", permite que você carregue o pacote na galeria Nuget. O comando recebe dois parâmetros: o caminho do arquivo para carregar e onde publicá-lo. Aqui, estamos usando a galeria GitHub declarada anteriormente.</p> <p><code>dotnet nuget push "bin/Release/DemoNuget.1.0.0.nupkg" --source "github"</code></p> <p>O arquivo de fluxo de trabalho completo se parece com isto:</p> <p><div class=highlight><pre><span></span><code>jobs:
build:
runs-on: windows-latest
steps:
- uses: actions/checkout@v4
- name: Creating the NuGet package
   run: dotnet pack --configuration Release
- name: Adding the source
   run: nuget sources add
-name "github" -Source https://nuget.pkg.github.com/ 60pportunities/index.json -Username 60pportunities -Password ${{ secrets.GITHUB_TOKEN }}
- name: Upload package
   run: dotnet nuget push "bin/Release/DemoNuget.1.0.0.nupkg" --source "github"
</code></pre></div> Uma vez que o pacote é publicado, ele fica visível por dois meios. Ou indo para a página inicial da conta e clicando na aba Pacotes que aparece no topo ou na página inicial do repositório de onde ele foi gerado. No lado direito há um link para a página de pacotes</p> <p>Nota: Embora não seja exigido pelo Nuget Standard, os Pacotes do GitHub podem gerar um erro durante o upload do pacote se ele não contiver a propriedade Meta RepositoryURL. Isso pode ser adicionado manualmente ao arquivo .csproj ou .nuspec do seu projeto.</p> <div class=highlight><pre><span></span><code>&lt;PropertyGroup&gt;
&lt;OutputType&gt;Exe&lt;/OutputType&gt;
&lt;TargetFramework&gt;net5.0&lt;/TargetFramework&gt;
&lt;RepositoryUrl&gt;https://github.com/compte-github/name-repo&lt;/RepositoryUrl&gt;
&lt;/PropertyGroup&gt;
</code></pre></div> <p>O procedimento para publicar pacotes JavaScript, Java e Ruby segue o mesmo princípio, usando cada vez a especificidade e a configuração de cada ferramenta de gerenciamento de pacotes (NPM, Maven, Gradle, Ruby, etc.). Seria muito longo cobrir todos eles neste livro. Em vez disso, sua configuração é explicada em detalhes na documentação oficial GitHub Actions.</p> <h3 id=debugging-a-workflow>Debugging a workflow<a class=headerlink href=#debugging-a-workflow title="Permanent link">¶</a></h3> <p>Apesar da experiência adquirida por meio da escrita de fluxos de trabalho, pode ocorrer o dia em que um dos seus fluxos de trabalho não se comportará como esperado, e pode exigir que você execute muitas tentativas e falhas para atingir o resultado desejado.</p> <p>Um dos truques para economizar tempo analisando o problema é ativar o modo de depuração (verbose). Assim, informações de fundo, parâmetros, testes condicionais e muito mais são adicionados aos logs do fluxo de trabalho. A análise do problema é então bastante simplificada.</p> <p>Existem duas configurações para habilitar a depuração:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> ACTIONS_RUNNER_DEBUG: que permite mais informações sobre o executor que executa o fluxo de trabalho</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> ACTIONS_STEP_DEBUG: que fornece mais detalhes sobre as diferentes ações executadas por um fluxo de trabalho</li> </ul> <p>Para ativá-los, basta criar um segredo nas Configurações do repositório e ter um valor de true: Ao executar o fluxo de trabalho, os logs devem ser enriquecidos com detalhes adicionais:</p> <h3 id=logs-enriquecidos>Logs enriquecidos<a class=headerlink href=#logs-enriquecidos title="Permanent link">¶</a></h3> <p>Uma solução fácil para habilitar a depuração apenas durante uma execução é esperar que um fluxo de trabalho falhe e usar o botão Re-run que habilitará a depuração apenas durante a próxima execução. Para fazer isso, marque Habilitar registro de depuração</p> <h3 id=conexao-direta-com-o-executor>Conexão direta com o executor<a class=headerlink href=#conexao-direta-com-o-executor title="Permanent link">¶</a></h3> <p>Se habilitar a verbosidade permitir algumas informações adicionais, há casos em que o que acontece no agente e especialmente na árvore de arquivos é uma caixa preta; mas é precisamente fácil ter problemas de caminho de arquivo e outros erros de um shell de configuração simples.</p> <p>A depuração passo a passo por meio de várias execuções de fluxo de trabalho pode se tornar longa e dolorosa antes de encontrar a origem do problema.</p> <p>A solução mais simples seria conectar-se diretamente na máquina virtual que executa o fluxo de trabalho para ver o que acontece, mas como os agentes do host são gerenciados pelo GitHub e em uma rede particionada, é mais complicado do que parece. No entanto, existe uma solução simples e elegante, o Tmate (<a href=http://www.tmate.io>www.tmate.io</a>). O Tmate é um produto gratuito que permite que você se conecte a uma máquina remota sem acessar um site que serve como proxy. É ainda melhor conectar-se a uma máquina e executar comandos diretamente por meio de uma página da Web sem instalar ferramentas.</p> <p>Tudo passa pelo uso da ação mxschmitt/action-tmate. Basta adicionar a etapa ao fluxo de trabalho onde você deseja que o fluxo de trabalho pause e permita que você se conecte.</p> <p><code>- uses: mxschmitt/action-tmate@v3</code></p> <p>Ao executar o fluxo de trabalho, dentro dos logs, o TMATE adicionará regularmente duas maneiras de se conectar. Uma para se conectar diretamente com SSH (funciona de qualquer console de terminal capaz de usar SSH) e outra de um site.</p> <p>Se você abrir a URL exibida, uma página da Web contendo um terminal será aberta. Este terminal está sendo executado em seu agente e agora você pode interagir diretamente com ele.</p> <p>Observe que quando você está conectado em SSH, o Tmate bloqueia o fluxo de trabalho e o impede de continuar. Então, pare a sessão e peça para o fluxo de trabalho continuar, volte para o diretório de trabalho do runner e crie um arquivo vazio chamado "continue".</p> <p><code>touch continue</code></p> <p>Depois que o arquivo é criado, o Tmate para e retorna o controle ao fluxo de trabalho para permitir que ele continue sua execução.</p> <p>Também é possível dizer ao Tmate para parar automaticamente após X minutos com a propriedade timeout-minutes. Se nenhum atraso for especificado, será o tempo máximo de execução de um fluxo de trabalho do GitHub. Ainda assim, seu fluxo de trabalho será "morto" pelo GitHub antes de terminar sua execução se outras etapas forem declaradas após o TMATE.</p> <div class=highlight><pre><span></span><code>- uses: mxschmitt/action-tmate@v3
   timeout-minutes: 5 # maximum delay before TMATE turns off itself
</code></pre></div> <p>Gosto especialmente de adicioná-lo como a última etapa, mas somente acionado quando ocorre um problema:</p> <div class=highlight><pre><span></span><code>- name: Setup tmate session
if: ${{failure() }}
uses: mxschmitt/action-tmate@v3
</code></pre></div> <p>Esta dica deve ajudar você a depurar seus fluxos de trabalho mais facilmente.</p> <p>Há também uma solução alternativa que permite que você execute os fluxos de trabalho do GitHub diretamente no seu computador e sem instalar um agente. Isso requer a ferramenta "Act", que pode ser encontrada no GitHub (<a href=https://github.com/nektos/act>https://github.com/nektos/act</a>).</p> <p>Apesar de algumas limitações, o Act analisa os arquivos YAML e tenta reproduzir o comportamento de um runner. Seu uso não é abordado neste livro, mas adiciona uma corda ao seu arco.</p> <p>No GitHub Actions, o tempo que os logs e artefatos ficam armazenados por padrão depende do tipo de item e do plano de conta que você está utilizando.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Logs: Armazenamento: Os logs de execução dos jobs (logs de cada execução de um fluxo de trabalho) são armazenados pelo GitHub por 90 dias.</li> </ul> <p>Acessibilidade: Você pode acessar os logs de execução de qualquer job ou execução do fluxo de trabalho enquanto os logs estiverem dentro desse período de retenção. Após esse período, os logs são excluídos automaticamente.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Artefatos: Armazenamento: Os artefatos (arquivos gerados durante o fluxo de trabalho, como binários, logs ou pacotes de build) têm uma retenção padrão de 90 dias.</li> </ul> <p>Acessibilidade: Assim como os logs, os artefatos podem ser acessados e baixados enquanto estiverem dentro do período de retenção de 90 dias. Após esse período, eles são automaticamente excluídos.</p> <p>Limitação de Tamanho: Além disso, há uma limitação de tamanho para artefatos individuais (50 GB por artefato), e um máximo de 100 GB no total por conta para artefatos armazenados.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Exceções e Personalizações: Alterar o Tempo de Retenção de Artefatos: Você pode personalizar a retenção dos artefatos usando a opção retention-days no arquivo de workflow. Isso permite definir um tempo de retenção menor ou maior, mas não pode exceder 90 dias.</li> </ul> <h2 id=improve-the-performance-of-your-workflows>Improve the performance of your workflows<a class=headerlink href=#improve-the-performance-of-your-workflows title="Permanent link">¶</a></h2> <p>Se você leu este livro, entendeu que a automação de tarefas e evitar erros humanos durante projetos de computador permite uma economia de tempo significativa porque uma máquina sempre será rápida como um humano e permitirá que ele se concentre em outras tarefas durante esse tempo. No entanto, também é importante que as tarefas automatizadas sejam executadas o mais rápido possível. Tomemos o exemplo de um fluxo de trabalho de compilação e implantação. Este desenvolvedor cria um aplicativo deve esperar que o fluxo de trabalho seja concluído para validar se seu desenvolvimento é confiável ou não. Um desenvolvedor pode fazer isso cerca de cinquenta vezes por dia nesta operação e representa tanto tempo perdido à toa. Multiplicando esse tempo pelo número de desenvolvedores da equipe, podemos facilmente imaginar as horas perdidas todos os dias.</p> <p>Outro ponto importante, dependendo da sua conta do GitHub, o custo do final do mês depende do tempo de execução dos agentes. Embora o limite seja alto por padrão (2000 minutos por mês para uma conta gratuita), é fácil alcançá-lo. Portanto, é importante acelerar os fluxos de trabalho o máximo possível, e existem vários pontos de melhoria. Abordaremos esses pontos neste capítulo.</p> <h3 id=improving-actions>Improving Actions<a class=headerlink href=#improving-actions title="Permanent link">¶</a></h3> <p>Ações são as bases dos fluxos de trabalho. Existem tantas possibilidades de Ações que não podemos cobrir tudo sobre otimização, mas existem regras gerais para manter seus fluxos de trabalho saudáveis.</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Desabilite (se: ${{ false }}) ou comente ações que não agregam valor ao seu fluxo de trabalho</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Prefira fluxos de trabalho em execução no Linux, a geração da máquina virtual subjacente sendo um pouco mais rápida</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Paralelize etapas por meio de trabalhos ou matrizes quando não tiverem dependências entre si</li> </ul> <p>O último ponto, quando seu fluxo de trabalho requer o download e a instalação de várias ferramentas e/ou utilitários, usar uma ação do Docker pode melhorar muito o tempo de execução do fluxo de trabalho, ainda mais, se a imagem do Docker da Ação foi gerada upstream. Este ponto de desempenho, embelezado com um exemplo factual, é abordado em detalhes no capítulo "Criar uma ação do Docker".</p> <h3 id=improve-the-source-code-checkout>Improve the source code checkout<a class=headerlink href=#improve-the-source-code-checkout title="Permanent link">¶</a></h3> <p>Se for possível fazer coisas infinitas com ações do GitHub. Nesse caso, a maioria dos projetos do GitHub, em algum momento, um fluxo de trabalho usando uma porção de elementos (código-fonte, script, binários) armazenados no repositório. Todos eles usarão a ação checkout que você encontrou várias vezes neste livro:</p> <p><code>- uses: actions/checkout@v4</code></p> <p>Este usado no estado não representa um problema porque ele tem, em sua versão 2.x, otimizado com uma configuração padrão que indica para baixar apenas a versão mais recente do código-fonte do branch padrão (geralmente o branch "main" ou "master") e somente este.</p> <p>No entanto, algumas operações podem exigir o download do histórico de commits para executar algumas operações neles. Isso pode ser feito com o parâmetro fetch-depth:</p> <div class=highlight><pre><span></span><code>- uses: actions/checkout@v4
with:
fetch-depth: 5 # Number of historic versions to download
</code></pre></div> <p>O valor padrão quando o parâmetro está faltando é 1 (fetch-depth: 1). Também é possível (ou você pode encontrar exemplos na Net) definir o valor fetch-depth como 0. Esse valor indica para baixar o histórico inteiro de todos os branches e todas as tags.</p> <div class=highlight><pre><span></span><code>uses: actions/checkout@v4
fetch-depth: 0 # WARNING! Do you really want to do that?
</code></pre></div> <p>O tempo de download pode então ser multiplicado por dez e só aumentará com o tempo. Então, certifique-se de verificar cada um dos seus fluxos de trabalho para usar o parâmetro fetch-depth somente quando realmente necessário.</p> <h3 id=caching-dependencies>Caching dependencies<a class=headerlink href=#caching-dependencies title="Permanent link">¶</a></h3> <p>A grande maioria dos projetos de TI, independentemente da linguagem de programação, usa bibliotecas de terceiros (pacotes nuget, npm, maven, ruby, etc.), representando centenas ou até milhares de arquivos para seu código-fonte no momento da compilação de seu aplicativo. Mesmo para um aplicativo pequeno, baixar essas dependências pode levar vários minutos. A ferramenta que baixa essas dependências (nuget.exe, npm.exe, etc.) é inteligente o suficiente para baixar apenas os arquivos ausentes no computador do desenvolvedor. Assim, se a primeira compilação for longa, a segunda é quase instantânea porque todos os arquivos já estão presentes localmente. Infelizmente, essa solução não funciona para fluxos de trabalho do GitHub porque cada nova execução de fluxo de trabalho é acionada em uma nova máquina virtual.</p> <p>No entanto, o GitHub Actions oferece uma solução elegante para responder a esse problema: um recurso de cache persistente. Essa solução inclui a adição da ação actions/cache dentro do seu fluxo de trabalho que salva e recupera elementos automaticamente de/para um cache persistente localizado nos servidores do GitHub. Essa ação deve ser inserida no início do fluxo de trabalho antes da resolução da dependência. Ele opera da seguinte forma:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Durante a primeira execução do fluxo de trabalho, a ação Cache não encontra um cache que atenda ao critério</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O fluxo de trabalho então baixa as dependências normalmente por meio da ferramenta de resolução de dependência</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> A ação Cache injeta uma etapa no final de um fluxo de trabalho (pós-etapas) que salva os arquivos no cache</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O fluxo de trabalho para</li> </ul> <p>Na próxima execução do fluxo de trabalho:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> A ação Cache encontra um cache que corresponde ao critério. Ele baixa o cache localmente e o coloca na pasta de destino</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> A ação cache define uma variável "cache-hit" como true para indicar que um cache foi encontrado</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> A ferramenta de resolução de dependência não precisa baixar arquivos porque eles já estão presentes localmente</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> A ação Cache injeta uma etapa no final do fluxo de trabalho, mas não salva os arquivos no cache porque a variável cache-hit é true. O cache é considerado já atualizado</li> </ul> <p>A implementação é extremamente simples, pois basta colocar a ação no início do fluxo de trabalho, especificar a(s) pasta(s) para fazer backup e dar um nome ao cache.</p> <div class=highlight><pre><span></span><code>uses: actions/cache@v4
with:
path: # folder to back up (e.g., nodes_modules)
key: # cache's name
restore-keys: # (optional) Alternative cache keys
</code></pre></div> <p>Cada propriedade tem uma mecânica própria. Vamos pegar aqui o exemplo de um projeto JavaScript usando NPM (NodeJS Package Manager) Para baixar as dependências necessárias para o projeto colocadas em uma pasta padrão chamada node_modules. A árvore de dependências, representando todos os arquivos para baixar, é gerada pelo NPM em um arquivo chamado package-lock.json.</p> <p>A propriedade path é usada para indicar as pastas (e seu conteúdo) que serão salvas no cache. Ela também é a pasta de destino onde o cache é restaurado. Então, para o nosso exemplo, o valor a ser especificado é a pasta node_modules:</p> <div class=highlight><pre><span></span><code>uses: actions/cache@v4
with:
path: '**/node_modules'
</code></pre></div> <p>A propriedade key indica o nome do cache. A chave com a qual os arquivos serão salvos e a chave com a qual encontraremos nosso cache entre os outros caches do repositório. Este ponto é importante; você pode ter vários caches por projeto, correspondendo para cada um deles, a um fluxo de trabalho específico. Então, para nosso exemplo, podemos chamar o cache de "node-modules", mas como você sabe se o cache corresponde à lista de arquivos listados no arquivo package-lock.json. Se compararmos os arquivos um por um, pode levar anos. A solução é calcular um hash de arquivo e usar esse hash no nome do cache; dessa forma, cada vez que uma dependência é adicionada, removida ou modificada de/para package-lock.json, seu hash muda, e podemos concluir diretamente que o cache contendo outro hash está obsoleto. O resultado então se torna:</p> <div class=highlight><pre><span></span><code>uses: actions/cache@v4
with:
path: **/node_modules'
key: node-modules-${{ hashFiles("**/package-lock.json')}}
#ex:mode-modules-5805ee260f7996bab5bb7c1e4be38d9653dd02417df04f712d68c7364a6daed2
</code></pre></div> <p>Por fim, a propriedade restore-keys, opcional, permite definir chaves alternativas no cache onde um cache não é encontrado. Por exemplo, tome o caso onde um conjunto de cem dependências são armazenadas em cache, se apenas uma dependência for adicionada ao arquivo package-lock.json, o hash será alterado, e o cache será ignorado, causando o download de 101 dependências. É possível indicar a ação para baixar o cache correspondente ao hash. Se o cache não corresponder, diga para ele procurar se existe outro cache quase equivalente (aqui, aquele com as 100 dependências). Dessa forma, a ação baixará o conteúdo do cache secundário (a variável cache-hit permanece falsa porque não é o cache exato desejado), o NPM então baixa a dependência ausente. Por fim, a ação (cache) injetada no final do fluxo de trabalho recria um novo cache contendo 101 dependências, tornando-se o novo cache primário.</p> <div class=highlight><pre><span></span><code>uses: actions/cache@v4
with:
path: **/node_modules'
key: node-modules-${{ hashFiles("**/package-lock.json')}}
restore-keys: nodes-modules-
</code></pre></div> <p>O resultado é claro. Em um projeto pequeno, o ganho já é de 30% do tempo total do fluxo de trabalho. Se o download do cache adicionar um pouco de tempo, é muito mais rápido do que baixar os mesmos arquivos por meio do mecanismo de resolução de dependência:</p> <p>Limitação: O cache é gratuito, mas é limitado a 10 GB por conta para todos os caches salvos. Ao exceder 10 GB, o novo cache (fluxo de trabalho atual) é salvo, mas o cache de dados antigo será excluído para voltar a ficar abaixo de 10 GB. Em paralelo, se um cache não for acessado por 7 dias, o cache será excluído automaticamente.</p> <p>Usamos aqui o exemplo muito comum das dependências, mas esse cache pode servir a muitos outros casos quando a necessidade é reutilizar o mesmo grupo de dados estáticos durante várias execuções de fluxo de trabalho.</p> <h3 id=the-usage-of-matrices>The usage of matrices<a class=headerlink href=#the-usage-of-matrices title="Permanent link">¶</a></h3> <p>No capítulo dedicado às matrizes, abordamos casos de uso para compilar uma versão iOS e uma versão Android em paralelo, mas também exemplos da necessidade de compilar o código-fonte em duas versões (ou mais) de um framework como o NodeJS. Existem muitos outros casos de usos ainda mais comuns para alavancar matrizes, como a realização de testes.</p> <p>Vamos pegar o exemplo de um fluxo de trabalho realizando testes de integração contidos no código-fonte. Em um fluxo de trabalho sendo simplificado aqui, por exemplo, um compila o aplicativo, o implementa, realiza alguns testes de integração e, em seguida, empacota tudo se todos os testes estiverem verdes.</p> <div class=highlight><pre><span></span><code>jobs:
my-project:
runs-on: self-hosted
steps:
- uses: actions/checkout@v4
- name: build
run: # build project
- name: deploy
run: # deploy the app
- name: Run integration tests
run: # run/tests
- name: Create package
run: # generate a zipped release
</code></pre></div> <p>A realização de testes unitários leva dois minutos e parece incompressível, pois é uma tarefa única. No entanto, as matrizes podem ajudar a acelerar a execução dos testes cortando-os por lote. Além disso, adaptando o fluxo de trabalho e distribuindo as tarefas por jobs, é possível "dividir" a parte dos testes unitários. Assim, o próximo novo fluxo de trabalho realizará as mesmas ações, mas com um tempo de execução muito diferente:</p> <div class=highlight><pre><span></span><code>jobs:
build:
runs-on: self-hosted
steps:
run: # build project
- name: deploy
run: # deploy the app
testing:
runs-on: self-hosted
needs: build
strategy:
matrix:
test-path:
- tests/integration/login/
steps:
- tests/integration/orders/
- uses: actions/checkout@v4
- tests/integration/basket/
- name: build
- tests/integration/other/
steps:
- name: Run integration tests
run: # run ${{ matrix.test-path}}''
packing:
runs-on: self-hosted
needs: testing
steps:
- name: Create package
run: #generate a zipped release
</code></pre></div> <p>Essa abordagem, como os processadores multithread, pode cortar uma tarefa em tarefas menores e economizar tempo. O resultado do fluxo de trabalho é o mesmo, mas sua árvore de execução (diagrama) e seu tempo de execução são divididos por quatro com uma etapa de teste paralelizada levando mais de vinte segundos:</p> <h2 id=the-security-within-github-actions>The security within GitHub Actions<a class=headerlink href=#the-security-within-github-actions title="Permanent link">¶</a></h2> <p>Hoje em dia, a segurança é muitas vezes deixada de lado quando considerada uma prioridade, especialmente no mundo da computação. No entanto, as últimas notícias têm mostrado que operações de hacking em larga escala podem ser realizadas comprometendo a cadeia de CI/CD. Ao ter acesso à fábrica de software, os invasores podem acessar o código-fonte do aplicativo e, então, procurar mais facilmente por falhas no software, extrair os segredos/strings de conexão/certificados para obter acesso aos ambientes de produção, mas também injetar malware dentro dos aplicativos e, assim, ter um malware quase indetectável que será então distribuído para outras empresas (por exemplo, o caso da pirataria da SolarWinds descoberta em 2021, mas que teria começado em 2015!).</p> <p>Longe de ser exaustivo, este capítulo tem como objetivo compartilhar as principais boas práticas e os principais erros das pessoas quando usam o GitHub Actions.</p> <h2 id=the-secrets-management>The secrets management<a class=headerlink href=#the-secrets-management title="Permanent link">¶</a></h2> <p>Os "segredos" discutidos aqui se referem a duas coisas que geralmente andam de mãos dadas:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Informações confidenciais (senha, certificado, string de conexão, chave)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Segredos GitHub: a funcionalidade que permite que você armazene essas informações críticas em uma variável segura</li> </ul> <p>A primeira boa prática referente a informações confidenciais é estritamente nunca, de forma alguma, escrever esses dados sensíveis no código-fonte, pela simples razão de que qualquer pessoa com acesso ao seu repositório (seja porque o repositório é público ou acessível por um colaborador) pode recuperar esses dados. Uma vez que o segredo é armazenado no histórico de commits, torna-se difícil apagá-lo. Isso permanece tecnicamente viável com comandos como "git rebase -i", mas pode ter consequências infelizes se outra pessoa já usa a versão atual do código-fonte. No próximo push/merge de um ou outro, podem ocorrer erros. Portanto, prefira a vigilância ou crie o hábito de nunca escrever um segredo no código-fonte.</p> <p>Como um anjo da guarda, o GitHub protege você escaneando automaticamente o código-fonte de seus repositórios públicos (ou privados com a Enterprise Edition). Ele alerta você por e-mail e pelo portal se encontrar segredos, como chaves para Azure, AWS, Dropbox, MailChimp e muitos outros.</p> <p>Info: A lista completa dos tipos de segredos gerenciados nativamente pelo GitHub pode ser encontrada na página <a href=https://docs.github.com/en/github/administering-a-repository/about-secret-scanning>https://docs.github.com/en/github/administering-a-repository/about-secret-scanning</a></p> <p>Como o repositório é necessariamente público, o dano está feito, e potencialmente piratas podem ter escaneado seu código-fonte; o segredo deve então ser considerado vulnerável e deve ser revogado instantaneamente por você. O tempo de detecção por um serviço de terceiros é em segundos, com os meios que os piratas possuem hoje; uma vez recebido o alerta, a desativação do segredo deve ser uma prioridade absoluta.</p> <p>Seu reflexo deve sempre armazenar dados sensíveis dentro dos segredos do GitHub abordados no capítulo "Segredos do GitHub". Mas eles são 100% confiáveis?</p> <h3 id=the-secrets-flaws>The secrets' flaws<a class=headerlink href=#the-secrets-flaws title="Permanent link">¶</a></h3> <p>Conforme explicado no capítulo dedicado aos segredos, quando o valor do seu segredo pode ser exibido nos logs, o GitHub substitui o valor do "*' e impede de ver seu conteúdo. O comportamento é o seguinte: o GitHub analisa os valores dos segredos no início do fluxo de trabalho e, sempre que o valor corre o risco de aparecer em um log, ele substitui seu valor usando o recurso add-mask:</p> <div class=highlight><pre><span></span><code>- run: echo "${{ secrets.MY_SECRET }}" # affiche
</code></pre></div> <p>Isso também pode causar comportamentos inesperados. Vamos pegar o exemplo de um nome secreto MY_SECRET com um valor de "p@ssword". Se outro comando usar o mesmo valor coincidentemente, ele será ofuscado ao mesmo tempo. Se testarmos o seguinte comando:</p> <div class=highlight><pre><span></span><code>- run: echo "my p@ssword is visible"
</code></pre></div> <p>Será exibida a seguinte mensagem: <code>my *** is visible</code></p> <p>Não é bem o que queremos, mas é inevitável.</p> <p>Em contraste, essa proteção não deve ser considerada suficientemente segura. De fato, uma pessoa com direitos suficientes para modificar o arquivo de fluxo de trabalho usa uma falha para obter o valor. Para isso, basta que ele "corte/edite" o valor para que ele não seja mais estritamente idêntico ao valor do segredo. Um exemplo pode ser injetar um espaço entre cada caractere como no comando a seguir:</p> <div class=highlight><pre><span></span><code>- run: echo "${{ secrets.MY_SECRET }}" | sed 's/./ &amp; /g' # adds a space between each character's secret
</code></pre></div> <p>Isso exibirá a seguinte mensagem no console: <code>p@ssword</code></p> <p>Nosso segredo não é mais tão secreto quanto o esperado. Lembre-se de que seus segredos são transmitidos para seus fluxos de trabalho e utilizáveis por eles, mas, portanto, expostos dentro deles. Este é um ponto de atenção a ter em mente quando você adiciona colaboradores ao seu repositório.</p> <p>A situação é complicada durante solicitações de pull em seu repositório. Qualquer um pode bifurcar seu repositório (claro, os segredos não são copiados), editar um fluxo de trabalho ou criar (ou criar um novo) e fazer uma solicitação de pull em seu repositório. Isso resultará no acionamento do fluxo de trabalho modificado dentro do contexto do seu repositório e dará a ele a possibilidade de roubar seus segredos. Desta vez, a proteção padrão do GitHub é mais consistente porque quando uma solicitação de pull vem de um repositório de terceiros (bifurcação), nenhum dos segredos (exceto GITHUB_TOKEN) é transmitido ao executor. Portanto, se o fluxo de trabalho tentar exibir o valor de um segredo, ele receberá uma mensagem de erro "O segredo XXX não existe".</p> <p>Essa proteção é ideal para a maioria dos casos, mas às vezes pode interferir no que queremos fazer. Então, se você criar um fluxo de trabalho de verificação de qualidade de código que dispara quando uma solicitação de pull é feita, mas precisa de um segredo para se conectar a um serviço de terceiros e executar a varredura, isso não é viável porque o segredo estará vazio, a varredura falhará.</p> <p>Se você realmente precisar disponibilizar um segredo em uma solicitação de pull externa, é possível, mas por sua conta e risco, desabilitando a proteção padrão do GitHub. Para isso, vá para as configurações (Settings) do seu repositório, depois na parte de ações e marque a caixa "Enviar segredos para fluxos de trabalho de solicitações de pull de fork".</p> <p>Compartilhando segredos com solicitações de pull externas</p> <h2 id=securing-self-hosted-agents>Securing self-hosted agents<a class=headerlink href=#securing-self-hosted-agents title="Permanent link">¶</a></h2> <p>Agentes auto-hospedados estão sendo executados em seu ambiente (computador, servidor); este é o primeiro ponto de entrada e ataque para comprometê-lo. Portanto, é essencial nunca definir estritamente um agente auto-hospedado em um repositório público, incluindo se nenhum de seus fluxos de trabalho o usar. Qualquer um pode bifurcar o repositório, criar um fluxo de trabalho que tenha como alvo seu agente auto-hospedado (runs-on: self-hosted) e que contenha um script malicioso ou um vírus e, em seguida, executar uma solicitação de pull em seu repositório. Isso potencialmente executaria o fluxo de trabalho perigoso em seu agente e o usaria como um backdoor.</p> <p>O GitHub desabilita os fluxos de trabalho de bifurcações por padrão para evitar erros humanos, mas você pode ter ativado esse recurso para transmitir segredos, como visto antes.</p> <h3 id=limiting-the-access>Limiting the access<a class=headerlink href=#limiting-the-access title="Permanent link">¶</a></h3> <p>O agente pode ser comprometido de fora e por pessoas com acesso ao repositório, deliberadamente ou porque suas credenciais foram roubadas.</p> <p>Portanto, é essencial considerar seu agente e a máquina em que está instalado como potencialmente vulneráveis. Algumas boas práticas permitem reduzir o risco em tais casos:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Instale o agente com os menores privilégios. Não instale com direitos de administrador; você evitará que ele possa assumir o controle total do servidor em que está localizado</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Limite o acesso à rede desta máquina. Se o agente não tiver motivo para acessar a rede, não permita que ele o faça, e se o acesso a certos recursos precisar ser feito (por exemplo, um servidor de produção, um banco de dados), abra essas rotas de rede exclusivamente.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Não use um agente para vários repositórios (possível com contas do GitHub Enterprise) e não instale vários agentes de vários repositórios na mesma máquina. Existe o risco de "ataque à cadeia de suprimentos" em que, por meio de um repositório corrompido, um fluxo de trabalho pode sair de sua pasta de trabalho e potencialmente acessar/modificar o código-fonte de outro fluxo de trabalho executado por um segundo agente na mesma máquina.</li> </ul> <p>A solução ideal seria implantar agentes em contêineres, mas infelizmente, o GitHub não fornece esses agentes em contêineres. Cabe a você fazer essa tarefa, mas tutoriais podem ser facilmente encontrados online. Fique atento novamente; é melhor ter controle total sobre a imagem de contêiner gerada.</p> <h2 id=using-third-party-actions>Using third-party Actions<a class=headerlink href=#using-third-party-actions title="Permanent link">¶</a></h2> <p>Ações de terceiros são certamente o primeiro ponto de vigilância a ser levado em conta. Uma regra de ouro a ser lembrada é que usar uma ação de terceiros é potencialmente arriscado, incluindo aquelas publicadas no GitHub Marketplace. De fato, o GitHub não inspeciona nem valida o conteúdo das ações publicadas em seu Marketplace, e cada ação é segura apenas pela boa vontade de seu autor. Como no ecossistema Open Source, todos podem contribuir e ver o que os outros fazem, mas infelizmente é impossível assistir a tudo.</p> <p>Além disso, encontrar os aplicativos ou ações do GitHub do Marketplace com um selo "validado" pode ser reconfortante. No entanto, não caia na armadilha. Isso significa apenas que o autor da ação faz parte de uma conta do GitHub (organização) que pertence a uma empresa que validou certos critérios, como suas informações (nome real, endereço real, nome de domínio real). Isso simplesmente garante que é o publicador oficial (ex: Microsoft, Terraform, etc.), mas isso não implica que o conteúdo publicado seja seguro ou à prova de bugs.</p> <p>Sempre inspecione o código-fonte de uma ação que você pretende integrar ao seu fluxo de trabalho. Quanto mais complexo o código-fonte, mais difícil será detectar um comportamento malicioso em potencial que seu autor terá bem escondido. Essa regra é especialmente verdadeira se você usar agentes auto-hospedados, pois você abre a porta para acessar seu servidor ou sua rede.</p> <p>Se um agente executado pelo GitHub executar seu fluxo de trabalho, os riscos serão reduzidos, mas ainda presentes. De fato, vamos pegar o exemplo de uma ação que permite que você publique um aplicativo no servidor de terceiros de um provedor de nuvem (por exemplo, Azure). Essa ação provavelmente solicitará credenciais para se conectar ao servidor remoto. Que garantia você tem de que essa ação não enviará suas credenciais para um servidor desonesto em paralelo? Nenhuma. Pior, a solução para analisar o código-fonte antes de usar uma Ação não é 100% confiável devido à mecânica de atualizações automáticas abordadas no capítulo Crie sua Ação &gt; Controle de versão.</p> <p>Lembre-se, se você quiser declarar em seu fluxo de trabalho para carregar uma Ação "v1", não há garantia de que depois disso o código-fonte da ação que será carregada em seu fluxo de trabalho seja sempre o mesmo, porque o autor pode excluir sua versão "v1", modificar o código-fonte para inserir código malicioso e, em seguida, recriar uma versão "v1". A modificação seria então invisível e indetectável do seu lado.</p> <p>Devemos usar terceiros? A resposta é "sim", mas isso deve ser feito com a maior vigilância possível.</p> <p>Existem vários níveis de confiança em relação a ações de terceiros. Se todas forem permitidas por padrão, é bem possível limitar o acesso apenas a certas ações. Por exemplo, você pode permitir apenas aquelas de repositórios pertencentes a você, aquelas publicadas pelo GitHub (que podem ser consideradas realmente seguras) e aquelas publicadas por editores confiáveis (lembrete para editores aprovados: isso não prova que a ação em si seja confiável).</p> <p>Em relação a outras ações que não se encaixam em nenhuma dessas categorias, seu uso dependerá do seu contexto (particularmente da criticidade do seu projeto). Também é possível limitar os riscos de modificações descontroladas, como explicado acima, usando o hash do commit. Este método é explicado no capítulo "steps" e faz referência a uma versão específica do código. Embora o commit seja imutável, ele garante a recuperação da versão do código-fonte quando o commit foi feito.</p> <p>Somente ações que correspondem a critérios especificados, mais ações definidas em um repositório dentro do Igmorand, podem ser usadas. Para recuperar o commit, uma pequena manipulação é realizada. Primeiro, vá para o repositório Action que você gostaria de usar, depois vá para sua página listando seus lançamentos. Uma vez nesta página, observe um identificador estranho de 7 caracteres na versão em que você está interessado.</p> <p>Esta é uma versão curta do hash do commit vinculado a esta versão. Clique neste número para abrir uma segunda página onde você pode obter a versão completa do hash.</p> <p>Hash completo</p> <p>Então use esse hash para referenciar uma versão bem específica da ação.</p> <p><div class=highlight><pre><span></span><code>- uses: 60pportunities/github-action-hello@7f2e08be313d58f0d0133b76514dda947b4c1f79
  with:
    firstname: 'Louis-Guillaume'
</code></pre></div> Importante: Se antes era possível usar esse hash curto de identificador para referenciar uma Ação, não é mais possível por motivos de segurança, e o GitHub agora autoriza apenas a versão completa do hash. Se você encontrar exemplos usando versões curtas, saiba que elas estão obsoletas.</p> <p>Um pequeno resumo de pontos de vigilância a serem lembrados sobre o uso de Ações de terceiros:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Não confie em nenhuma ação</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Sempre dê uma olhada em seu código-fonte</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Limite o uso de ações de terceiros nos fluxos de trabalho implantados por meio de agentes auto-hospedados</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Se tal uso for necessário, seja ainda mais vigilante</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Prefira o uso do hash para referenciar uma ação, mesmo que isso signifique não obter os patches/evoluções automaticamente</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> O ideal é bifurcar a ação e usar apenas a versão clonada. Certamente, você não terá atualizações, mas terá total controle sobre o código-fonte da ação e, acima de tudo, dificilmente verá a ação desaparecer porque o autor decidiu fazer isso (não subestime).</li> </ul> <h3 id=keep-up-with-the-good-security-practices>Keep up with the good security practices<a class=headerlink href=#keep-up-with-the-good-security-practices title="Permanent link">¶</a></h3> <p>O GitHub Actions evolui dia a dia, e devido à sua complexidade, os possíveis maus usos da solução são numerosos, por isso é impossível listar todos e/ou todos os conhecidos.</p> <p>Quando uma vulnerabilidade é séria o suficiente ou amplamente utilizada (principalmente por ignorância), o GitHub pode desabilitar drasticamente um recurso e substituí-lo por outro. Por exemplo, este foi o caso do uso de hashes de "versões curtas" (risco de colisão) e da desabilitação do set-env para o gerenciamento de variáveis. No entanto, é impossível desativar tudo, e às vezes, o mau uso da funcionalidade causa uma vulnerabilidade.</p> <p>O GitHub atualiza regularmente sua documentação, especialmente quando um ponto de recurso merece atenção, mas não são cobertos todos os riscos associados ao mau uso do produto. Além disso, um bom hábito é a vigilância tecnológica e o aprendizado das boas e más práticas lendo os "Relatórios de Pesquisa de Vulnerabilidade" publicados pelo GitHub no portal dedicado: <a href=https://securitylab.github.com/advisories>https://securitylab.github.com/advisories</a>.</p> <p>Nada como ver os erros dos outros para aprender a não fazer o mesmo.</p> <h2 id=controlling-the-github_tokens-authorizations>Controlling the GITHUB_TOKEN's authorizations<a class=headerlink href=#controlling-the-github_tokens-authorizations title="Permanent link">¶</a></h2> <p>Por padrão, esse token é gerado automaticamente para cada execução de fluxo de trabalho, o que simplifica a autenticação com o GitHub tem os direitos somente leitura' no repositório, o que é bom, mas até 2023, ele tem gravações de 'contribuidor', o que era fácil, mas poderia ser perigoso. É recomendável reduzir os direitos atribuídos ao token (privilégio mínimo) por motivos de segurança. Esse controle pode ser obtido de duas maneiras:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> No nível do repositório, definindo uma configuração padrão</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> No nível de cada fluxo de trabalho</li> </ul> <p>No repositório, por meio do menu Configurações &gt; Ações, você pode especificar que o token tenha apenas direitos de leitura:</p> <p>Dentro de um fluxo de trabalho, isso pode ser definido usando as permissões de atributo no nível do fluxo de trabalho ou para um trabalho específico:</p> <div class=highlight><pre><span></span><code>myjob:
  runs-on: self-hosted
     permissions:
       actions: read
       issues: write # checks: read/write/none
                     # contents: read/write/none
                     # deployments: read/write/none
                     # issues: read/write/none
                     #packages: read/write/none
                     #pull-requests: read/write/none
                     #repository-projects: read/write/none
                     #security-events: read/write/none
                     #statuses: read/write/none
</code></pre></div> <h2 id=stay-protected-against-command-injection>Stay protected against command injection<a class=headerlink href=#stay-protected-against-command-injection title="Permanent link">¶</a></h2> <p>Injeção de comando, é uma reminiscência do princípio de injeção de SQL: envolve enviar a você um texto que será interpretado e executado quando não deveria.</p> <p>Aqui está um exemplo simples de um fluxo de trabalho que é acionado quando alguém cria um Issue no seu repositório e, portanto, pode ser feito por qualquer pessoa sem direitos específicos.</p> <div class=highlight><pre><span></span><code>- name: print title
   run: echo "${{ github.event.issue.title}}"
</code></pre></div> <p>A pessoa cria um Issue com um título específico: Issue with injected command</p> <p>Devido à maneira como a sintaxe ${{}} é expandida antes da execução por um agente (isso significa que as variáveis são substituídas no YAML), isso faz com que o fluxo de trabalho execute o seguinte comando:</p> <div class=highlight><pre><span></span><code>- name: print title
run: echo "$(touch pwned.txt)"
</code></pre></div> <p>Dessa forma, um novo comando é executado pelo seu fluxo de trabalho sem o seu consentimento. Assim, o invasor poderia, como mostrado na captura de tela a seguir, criar um arquivo pwnded.txt, mas potencialmente fazer coisas mais perigosas, como baixar um vírus (se você usar um self-agent) ou exportar segredos acessíveis pelo fluxo de trabalho e enviá-los para um servidor remoto.</p> <p>A solução é usar variáveis intermediárias ao usar uma entrada de fora (parâmetro do fluxo de trabalho, variável de um nome externo (nome do problema, nome da mensagem de confirmação, etc.) dentro do seu fluxo de trabalho.</p> <div class=highlight><pre><span></span><code>- name: print title
env:
TITLE: ${{ github.event.issue.title}}
run: echo "$TITLE"
</code></pre></div> <p>Dessa forma, o comando é "expandido" em uma variável, mas como é uma variável, o comando não será executado na seção de execução.</p> <h1 id=my-real-world-workflows>My Real-World Workflows<a class=headerlink href=#my-real-world-workflows title="Permanent link">¶</a></h1> <p>Nesta última parte, um pouco abrangente, decidi dissecar alguns fluxos de trabalho que uso em meus projetos. Úteis ou não para você, você verá diferentes fluxos de trabalho, diferentes tópicos abordados e a riqueza de possíveis casos de uso.</p> <p>Cada fluxo de trabalho é explicado neste livro, mas você encontrará todos os fluxos de trabalho neste repositório: <a href=https://github.com/60pportunities/book-github-actions-advanced-workflows>https://github.com/60pportunities/book-github-actions-advanced-workflows</a>.</p> <h2 id=powerpoint>PowerPoint<a class=headerlink href=#powerpoint title="Permanent link">¶</a></h2> <p>É comum no meu trabalho fazer apresentações técnicas. Embora eu aprecie o software Microsoft PowerPoint, também gosto da flexibilidade do Markdown, que me permite transformar ou traduzir meu texto rapidamente para vários idiomas antes de gerar uma apresentação.</p> <h2 id=prepare-the-markdown>Prepare the markdown<a class=headerlink href=#prepare-the-markdown title="Permanent link">¶</a></h2> <p>O fluxo de trabalho</p> <p>O fluxo de trabalho é bem simples. Em um runner Linux, basta instalar o Pandoc (<a href=https://github.com/jgm/pandoc>https://github.com/jgm/pandoc</a>) e pedir para ele gerar uma versão do PowerPoint, bem como uma versão HTML dinâmica (que usa o plugin RevealJS (<a href=https://revealjs.com/ >https://revealjs.com/</a>) e então armazenar os arquivos gerados como anexos do fluxo de trabalho.</p> <div class=highlight><pre><span></span><code>jobs:
GenerateFile:
runs-on: self-hosted
steps: # retrieve the markdown content from the repo
- uses: actions/checkout@v4
- run: sudo apt-get update # update the agent's packages
- name: Apt-get update # pandoc will transform the markdown into PowerPoint
- name: install pandoc
   run: sudo apt-get install --assume-yes pandoc # create the PowerPoint
- name: Build PPTX version
   run: pandoc content.md --output=demo.pptx
     working-directory: ./powerpoint # create a dynamic HTML version
- name: Build HTML version
 run: pandoc --to-revealjs --standalone content.md --output-demo.html -V revealjs- url="https://cdn.jsdelivr.net/npm/reveal.js@3.9.2"
 working-directory: ./powerpoint # Upload a zip to easily retrieve it
- name: Upload a Build Artifact
  uses: actions/upload-artifact@v4
  with:
    name: Generated documents
    retention-days: 1
    path: |
           ./powerpoint/*

working-directory: ./powerpoint
</code></pre></div> <p>Upon execution, a zip containing your two presentations is published:</p> <h2 id=points-of-attention>Points of Attention<a class=headerlink href=#points-of-attention title="Permanent link">¶</a></h2> <p>Observe o parâmetro -assume-yes que diz à linha de comando apt-get para sempre aceitar se uma pergunta for feita ao usuário que está executando o comando. O agente não é "interativo" e, portanto, você deve sempre pensar em passar parâmetros que evitem qualquer interação com o usuário (por exemplo, pedir uma senha, confirmar uma ação, etc.).</p> <p>O segundo ponto é "retention-days" definido como 1. No GitHub, o armazenamento não é ilimitado nem gratuito. Não há sentido em manter artefatos por muito tempo. Neste caso específico, quero meu PowerPoint hoje, não em dez dias.</p> <h2 id=book-generation>Book Generation<a class=headerlink href=#book-generation title="Permanent link">¶</a></h2> <p>Como vimos anteriormente no livro, embora seja publicado em formato de papel e e-book, ele é, na verdade, inteiramente escrito e gerado via GitHub Actions. Aqui está o fluxo de trabalho quase completo e um exemplo de um livro gerado, caso você sinta vontade de escrever um livro ou publicar um e-book.</p> <div class=highlight><pre><span></span><code>name: Generate a book
on:
workflow_dispatch:
jobs:
generating-the-book:
name: Generate the books
runs-on: self-hosted
steps:
- name: Apt-get update
run: sudo apt-get update
- name: install pandoc
- run: |
         wget https://github.com/jgm/pandoc/releases/download/3.3/pandoc-3.3-1-amd64.deb
         sudo dpkg -i pandoc-3.3-1-amd64.deb # to make a PDF I need additional plugins
- name: install pdflatex
run: |
sudo apt-get install texlive-latex-base
sudo apt-get install texlive-fonts-recommended
sudo apt-get install texlive-latex-extra
sudo apt-get install texlive-xetex

- uses: actions/checkout@v4

- name: Create dist folder
   run: mkdir ./book/dist
- #I modify some markdown on the fly
- name: inject date
run: |
today=$(date + "%d-%m-%Y")
echo '' &gt;&gt; 00-01-edition.md
echo '## Edition {.unlisted .unnumbered}' &gt;&gt; 00-01-edition.md
echo '' &gt;&gt; 00-01-edition.md
echo 'Last modification of content' &gt;&gt; 00-01-edition.md
echo $today &gt;&gt; 00-01-edition.md
working-directory: ./book/en
working-directory: ./book/en # I generate an intermediate text version # I prepare a listing that will allow me to give all the files to merge with a single parameter
- name: prepare files to include
- name: Build TXT result EN
run: |
run:
ls *.md &gt;&gt;_includes.txt
cat_includes.txt
working-directory: ./book/en # a PDF version that I send to my printer
- name: Build PDF version EN
toc.txt
pandoc -V documentclass=memoir -s $(cat_includes.txt) -o ../dist/result-en.txt
pandoc -V documentclass-memoir -s $(cat_includes.txt) --toc -o ../dist/result-en-
working-directory: ./book/en # I transform this TXT into Epub
- name: Build EPUB version EN
run: pandoc -V documentclass=memoir -V lang=en --listings --pdf-engine-xelatex --from-markdown-blank_before_header -s $(cat _includes.txt) -o'../dist/Implementing DevSecOps with GitHub Actions.pdf'
run: pandoc -s ../dist/result-en-toc.txt --epub-cover-image-./assets/cover.png epub-metadata=./assets/metadata.xml -o '../dist/Implementing DevSecOps with GitHub
Actions.epub'
working-directory: ./book/en # I can also generate a Word version if I want
- name: Build Word version EN
run: pandoc -s ../dist/result-en.txt -o '../dist/Implementing DevSecOps with GitHub Actions.docx' --reference-doc=../latex/custom-reference.docx --toc
working-directory: ./book/en # I make a zip
- uses: actions/upload-artifact@v4
 with:
name: "Implementing DevSecOps with GitHub Actions - books"
path: book/dist
retention-days: 1
</code></pre></div> <p>Nada muito complicado, são apenas comandos encontrados na documentação do Pandoc. Mas esse fluxo de trabalho é muito útil para mim porque posso rastrear minhas alterações, o que não seria capaz de fazer se tivesse escrito meu livro em um documento do Word. A outra alternativa (LaTex) não me agradou, o Markdown é muito mais simples.</p> <h2 id=documentary-website>Documentary Website<a class=headerlink href=#documentary-website title="Permanent link">¶</a></h2> <p>É comum precisar gerar documentação para vários projetos, e nada supera um site que fornece uma interface gráfica agradável, um mecanismo de busca e/ou vários links. É mais fácil do que um arquivo PDF que todos precisam baixar. Existem diferentes ferramentas para gerar essas documentações, como Docusaurus (<a href=https://docusaurus.io>https://docusaurus.io</a>), MKDocs (<a href=https://www.mkdocs.org/ >https://www.mkdocs.org/</a>) ou Hugo (<a href=https://gohugo.io/ >https://gohugo.io/</a>). Este último é muito leve e contém vários temas muito bons, daí minha escolha preferida.</p> <p>Como bônus, usaremos o GitHub, mais especificamente o GitHub Pages, para hospedar nosso site. Não há necessidade de comprar um servidor de hospedagem, temos um site e uma URL pública.</p> <h2 id=preparing-the-content>Preparing the content<a class=headerlink href=#preparing-the-content title="Permanent link">¶</a></h2> <p>Para isso, nada de mágica, basta seguir a documentação do Hugo (<a href=https://gohugo.io/content-management/organization/ >https://gohugo.io/content-management/organization/</a>) e organizar as páginas do site seguindo uma estrutura:</p> <div class=highlight><pre><span></span><code>content/
blog/
- hugo-is-cool/
- images/
- funnier-cat.jpg
-funny-cat.jpg
cats-info.md
index.md
posts/
post1.md
- post2.md
1-landscape.jpg
- 2-sunset.jpg
_index.md
content-1.md
content-2.md
1-logo.png _index.md
name: Build Hugo site
runs-on: ubuntu-22.04
steps: # installation of the CLI tool
- name: Setup Hugo CLI
run:
wget -O ${{ runner.temp }}/hugo.deb https://github.com/gohugoio/hugo/releases/ download/v0.125.6/hugo_0.125.6_linux-amd64.deb
sudo dpkg -i ${{ runner.temp }}/hugo.deb
Le workflow
jobs:
build-hugo: # installation of prerequisites. Sass allows generating CSS files
- name: Setup Dart Sass
run: sudo snap install dart-sass # we take the content of our site
- name: Checkout
uses: actions/checkout@v4.1.1
with:
submodules: recursive
fetch-depth: 0 # we activate GitHub Pages to host our website
- name: Setup Pages
id: pages
uses: actions/configure-pages@v5.0.0
env: # For maximum backward compatibility with Hugo modules, we put the two possible
variables
HUGO_ENVIRONMENT: production
HUGO_ENV: production
run:
hugo\
--gc\
--minify\
--baseURL"${{ steps.pages.outputs.base_url}}/" # we build the website from our markdown
- name: Build with Hugo
working-directory: website
deploy:
environment:
name: github-pages
&gt;
</code></pre></div> <p>url: ${{ steps.deployment.outputs.page_url}} runs-on: self-hosted needs: build-hugo steps: - name: Deploy to GitHub Pages id: deployment uses: actions/deploy-pages@v4</p> <h2 id=points-of-attention_1>Points of Attention<a class=headerlink href=#points-of-attention_1 title="Permanent link">¶</a></h2> <p>Não foi necessário criar dois jobs, pois eles são sequenciais, no entanto, isso torna a renderização gráfica no portal e a legibilidade do código mais fáceis. Além disso, força o isolamento de etapas principais em um fluxo de trabalho e permite mais flexibilidade em caso de evolução futura (ou divisão).</p> <h2 id=devsecops>DevSecOps<a class=headerlink href=#devsecops title="Permanent link">¶</a></h2> <p>A segurança do projeto começa na estação de trabalho do desenvolvedor, e há uma infinidade de ferramentas de segurança disponíveis. Quando você é um DevOps experiente, você quer ser capaz de implantar na produção com confiança executando uma série de testes que permitirão ou impedirão a implantação na produção.</p> <p>Como os aplicativos vêm em diferentes formatos (por exemplo, móvel, web, desktop, conteinerizado), você pode precisar implementar diferentes tipos de controles - e até mesmo diferentes tipos de ferramentas para proteger cada componente do seu aplicativo. Vamos dar uma olhada nos principais tipos de testes que você deve usar. Aqui estão os principais tipos:</p> <h3 id=static-application-security-testing>STATIC APPLICATION SECURITY TESTING<a class=headerlink href=#static-application-security-testing title="Permanent link">¶</a></h3> <p>Ferramentas de Static Application Security Testing (SAST) analisam o código-fonte de um aplicativo (o código escrito por seus desenvolvedores) para detectar vulnerabilidades potenciais sem executar o programa. Ao analisar a base de código durante a fase de desenvolvimento, o SAST fornece aos desenvolvedores informações sobre falhas de segurança e erros de codificação. Uma boa ferramenta SAST pode detectar odores de código, bem como quaisquer práticas ruins que possam levar a vulnerabilidades, como SQL ou injeção de caminho, estouro de buffer, XSS e validação de entrada.</p> <h3 id=software-composition-analysis>SOFTWARE COMPOSITION ANALYSIS<a class=headerlink href=#software-composition-analysis title="Permanent link">¶</a></h3> <p>A Análise de Composição de Software (SCA) é essencial para identificar e gerenciar riscos de segurança associados a componentes de código aberto usados no desenvolvimento de software, normalmente de pacotes adicionais (por exemplo, pacotes NPM para JavaScript, NuGet para .NET, Maven, gems). A maioria dos desenvolvedores carrega um pacote quando precisa, mas nunca verifica se o pacote tem uma vulnerabilidade conhecida. Uma ferramenta SCA alertará você quando seu aplicativo usar um pacote vulnerável e quando uma correção já existir, mas você não estiver usando a versão corrigida da dependência.</p> <h3 id=dynamic-application-security-testing>DYNAMIC APPLICATION SECURITY TESTING<a class=headerlink href=#dynamic-application-security-testing title="Permanent link">¶</a></h3> <p>As ferramentas Dynamic Application Security Testing (DAST) avaliam os aplicativos em seu estado de execução, simulando ataques reais para identificar vulnerabilidades. Ao integrar o DAST ao processo de teste, as equipes de DevSecOps podem descobrir fraquezas de segurança que podem não ser aparentes durante a análise estática. Uma ferramenta DAST atua como uma ferramenta de teste de penetração totalmente automatizada que testará as principais vulnerabilidades conhecidas (OWASP) e muitas outras práticas ruins, como vazamento/exposição de informações.</p> <h3 id=interactive-application-security-testing>INTERACTIVE APPLICATION SECURITY TESTING<a class=headerlink href=#interactive-application-security-testing title="Permanent link">¶</a></h3> <p>As ferramentas Interactive Application Security Testing (IAST) são uma combinação de uma ferramenta DAST e uma ferramenta SAST porque, ao permitir acesso ao código-fonte ("caixa cinza"), elas ajudam o DAST a ter um melhor desempenho, mas também limitam o número de falsos positivos. O IAST é superefetivo, mas mais difícil de configurar, pois tende a testar cada aplicativo profundamente.</p> <h3 id=container-scanner>CONTAINER SCANNER<a class=headerlink href=#container-scanner title="Permanent link">¶</a></h3> <p>Os contêineres oferecem agilidade e escalabilidade, mas também apresentam desafios de segurança exclusivos. Por exemplo, se seu aplicativo for conteinerizado, você precisa implementar controles adicionais. Primeiramente, os scanners examinarão seu Dockerfile para verificar se a imagem base contém vulnerabilidades conhecidas e também procurarão por práticas ruins, como executar como root, usar a tag "latest" ou expor portas perigosas. O exemplo de Dockerfile a seguir contém pelo menos três práticas ruins e pode haver uma vulnerabilidade na imagem base do Node.js:</p> <div class=highlight><pre><span></span><code>FROM node:latest
WORKDIR /usr/src/app
COPY package*.json
RUN npm install
COPY..
EXPOSE 3000 22
HEALTHCHECK CMD Curl --fail https://localhost:3000 | exit 1
CMD ["node","app.js"]
</code></pre></div> <h3 id=infrastructure-as-code-scanner>INFRASTRUCTURE-AS-CODE SCANNER<a class=headerlink href=#infrastructure-as-code-scanner title="Permanent link">¶</a></h3> <p>A infraestrutura como código (IaC) permite que as organizações gerenciem e provisionem infraestrutura por meio de código, trazendo os benefícios do controle de versão e automação para a camada de infraestrutura. A varredura de IaC garante que o código de infraestrutura passe por rigorosas verificações de segurança, como validação de configuração, adesão às melhores práticas, detecção de configurações incorretas de segurança e aplicação de políticas de segurança durante todo o processo de implantação da infraestrutura.</p> <h3 id=secrets-scanner>SECRETS SCANNER<a class=headerlink href=#secrets-scanner title="Permanent link">¶</a></h3> <p>Um segredo (por exemplo, uma chave de API, uma senha, uma string de conexão para um banco de dados) não deve ser armazenado no código-fonte (hardcoded) ou em um arquivo de configuração armazenado no repositório de código, porque se um hacker obtiver acesso ao código, ele poderá acessar ambientes de produção e/ou outros ambientes críticos. Os scanners de segredos podem detectar mais de 150 tipos de segredos que os desenvolvedores podem deixar no código e, uma vez que um segredo tenha sido armazenado no código (commit), ele deve ser considerado "comprometido" e revogado imediatamente.</p> <p>Depois de ver todas essas ferramentas, vamos configurar um fluxo de trabalho para melhorar a qualidade do que produzimos.</p> <h2 id=the-workflow>The Workflow<a class=headerlink href=#the-workflow title="Permanent link">¶</a></h2> <p>O fluxo de trabalho consiste em várias etapas:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Análise estática, ou seja, todas as verificações que podem ser feitas antes mesmo da compilação (idealmente para serem executadas no momento de uma solicitação de pull): SCA + SAST + linter + credscan</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Compilação e empacotamento</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Implantação no ambiente de teste</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Análise dinâmica (teste de desempenho e teste de penetração): DAST</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Implantação na produção</li> </ul> <p>Observe que o fluxo de trabalho paraleliza as etapas quando possível e, em seguida, adiciona dependências para que todos os testes sejam aprovados antes de passar para a próxima etapa.</p> <div class=highlight><pre><span></span><code>workflow DevSecOps
name: DevSecOps
on:
workflow_dispatch:
jobs:
secrets:
  runs-on: self-hosted
    env:
SPECTRAL_DSN: ${{ secrets.SPECTRAL_DSN}}
steps:
- uses: actions/checkout@v4
- name: scan secrets with Spectral
uses: spectralops/spectral-github-action@v5
with:
spectral-dsn: ${{ env.SPECTRAL_DSN }}
spectral-args: scan --ok --engines iac --include-tags base,azure
IaC:
runs-on: self-hosted
env:
SPECTRAL_DSN: ${{ secrets.SPECTRAL_DSN}}
steps:
- uses: actions/checkout@v4
- name: scan IaC with Spectral
uses: spectralops/spectral-github-action@v5
with:
spectral-dsn: ${{ env.SPECTRAL_DSN}}
spectral-args: scan --ok --engines secrets --include-tags base,audit
SAST:
runs-on: self-hosted
env:
SPECTRAL_DSN: ${{ secrets.SPECTRAL_DSN }}
steps:
- uses: actions/checkout@v4
- uses: bearer/bearer-action@v2
with:
path: "./devsecops/src/frontend"
skip-rule: javascript_lang_dynamic_regex,javascript_lang_logger_leak

SCA:
runs-on: self-hosted
env:
SPECTRAL_DSN: ${{ secrets.SPECTRAL_DSN }}
steps:
- uses: actions/checkout@v4
- name: Setup .NET
uses: actions/setup-dotnet@v4
- name: Restore dependencies
run: dotnet restore ./devsecops/src/frontend/CafeReadConf.sln
- name: dotnet publish
run: dotnet publish -c Release -o ./myapp --property WarningLevel=0
working-directory: ./devsecops/src/frontend

- name: scan SCA with Spectral
uses: spectralops/spectral-github-action@v5
with:
spectral-dsn: ${{ env.SPECTRAL_DSN }}
spectral-args: scan --ok --engines oss --include-tags base,audit
- name: Run Snyk to check for vulnerabilities
uses: snyk/actions/dotnet@master
env:
SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
with:
args:
--sarif-file-output=snyk.sarif --file=./devsecops/src/frontend/CafeReadConf.sln --severity-threshold=medium

- name: Upload result to GitHub Code Scanning
uses: github/codeql-action/upload-sarif@v3
with:
sarif_file: snyk.sarif
Docker:
runs-on: self-hosted
steps:
- uses: actions/checkout@v4
name: hadolint
run: |
echo 'Downloading Hadolint to lint Dockerfile...'
wget https://github.com/hadolint/hadolint/releases/download/v2.12.0/hadolint- Linux-x86_64
chmod +x hadolint-Linux-x86_64
mv hadolint-Linux-x86_64 hadolint
echo 'Start Dockerfile lint...'
./hadolint Dockerfile -f tty &gt; results.txt

echo 'Results:'
cat results.txt
working-directory: ./devsecops/src/frontend

build:
needs: [secrets, SCA, Docker, IaC, SAST]
runs-on: self-hosted
steps:
- uses: actions/checkout@v4
- name: Setup .NET
uses: actions/setup-dotnet@v4
with:
dotnet-version: "8.0.x"
- name: Restore dependencies
run: dotnet restore ./devsecops/src/frontend/CafeReadConf.sln
- name: Build
run: dotnet build --no-restore --configuration Release --property WarningLevel=0
working-directory: ./devsecops/src/frontend
- name: dotnet publish
run: dotnet publish -c Release --property WarningLevel=0
working-directory: ./devsecops/src/frontend
- name: Upload artifact for deployment job
uses: actions/upload-artifact@v4
  with:
    name: .net-app
    path: ./devsecops/src/frontend/bin/Release/net8.0/publish
deployToDev:
 needs: [build]
  runs-on: windows-latest
    environment:
      name: "dev"
      url: ${{ steps.deploy-to-webapp-dev.outputs.webapp-url}}
  steps:
   - name: Download artifact from build job
     uses: actions/download-artifact@v4
     with:
       name: .net-app
   - name: Deploy to Azure Web App
       id: deploy-to-webapp-dev
      uses: azure/webapps-deploy@v2
      with:app-name: "ghactions-dev"
       publish-profile: ${{ secrets. AZUREAPPSERVICE_PUBLISHPROFILE_DEV }}
       package:.
DAST:
  needs: [deployToDev]
  runs-on: self-hosted
steps:
  - uses: actions/checkout@v4
  - name: ZAP Scan
    uses: zaproxy/action-full-scan@v0.8.0
     with:
       token: ${{ secrets.GITHUB_TOKEN }}
       docker_name: "ghcr.io/zaproxy/zaproxy:stable"
       target:https://ghactions-dev-gjbyf4c5hhhzgecw.westeurope-01.azurewebsites.net
        rules_file_name: ".zap/rules.tsv"
        cmd_options: "-a"
LoadTest:
needs: [deployToDev]
runs-on: self-hosted
  steps:
  - uses: actions/checkout@v4
  - name: Login to Azure
  uses: azure/login@v1
  continue-on-error: false
   with:
     creds: ${{ secrets. AZURE_CREDENTIALS }}
  - name: "Azure Load Testing"
    uses: azure/load-testing@v1
    with:
    resourceGroup: "rg-book-gha"
    loadTestConfigFile: "devsecops/.load/loadtest.yaml"
    loadTestResource: "loadtestbookgha"
  deployToProd:
    needs: [LoadTest, DAST]
     runs-on: self-hosted
     environment:name: "production"
     url: ${{ steps.deploy-to-webapp.outputs.webapp-url}}
     steps:
     - name: Download artifact from build job
       uses: actions/download-artifact@v4
         with:
           name: .net-app
    - name: Deploy to Azure Web App
       id: deploy-to-webapp
       uses: azure/webapps-deploy@v2
       with:
       app-name: "ghactions-prd"
       publish-profile: ${{ secrets. AZUREAPPSERVICE_PRD}}
       package:.
</code></pre></div> <h2 id=create-a-public-container>Create a Public Container<a class=headerlink href=#create-a-public-container title="Permanent link">¶</a></h2> <p>Às vezes, você precisa distribuir software dentro da sua empresa ou para terceiros. O fluxo de trabalho a seguir usa o exemplo de um Azure Agente de produto DevOps (uma alternativa ao GitHub/Gitlab) e o empacota como um contêiner, publicado na Internet. O fluxo de trabalho a seguir faz várias coisas:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Executa análise DevSecOps para verificar vulnerabilidades de segurança</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Compila e empacota vários contêineres em várias plataformas (Windows e Linux)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Produz manifestos de implantação (HELM Chart dedicado à implantação em um cluster Kubernetes)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Gera um site de documentação</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Executa testes de integração</li> </ul> <h2 id=the-workflow_1>The Workflow<a class=headerlink href=#the-workflow_1 title="Permanent link">¶</a></h2> <p>Este fluxo de trabalho tem quase 900 linhas, então cobriremos apenas certos detalhes e a apresentação das etapas. O código-fonte inteiro pode ser encontrado aqui: <a href=https://github.com/clemlesne/blue-agent/blob/main/.github/workflows/pipeline.yaml>https://github.com/clemlesne/blue-agent/blob/main/.github/workflows/pipeline.yaml</a></p> <p>Dica: para vê-lo em execução completa, recomendo que você o analise diretamente no repositório dedicado: <a href=https://github.com/clemlesne/blue-agent/actions/ >https://github.com/clemlesne/blue-agent/actions/</a>.</p> <p>A primeira etapa (Inicializar) consiste em criar variáveis de ambiente (notavelmente versão e ramificação) que serão usadas posteriormente para marcar os contêineres.</p> <p>Em seguida, três etapas de análise estática são executadas: SAST - Credenciais que verifica se uma senha foi esquecida no código, Semgrep estático que analisará a qualidade do código e, finalmente, Teste estático que executará uma análise do arquivo Docker, uma análise de conformidade do código (legibilidade) e também simulará uma implantação de infraestrutura no Azure. Três ações ocultas em um Makefile:</p> <div class=highlight><pre><span></span><code>test:
Build Helm chart
40s.
@echo' Running Prettier" npx --yes prettier@2.8.8 --editorconfig --check.'
@echo "Running Hadolint"
find. -name "Dockerfile*" -exec bash -c "echo 'File {}:' &amp;&amp; hadolint {}" \;
</code></pre></div> <div class=highlight><pre><span></span><code>@echo " Running Azure Bicep Validate"
az deployment sub validate\
--location francecentral \
--parameters container/test/bicep/example.json \
--template-file container/src/bicep/main.bicep \
--verbose \
--name lgmorandgha
</code></pre></div> <p>Em seguida vem a parte técnica onde para cada distribuição (sistema operacional), um Dockerfile dedicado é executado, etiquetado, assinado e verificado novamente com uma ferramenta DevSecOps (Snyk). Assim, usando matrizes, o fluxo de trabalho publica 7 versões diferentes em paralelo com um único fluxo de trabalho:</p> <div class=highlight><pre><span></span><code>build-release-linux:
name: Build &amp; release image (Linux ${{ matrix.os }})
needs:
 - init
 - sast-creds
 - sast-semgrep
runs-on: ubuntu-24.04
strategy:
fail-fast: false
matrix:
include:
- os: bookworm
arch: linux/amd64,linux/arm64
- os: bullseye
#steps to build the container image
arch: linux/amd64,linux/arm64
- os: focal
arch: linux/amd64,linux/arm64
os: jammy
arch: linux/amd64,linux/arm64
- os: noble
arch: linux/amd64
- os: ubi8
arch: linux/amd64,linux/arm64
- os: ubi9
arch: linux/amd64,linux/arm64
steps:
</code></pre></div> <p>Então vêm os passos finais:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> publicar e atualizar o Docker Hub</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> publicar um Helm chart que facilitará a implantação de artefatos em clusters Kubernetes</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> atualizar e publicar um site de documentação</li> </ul> <p>Este fluxo de trabalho é interessante porque representa excelência quando você quer publicar um componente open-source, garantindo a segurança dos componentes, documentação atualizada e também considerando a experiência do usuário com facilidades de implantação (aqui uma imagem de contêiner e um manifesto Helm opcional).</p> <h2 id=conclusao>Conclusão<a class=headerlink href=#conclusao title="Permanent link">¶</a></h2> <p>É com estas palavras que este livro termina. Espero que através dos capítulos e principalmente dos exercícios, você tenha conseguido descobrir e até mesmo apreciar a facilidade com que é possível construir coisas usando GitHub Actions. Este livro é apenas uma grande introdução às possibilidades que eles trazem, e certamente virão para enriquecer e se tornar um jogador-chave no cenário DevOps.</p> <p>Ao ler o livro, sinta-se à vontade para olhar os apêndices, que contêm diferentes recursos que considerei apropriado reunir. Além disso, se você encontrar algum erro no livro ou quiser trocar comigo, me fazer uma pergunta ou qualquer coisa, escreva um e-mail para <a href=mailto:book@morand.me>book@morand.me</a>.</p> <p>Desejo que você se divirta brincando com essas Ações e espero que você automatize com sucesso todos os tipos de tarefas ou coisas.</p> <h2 id=usando-hashicorp-vault-no-github>Usando HashiCorp Vault no GitHub<a class=headerlink href=#usando-hashicorp-vault-no-github title="Permanent link">¶</a></h2> <p>Poderíamos ter usado o <strong>Azure Key Vault</strong>, mas o que queremos é demonstrar o uso do OpenID Connect (OIDC). Ao <strong>centralizar a configuração e o acesso aos segredos</strong>, você aprenderá a estabelecer um fluxo de trabalho seguro e eficiente para gerenciar informações confidenciais. OIDC é um padrão aberto para autenticação e autorização seguras e padronizadas de usuários. Ao confiar em provedores de identidade bem estabelecidos, como Auth0, Okta,GitHub, Google ou Microsoft Entra ID (antigo Azure Active Directory), o OIDC permite que aplicativos clientes autentiquem usuários sem a necessidade de gerenciar credenciais de usuário diretamente. O OIDC tem alguns componentes para você se familiarizar:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <strong>Aplicativo cliente</strong>: Aplicativo inicia o processo de autenticação e interage com o provedor de identidade;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <strong>Provedor de identidade</strong>: Um serviço confiável que autentica usuários e fornece informações relacionadas à identidade para aplicativos clientes;</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <strong>Servidor de autorização</strong>: O servidor manipula solicitações de autenticação e autorização de aplicativos clientes.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <strong>Token de identidade</strong>: Um JSON Web Token (JWT) que contém declarações de identidade sobre o usuário autenticado.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <strong>Token de acesso</strong>: Um token que autoriza aplicativos clientes a acessar recursos protegidos em nome do usuário autenticado.</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> <strong>Escopo</strong>: Quando um aplicativo cliente solicita autenticação usando OIDC, ele pode especificar o escopo de acesso desejado para o usuário autenticado.</li> </ul> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=80% href=../img/github_oidc.png><img alt src=../img/github_oidc.png></a></p> <p>Observação: Ao integrar o OIDC com o GitHub Actions, você pode aproveitar os mecanismos de autenticação fornecidos por provedores de identidade confiáveis JWKS é uma maneira padronizada de representar um conjunto de chaves criptográficas em um formato JSON.</p> <p><a href="https://github.com/60pportunities/book-github-actions-content?tab=readme-ov-file">https://github.com/60pportunities/book-github-actions-content?tab=readme-ov-file</a></p> <h2 id=apendices>Apêndices<a class=headerlink href=#apendices title="Permanent link">¶</a></h2> <p>Um máximo de códigos, exemplos, exercícios e Ações construídos dentro deste livro estão disponíveis em acesso aberto para seus repositórios dedicados. Exemplos de código e respostas aos exercícios estão no repositório principal: <a href=https://github.com/60pportunities/book-github-actions-content>https://github.com/60pportunities/book-github-actions-content</a></p> <p>As Ações podem ser encontradas em:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Hello World: <a href=https://github.com/60pportunities/github-action-hello>https://github.com/60pportunities/github-action-hello</a></li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Generate Release: <a href=https://github.com/60pportunities/github-action-generate-relnotes>https://github.com/60pportunities/github-action-generate-relnotes</a></li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Pandoc: <a href=https://github.com/60pportunities/github-action-pandoc>https://github.com/60pportunities/github-action-pandoc</a></li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> CredScanning:<a href=https://github.com/60pportunities/github-action-composite-credscanning>https://github.com/60pportunities/github-action-composite-credscanning</a></li> </ul> <h2 id=recursos-recomendados>Recursos recomendados<a class=headerlink href=#recursos-recomendados title="Permanent link">¶</a></h2> <p>Aqui estão alguns recursos que recomendo para aprofundar o uso do GitHub Actions:</p> <p>A documentação oficial: <a href=https://docs.github.com/en/actions>https://docs.github.com/en/actions</a> • O blog oficial do GitHub: <a href=https://github.blog/ >https://github.blog/</a> - [x] O GitHub Actions Toolkit: <a href=https://github.com/actions/toolkit>https://github.com/actions/toolkit</a> - [x] O action github-script que permite interagir facilmente com o GitHub em qualquer fluxo de trabalho: <a href=https://github.com/actions/github->https://github.com/actions/github-</a> script - [x] O Changelog do GitHub <a href=https://github.blog/changelog/ >https://github.blog/changelog/</a> - [x] Os fóruns do GitHub: <a href=https://github.community>https://github.community</a>, Você encontrará ajuda, mas principalmente muitas informações ou recursos que o GitHub não julgou relevantes para indicar na documentação. - [x] The Awesome List: uma lista de Actions consideradas as mais relevantes ou de melhor qualidade <a href=https://github.com/sdras/awesome-actions>https://github.com/sdras/awesome-actions</a>. Ler o código-fonte deles permitirá que você aprenda muito sobre boas práticas - [x] O blog da equipe de segurança do GitHub: https:// securitylab.github.com/advisories</p> <p>Alguns exemplos muito úteis de fluxos de trabalho para implantar na Nuvem:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Azure: <a href=https://github.com/Azure/actions-workflow-samples>https://github.com/Azure/actions-workflow-samples</a></li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> AWS: <a href=https://github.com/actions/starter-workflows/blob/master/ci/aws.yml>https://github.com/actions/starter-workflows/blob/master/ci/aws.yml</a></li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> GCP: <a href=https://github.com/google-github-actions/setup-gcloud>https://github.com/google-github-actions/setup-gcloud</a></li> </ul> <p>Com o passar dos meses, outros recursos certamente surgirão, e você completará sua própria lista de recursos favoritos.</p> <p>Como criar um runner auto-hospedado dockerizado</p> <p>No capítulo dedicado aos agentes, é abordada a noção de runners auto-hospedados, a capacidade de instalar um agente que roda em um servidor privado em vez do GitHub com o objetivo principal de fornecer funcionalidade adicional ou acessar uma rede privada. Os agentes auto-hospedados são instalados em um servidor no qual os agentes baixam e instalam conforme necessário em ferramentas de terceiros (SDK, tempo de execução, outros). Se um agente estiver vinculado a um único repositório por padrão (exceto com o GitHub Enterprise). Nesse caso, é possível instalar vários agentes gerenciando vários projetos lado a lado no mesmo computador. Além de problemas de segurança, o risco de colisão (aplicativos instalados por cada projeto, incompatíveis entre si) é real. Além disso, os diretórios de trabalho contêm uma cópia do código-fonte baixado e outros elementos que potencialmente contêm dados confidenciais.</p> <p>A resposta para esse problema é executar runners dentro de um contêiner para isolá-los uns dos outros e redefini-los sempre que necessário para fornecer um ambiente de trabalho limpo.</p> <p>A criação de um agente em contêiner é relativamente simples. Sua implementação requer a criação de um contêiner de imagem que baixa automaticamente a versão mais recente do runner, uma ação que você normalmente faz por meio da página Configurações &gt; Ações do seu repositório. Este contêiner então inicia na inicialização, o comando para registrar.</p> <p>O primeiro passo consiste em criar um Dockerfile que cuida da instalação do agente e inicia um script entrypoint.sh:</p> <div class=highlight><pre><span></span><code>FROM ubuntu:20.04                                            # we need a default version
ENV RUNNER_VERSION=2.277.1
RUN useradd -m actions
RUN apt-get -yqq update &amp;&amp; apt-get install -yqq curl ją wget # calls the GitHub api to retrieve the last version
RUN\
COPY entrypoint.sh.
RUN chmod +x entrypoint.sh
LABEL="$(curl -s -X GET 'https://api.github.com/repos/actions/runner/releases/latest' | jq -r '.tag_name')" \
USER actions
ENTRYPOINT ["./entrypoint.sh"]
RUNNER_VERSION=":
="$(echo ${latest_version_label:1})" \
cd /home/actions &amp;&amp; mkdir actions-runner &amp;&amp; cd actions-runner\
&amp;&amp; wget
https://github.com/actions/runner/releases/download/v$
{RUNNER_VERSION}/actions-runner-linux-x64-${RUNNER_VERSION}.tar.gz \
&amp;&amp; tar xzf./actions-runner-linux-x64-${RUNNER_VERSION}.tar.gz
WORKDIR /home/actions/actions-runner
RUN chown -R actions ~actions &amp;&amp; /home/actions/actions-runner/bin/ installdependencies.sh
</code></pre></div> <p>Em seguida, vem o arquivo entrypoint.sh, que é responsável por realizar várias ações:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Autentique-se no GitHub e solicite um novo token de registro. Cada executor requer um token dedicado, e solicitar esse token dinamicamente permite a criação de vários contêineres lado a lado, cada um usando seu próprio token</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Use o arquivo config.sh para registrar-se no repositório GitHub, as variáveis sendo passadas como parâmetros</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> Uma vez que o executor é registrado no GitHub, inicia o executor (será visto como "idle" no GitHub)</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> No final, quando o contêiner estiver fechando, cancela o registro do executor A vida do contêiner é efêmera e não deixaria rastros. É possível criar um novo agente original girando um novo contêiner.</li> </ul> <div class=highlight><pre><span></span><code># set up the starting script
#!/usr/bin/env bash
x
set -eEuo pipefail
GITHUB ACTIONS: A PRACTICAL GUIDE
# retrive a registration token
TOKEN=$(curl -s -X POST -H "authorization: token ${TOKEN}" "https://api.github.com/ repos/${OWNER}/${REPO}/actions/runners/registration-token" | jq -r .token)
cleanup() {
}
./config.sh remove --token "${TOKEN}"
--unattended \
--work_work
#starting
./run.sh
#cleaning
cleanup
# registrering the runner
./config.sh \
--url "https://github.com/${OWNER}/${REPO}" \
--token "${TOKEN}" \
--name "${NAME}" \
</code></pre></div> <p>Agora que todos os elementos estão prontos, você precisa gerar uma imagem de contêiner e publicá-la em qualquer registro docker (ou localmente usando o Docker build). O procedimento é exatamente o mesmo que criar uma Action dockerizada explicada anteriormente neste livro.</p> <p>Código-fonte: Se você estiver procurando por um exemplo pronto para uso e seu fluxo de trabalho para gerar a imagem docker, você pode encontrar um exemplo deste repositório público: <a href=https://github.com/60pportunities/self-hosted-runner-dockerized>https://github.com/60pportunities/self-hosted-runner-dockerized</a>.</p> <p>Depois que sua imagem de contêiner for gerada e disponibilizada em um registro, você precisa criar uma instância do contêiner transmitindo os parâmetros necessários:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> NAME: nome do runner, deve ser exclusivo</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> OWNER: o nome da sua conta do GitHub</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> REPO: o nome do repositório ao qual o runner será vinculado</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> IMAGE: o nome da sua imagem Docker que você acabou de criar</li> <li class=task-list-item><label class=task-list-control><input checked disabled type=checkbox><span class=task-list-indicator></span></label> TOKEN: um Personal Access Token que fornece acesso aos seus repositórios. A criação de um PAT é feita no portal do GitHub clicando em seu perfil e depois em Settings &gt; Developer Settings</li> </ul> <p>O uso dele pode ir além, implantando, por exemplo, instâncias do seu contêiner dentro de um cluster Kubernetes ou uma oferta serverless para contêineres (por exemplo, Azure Container Instance, Cloud Run no GCP, Fargate na AWS). Depende de você, agora você tem mais agilidade do que com um runner instalado diretamente em um servidor.</p> <p>Personal access tokens Tokens de acesso pessoal funcionam como tokens de acesso OAuth comuns. Eles podem ser usados em vez de uma senha para o Git sobre HTTPS, ou podem ser usados para autenticar na API sobre Basic Authentication.</p> <p>Creating a PAT</p> <div class=highlight><pre><span></span><code>docker run --env OWNER={OWNER} --
--env TOKEN={TOKEN} --env NAME={NAME} --
--env
REPO={REPO} {IMAGE}
Here is an example:
docker run --env OWNER=60pportunities --env TOKEN=ghp_mXkDnajJQjM921W1UqfkO --
env NAME=redtower-runner --env REPO-my-repo 60pportunities/self-hosted-runnner
</code></pre></div> <p><a href=https://spacelift.io/blog/ci-cd-pipeline>https://spacelift.io/blog/ci-cd-pipeline</a> <a href=https://spacelift.io/blog/ci-cd-pipeline>https://spacelift.io/blog/ci-cd-pipeline</a> <a href="https://github.com/sottlmarek/DevSecOps?tab=readme-ov-file">https://github.com/sottlmarek/DevSecOps?tab=readme-ov-file</a> <a href="https://app.exampro.co/student/material/gha/6770?autoplay=true">https://app.exampro.co/student/material/gha/6770?autoplay=true</a> <a href=https://docs.edgeimpulse.com/docs/tutorials/lifecycle-management/gitactions-docker>https://docs.edgeimpulse.com/docs/tutorials/lifecycle-management/gitactions-docker</a> <a href="https://davecross.substack.com/p/github-actions-essentials-is-published?utm_campaign=post&utm_medium=web">https://davecross.substack.com/p/github-actions-essentials-is-published?utm_campaign=post&amp;utm_medium=web</a> <a href=https://docs.openedx.org/en/latest/developers/references/developer_guide/testing/github-actions.html>https://docs.openedx.org/en/latest/developers/references/developer_guide/testing/github-actions.html</a> <a href=https://medium.com/@ravipatel.it/key-concepts-of-github-actions-a-guide-from-beginner-to-advanced-abb95c59e0f4>https://medium.com/@ravipatel.it/key-concepts-of-github-actions-a-guide-from-beginner-to-advanced-abb95c59e0f4</a> <a href="https://davecross.substack.com/p/github-actions-essentials-is-published?utm_campaign=post&utm_medium=web">https://davecross.substack.com/p/github-actions-essentials-is-published?utm_campaign=post&amp;utm_medium=web</a></p> <p><a href=https://docs.openedx.org/en/latest/developers/references/developer_guide/testing/github-actions.html>https://docs.openedx.org/en/latest/developers/references/developer_guide/testing/github-actions.html</a></p> <p><a href=https://docs.github.com/pt/actions/about-github-actions/understanding-github-actions>https://docs.github.com/pt/actions/about-github-actions/understanding-github-actions</a> <a href=https://docs.github.com/pt/actions/writing-workflows/quickstart>https://docs.github.com/pt/actions/writing-workflows/quickstart</a></p> <p><a href=https://docs.github.com/en/actions/guides>https://docs.github.com/en/actions/guides</a></p> <p><a href=https://docs.github.com/en/actions/writing-workflows/workflow-syntax-for-github-actions>https://docs.github.com/en/actions/writing-workflows/workflow-syntax-for-github-actions</a></p> <p><a href=https://github.com/marketplace/actions/setup-node-js-environment>https://github.com/marketplace/actions/setup-node-js-environment</a> <a href=https://docs.github.com/pt/actions/learn-github-actions/using-starter-workflows>https://docs.github.com/pt/actions/learn-github-actions/using-starter-workflows</a> <a href=https://docs.github.com/pt/actions/automating-builds-and-tests>https://docs.github.com/pt/actions/automating-builds-and-tests</a> <a href=https://docs.github.com/pt/actions/publishing-packages>https://docs.github.com/pt/actions/publishing-packages</a> <a href=https://docs.github.com/pt/actions/deployment>https://docs.github.com/pt/actions/deployment</a> <a href=https://docs.github.com/pt/actions/managing-issues-and-pull-requests>https://docs.github.com/pt/actions/managing-issues-and-pull-requests</a> <a href=https://docs.github.com/pt/actions/examples>https://docs.github.com/pt/actions/examples</a></p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="13 de abril de 2025 20:35:33"><span class=timeago datetime=2025-04-13T20:35:33-03:00 locale=pt></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="13 de abril de 2025 20:35:33">2025-04-13</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="13 de abril de 2025 20:35:33"><span class=timeago datetime=2025-04-13T20:35:33-03:00 locale=pt></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="13 de abril de 2025 20:35:33">2025-04-13</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Contributors> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"></path></svg> </span> <nav> <a href=mailto:horacio.vasconcellos@gmail.com>horacio.vasconcellos</a> </nav> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright © 2024 Documentação <a href=#__consent>Change cookie settings</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a> </div> <div class=md-social> <a class=md-social__link href=https://github.com/horaciovasconcellos rel=noopener target=_blank title=github.com> <svg viewbox="0 0 496 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </a> <a class=md-social__link href=https://gitlab.com/horaciovasconcellos rel=noopener target=_blank title=gitlab.com> <svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81s-5.7.083-8.4 1.11c-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.1 18.1 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3s9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82"></path></svg> </a> <a class=md-social__link href=https://twitter.com/Horacio_Junior rel=noopener target=_blank title="Horacio.Vasconcellos on Twitter"> <svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"></path></svg> </a> <a class=md-social__link href rel="noopener me" target=_blank title="Horaci.Vasconcellos on Mastodon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.5 102.5 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5m-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path></svg> </a> <a class=md-social__link href=https://gitter.im/squidfunk/mkdocs-material rel=noopener target=_blank title=gitter.im> <svg viewbox="0 0 384 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M66.4 322.5H16V0h50.4zM166.9 76.1h-50.4V512h50.4zm100.6 0h-50.4V512h50.4zM368 76h-50.4v247H368z"></path></svg> </a> <a class=md-social__link href=https://hub.docker.com/u/77678117787 rel=noopener target=_blank title=hub.docker.com> <svg viewbox="0 0 640 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"></path></svg> </a> <a class=md-social__link href=https://www.linkedin.com/in/hor%C3%A1cio-correa-t-de-vasconcellos-j%C3%BAnior-b7788467/ rel=noopener target=_blank title=www.linkedin.com> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg> </a> <a class=md-social__link href=https://www.instagram.com/horacio.vasconcellos/ rel=noopener target=_blank title=www.instagram.com> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141m0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7m146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8m76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8M398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1"></path></svg> </a> <a class=md-social__link href=https://www.facebook.com/horacio.vasconcellos rel=noopener target=_blank title=www.facebook.com> <svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 120 82.7 220.8 194.2 248.5V334.2h-52.8V256h52.8v-33.7c0-87.1 39.4-127.5 125-127.5 16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287v175.9C413.8 494.8 512 386.9 512 256"></path></svg> </a> <a class=md-social__link href=http://60pportunities.com.br rel=noopener target=_blank title=60pportunities.com.br> <svg viewbox="0 0 640 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M180.5 74.262C80.813 74.262 0 155.633 0 256s80.819 181.738 180.5 181.738S361 356.373 361 256 280.191 74.262 180.5 74.262m288.25 10.646c-49.845 0-90.245 76.619-90.245 171.095s40.406 171.1 90.251 171.1 90.251-76.619 90.251-171.1H559c0-94.503-40.4-171.095-90.248-171.095Zm139.506 17.821c-17.526 0-31.735 68.628-31.735 153.274s14.2 153.274 31.735 153.274S640 340.631 640 256c0-84.649-14.215-153.271-31.742-153.271Z"></path></svg> </a> <a class=md-social__link href=https://60pportunities.com.br rel=noopener target=_blank title=60pportunities.com.br> <svg viewbox="0 0 576 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M244 246c-3.2-2-6.3-2.9-10.1-2.9-6.6 0-12.6 3.2-19.3 3.7l1.7 4.9zm135.9 197.9c-19 0-64.1 9.5-79.9 19.8l6.9 45.1c35.7 6.1 70.1 3.6 106-9.8-4.8-10-23.5-55.1-33-55.1M340.8 177c6.6 2.8 11.5 9.2 22.7 22.1 2-1.4 7.5-5.2 7.5-8.6 0-4.9-11.8-13.2-13.2-23 11.2-5.7 25.2-6 37.6-8.9 68.1-16.4 116.3-52.9 146.8-116.7C548.3 29.3 554 16.1 554.6 2l-2 2.6c-28.4 50-33 63.2-81.3 100-31.9 24.4-69.2 40.2-106.6 54.6l-6.3-.3v-21.8c-19.6 1.6-19.7-14.6-31.6-23-18.7 20.6-31.6 40.8-58.9 51.1-12.7 4.8-19.6 10-25.9 21.8 34.9-16.4 91.2-13.5 98.8-10M555.5 0l-.6 1.1-.3.9.6-.6zm-59.2 382.1c-33.9-56.9-75.3-118.4-150-115.5l-.3-6c-1.1-13.5 32.8 3.2 35.1-31l-14.4 7.2c-19.8-45.7-8.6-54.3-65.5-54.3-14.7 0-26.7 1.7-41.4 4.6 2.9 18.6 2.2 36.7-10.9 50.3l19.5 5.5c-1.7 3.2-2.9 6.3-2.9 9.8 0 21 42.8 2.9 42.8 33.6 0 18.4-36.8 60.1-54.9 60.1-8 0-53.7-50-53.4-60.1l.3-4.6 52.3-11.5c13-2.6 12.3-22.7-2.9-22.7-3.7 0-43.1 9.2-49.4 10.6-2-5.2-7.5-14.1-13.8-14.1-3.2 0-6.3 3.2-9.5 4-9.2 2.6-31 2.9-21.5 20.1L15.9 298.5c-5.5 1.1-8.9 6.3-8.9 11.8 0 6 5.5 10.9 11.5 10.9 8 0 131.3-28.4 147.4-32.2 2.6 3.2 4.6 6.3 7.8 8.6 20.1 14.4 59.8 85.9 76.4 85.9 24.1 0 58-22.4 71.3-41.9 3.2-4.3 6.9-7.5 12.4-6.9.6 13.8-31.6 34.2-33 43.7-1.4 10.2-1 35.2-.3 41.1 26.7 8.1 52-3.6 77.9-2.9 4.3-21 10.6-41.9 9.8-63.5l-.3-9.5c-1.4-34.2-10.9-38.5-34.8-58.6-1.1-1.1-2.6-2.6-3.7-4 2.2-1.4 1.1-1 4.6-1.7 88.5 0 56.3 183.6 111.5 229.9 33.1-15 72.5-27.9 103.5-47.2-29-25.6-52.6-45.7-72.7-79.9m-196.2 46.1v27.2l11.8-3.4-2.9-23.8zm-68.7-150.4 24.1 61.2 21-13.8-31.3-50.9zm84.4 154.9 2 12.4c9-1.5 58.4-6.6 58.4-14.1 0-1.4-.6-3.2-.9-4.6-26.8 0-36.9 3.8-59.5 6.3"></path></svg> </a> <a class=md-social__link href=https://www.producthunt.com/@horacio_vasconcellos rel=noopener target=_blank title=www.producthunt.com> <svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M326.3 218.8c0 20.5-16.7 37.2-37.2 37.2h-70.3v-74.4h70.3c20.5 0 37.2 16.7 37.2 37.2M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248m-128.1-37.2c0-47.9-38.9-86.8-86.8-86.8H169.2v248h49.6v-74.4h70.3c47.9 0 86.8-38.9 86.8-86.8"></path></svg> </a> <a class=md-social__link href=https://gitlab.com/horaciovasconcellos rel=noopener target=_blank title=gitlab.com> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1s21.16-47.06 47.06-47.06h47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06S448 171 448 196.9s-21.16 47.06-47.06 47.06h-47.06zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06S309 480 283.1 480s-47.06-21.16-47.06-47.06v-47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06s21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06z"></path></svg> </a> <a class=md-social__link href=http://60pportunities.com.br rel=noopener target=_blank title=60pportunities.com.br> <svg viewbox="0 0 640 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"></path></svg> </a> <a class=md-social__link href rel=noopener target=_blank title> <svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.8l167.6-182.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4"></path></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent hidden id=__consent> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Consentimento</h4> <p>Utilizamos cookies para reconhecer as suas repetidas visitas e preferências, bem como para medir a eficácia da nossa documentação e se os usuários encontre o que eles estão procurando. Com o seu consentimento, você está nos ajudando a melhorar nossa documentação.</p> <input class=md-toggle id=__settings type=checkbox> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input checked name=analytics type=checkbox> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input checked name=github type=checkbox> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"base": "..", "features": ["announce.dismiss", "commit", "content.code.annotation", "content.code.copy", "search.highlight", "search.share", "search.suggest", "version", "content.footnote.tooltips"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../assets/javascripts/bundle.c8b220af.min.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> <script src=../javascripts/tables.js></script> <script src=../javascripts/tablesort.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script><script>document$.subscribe(() => {
            window.update_swagger_ui_iframe_height = function (id) {
                var iFrameID = document.getElementById(id);
                if (iFrameID) {
                    full_height = (iFrameID.contentWindow.document.body.scrollHeight + 80) + "px";
                    iFrameID.height = full_height;
                    iFrameID.style.height = full_height;
                }
            }
        
            let iframe_id_list = []
            var iframes = document.getElementsByClassName("swagger-ui-iframe");
            for (var i = 0; i < iframes.length; i++) { 
                iframe_id_list.push(iframes[i].getAttribute("id"))
            }
        
            let ticking = true;
            
            document.addEventListener('scroll', function(e) {
                if (!ticking) {
                    window.requestAnimationFrame(()=> {
                        let half_vh = window.innerHeight/2;
                        for(var i = 0; i < iframe_id_list.length; i++) {
                            let element = document.getElementById(iframe_id_list[i])
                            if(element==null){
                                return
                            }
                            let diff = element.getBoundingClientRect().top
                            if(element.contentWindow.update_top_val){
                                element.contentWindow.update_top_val(half_vh - diff)
                            }
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("swagger-ui-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script></body> </html>